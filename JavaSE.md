# JavaSE

## åŸºç¡€

### æ•°æ®

#### å˜é‡

|          |    æˆå‘˜å˜é‡    |          å±€éƒ¨å˜é‡          |       é™æ€å˜é‡       |
| :------: | :------------: | :------------------------: | :------------------: |
| å®šä¹‰ä½ç½® | åœ¨ç±»ä¸­ï¼Œæ–¹æ³•å¤– |    æ–¹æ³•ä¸­æˆ–è€…æ–¹æ³•çš„å½¢å‚    |    åœ¨ç±»ä¸­ï¼Œæ–¹æ³•å¤–    |
| åˆå§‹åŒ–å€¼ | æœ‰é»˜è®¤åˆå§‹åŒ–å€¼ | æ— ï¼Œå…ˆå®šä¹‰ï¼Œå¤åˆ¶åæ‰èƒ½ä½¿ç”¨ |    æœ‰é»˜è®¤åˆå§‹åŒ–å€¼    |
| è°ƒç”¨æ–¹æ³• |    å¯¹è±¡è°ƒç”¨    |                            |  å¯¹è±¡è°ƒç”¨ï¼Œç±»åè°ƒç”¨  |
| å­˜å‚¨ä½ç½® |      å †ä¸­      |            æ ˆä¸­            |        æ–¹æ³•åŒº        |
| ç”Ÿå‘½å‘¨æœŸ |  ä¸å¯¹è±¡å…±å­˜äº¡  |        ä¸æ–¹æ³•å…±å­˜äº¡        |      ä¸ç±»å…±å­˜äº¡      |
|   åˆ«å   |    å®ä¾‹å˜é‡    |                            | ç±»å˜é‡ï¼Œé™æ€æˆå‘˜å˜é‡ |

é™æ€å˜é‡åªæœ‰ä¸€ä¸ªï¼ 



***



#### æ•°æ®ç±»å‹

##### åŸºæœ¬æ•°æ®ç±»å‹

Javaè¯­è¨€æä¾›äº†å…«ç§åŸºæœ¬ç±»å‹ã€‚å…­ç§æ•°å­—ç±»å‹ï¼ˆå››ä¸ªæ•´æ•°å‹ï¼Œä¸¤ä¸ªæµ®ç‚¹å‹ï¼‰ï¼Œä¸€ç§å­—ç¬¦ç±»å‹ï¼Œè¿˜æœ‰ä¸€ç§å¸ƒå°”å‹ã€‚

**byteï¼š**

- byte æ•°æ®ç±»å‹æ˜¯8ä½ã€æœ‰ç¬¦å·çš„ï¼Œä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°ï¼›**8ä½ä¸€ä¸ªå­—èŠ‚**
- æœ€å°å€¼æ˜¯ **-128ï¼ˆ-2^7ï¼‰**ï¼›
- æœ€å¤§å€¼æ˜¯ **127ï¼ˆ2^7-1ï¼‰**ï¼›
- é»˜è®¤å€¼æ˜¯ **`0`**ï¼›
- byte ç±»å‹ç”¨åœ¨å¤§å‹æ•°ç»„ä¸­èŠ‚çº¦ç©ºé—´ï¼Œä¸»è¦ä»£æ›¿æ•´æ•°ï¼Œå› ä¸º byte å˜é‡å ç”¨çš„ç©ºé—´åªæœ‰ int ç±»å‹çš„å››åˆ†ä¹‹ä¸€ï¼›
- ä¾‹å­ï¼š`byte a = 100ï¼Œbyte b = -50`

**shortï¼š**

- short æ•°æ®ç±»å‹æ˜¯ 16 ä½ã€æœ‰ç¬¦å·çš„ä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°
- æœ€å°å€¼æ˜¯ **-32768ï¼ˆ-2^15ï¼‰**ï¼›
- æœ€å¤§å€¼æ˜¯ **32767ï¼ˆ2^15 - 1ï¼‰**ï¼›
- Short æ•°æ®ç±»å‹ä¹Ÿå¯ä»¥åƒ byte é‚£æ ·èŠ‚çœç©ºé—´ã€‚ä¸€ä¸ªshortå˜é‡æ˜¯intå‹å˜é‡æ‰€å ç©ºé—´çš„äºŒåˆ†ä¹‹ä¸€ï¼›
- é»˜è®¤å€¼æ˜¯ **`0`**ï¼›
- ä¾‹å­ï¼š`short s = 1000ï¼Œshort r = -20000`

**intï¼š**

- int æ•°æ®ç±»å‹æ˜¯32ä½ã€4å­—èŠ‚ã€æœ‰ç¬¦å·çš„ä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°ï¼›
- æœ€å°å€¼æ˜¯ **-2,147,483,648ï¼ˆ-2^31ï¼‰**ï¼›
- æœ€å¤§å€¼æ˜¯ **2,147,483,647ï¼ˆ2^31 - 1ï¼‰**ï¼›
- ä¸€èˆ¬åœ°æ•´å‹å˜é‡é»˜è®¤ä¸º int ç±»å‹ï¼›
- é»˜è®¤å€¼æ˜¯ **`0`** ï¼›
- ä¾‹å­ï¼š`int a = 100000, int b = -200000`

**longï¼š**

- long æ•°æ®ç±»å‹æ˜¯ 64 ä½ã€æœ‰ç¬¦å·çš„ä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°ï¼›
- æœ€å°å€¼æ˜¯ **-9,223,372,036,854,775,808ï¼ˆ-2^63ï¼‰**ï¼›
- æœ€å¤§å€¼æ˜¯ **9,223,372,036,854,775,807ï¼ˆ2^63 -1ï¼‰**ï¼›
- è¿™ç§ç±»å‹ä¸»è¦ä½¿ç”¨åœ¨éœ€è¦æ¯”è¾ƒå¤§æ•´æ•°çš„ç³»ç»Ÿä¸Šï¼›
- é»˜è®¤å€¼æ˜¯ **` 0L`**
- ä¾‹å­ï¼š `long a = 100000Lï¼ŒLong b = -200000L`
  "L"ç†è®ºä¸Šä¸åˆ†å¤§å°å†™ï¼Œä½†æ˜¯è‹¥å†™æˆ"l"å®¹æ˜“ä¸æ•°å­—"1"æ··æ·†ï¼Œä¸å®¹æ˜“åˆ†è¾©ã€‚æ‰€ä»¥æœ€å¥½å¤§å†™ã€‚

**floatï¼š**

- float æ•°æ®ç±»å‹æ˜¯å•ç²¾åº¦ã€32ä½ã€ç¬¦åˆIEEE 754æ ‡å‡†çš„æµ®ç‚¹æ•°ï¼›
- float åœ¨å‚¨å­˜å¤§å‹æµ®ç‚¹æ•°ç»„çš„æ—¶å€™å¯èŠ‚çœå†…å­˜ç©ºé—´ï¼›
- é»˜è®¤å€¼æ˜¯ **`0.0f`**
- æµ®ç‚¹æ•°ä¸èƒ½ç”¨æ¥è¡¨ç¤ºç²¾ç¡®çš„å€¼ï¼Œå¦‚è´§å¸ï¼›
- ä¾‹å­ï¼š`float f1 = 234.5F`

**doubleï¼š**

- double æ•°æ®ç±»å‹æ˜¯åŒç²¾åº¦ã€64 ä½ã€ç¬¦åˆIEEE 754æ ‡å‡†çš„æµ®ç‚¹æ•°ï¼›
- æµ®ç‚¹æ•°çš„é»˜è®¤ç±»å‹ä¸ºdoubleç±»å‹ï¼›
- doubleç±»å‹åŒæ ·ä¸èƒ½è¡¨ç¤ºç²¾ç¡®çš„å€¼ï¼Œå¦‚è´§å¸ï¼›
- é»˜è®¤å€¼æ˜¯ **`0.0d`**
- ä¾‹å­ï¼š`double d1 = 123.4`

**booleanï¼š**

- booleanæ•°æ®ç±»å‹è¡¨ç¤ºä¸€ä½çš„ä¿¡æ¯ï¼›
- åªæœ‰ä¸¤ä¸ªå–å€¼ï¼štrue å’Œ falseï¼›
- è¿™ç§ç±»å‹åªä½œä¸ºä¸€ç§æ ‡å¿—æ¥è®°å½• true/false æƒ…å†µï¼›
- é»˜è®¤å€¼æ˜¯ **`false`**ï¼›
- ä¾‹å­ï¼š`boolean one = true`

**charï¼š**

- charç±»å‹æ˜¯ä¸€ä¸ªå•ä¸€çš„ 16 ä½ Unicode å­—ç¬¦ï¼›
- æœ€å°å€¼æ˜¯ **`\u0000`**ï¼ˆå³ä¸º0ï¼‰
- æœ€å¤§å€¼æ˜¯ **`\uffff`**ï¼ˆå³ä¸º65,535ï¼‰ï¼›
- char æ•°æ®ç±»å‹å¯ä»¥å‚¨å­˜ä»»ä½•å­—ç¬¦ï¼›
- ä¾‹å­ï¼š`char c = 'A';`   `char c = 'å¼ ';`

```mermaid
graph LR
æ•°æ®èŒƒå›´ä»å°åˆ°å¤§å›¾

A[byte]-->B[short]
C[char]-->D[int]
B-->D
D-->F[long]
F-->G[float]
G-->H[double]
```



***



##### å¼•ç”¨æ•°æ®ç±»å‹

å¼•ç”¨æ•°æ®ç±»å‹ï¼šç±»ï¼Œæ¥å£ï¼Œæ•°ç»„éƒ½æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œåˆå«åŒ…è£…ç±»

åŒ…è£…ç±»çš„ä½œç”¨ï¼š

* åŒ…è£…ç±»ä½œä¸ºç±»é¦–å…ˆæ‹¥æœ‰äº†Objectç±»çš„æ–¹æ³•ã€‚
* åŒ…è£…ç±»ä½œä¸ºå¼•ç”¨ç±»å‹çš„å˜é‡å¯ä»¥å­˜å‚¨nullå€¼ã€‚


```java
åŸºæœ¬æ•°æ®ç±»å‹                åŒ…è£…ç±»ï¼ˆå¼•ç”¨æ•°æ®ç±»å‹ï¼‰
byte                      Byte
short                     Short
int                       Integer(ç‰¹æ®Š)
long                      Long

float                     Float
double                    Double
char                      Character(ç‰¹æ®Š)
boolean                   Boolean
```
Javaä¸ºåŒ…è£…ç±»åšäº†ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½ï¼Œå…·ä½“æ¥çœ‹ç‰¹æ®ŠåŠŸèƒ½ä¸»è¦æœ‰ï¼š

* å¯ä»¥æŠŠåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹çš„å€¼
  1. è°ƒç”¨toString()æ–¹æ³•
  2. è°ƒç”¨Integer.toString(åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼)å¾—åˆ°å­—ç¬¦ä¸²
  3. ç›´æ¥æŠŠåŸºæœ¬æ•°æ®ç±»å‹+ç©ºå­—ç¬¦ä¸²å°±å¾—åˆ°äº†å­—ç¬¦ä¸²ï¼ˆæ¨èä½¿ç”¨ï¼‰

* æŠŠå­—ç¬¦ä¸²ç±»å‹çš„æ•°å€¼è½¬æ¢æˆå¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€‚ï¼ˆ**é‡è¦**ï¼‰

  1. Xxx.parseXxx("å­—ç¬¦ä¸²ç±»å‹çš„æ•°å€¼")  ---->Integer.parseInt(numStr)
  2. Xxx.valueOf("å­—ç¬¦ä¸²ç±»å‹çš„æ•°å€¼")    ---->Integer.valueOf(numStr) ï¼ˆæ¨èä½¿ç”¨ï¼‰

  ```java
  public class PackageClass02 {
      public static void main(String[] args) {
          // 1.æŠŠåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼è½¬æˆå­—ç¬¦ä¸²
          Integer it = 100 ;
          // a.è°ƒç”¨toString()æ–¹æ³•ã€‚
          String itStr = it.toString();
          System.out.println(itStr+1);//1001
          // b.è°ƒç”¨Integer.toString(åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼)å¾—åˆ°å­—ç¬¦ä¸²ã€‚
          String itStr1 = Integer.toString(it);
          System.out.println(itStr1+1);//1001
          // c.ç›´æ¥æŠŠåŸºæœ¬æ•°æ®ç±»å‹+ç©ºå­—ç¬¦ä¸²å°±å¾—åˆ°äº†å­—ç¬¦ä¸²ã€‚
          String itStr2 = it+"";
          System.out.println(itStr2+1);// 1001
  
          // 2.æŠŠå­—ç¬¦ä¸²ç±»å‹çš„æ•°å€¼è½¬æ¢æˆå¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€‚ï¼ˆçœŸçš„å¾ˆæœ‰ç”¨ï¼‰
          String numStr = "23";
          //int numInt = Integer.parseInt(numStr);
          int numInt = Integer.valueOf(numStr);
          System.out.println(numInt+1);//24
  
          String doubleStr = "99.9";
          //double doubleDb = Double.parseDouble(doubleStr);
          double doubleDb = Double.valueOf(doubleStr);
          System.out.println(doubleDb+0.1);//100.0
      }
  }
  ```

  

***



#### è£…ç®±æ‹†ç®±

* **è‡ªåŠ¨è£…ç®±**ï¼šå¯ä»¥ç›´æ¥æŠŠåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼æˆ–è€…å˜é‡èµ‹å€¼ç»™åŒ…è£…ç±»ã€‚
* **è‡ªåŠ¨æ‹†ç®±**ï¼šå¯ä»¥æŠŠåŒ…è£…ç±»çš„å˜é‡ç›´æ¥èµ‹å€¼ç»™åŸºæœ¬æ•°æ®ç±»å‹ã€‚

```java
public class PackegeClass {
    public static void main(String[] args) {
        int a = 12 ;
        Integer a1 = 12 ;  // è‡ªåŠ¨è£…ç®±
        Integer a2 = a ;   // è‡ªåŠ¨è£…ç®±

        double b = 99.9;
        Double b1 = 99.9; // è‡ªåŠ¨è£…ç®±
        Double b2 = b ;   // è‡ªåŠ¨è£…ç®±

        Integer c = 100 ;
        int c1 = c ;      // è‡ªåŠ¨æ‹†ç®±

        int d = 12;
        Integer d1 = null; // å¼•ç”¨æ•°æ®ç±»å‹çš„é»˜è®¤å€¼å¯ä»¥ä¸ºnull
        Integer d2 = 0;

        Integer it = Integer.valueOf(12);  // æ‰‹å·¥è£…ç®±ï¼
        // Integer it1 = new Integer(12); // æ‰‹å·¥è£…ç®±ï¼
        Integer it2 = 12;

        Integer it3 = 111 ;
        int it33 = it3.intValue(); // æ‰‹å·¥æ‹†ç®±
    }
}
```



***



#### ç¼“å­˜æ± 

new Integer(123) ä¸ Integer.valueOf(123) çš„åŒºåˆ«åœ¨äºï¼š

- new Integer(123) : æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼›

- Integer.valueOf(123) : ä¼šä½¿ç”¨ç¼“å­˜æ± ä¸­çš„å¯¹è±¡ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šå–å¾—åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚

  ```java
  Integer x = new Integer(123);
  Integer y = new Integer(123);
  System.out.println(x == y);    // false
  Integer z = Integer.valueOf(123);
  Integer k = Integer.valueOf(123);
  System.out.println(z == k);   // true
  ```

valueOf() æ–¹æ³•çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± ä¸­ï¼Œå¦‚æœåœ¨çš„è¯å°±ç›´æ¥è¿”å›ç¼“å­˜æ± çš„å†…å®¹ã€‚ç¼–è¯‘å™¨ä¼šåœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹è°ƒç”¨ valueOf() æ–¹æ³•ï¼Œå› æ­¤å¤šä¸ªå€¼ç›¸åŒä¸”å€¼åœ¨ç¼“å­˜æ± èŒƒå›´å†…çš„ Integer å®ä¾‹ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥åˆ›å»ºï¼Œé‚£ä¹ˆå°±ä¼šå¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚

åŸºæœ¬ç±»å‹å¯¹åº”çš„ç¼“å­˜æ± å¦‚ä¸‹ï¼š

- boolean values true and false
- all byte values
- short values between -128 and 127
- int values between -128 and 127
- char in the range \u0000 to \u007F

åœ¨ jdk 1.8 æ‰€æœ‰çš„æ•°å€¼ç±»ç¼“å†²æ± ä¸­ï¼ŒInteger çš„ç¼“å­˜æ± IntegerCache å¾ˆç‰¹æ®Šï¼Œè¿™ä¸ªç¼“å†²æ± çš„ä¸‹ç•Œæ˜¯ - 128ï¼Œä¸Šç•Œé»˜è®¤æ˜¯ 127ï¼Œä½†æ˜¯è¿™ä¸ªä¸Šç•Œæ˜¯å¯è°ƒçš„ï¼Œåœ¨å¯åŠ¨ jvm çš„æ—¶å€™ï¼Œé€šè¿‡AutoBoxCacheMax=<size> æ¥æŒ‡å®šè¿™ä¸ªç¼“å†²æ± çš„å¤§å°ï¼Œè¯¥é€‰é¡¹åœ¨ JVM åˆå§‹åŒ–çš„æ—¶å€™ä¼šè®¾å®šä¸€ä¸ªåä¸º java.lang.IntegerCache.high ç³»ç»Ÿå±æ€§ï¼Œç„¶åIntegerCache åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šè¯»å–è¯¥ç³»ç»Ÿå±æ€§æ¥å†³å®šä¸Šç•Œã€‚

```java
Integer x = Integer.valueOf(100);
Integer y = Integer.valueOf(100);
System.out.println(x == y);   // true

Integer x = Integer.valueOf(1000);
Integer y = Integer.valueOf(1000);
System.out.println(x == y);   // false
//å› ä¸ºç¼“å­˜æ± æœ€å¤§127
```



***



#### è¾“å…¥æ•°æ®

è¯­æ³•ï¼š`Scanner sc = new Scanner(System.in);`
	next() : é‡åˆ°äº†ç©ºæ ¼, å°±ä¸å†å½•å…¥æ•°æ®äº† , ç»“æŸæ ‡è®°: ç©ºæ ¼, tabé”®
	nextLine() : å¯ä»¥å°†æ•°æ®å®Œæ•´çš„æ¥æ”¶è¿‡æ¥ , ç»“æŸæ ‡è®°: å›è½¦æ¢è¡Œç¬¦

ä¸€èˆ¬ä½¿ç”¨`sc.nextInt()`æˆ–è€…`sc.nextLine()`æ¥å—æ•´å‹å’Œå­—ç¬¦ä¸²ï¼Œç„¶åè½¬æˆéœ€è¦çš„æ•°æ®ç±»å‹ã€‚

Scannerï¼š`BufferedReader br = new BufferedReader(new InputStreamReader(System.in))`   
printï¼š`PrintStream.write()`

> ä½¿ç”¨å¼•ç”¨æ•°æ®ç±»å‹çš„API

```java
import java.util.Scanner;
public class ScannerDemo {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
    }
}
```



***



#### é¢è¯•é¢˜

* æœ‰äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¼•ç”¨ç±»å‹ï¼Ÿ

  > 1ã€å®ƒå°è£…äº†æ•°æ®å’Œå¤„ç†è¯¥æ•°æ®çš„æ–¹æ³•ï¼Œæ¯”å¦‚Integer.parseInt(String)å°±æ˜¯å°†Stringå­—ç¬¦ç±»å‹æ•°æ®è½¬æ¢ä¸ºIntegeræ•´å‹æ•°æ®ã€‚
  >
  > 2ã€Javaä¸­å¤§éƒ¨åˆ†ç±»å’Œæ–¹æ³•éƒ½æ˜¯é’ˆå¯¹å¼•ç”¨æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬æ³›å‹å’Œé›†åˆã€‚
  >
  > 3ã€å¼•ç”¨ç±»å‹åœ¨å †é‡Œï¼ŒåŸºæœ¬ç±»å‹åœ¨æ ˆé‡Œã€‚æ ˆç©ºé—´å°ä¸”è¿ç»­ï¼Œæ ˆä¸Šçš„æ•°æ®éšæ—¶å°±ä¼šè¢«æ”¶å›

* å¼•ç”¨æ•°æ®ç±»å‹é‚£ä¹ˆå¥½ï¼Œä¸ºä»€ä¹ˆè¿˜ç”¨åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ

  > æ ˆç©ºé—´å°ä¸”è¿ç»­ï¼Œå¾€å¾€ä¼šè¢«æ”¾åœ¨ç¼“å­˜ã€‚å¼•ç”¨ç±»å‹cache missï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰ç‡é«˜ä¸”è¦å¤šä¸€æ¬¡è§£å¼•ç”¨ã€‚å¯¹è±¡è¿˜è¦å†å¤šå‚¨å­˜ä¸€ä¸ªå¯¹è±¡å¤´ï¼Œå¯¹åŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ç©ºé—´æµªè´¹ç‡å¤ªé«˜
  > é€»è¾‘ä¸Šæ¥è®²ï¼Œjavaåªæœ‰åŒ…è£…ç±»å°±å¤Ÿäº†ï¼Œä¸ºäº†è¿è¡Œé€Ÿåº¦ï¼Œéœ€è¦ç”¨åˆ°åŸºæœ¬æ•°æ®ç±»å‹ã€‚ä¼˜å…ˆè€ƒè™‘è¿è¡Œæ•ˆç‡çš„é—®é¢˜ï¼Œæ‰€ä»¥äºŒè€…åŒæ—¶å­˜åœ¨æ˜¯åˆä¹æƒ…ç†çš„ã€‚

* Javaé›†åˆä¸èƒ½å­˜æ”¾åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåªå­˜æ”¾å¯¹è±¡çš„å¼•ç”¨ï¼Ÿ

  > ä¸èƒ½æ”¾åŸºæœ¬æ•°æ®ç±»å‹æ˜¯å› ä¸ºä¸æ˜¯Objectçš„å­ç±»ã€‚æ³›å‹æ€æƒ³ï¼Œå¦‚æœä¸ç”¨æ³›å‹è¦å†™å¾ˆå¤šå‚æ•°ç±»å‹ä¸åŒçš„ä½†åŠŸèƒ½ç›¸åŒçš„å‡½æ•°ï¼ˆæ–¹æ³•é‡è½½ï¼‰

* ==

  > == æ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å…·ä½“çš„å€¼
  > == æ¯”è¾ƒå¼•ç”¨æ•°æ®ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å¯¹è±¡åœ°å€å€¼



****



### æ•°ç»„

#### åˆå§‹åŒ–

æ•°ç»„å°±æ˜¯å­˜å‚¨æ•°æ®é•¿åº¦å›ºå®šçš„å®¹å™¨ï¼Œå­˜å‚¨å¤šä¸ªæ•°æ®çš„**æ•°æ®ç±»å‹è¦ä¸€è‡´**

åˆ›å»ºæ•°ç»„ï¼š

* æ•°æ®ç±»å‹[] æ•°ç»„åï¼š`int[] arr;`  ï¼ˆå¸¸ç”¨ï¼‰
* æ•°æ®ç±»å‹ æ•°ç»„å[]ï¼š`int arr[];`

é™æ€åˆå§‹åŒ–ï¼š

* æ•°æ®ç±»å‹[] æ•°ç»„å = new æ•°æ®ç±»å‹[]{å…ƒç´ 1,å…ƒç´ 2,...}ï¼š`int[] arr = new int[]{11,22,33};`
* æ•°æ®ç±»å‹[] æ•°ç»„å = {å…ƒç´ 1,å…ƒç´ 2,...}ï¼š`int[] arr = {44,55,66};`

åŠ¨æ€åˆå§‹åŒ–

* æ•°æ®ç±»å‹[] æ•°ç»„å = new æ•°æ®ç±»å‹[æ•°ç»„é•¿åº¦]ï¼š`int[] arr = new int[3];`



#### å…ƒç´ è®¿é—®

* **ç´¢å¼•**ï¼šæ¯ä¸€ä¸ªå­˜å‚¨åˆ°æ•°ç»„çš„å…ƒç´ ï¼Œéƒ½ä¼šè‡ªåŠ¨çš„æ‹¥æœ‰ä¸€ä¸ªç¼–å·ï¼Œä»**0**å¼€å§‹ã€‚è¿™ä¸ªè‡ªåŠ¨ç¼–å·ç§°ä¸ºæ•°ç»„ç´¢å¼•(index)ï¼Œå¯ä»¥é€šè¿‡æ•°ç»„çš„ç´¢å¼•è®¿é—®åˆ°æ•°ç»„ä¸­çš„å…ƒç´ ã€‚ 	

* **è®¿é—®æ ¼å¼ï¼š**æ•°ç»„å[ç´¢å¼•]ï¼š`arr[0]`
* **èµ‹å€¼ï¼š**`arr[0] = 10;`



***



#### å†…å­˜åˆ†é…

##### æ¦‚å¿µ

å†…å­˜æ˜¯è®¡ç®—æœºä¸­çš„é‡è¦åŸä»¶ï¼Œä¸´æ—¶å­˜å‚¨åŒºåŸŸï¼Œä½œç”¨æ˜¯è¿è¡Œç¨‹åºã€‚æˆ‘ä»¬ç¼–å†™çš„ç¨‹åºæ˜¯å­˜æ”¾åœ¨ç¡¬ç›˜ä¸­çš„ï¼Œåœ¨ç¡¬ç›˜ä¸­çš„ç¨‹åºæ˜¯ä¸ä¼šè¿è¡Œçš„ã€‚å¿…é¡»æ”¾è¿›å†…å­˜ä¸­æ‰èƒ½è¿è¡Œï¼Œè¿è¡Œå®Œæ¯•åä¼šæ¸…ç©ºå†…å­˜ã€‚ Javaè™šæ‹Ÿæœºè¦è¿è¡Œç¨‹åºï¼Œå¿…é¡»è¦å¯¹å†…å­˜è¿›è¡Œç©ºé—´çš„åˆ†é…å’Œç®¡ç†ã€‚ 

ç›®å‰æˆ‘ä»¬åªéœ€è¦è®°ä½ä¸¤ä¸ªå†…å­˜ï¼Œåˆ†åˆ«æ˜¯ï¼šæ ˆå†…å­˜å’Œå †å†…å­˜

| åŒºåŸŸåç§°   | ä½œç”¨                                                     |
| ---------- | -------------------------------------------------------- |
| å¯„å­˜å™¨     | ç»™CPUä½¿ç”¨ï¼Œå’Œæˆ‘ä»¬å¼€å‘æ— å…³                                |
| æœ¬åœ°æ–¹æ³•æ ˆ | JVMåœ¨ä½¿ç”¨æ“ä½œç³»ç»ŸåŠŸèƒ½çš„æ—¶å€™ä½¿ç”¨ï¼Œå’Œæˆ‘ä»¬å¼€å‘æ— å…³          |
| æ–¹æ³•åŒº     | å­˜å‚¨å¯ä»¥è¿è¡Œçš„classæ–‡ä»¶                                  |
| å †å†…å­˜     | å­˜å‚¨å¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œnewæ¥åˆ›å»ºçš„ï¼Œéƒ½å­˜å‚¨åœ¨å †å†…å­˜            |
| æ–¹æ³•æ ˆ     | æ–¹æ³•è¿è¡Œæ—¶ä½¿ç”¨çš„å†…å­˜ï¼Œæ¯”å¦‚mainæ–¹æ³•è¿è¡Œï¼Œè¿›å…¥æ–¹æ³•æ ˆä¸­æ‰§è¡Œ |



##### å†…å­˜å›¾

* Javaå†…å­˜åˆ†é…-ä¸€ä¸ªæ•°ç»„å†…å­˜å›¾

  ![](https://gitee.com/seazean/images/raw/master/JavaSE/æ•°ç»„å†…å­˜åˆ†é…-ä¸€ä¸ªæ•°ç»„å†…å­˜å›¾.png)

* ä¸¤ä¸ªæ•°ç»„å†…å­˜å›¾

  ![](https://gitee.com/seazean/images/raw/master/JavaSE/æ•°ç»„å†…å­˜åˆ†é…-ä¸¤ä¸ªæ•°ç»„å†…å­˜å›¾.png)

* å¤šä¸ªæ•°ç»„æŒ‡å‘ç›¸åŒå†…å­˜å›¾

  ![](https://gitee.com/seazean/images/raw/master/JavaSE/æ•°ç»„å†…å­˜åˆ†é…-å¤šä¸ªæ•°ç»„æŒ‡å‘ä¸€ä¸ªæ•°ç»„å†…å­˜å›¾.png)

***



#### å¼‚å¸¸

* ç´¢å¼•è¶Šç•Œå¼‚å¸¸ï¼šArrayIndexOutOfBoundsException 

* ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼šNullPointerException 

  ```java
  public class ArrayDemo {
      public static void main(String[] args) {
          int[] arr = new int[3];
          //æŠŠnullèµ‹å€¼ç»™æ•°ç»„
          arr = null;
          System.out.println(arr[0]);
      }
  }
  ```

  arr = nullï¼Œè¡¨ç¤ºå˜é‡arrå°†ä¸å†ä¿å­˜æ•°ç»„çš„å†…å­˜åœ°å€ï¼Œä¹Ÿå°±ä¸å…è®¸å†æ“ä½œæ•°ç»„ï¼Œå› æ­¤è¿è¡Œçš„æ—¶å€™ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚åœ¨å¼€å‘ä¸­ï¼Œç©ºæŒ‡é’ˆå¼‚å¸¸æ˜¯ä¸èƒ½å‡ºç°çš„ï¼Œä¸€æ—¦å‡ºç°äº†ï¼Œå°±å¿…é¡»è¦ä¿®æ”¹æˆ‘ä»¬ç¼–å†™çš„ä»£ç ã€‚

  è§£å†³æ–¹æ¡ˆï¼šç»™æ•°ç»„ä¸€ä¸ªçœŸæ­£çš„å †å†…å­˜ç©ºé—´å¼•ç”¨å³å¯ï¼
  
  

***



#### äºŒç»´æ•°ç»„

äºŒç»´æ•°ç»„ä¹Ÿæ˜¯ä¸€ç§å®¹å™¨ï¼Œä¸åŒäºä¸€ç»´æ•°ç»„ï¼Œè¯¥å®¹å™¨å­˜å‚¨çš„éƒ½æ˜¯ä¸€ç»´æ•°ç»„å®¹å™¨

åˆå§‹åŒ–

* åŠ¨æ€åˆå§‹åŒ–ï¼š
  æ•°æ®ç±»å‹[][] å˜é‡å = new æ•°æ®ç±»å‹[m] [n] : `int[][] arr = new int[3][3];`
  	mè¡¨ç¤ºè¿™ä¸ªäºŒç»´æ•°ç»„ï¼Œå¯ä»¥å­˜æ”¾å¤šå°‘ä¸ªä¸€ç»´æ•°ç»„
  	nè¡¨ç¤ºæ¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œå¯ä»¥å­˜æ”¾å¤šå°‘ä¸ªå…ƒç´ 
* é™æ€åˆå§‹åŒ–
  * æ•°æ®ç±»å‹[][] å˜é‡å = new æ•°æ®ç±»å‹[][]{ {å…ƒç´ 1, å…ƒç´ 2...} , {å…ƒç´ 1, å…ƒç´ 2...} 
  * æ•°æ®ç±»å‹[][] å˜é‡å = { {å…ƒç´ 1, å…ƒç´ 2...} , {å…ƒç´ 1, å…ƒç´ 2...} ...}
  * `int[][] arr = {{11,22,33}, {44,55,66}};`



éå†ï¼š

```java
public class Test1 {
    /*
        æ­¥éª¤:
            1. éå†äºŒç»´æ•°ç»„ï¼Œå–å‡ºé‡Œé¢æ¯ä¸€ä¸ªä¸€ç»´æ•°ç»„
            2. åœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ç»§ç»­å®Œæˆéå†ï¼Œè·å–å†…éƒ¨å­˜å‚¨çš„æ¯ä¸€ä¸ªå…ƒç´ 
     */
    public static void main(String[] args) {
        int[][] arr = {{11, 22, 33}, {33, 44, 55}};
        // 1. éå†äºŒç»´æ•°ç»„ï¼Œå–å‡ºé‡Œé¢æ¯ä¸€ä¸ªä¸€ç»´æ•°ç»„
        for (int i = 0; i < arr.length; i++) {
            //System.out.println(arr[i]);
            // 2. åœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ç»§ç»­å®Œæˆéå†ï¼Œè·å–å†…éƒ¨å­˜å‚¨çš„æ¯ä¸€ä¸ªå…ƒç´ 
            //int[] temp = arr[i];
            for (int j = 0; j < arr[i].length; j++) {
                System.out.println(arr[i][j]);
            }
        }
    }
}
```





****



### è¿ç®—

* i++ä¸++içš„åŒºåˆ«ï¼Ÿ
  i++è¡¨ç¤ºå…ˆå°†iæ”¾åœ¨è¡¨è¾¾å¼ä¸­è¿ç®—ï¼Œç„¶åå†åŠ 1ï¼›
  ++iè¡¨ç¤ºå…ˆå°†iåŠ 1ï¼Œç„¶åå†æ”¾åœ¨è¡¨è¾¾å¼ä¸­è¿ç®—

* ||å’Œ|ï¼Œ&&å’Œ&çš„åŒºåˆ«ï¼Œé€»è¾‘è¿ç®—ç¬¦

  **&å’Œ| ç§°ä¸ºå¸ƒå°”è¿ç®—ç¬¦ï¼Œä½è¿ç®—ç¬¦ã€‚&&å’Œ|| ç§°ä¸ºæ¡ä»¶å¸ƒå°”è¿ç®—ç¬¦,ä¹Ÿå«çŸ­è·¯è¿ç®—ç¬¦**ã€‚

  ä¸¤ç§è¿ç®—ç¬¦å¾—åˆ°çš„ç»“æœå®Œå…¨ç›¸åŒï¼Œä½†å¾—åˆ°ç»“æœçš„æ–¹å¼åˆä¸€ä¸ªé‡è¦åŒºåˆ«ï¼šæ¡ä»¶å¸ƒå°”è¿ç®—ç¬¦æ€§èƒ½æ¯”è¾ƒå¥½ã€‚ä»–æ£€æŸ¥ç¬¬ä¸€ä¸ªæ“ä½œæ•°çš„å€¼ï¼Œå†æ ¹æ®è¯¥æ“ä½œæ•°çš„å€¼è¿›è¡Œæ“ä½œï¼Œå¯èƒ½æ ¹æœ¬å°±ä¸å¤„ç†ç¬¬äºŒä¸ªæ“ä½œæ•°ã€‚

  ç»“è®ºï¼šå¦‚æœ&&è¿ç®—ç¬¦çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯falseï¼Œå°±ä¸éœ€è¦è€ƒè™‘ç¬¬äºŒä¸ªæ“ä½œæ•°çš„å€¼äº†ï¼Œå› ä¸ºæ— è®ºç¬¬äºŒä¸ªæ“ä½œæ•°çš„å€¼æ˜¯ä»€ä¹ˆï¼Œå…¶ç»“æœéƒ½æ˜¯falseã€‚åŒæ ·ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯trueï¼Œ||è¿ç®—ç¬¦å°±è¿”å›trueï¼Œæ— éœ€è€ƒè™‘ç¬¬äºŒä¸ªæ“ä½œæ•°çš„å€¼ã€‚ä½†&å’Œ|å´ä¸æ˜¯è¿™æ ·ï¼Œå®ƒä»¬æ€»æ˜¯è¦è®¡ç®—ä¸¤ä¸ªæ“ä½œæ•°ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œ**å°½å¯èƒ½ä½¿ç”¨&&å’Œ||è¿ç®—ç¬¦**





****



### å‚æ•°

#### å½¢å‚å®å‚

* å½¢å‚
  å¯ä»¥ç†è§£ä¸ºå½¢å¼å‚æ•°ï¼Œç”¨äºå®šä¹‰æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨çš„å‚æ•°ï¼Œåªèƒ½æ˜¯å˜é‡
  å½¢å‚åªæœ‰åœ¨æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œè™šæ‹Ÿæœºæ‰åˆ†é…å†…å­˜å•å…ƒï¼Œæ–¹æ³•è°ƒç”¨ç»“æŸä¹‹åä¾¿ä¼šé‡Šæ”¾æ‰€åˆ†é…çš„å†…å­˜å•å…ƒ

* å®å‚

  è°ƒç”¨æ–¹æ³•æ—¶ä¼ é€’çš„æ•°æ®å¯ä»¥æ˜¯å¸¸é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å˜é‡



#### å¯å˜å‚æ•°

å¯å˜å‚æ•°ç”¨åœ¨å½¢å‚ä¸­å¯ä»¥æ¥æ”¶å¤šä¸ªæ•°æ®ã€‚

å¯å˜å‚æ•°çš„æ ¼å¼ï¼šæ•°æ®ç±»å‹... å‚æ•°åç§°

å¯å˜å‚æ•°çš„ä½œç”¨ï¼šä¼ è¾“å‚æ•°éå¸¸çµæ´»ï¼Œæ–¹ä¾¿ã€‚å¯ä»¥ä¸ä¼ è¾“å‚æ•°ã€ä¼ è¾“ä¸€ä¸ªå‚æ•°ã€æˆ–è€…ä¼ è¾“ä¸€ä¸ªæ•°ç»„ã€‚

å¯å˜å‚æ•°åœ¨æ–¹æ³•å†…éƒ¨æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

å¯å˜å‚æ•°çš„æ³¨æ„äº‹é¡¹ï¼š
	1.ä¸€ä¸ªå½¢å‚åˆ—è¡¨ä¸­å¯å˜å‚æ•°åªèƒ½æœ‰ä¸€ä¸ªï¼
	2.å¯å˜å‚æ•°å¿…é¡»æ”¾åœ¨å½¢å‚åˆ—è¡¨çš„**æœ€åé¢**ï¼

```java
public static void main(String[] args) {
	sum(); // å¯ä»¥ä¸ä¼ è¾“å‚æ•°ã€‚
	sum(10); // å¯ä»¥ä¼ è¾“ä¸€ä¸ªå‚æ•°ã€‚
	sum(10,20,30); // å¯ä»¥ä¼ è¾“å¤šä¸ªå‚æ•°ã€‚
	sum(new int[]{10,30,50,70,90}); // å¯ä»¥ä¼ è¾“ä¸€ä¸ªæ•°ç»„ã€‚
}

public static void sum(int... nums){
	int sum = 0;
	for(int i : a) {
		sum += i;
	}
	return sum;
}
```



***



### æ–¹æ³•

#### æ–¹æ³•æ¦‚è¿°

æ–¹æ³•ï¼ˆmethodï¼‰æ˜¯å°†å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ä»£ç å—ç»„ç»‡æˆä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä½¿å…¶å…·æœ‰ç‰¹æ®ŠåŠŸèƒ½çš„ä»£ç é›†

æ³¨æ„ï¼šæ–¹æ³•å¿…é¡»å…ˆåˆ›å»ºæ‰å¯ä»¥ä½¿ç”¨ï¼Œè¯¥è¿‡ç¨‹æˆä¸ºæ–¹æ³•å®šä¹‰
			æ–¹æ³•åˆ›å»ºåå¹¶ä¸æ˜¯ç›´æ¥å¯ä»¥è¿è¡Œçš„ï¼Œéœ€è¦æ‰‹åŠ¨ä½¿ç”¨åï¼Œæ‰æ‰§è¡Œï¼Œè¯¥è¿‡ç¨‹æˆä¸ºæ–¹æ³•è°ƒç”¨



***



#### å®šä¹‰è°ƒç”¨

* å®šä¹‰æ ¼å¼

  ```java
  public static è¿”å›å€¼ç±»å‹ æ–¹æ³•å(å‚æ•°) {
  	//æ–¹æ³•ä½“;
  	return æ•°æ® ;
  }
  //æ³¨æ„ï¼šæ–¹æ³•å®šä¹‰æ—¶ï¼Œå¤šä¸ªå‚æ•°ä¹‹é—´ä½¿( ï¼Œ)åˆ†éš”
  ```

* è°ƒç”¨æ ¼å¼

  ```java
  æ•°æ®ç±»å‹ å˜é‡å = æ–¹æ³•å ( å‚æ•° ) ;
  //æ³¨æ„ï¼šæ–¹æ³•çš„è¿”å›å€¼é€šå¸¸ä¼šä½¿ç”¨å˜é‡æ¥æ”¶ï¼Œå¦åˆ™è¯¥è¿”å›å€¼å°†æ— æ„ä¹‰
  ```

* è§£é‡Š
  å¦‚æœæ–¹æ³•æ“ä½œå®Œæ¯•ï¼Œæ²¡æœ‰æ•°æ®è¿”å›ï¼Œè¿™é‡Œå†™voidï¼Œè€Œä¸”æ–¹æ³•ä½“ä¸­ä¸€èˆ¬ä¸å†™return

  æ–¹æ³•åï¼šè°ƒç”¨æ–¹æ³•æ—¶å€™ä½¿ç”¨çš„æ ‡è¯†
  å‚æ•°ï¼šç”±æ•°æ®ç±»å‹å’Œå˜é‡åç»„æˆï¼Œå¤šä¸ªå‚æ•°ä¹‹é—´ç”¨é€—å·éš”å¼€
  æ–¹æ³•ä½“ï¼šå®ŒæˆåŠŸèƒ½çš„ä»£ç å—
  returnï¼šå¦‚æœæ–¹æ³•æ“ä½œå®Œæ¯•ï¼Œæœ‰æ•°æ®è¿”å›ï¼Œç”¨äºæŠŠæ•°æ®è¿”å›ç»™è°ƒç”¨è€…

* æ³¨æ„
  voidç±»å‹çš„æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨å³å¯
  évoidç±»å‹çš„æ–¹æ³•ï¼Œæ¨èç”¨å˜é‡æ¥æ”¶è°ƒç”¨
  
* æ€»ç»“ï¼šæ¯ä¸ªæ–¹æ³•åœ¨è¢«è°ƒç”¨æ‰§è¡Œçš„æ—¶å€™ï¼Œéƒ½ä¼šè¿›å…¥æ ˆå†…å­˜ï¼Œå¹¶ä¸”æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œæ–¹æ³•å†…éƒ¨ä»£ç è°ƒç”¨å®Œæ¯•ä¹‹åï¼Œä¼šä»æ ˆå†…å­˜ä¸­å¼¹æ ˆæ¶ˆå¤±ã€‚



***



#### æ³¨æ„äº‹é¡¹

* æ–¹æ³•ä¸èƒ½åµŒå¥—å®šä¹‰

  ```java
  public class MethodDemo {
  	public static void main(String[] args) {
  	}
  	public static void methodOne() {
  		public static void methodTwo() {
  			// è¿™é‡Œä¼šå¼•å‘ç¼–è¯‘é”™è¯¯!!!
  		}
  	}
  }
  ```

* voidè¡¨ç¤ºæ— è¿”å›å€¼ï¼Œå¯ä»¥çœç•¥returnï¼Œä¹Ÿå¯ä»¥å•ç‹¬çš„ä¹¦å†™returnï¼Œåé¢ä¸åŠ æ•°æ®

  ```java
  public static void methodTwo() {
  	//return 100; ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºæ²¡æœ‰å…·ä½“è¿”å›å€¼ç±»å‹
  	return;
  	//System.out.println(100); returnè¯­å¥åé¢ä¸èƒ½è·Ÿæ•°æ®æˆ–ä»£ç 
  }
  ```

  

***



#### æ–¹æ³•é‡è½½

æ–¹æ³•é‡è½½æŒ‡åŒä¸€ä¸ªç±»ä¸­å®šä¹‰çš„å¤šä¸ªæ–¹æ³•ä¹‹é—´çš„å…³ç³»ï¼Œæ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„å¤šä¸ªæ–¹æ³•ç›¸äº’æ„æˆé‡è½½
	1.å¤šä¸ªæ–¹æ³•åœ¨**åŒä¸€ä¸ªç±»**ä¸­
	2.å¤šä¸ªæ–¹æ³•å…·æœ‰**ç›¸åŒçš„æ–¹æ³•å**
	3.å¤šä¸ªæ–¹æ³•çš„**å‚æ•°ä¸ç›¸åŒ**ï¼Œç±»å‹ä¸åŒæˆ–è€…æ•°é‡ä¸åŒ

æ³¨æ„ï¼š
	1.é‡è½½ä»…å¯¹åº”æ–¹æ³•çš„å®šä¹‰ï¼Œä¸æ–¹æ³•çš„è°ƒç”¨æ— å…³ï¼Œè°ƒç”¨æ–¹å¼å‚ç…§æ ‡å‡†æ ¼å¼
	2.é‡è½½ä»…é’ˆå¯¹**åŒä¸€ä¸ªç±»**ä¸­æ–¹æ³•çš„åç§°ä¸å‚æ•°è¿›è¡Œè¯†åˆ«ï¼Œ**ä¸è¿”å›å€¼æ— å…³**ã€‚
	3.ä¸èƒ½é€šè¿‡è¿”å›å€¼æ¥åˆ¤å®šä¸¤ä¸ªæ–¹æ³•æ˜¯å¦ç›¸äº’æ„æˆé‡è½½

```java
//æ­£ç¡®èŒƒä¾‹
public class MethodDemo {
	public static void fn(int a) {
		//æ–¹æ³•ä½“
	}
	public static int fn(double a) {
		//æ–¹æ³•ä½“
	}
}
//é”™è¯¯èŒƒä¾‹
public class MethodDemo {
	public static void fn(int a) {
		//æ–¹æ³•ä½“
	}
	public static int fn(int a) { /*é”™è¯¯åŸå› ï¼šé‡è½½ä¸è¿”å›å€¼æ— å…³*/
		//æ–¹æ³•ä½“
	}
}
public class MethodDemo01 {
	public static int fn(double a) { /*é”™è¯¯åŸå› ï¼šè¿™æ˜¯ä¸¤ä¸ªç±»çš„ä¸¤ä¸ªfnæ–¹æ³•*/
		//æ–¹æ³•ä½“
	}
}
```



***



#### å‚æ•°ä¼ é€’

* **åŸºæœ¬æ•°æ®ç±»å‹çš„å‚æ•°ï¼Œå½¢å¼å‚æ•°çš„æ”¹å˜ï¼Œä¸å½±å“å®é™…å‚æ•°**
  æ¯ä¸ªæ–¹æ³•åœ¨æ ˆå†…å­˜ä¸­ï¼Œéƒ½ä¼šæœ‰ç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåå°±ä¼šå¼¹æ ˆæ¶ˆå¤±

```java
public class ArgsDemo01 {
	public static void main(String[] args) {
		int number = 100;
		System.out.println("è°ƒç”¨changeæ–¹æ³•å‰ï¼š" + number);//100
		change(number);
		System.out.println("è°ƒç”¨changeæ–¹æ³•åï¼š" + number);//100
	}
	public static void change(int number) {
		number = 200;
	}
}
```

* **å¼•ç”¨ç±»å‹çš„å‚æ•°ï¼Œå½¢å¼å‚æ•°çš„æ”¹å˜ï¼Œå½±å“å®é™…å‚æ•°çš„å€¼**
  å¼•ç”¨æ•°æ®ç±»å‹çš„ä¼ å‚ï¼Œä¼ å…¥çš„æ˜¯åœ°å€å€¼ï¼Œå†…å­˜ä¸­ä¼šé€ æˆä¸¤ä¸ªå¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå†…å­˜çš„æ•ˆæœï¼Œæ‰€ä»¥å³ä½¿æ–¹æ³•å¼¹æ ˆï¼Œå †å†…å­˜ä¸­çš„æ•°æ®ä¹Ÿå·²ç»æ˜¯æ”¹å˜åçš„ç»“æœ

```java
public class ArgsDemo02 {
	public static void main(String[] args) {
		int[] arr = {10, 20, 30};
		System.out.println("è°ƒç”¨changeæ–¹æ³•å‰ï¼š" + arr[1]);
		change(arr);
		System.out.println("è°ƒç”¨changeæ–¹æ³•åï¼š" + arr[1]);
	}
	public static void change(int[] arr) {
		arr[1] = 200;
	}
}
```



***



### æšä¸¾

æšä¸¾æ˜¯Javaä¸­çš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œä¸ºäº†åšä¿¡æ¯çš„æ ‡å¿—å’Œä¿¡æ¯çš„åˆ†ç±»

å®šä¹‰æšä¸¾çš„æ ¼å¼ï¼š

```java
ä¿®é¥°ç¬¦ enum æšä¸¾åç§°{
	ç¬¬ä¸€è¡Œéƒ½æ˜¯ç½—åˆ—æšä¸¾å®ä¾‹çš„åç§°ã€‚
}
```

æšä¸¾çš„ç‰¹ç‚¹ï¼š

* æšä¸¾ç±»æ˜¯ç”¨finalä¿®é¥°çš„ï¼Œæšä¸¾ç±»ä¸èƒ½è¢«ç»§æ‰¿
* æšä¸¾ç±»é»˜è®¤ç»§æ‰¿äº†java.lang.Enumæšä¸¾ç±»
* æšä¸¾ç±»çš„ç¬¬ä¸€è¡Œéƒ½æ˜¯å¸¸é‡ï¼Œå¿…é¡»æ˜¯ç½—åˆ—æšä¸¾ç±»çš„å®ä¾‹åç§°
* æšä¸¾ç±»ç›¸å½“äºæ˜¯å¤šä¾‹è®¾è®¡æ¨¡å¼

| æ–¹æ³•å                                            | è¯´æ˜                                 |
| ------------------------------------------------- | ------------------------------------ |
| String name()                                     | è·å–æšä¸¾é¡¹çš„åç§°                     |
| int ordinal()                                     | è¿”å›æšä¸¾é¡¹åœ¨æšä¸¾ç±»ä¸­çš„ç´¢å¼•å€¼         |
| int compareTo(E  o)                               | æ¯”è¾ƒä¸¤ä¸ªæšä¸¾é¡¹ï¼Œè¿”å›çš„æ˜¯ç´¢å¼•å€¼çš„å·®å€¼ |
| String toString()                                 | è¿”å›æšä¸¾å¸¸é‡çš„åç§°                   |
| static <T> T  valueOf(Class<T> type,String  name) | è·å–æŒ‡å®šæšä¸¾ç±»ä¸­çš„æŒ‡å®šåç§°çš„æšä¸¾å€¼   |
| values()                                          | è·å¾—æ‰€æœ‰çš„æšä¸¾é¡¹                     |

* æºç åˆ†æï¼š

  ```java
  enum Season {
      SPRING , SUMMER , AUTUMN , WINTER;
  }
  //æšä¸¾ç±»çš„ç¼–è¯‘ä»¥åæºä»£ç ï¼š
  public final class Season extends java.lang.Enum<Season> {
  	public static final Season SPRING = new Season();
  	public static final Season SUMMER = new Season();
  	public static final Season AUTUMN = new Season();
  	public static final Season WINTER = new Season();
  
  	public static Season[] values();
  	public static Season valueOf(java.lang.String);
  }
  ```

* APIä½¿ç”¨

  ```java
  public class EnumDemo {
      public static void main(String[] args){
          //è·å–ç´¢å¼•
          Season s = Season.SPRING;  // s = SPRING
          System.out.println(s.ordinal());
          //è·å–å…¨éƒ¨æšä¸¾
          Season[] ss = Season.values();
          for(int i = 0; i < ss.length; i++){
              System.out.println(ss[i]);
          }
          
          int result = Season.SPRING.compareTo(Season.WINTER);
          System.out.println(result);//-3
      }
  }
  enum Season {
      SPRING , SUMMER , AUTUMN , WINTER;
  }
  ```

* è¶…çº§ç›ä¸½ï¼Œæšä¸¾çš„è°ƒç”¨

  ```java
  //è¶…çº§ç›ä¸½  æšä¸¾çš„è°ƒç”¨
  enum Orientation{
  	UP, DOWN, LEFT, RIGHT;
  }
  public class EnumDemo {
      public static void main(String[] args){
          move(Orientation.DOWN)
      }
      public static void move(Orientation o){
          switch(0) {
              case UP:
                  System.out.println("è®©ğŸå¾€ğŸ‘†è¹¦~~~~");
                  break;
              //...........
          }
      }
  }
  ```

  



****



### æ’åº

#### å†’æ³¡æ’åº

å†’æ³¡æ’åºçš„ä½œç”¨ï¼š
    å¯ä»¥ç”¨äºå¯¹æ•°ç»„æˆ–è€…å¯¹é›†åˆçš„å…ƒç´ è¿›è¡Œå¤§å°æ’åºï¼ï¼

å†’æ³¡æ’åºçš„æ ¸å¿ƒç®—æ³•æ€æƒ³:
    int[] arr = new int[] {55, 22, 99, 88};
    æ€æƒ³ï¼šæ¯æ¬¡ä»æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ä¸¤ä¸¤æ¯”è¾ƒã€‚æŠŠè¾ƒå¤§çš„å…ƒç´ ä¸è¾ƒå°çš„å…ƒç´ è¿›è¡Œå±‚å±‚äº¤æ¢ã€‚
    æœ€ç»ˆæŠŠå½“å‰æœ€å¤§çš„ä¸€ä¸ªå…ƒç´ å­˜å…¥åˆ°æ•°ç»„å½“å‰çš„æœ«å°¾ã€‚è¿™å°±æ˜¯å†’æ³¡æ€æƒ³ã€‚


å†’æ³¡æ’åºçš„æ ¸å¿ƒç‚¹ï¼šæ¯æ¬¡ä¸¤ä¸¤æ¯”è¾ƒæ‰¾å‡ºå½“å‰æœ€å¤§å€¼å†’å‡ºåˆ°å½“å‰æœ€åé¢å³å¯ï¼ï¼

å†’æ³¡æ’åºçš„å®ç°æ ¸å¿ƒï¼š
    1.ç¡®å®šæ€»å…±éœ€è¦å†’å‡ è½®ï¼š æ•°ç»„çš„é•¿åº¦-1.
    2.æ¯è½®ä¸¤ä¸¤æ¯”è¾ƒå‡ æ¬¡ã€‚

>   i(è½®æ•°)      æ¬¡æ•°         æ¯è½®æ¬¡æ•°çš„è§„å¾‹ï¼šæ•°ç»„é•¿åº¦-i-1 æ¬¡
>         0             3
>         1             2
>         2             1

```java
// 0 1ä½ç½®æ¯”è¾ƒï¼Œå¤§çš„æ”¾åé¢ï¼Œç„¶å1 2ä½ç½®æ¯”è¾ƒï¼Œå¤§çš„ç»§ç»­æ”¾åé¢ï¼Œä¸€è½®å¾ªç¯æœ€åä¸€ä½æ˜¯æœ€å¤§å€¼

public class BubbleSort {
    public static void main(String[] args) {
        int[] arr = new int[] {55, 22, 99, 88};
        // 1.å®šä¹‰ä¸€ä¸ªå¾ªç¯æ§åˆ¶æ€»å…±éœ€è¦å†’æ³¡å‡ è½®ï¼šæ•°ç»„çš„é•¿åº¦-1
        for(int i = 0 ;  i < arr.length - 1 ; i++ ){
            // 2.æ§åˆ¶æ¯è½®æ¯”è¾ƒå‡ æ¬¡ã€‚
            // j = 1; j < arr.length - i;
            for(int j = 0 ; j < arr.length - i - 1 ; j++ ){
                // å¦‚æœå½“å‰å…ƒç´ å¤§äºåä¸€ä¸ªå…ƒç´ 
                if(arr[j] > arr[j+1]){
                    // äº¤æ¢ä½ç½®ã€‚å¤§çš„å…ƒç´ å¿…é¡»åç§»ï¼
                    // å®šä¹‰ä¸€ä¸ªä¸´æ—¶å˜é‡å­˜å‚¨åä¸€ä¸ªå…ƒç´ 
                    int temp = arr[j+1];
                    arr[j+1] = arr[j];
                    arr[j] = temp;
                }
            }
        }
        System.out.println("æ•°ç»„ï¼š"+ Arrays.toString(arr));
    }
}
```



***



#### é€‰æ‹©æ’åº

é€‰æ‹©æ’åºçš„æ€æƒ³ï¼šä»å½“å‰ä½ç½®å¼€å§‹æ‰¾å‡ºåé¢çš„è¾ƒå°å€¼ä¸è¯¥ä½ç½®äº¤æ¢ã€‚
æ•°ç»„ï¼šint[] arr = {5 , 1 , 3 , 2}

é€‰æ‹©æ’åºçš„å®ç°æ€è·¯ï¼š
    ï¼ˆ1ï¼‰æ§åˆ¶é€‰æ‹©å‡ è½®ï¼šæ•°ç»„çš„é•¿åº¦-1.
    ï¼ˆ2ï¼‰æ§åˆ¶æ¯è½®ä»å½“å‰ä½ç½®å¼€å§‹æ¯”è¾ƒå‡ æ¬¡ã€‚

	> i(è½®æ•°)     æ¬¡æ•°
	>        0           3
	>        1           2
	>        2           1

```java
// 0 1ä½ç½®æ¯”è¾ƒï¼Œå°çš„æ”¾0ä½ç½®ï¼Œç„¶å0 2ä½ç½®æ¯”ï¼Œå°çš„ç»§ç»­æ”¾0ä½ç½®ï¼Œä¸€è½®å¾ªç¯0ä½ç½®æ˜¯æœ€å°å€¼
public class SelectSort {
    public static void main(String[] args) {
        int[] arr = {5 , 1 , 3 , 2};
        // 1.å®šä¹‰ä¸€ä¸ªå¾ªç¯æ§åˆ¶é€‰æ‹©å‡ è½®
        for(int i = 0 ; i < arr.length - 1 ; i++ ){
            // 2.å®šä¹‰ä¸€ä¸ªå¾ªç¯æ§åˆ¶æ¯è½®æ¯”è¾ƒå‡ æ¬¡ï¼Œä¸€å®šæ˜¯ä»¥å½“å‰ä½ç½®ä¸åé¢å…ƒç´ æ¯”è¾ƒ
            for(int j = i+1 ; j < arr.length ; j++ ){
                // æ‹¿å½“å‰ä½ç½®ä¸jæŒ‡å®šçš„å…ƒç´ è¿›è¡Œå¤§å°æ¯”è¾ƒï¼Œåé¢çš„è¾ƒå°å°±äº¤æ¢ä½ç½®
                if(arr[j] < arr[i]){
                    int temp = arr[i];
                    arr[i] = arr[j];
                    arr[j] = temp;
                }
            }
        }
        System.out.println("æ•°ç»„ï¼š"+ Arrays.toString(arr));
    }
}
```



***



#### å¿«é€Ÿæ’åº

å¿«é€Ÿæ’åºç®—æ³•ä¸­,æ¯ä¸€æ¬¡é€’å½’æ—¶ä»¥ç¬¬ä¸€ä¸ªæ•°ä¸ºåŸºå‡†æ•°,æ‰¾åˆ°æ•°ç»„ä¸­æ‰€æœ‰æ¯”åŸºå‡†æ•°å°çš„.å†æ‰¾åˆ°æ‰€æœ‰æ¯”åŸºå‡†æ•°å¤§çš„.å°çš„å…¨éƒ¨æ”¾å·¦è¾¹,å¤§çš„å…¨éƒ¨æ”¾å³è¾¹,ç¡®å®šåŸºå‡†æ•°çš„æ­£ç¡®ä½ç½®

> ä¸ç”¨é€’å½’å¯ä»¥ç›´æ¥æ‰¾å‡ºæŸä¸ªæ•°å­—åœ¨æ•°ç»„ä¸­çš„ä½ç½®

```java
public class MyQuiteSortDemo2 {
    public static void main(String[] args) {
//        1ï¼Œä»å³å¼€å§‹æ‰¾æ¯”åŸºå‡†æ•°å°çš„
//        2ï¼Œä»å·¦å¼€å§‹æ‰¾æ¯”åŸºå‡†æ•°å¤§çš„
//        3ï¼Œäº¤æ¢ä¸¤ä¸ªå€¼çš„ä½ç½®
//        4ï¼Œçº¢è‰²ç»§ç»­å¾€å·¦æ‰¾ï¼Œè“è‰²ç»§ç»­å¾€å³æ‰¾ï¼Œç›´åˆ°ä¸¤ä¸ªç®­å¤´æŒ‡å‘åŒä¸€ä¸ªç´¢å¼•ä¸ºæ­¢
//        5ï¼ŒåŸºå‡†æ•°å½’ä½
		int[] arr = {6, 1, 2, 7, 9, 3, 4, 5, 10, 8};
		quiteSort(arr,0,arr.length-1);
        for (int i = 0; i < arr.length; i++) {
            System.out.print(arr[i] + " ");
        }
    }

    private static void quiteSort(int[] arr, int left, int right) {
     	// é€’å½’ç»“æŸçš„æ¡ä»¶
        if(right < left){
            return;
        }
        
        int left0 = left;
        int right0 = right;
        int baseNumber = arr[left0];//è®¡ç®—å‡ºåŸºå‡†æ•°

        while(left != right){
			//1.ä»å³å¼€å§‹æ‰¾æ¯”åŸºå‡†æ•°å°çš„
            while(arr[right] >= baseNumber && right > left){
                right--;
            }
			//2.ä»å·¦å¼€å§‹æ‰¾æ¯”åŸºå‡†æ•°å¤§çš„
            while(arr[left] <= baseNumber && right > left){
                left++;
            }
			//3.äº¤æ¢ä¸¤ä¸ªå€¼çš„ä½ç½®
            int temp = arr[left];
            arr[left] = arr[right];
            arr[right] = temp;
        }
        //åŸºå‡†æ•°å½’ä½
        int temp = arr[left];
        arr[left] = arr[left0];
        arr[left0] = temp;
      
		// é€’å½’è°ƒç”¨è‡ªå·±,å°†å·¦åŠéƒ¨åˆ†æ’å¥½åº
        quiteSort(arr,left0,--left);
      	// é€’å½’è°ƒç”¨è‡ªå·±,å°†å³åŠéƒ¨åˆ†æ’å¥½åº
        quiteSort(arr,++right,right0);
    }
}
```



***



#### äºŒåˆ†æŸ¥æ‰¾

> æ­£å¸¸æŸ¥æ‰¾ï¼šä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹éå†ï¼Œä¸€ä¸ªä¸€ä¸ªçš„å¾€åæ‰¾ï¼Œç»¼åˆæŸ¥æ‰¾æ¯”è¾ƒè€—æ—¶ã€‚

äºŒåˆ†æŸ¥æ‰¾çš„å‰æï¼šå¯¹æ•°ç»„æ˜¯æœ‰è¦æ±‚çš„,æ•°ç»„å¿…é¡»å·²ç»æ’å¥½åºã€‚
æ¯æ¬¡å…ˆä¸ä¸­é—´çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå¤§äºå¾€å³è¾¹æ‰¾ï¼Œå¦‚æœå°äºå¾€å·¦è¾¹æ‰¾ï¼Œå¦‚æœç­‰äºå°±è¿”å›è¯¥å…ƒç´ ç´¢å¼•ä½ç½®ï¼å¦‚æœæ²¡æœ‰è¯¥å…ƒç´ ï¼Œè¿”å›-1ã€‚

```java
/*å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œè®°å½•å¼€å§‹çš„ç´¢å¼•ä½ç½®å’Œç»“æŸçš„ç´¢å¼•ä½ç½®ã€‚
å–å‡ºä¸­é—´ç´¢å¼•ä½ç½®çš„å€¼ï¼Œæ‹¿å…ƒç´ ä¸ä¸­é—´ä½ç½®çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå°äºä¸­é—´å€¼ï¼Œç»“æŸä½ç½®=ä¸­é—´ç´¢å¼•-1.
å–å‡ºä¸­é—´ç´¢å¼•ä½ç½®çš„å€¼ï¼Œæ‹¿å…ƒç´ ä¸ä¸­é—´ä½ç½®çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå¤§äºä¸­é—´å€¼ï¼Œå¼€å§‹ä½ç½®=ä¸­é—´ç´¢å¼•+1.
å¾ªç¯æ­£å¸¸æ‰§è¡Œçš„æ¡ä»¶ï¼šå¼€å§‹ä½ç½®ç´¢å¼•<=ç»“æŸä½ç½®ç´¢å¼•ã€‚å¦åˆ™è¯´æ˜å¯»æ‰¾å®Œæ¯•ä½†æ˜¯æ²¡æœ‰è¯¥å…ƒç´ å€¼è¿”å›-1.*/

public class BinarySerach {
    public static void main(String[] args) {
        // 1.æ•°ç»„
        int[] arr = {10, 14, 21, 38, 45, 47, 53, 81, 87, 99};
        // 2.éœ€æ±‚æ˜¯ä»æ•°ç»„ä¸­äºŒåˆ†æŸ¥è¯¢æŸä¸ªå…ƒç´ å€¼çš„ç´¢å¼•ï¼ˆæé«˜æ€§èƒ½ï¼‰
        System.out.println("81çš„ç´¢å¼•æ˜¯ï¼š" + binarySerach(arr,23));
 
    }

    /**
     * @param arr  è¢«æ£€ç´¢çš„æ•°ç»„
     * @param number è¢«æ£€ç´¢çš„å…ƒç´ å€¼
     * @return  è¿”å›å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•å€¼ï¼Œä¸å­˜åœ¨è¯¥å…ƒç´ è¿”å›-1
     */
    public static int binarySerach(int[] arr , int number){
        // 3.è®°å½•å½“å‰åŒºé—´æœç´¢çš„å¼€å§‹ç´¢å¼•å’Œç»“æŸç´¢å¼•ã€‚
        int start = 0 ;//å·¦
        int end = arr.length - 1;//å³
        // 4.å®šä¹‰ä¸€ä¸ªå¾ªç¯ï¼Œåå¤å»å¾ªç¯å…ƒç´ ã€‚
        while(start <= end){
            // 5.å–ä¸­é—´ç´¢å¼•ä½ç½®
            int middleIndex = (start + end) / 2 ;
            // 6.åˆ¤æ–­å½“å‰å…ƒç´ ä¸ä¸­é—´å…ƒç´ çš„å¤§å°
            if(number < arr[middleIndex]){
                // 7.å¾€å·¦è¾¹ç»§ç»­å¯»æ‰¾ï¼Œç»“æŸç´¢å¼•åº”è¯¥-1
                end = middleIndex - 1;
            }else if(number > arr[middleIndex]){
                start = middleIndex + 1;
            }else if(number == arr[middleIndex]){
                return middleIndex;
            }
        }
        // å¦‚æœä¸Šè¿°å¾ªç¯æ‰§è¡Œå®Œæ¯•è¿˜æ²¡æœ‰è¿”å›ç´¢å¼•ï¼Œè¯´æ˜æ ¹æœ¬ä¸å­˜åœ¨è¯¥å…ƒç´ å€¼ï¼Œç›´æ¥è¿”å›-1
        return -1;
    }
}
```



***



### é€’å½’

#### æ¦‚è¿°

é€’å½’ï¼šæ–¹æ³•åœ¨æ–¹æ³•ä¸­åˆè°ƒç”¨äº†è‡ªå·±ã€‚

é€’å½’ï¼š
    ç›´æ¥é€’å½’ï¼šè‡ªå·±çš„æ–¹æ³•è°ƒç”¨è‡ªå·±ã€‚
    é—´æ¥é€’å½’ï¼šè‡ªå·±çš„æ–¹æ³•è°ƒç”¨åˆ«çš„æ–¹æ³•ï¼Œåˆ«çš„æ–¹æ³•åˆè°ƒç”¨è‡ªå·±ã€‚
æ³¨æ„ï¼š
     é€’å½’å¦‚æœæ§åˆ¶çš„ä¸æ°å½“ï¼Œä¼šå½¢æˆé€’å½’çš„æ­»å¾ªç¯ï¼Œä»è€Œå¯¼è‡´æ ˆå†…å­˜æº¢å‡ºé”™è¯¯ï¼



***



#### ç®—æ³•æ€æƒ³

##### æ ¸å¿ƒæ€æƒ³

é€’å½’çš„ä¸‰è¦ç´ ï¼ˆç†è®ºï¼‰ï¼š
    1.é€’å½’çš„ç»ˆç»“ç‚¹
    2.é€’å½’çš„å…¬å¼
    3.é€’å½’çš„æ–¹å‘ï¼šå¿…é¡»èµ°å‘ç»ˆç»“ç‚¹

```java
//f(x)=f(x-1)+1;   f(1)=1;    f(10)=?
//1.é€’å½’çš„ç»ˆç»“ç‚¹ï¼š f(1)  = 1
//2.é€’å½’çš„å…¬å¼ï¼šf(x) = f(x - 1) + 1
//3.é€’å½’çš„æ–¹å‘ï¼šå¿…é¡»èµ°å‘ç»ˆç»“ç‚¹
public static int f(int x){
    if(x == 1){
        return 1;
    }else{
        return f(x-1) + 1;
    }
}
```



##### å…¬å¼è½¬æ¢

```java
//å·²çŸ¥ï¼š f(x) = f(x + 1) + 2,  f(1) = 1ã€‚æ±‚ï¼šf(10) = ?
//å…¬å¼è½¬æ¢
//f(x-1)=f(x-1+1)+2 => f(x)=f(x-1)+2
//ï¼ˆ1ï¼‰é€’å½’çš„å…¬å¼ï¼š   f(n) = f(n-1)- 2 ;
//ï¼ˆ2ï¼‰é€’å½’çš„ç»ˆç»“ç‚¹ï¼š  f(1) = 1
//ï¼ˆ3ï¼‰é€’å½’çš„æ–¹å‘ï¼šå¿…é¡»èµ°å‘ç»ˆç»“ç‚¹ã€‚
public static int f(int n){
    if(n == 1){
        return 1;
    }else{
        return f(n-1) - 2;
    }
}
```



##### æ³¨æ„

ä»¥ä¸Šç†è®ºåªèƒ½é’ˆå¯¹äº**è§„å¾‹åŒ–é€’å½’**ï¼Œå¦‚æœæ˜¯éè§„å¾‹åŒ–æ˜¯ä¸èƒ½å¥—ç”¨ä»¥ä¸Šå…¬å¼çš„ï¼
éè§„å¾‹åŒ–é€’å½’çš„é—®é¢˜ï¼šæ–‡ä»¶æœç´¢ï¼Œå•¤é…’é—®é¢˜ã€‚



***



#### ç»å…¸æ¡ˆä¾‹

##### çŒ´å­åƒæ¡ƒ

çŒ´å­ç¬¬ä¸€å¤©æ‘˜äº†è‹¥å¹²ä¸ªæ¡ƒå­ï¼Œå½“å³åƒäº†ä¸€åŠï¼Œè§‰å¾—å¥½ä¸è¿‡ç˜¾ï¼Œç„¶ååˆå¤šåƒäº†ä¸€ä¸ªã€‚
ç¬¬äºŒå¤©åˆåƒäº†å‰ä¸€å¤©å‰©ä¸‹çš„ä¸€åŠï¼Œè§‰å¾—å¥½ä¸è¿‡ç˜¾ï¼Œç„¶ååˆå¤šåƒäº†ä¸€ä¸ªã€‚ä»¥åæ¯å¤©éƒ½æ˜¯å¦‚æ­¤
ç­‰åˆ°ç¬¬åå¤©å†åƒçš„æ—¶å€™å‘ç°åªæœ‰1ä¸ªæ¡ƒå­ï¼Œè¯·é—®çŒ´å­ç¬¬ä¸€å¤©æ€»å…±æ‘˜äº†å¤šå°‘ä¸ªæ¡ƒå­ã€‚

```java
/*
ï¼ˆ1ï¼‰å…¬å¼ï¼š f(x+1)=f(x)-f(x)/2-1; ==> 2f(x+1) = f(x) - 2 ==> f(x)=2f(x+1)+2
ï¼ˆ2ï¼‰ç»ˆç»“ç‚¹ï¼šf(10) = 1
ï¼ˆ3ï¼‰é€’å½’çš„æ–¹å‘ï¼šèµ°å‘äº†ç»ˆç»“ç‚¹
*/

public static int f(int x){
    if(x == 10){
        return 1;
    } else {
        return 2*f(x+1)+2
    }
}
```



##### æ±‚å’Œ

```java
//ï¼ˆ1ï¼‰é€’å½’çš„ç»ˆç‚¹æ¥ï¼šf(1) = 1
//ï¼ˆ2ï¼‰é€’å½’çš„å…¬å¼ï¼š f(n) = f(n-1) + n
//ï¼ˆ3ï¼‰é€’å½’çš„æ–¹å‘å¿…é¡»èµ°å‘ç»ˆç»“ç‚¹ï¼š
public static int f(int n){
        if(n == 1 ) return 1;
        return f(n-1) + n;
}
```



##### é˜¶ä¹˜

```java
//ï¼ˆ1ï¼‰é€’å½’çš„ç»ˆç‚¹æ¥ï¼š f(1) = 1
//ï¼ˆ2ï¼‰é€’å½’çš„å…¬å¼   f(n) = f(n-1)*n
//ï¼ˆ3ï¼‰é€’å½’çš„æ–¹å‘å¿…é¡»èµ°å‘ç»ˆç»“ç‚¹

public static int f(int n){
	if(n == 1){
		return 1 ;
	}else{
		return f(n-1)*n;
	}
}
```



****



##### å•¤é…’é—®é¢˜

éè§„å¾‹åŒ–é€’å½’é—®é¢˜ã€‚

å•¤é…’2å…ƒä¸€ç“¶ï¼Œ4ä¸ªç›–å­å¯ä»¥æ¢ä¸€ç“¶ï¼Œ2ä¸ªç©ºç“¶å¯ä»¥æ¢ä¸€ç“¶ã€‚

```java
public class BeerDemo{
    // å®šä¹‰ä¸€ä¸ªé™æ€å˜é‡å­˜å‚¨å¯ä»¥å–é…’çš„æ€»æ•°
    public static int totalNum;
    public static int lastBottleNum;
    public static int lastCoverNum;
    public static void main(String[] args) {
        buyBeer(10);
        System.out.println("æ€»æ•°ï¼š"+totalNum);
        System.out.println("å‰©ä½™ç›–å­ï¼š"+ lastCoverNum);
        System.out.println("å‰©ä½™ç“¶å­ï¼š"+ lastBottleNum);
    }
    public static void buyBeer(int money){
        int number = money / 2;
        totalNum += number;
        // ç®—å‡ºå½“å‰å‰©ä½™çš„å…¨éƒ¨ç›–å­å’Œç“¶å­æ•°ï¼Œæ¢ç®—æˆé‡‘é¢ç»§ç»­è´­ä¹°ã€‚
        int currentBottleNum = lastBottleNum + number ;
        int currentCoverNum = lastCoverNum + number ;
        // æŠŠä»–ä»¬æ¢ç®—æˆé‡‘é¢
        int totalMoney = 0 ;
        totalMoney += (currentBottleNum/2)*2;//é™¤2ä»£è¡¨å¯ä»¥æ¢å‡ ä¸ªç“¶å­ï¼Œä¹˜2ä»£è¡¨æ¢ç®—æˆé’±ï¼Œç§’ï¼
        lastBottleNum = currentBottleNum % 2 ;//å–ä½™//ç®—å‡ºå‰©ä½™çš„ç“¶å­
     
        totalMoney += (currentCoverNum / 4) * 2;
        lastCoverNum = currentCoverNum % 4 ;

        // ç»§ç»­æ‹¿é’±ä¹°é…’
        if(totalMoney >= 2){
            buyBeer(totalMoney);
        }
    }
}
```





***



### Debug

Debugæ˜¯ä¾›ç¨‹åºå‘˜ä½¿ç”¨çš„ç¨‹åºè°ƒè¯•å·¥å…·ï¼Œå®ƒå¯ä»¥ç”¨äºæŸ¥çœ‹ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä¹Ÿå¯ä»¥ç”¨äºè¿½è¸ªç¨‹åºæ‰§è¡Œè¿‡ç¨‹æ¥è°ƒè¯•ç¨‹åºã€‚

åŠ æ–­ç‚¹->Debugè¿è¡Œ->å•æ­¥è¿è¡Œ->çœ‹Debuggerçª—å£->çœ‹Consoleçª—å£

![](https://gitee.com/seazean/images/raw/master/JavaSE/DebugæŒ‰é”®è¯´æ˜.png)

<img src="https://gitee.com/seazean/images/raw/master/JavaSE/Debugæ¡ä»¶æ–­ç‚¹.png" alt="Debugæ¡ä»¶æ–­ç‚¹" style="zoom:50%;" />









***



## å¯¹è±¡

### æ¦‚è¿°

**Javaæ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„é«˜çº§ç¼–ç¨‹è¯­è¨€ã€‚**

**ä¸‰å¤§ç‰¹å¾ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€**

é¢å‘å¯¹è±¡æœ€é‡è¦çš„ä¸¤ä¸ªæ¦‚å¿µï¼šç±»å’Œå¯¹è±¡ã€‚

* ç±»ï¼šç›¸åŒäº‹ç‰©å…±åŒç‰¹å¾çš„æè¿°ã€‚ç±»åªæ˜¯å­¦æœ¯ä¸Šçš„ä¸€ä¸ªæ¦‚å¿µå¹¶éçœŸå®å­˜åœ¨çš„ï¼Œåªèƒ½æè¿°ä¸€ç±»äº‹ç‰©ã€‚
* å¯¹è±¡ï¼šæ˜¯çœŸå®å­˜åœ¨çš„å®ä¾‹ï¼Œ å®ä¾‹==å¯¹è±¡ã€‚**å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹åŒ–**ï¼
* ç»“è®ºï¼šæœ‰äº†ç±»å’Œå¯¹è±¡å°±å¯ä»¥æè¿°ä¸‡åƒä¸–ç•Œæ‰€æœ‰çš„äº‹ç‰©ã€‚ å¿…é¡»å…ˆæœ‰ç±»æ‰èƒ½æœ‰å¯¹è±¡ã€‚



### ç±»

#### å®šä¹‰

```java
å®šä¹‰ç±»ï¼š
	æ ¼å¼ï¼šä¿®é¥°ç¬¦ class ç±»å{
	
	}
```

**1.ç±»åçš„é¦–å­—æ¯å»ºè®®å¤§å†™ã€‚æ»¡è¶³é©¼å³°æ¨¡å¼ã€‚ StudentNameCode**
2.ä¸€ä¸ªJavaä»£ç ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªç±»ï¼ŒæŒ‰ç…§è§„èŒƒä¸€ä¸ªJavaæ–‡ä»¶ä¸€ä¸ªç±»ã€‚
3.ä¸€ä¸ªJavaä»£ç æ–‡ä»¶ä¸­ï¼Œåªèƒ½æœ‰ä¸€ä¸ªç±»æ˜¯publicä¿®é¥°ï¼Œ**publicä¿®é¥°çš„ç±»åå¿…é¡»æˆä¸ºå½“å‰Javaä»£ç çš„æ–‡ä»¶åç§°**ã€‚

```java
ç±»ä¸­çš„æˆåˆ†:æœ‰ä¸”ä»…æœ‰äº”å¤§æˆåˆ†ï¼ˆäº”å¤§é‡‘åˆšï¼‰
ä¿®é¥°ç¬¦ class ç±»å{
		1.æˆå‘˜å˜é‡(Field):  æè¿°ç±»æˆ–è€…å¯¹è±¡çš„å±æ€§ä¿¡æ¯çš„ã€‚
        2.æˆå‘˜æ–¹æ³•(Method): æè¿°ç±»æˆ–è€…å¯¹è±¡çš„è¡Œä¸ºä¿¡æ¯çš„ã€‚
		3.æ„é€ å™¨(Constructor): åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡è¿”å›ã€‚
		4.ä»£ç å—(åé¢å­¦ä¹ çš„)
		5.å†…éƒ¨ç±»(åé¢å­¦ä¹ çš„)
   		 }
ç±»ä¸­æœ‰ä¸”ä»…æœ‰è¿™äº”ç§æˆåˆ†ï¼Œå¦åˆ™ä»£ç æŠ¥é”™ï¼
public class ClassDemo {
    System.out.println(1);//æŠ¥é”™
}
```



***



#### æ„é€ å™¨

```java
æ„é€ å™¨ï¼š
    æ ¼å¼ï¼šä¿®é¥°ç¬¦ ç±»å(å½¢å‚åˆ—è¡¨){
    
         }
```

ä½œç”¨ï¼šåˆå§‹åŒ–ç±»çš„ä¸€ä¸ªå¯¹è±¡è¿”å›
åˆ†ç±»ï¼šæ— å‚æ•°æ„é€ å™¨ï¼Œæœ‰å‚æ•°æ„é€ å™¨

æ³¨æ„ï¼šä¸€ä¸ªç±»é»˜è®¤è‡ªå¸¦ä¸€ä¸ªæ— å‚æ•°æ„é€ å™¨ï¼Œå†™äº†æœ‰å‚æ•°æ„é€ å™¨é»˜è®¤çš„æ— å‚æ•°æ„é€ å™¨å°±æ¶ˆå¤±ï¼Œè¿˜éœ€è¦ç”¨æ— å‚æ•°æ„é€ å™¨å°±è¦è‡ªå·±é‡æ–°å†™ã€‚

æ„é€ å™¨åˆå§‹åŒ–å¯¹è±¡çš„æ ¼å¼ï¼šç±»å å¯¹è±¡åç§° = new æ„é€ å™¨;

* æ— å‚æ•°æ„é€ å™¨çš„ä½œç”¨ï¼šåˆå§‹åŒ–ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼ˆä½¿ç”¨å¯¹è±¡çš„é»˜è®¤å€¼åˆå§‹åŒ–ï¼‰è¿”å›ã€‚
* æœ‰å‚æ•°æ„é€ å™¨çš„ä½œç”¨ï¼šåˆå§‹åŒ–ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼ˆå¯ä»¥åœ¨åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™ä¸ºå¯¹è±¡èµ‹å€¼ï¼‰è¿”å›ã€‚



------



### åŒ…

* åŒ…ï¼š
      åˆ†é—¨åˆ«ç±»çš„ç®¡ç†å„ç§ä¸åŒçš„æŠ€æœ¯ã€‚
      ä¼ä¸šçš„ä»£ç å¿…é¡»ç”¨åŒ…åŒºåˆ†ã€‚ä¾¿äºç®¡ç†æŠ€æœ¯ï¼Œæ‰©å±•æŠ€æœ¯ï¼Œé˜…è¯»æŠ€æœ¯ã€‚
* å®šä¹‰åŒ…çš„æ ¼å¼ï¼špackage åŒ…å; å¿…é¡»æ”¾åœ¨ç±»åçš„æœ€ä¸Šé¢ã€‚
* æ³¨æ„ï¼š
  ç›¸åŒåŒ…ä¸‹çš„ç±»å¯ä»¥ç›´æ¥è®¿é—®ï¼›ä¸åŒåŒ…ä¸‹çš„ç±»å¿…é¡»å¯¼åŒ…,æ‰å¯ä»¥ä½¿ç”¨ï¼
  å¯¼åŒ…æ ¼å¼ï¼šimport åŒ…å.ç±»å;



***



### å°è£…

å°è£…çš„å“²å­¦æ€ç»´ï¼šåˆç†éšè—ï¼Œåˆç†æš´éœ²ã€‚
å°è£…æœ€åˆçš„ç›®çš„ï¼šæé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¤ç”¨æ€§,ç»„ä»¶åŒ–ã€‚
å°è£…çš„æ­¥éª¤ï¼š
		**1.æˆå‘˜å˜é‡åº”è¯¥ç§æœ‰ã€‚ç”¨privateä¿®é¥°ï¼Œåªèƒ½åœ¨æœ¬ç±»ä¸­ç›´æ¥è®¿é—®ã€‚**
		**2.æä¾›æˆå¥—çš„getterå’Œsetteræ–¹æ³•æš´éœ²æˆå‘˜å˜é‡çš„å–å€¼å’Œèµ‹å€¼ã€‚**

ä¸ºä»€ä¹ˆä½¿ç”¨privateä¿®é¥°æˆå‘˜å˜é‡ï¼šå®ç°æ•°æ®å°è£…ï¼Œä¸æƒ³è®©åˆ«äººä½¿ç”¨ä¿®æ”¹ä½ çš„æ•°æ®ï¼Œæ¯”è¾ƒå®‰å…¨ã€‚



***



### this

thiså…³é”®å­—çš„ä½œç”¨ï¼š
	thiså…³é”®å­—ä»£è¡¨äº†å½“å‰å¯¹è±¡çš„å¼•ç”¨ã€‚
	thiså‡ºç°åœ¨æ–¹æ³•ä¸­ï¼š**å“ªä¸ªå¯¹è±¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•thiså°±ä»£è¡¨è°ã€‚**
	thiså¯ä»¥å‡ºç°åœ¨æ„é€ å™¨ä¸­ï¼šä»£è¡¨æ„é€ å™¨æ­£åœ¨åˆå§‹åŒ–çš„é‚£ä¸ªå¯¹è±¡ã€‚
	thiså¯ä»¥åŒºåˆ†å˜é‡æ˜¯è®¿é—®çš„æˆå‘˜å˜é‡è¿˜æ˜¯å±€éƒ¨å˜é‡ã€‚

```java
public class ThisDemo{
	public static void main(String[] args){
		Animal a = new Animal();
        a.setName("ç‹—å­");
	}
}
class Aniaml{
    private String name;
    private int age ;
    .....
    public void setName(String name) {
        // è°è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œthiså°±ä»£è¡¨è°!!!
		this.name = name; //  a.name = ç‹—å­
    }
}
```



------



### static

#### staticä»‹ç»

Javaæ˜¯é€šè¿‡æˆå‘˜å˜é‡æ˜¯å¦æœ‰staticä¿®é¥°æ¥åŒºåˆ†æ˜¯ç±»çš„è¿˜æ˜¯å±äºå¯¹è±¡çš„ã€‚

static é™æ€ä¿®é¥°çš„æˆå‘˜ï¼ˆæ–¹æ³•å’Œæˆå‘˜å˜é‡ï¼‰å±äºç±»æœ¬èº«çš„ã€‚

æŒ‰ç…§æœ‰æ— staticä¿®é¥°ï¼Œæˆå‘˜å˜é‡å’Œæ–¹æ³•å¯ä»¥åˆ†ä¸ºï¼š

* æˆå‘˜å˜é‡ï¼š
  * é™æ€æˆå‘˜å˜é‡ï¼ˆç±»å˜é‡ï¼‰ï¼š
    æœ‰staticä¿®é¥°çš„æˆå‘˜å˜é‡ç§°ä¸ºé™æ€æˆå‘˜å˜é‡ä¹Ÿå«ç±»å˜é‡ï¼Œå±äºç±»æœ¬èº«ï¼Œ**ä¸ç±»ä¸€èµ·åŠ è½½ä¸€æ¬¡ï¼Œåªæœ‰ä¸€ä¸ª**ï¼Œç›´æ¥ç”¨ç±»åè®¿é—®å³å¯ã€‚ 
  * å®ä¾‹æˆå‘˜å˜é‡ï¼š
    æ— staticä¿®é¥°çš„æˆå‘˜å˜é‡ç§°ä¸ºå®ä¾‹æˆå‘˜å˜é‡ï¼Œå±äºç±»çš„æ¯ä¸ªå¯¹è±¡çš„ã€‚**ä¸ç±»çš„å¯¹è±¡ä¸€èµ·åŠ è½½**ï¼Œå¯¹è±¡æœ‰å¤šå°‘ä¸ªï¼Œå®ä¾‹æˆå‘˜å˜é‡å°±åŠ è½½å¤šå°‘ä¸ªï¼Œå¿…é¡»ç”¨ç±»çš„å¯¹è±¡æ¥è®¿é—®ã€‚

* æˆå‘˜æ–¹æ³•ï¼š
  * é™æ€æ–¹æ³•ï¼š
    æœ‰staticä¿®é¥°çš„æˆå‘˜æ–¹æ³•ç§°ä¸ºé™æ€æ–¹æ³•ä¹Ÿå«ç±»æ–¹æ³•ï¼Œå±äºç±»æœ¬èº«çš„ï¼Œç›´æ¥ç”¨ç±»åè®¿é—®å³å¯ã€‚  
  * å®ä¾‹æ–¹æ³•ï¼š
    æ— staticä¿®é¥°çš„æˆå‘˜æ–¹æ³•ç§°ä¸ºå®ä¾‹æ–¹æ³•ï¼Œå±äºç±»çš„æ¯ä¸ªå¯¹è±¡çš„ï¼Œå¿…é¡»ç”¨ç±»çš„å¯¹è±¡æ¥è®¿é—®ã€‚ 



****



#### staticç”¨æ³•

æˆå‘˜å˜é‡çš„è®¿é—®è¯­æ³•ï¼š

* é™æ€æˆå‘˜å˜é‡ï¼šåªæœ‰ä¸€ä»½å¯ä»¥è¢«ç±»å’Œç±»çš„å¯¹è±¡**å…±äº«è®¿é—®**
  * ç±»å.é™æ€æˆå‘˜å˜é‡ï¼ˆåŒä¸€ä¸ªç±»ä¸­è®¿é—®é™æ€æˆå‘˜å˜é‡å¯ä»¥çœç•¥ç±»åä¸å†™ï¼‰
  * å¯¹è±¡.é™æ€æˆå‘˜å˜é‡ï¼ˆä¸æ¨èï¼‰

* å®ä¾‹æˆå‘˜å˜é‡ï¼š
  * å¯¹è±¡.å®ä¾‹æˆå‘˜å˜é‡ï¼ˆå…ˆåˆ›å»ºå¯¹è±¡ï¼‰

æˆå‘˜æ–¹æ³•çš„è®¿é—®è¯­æ³•ï¼š

* é™æ€æ–¹æ³•ï¼šæœ‰staticä¿®é¥°ï¼Œå±äºç±»

  * ç±»å.é™æ€æ–¹æ³•ï¼ˆåŒä¸€ä¸ªç±»ä¸­è®¿é—®é™æ€æˆå‘˜å¯ä»¥çœç•¥ç±»åä¸å†™ï¼‰
  * å¯¹è±¡.é™æ€æ–¹æ³•ï¼ˆä¸æ¨èï¼‰
  
* å®ä¾‹æ–¹æ³•ï¼šæ— staticä¿®é¥°ï¼Œå±äºå¯¹è±¡

  * å¯¹è±¡.å®ä¾‹æ–¹æ³•
  
  ```java
  public class Student {
      // 1.é™æ€æ–¹æ³•ï¼šæœ‰staticä¿®é¥°ï¼Œå±äºç±»ï¼Œç›´æ¥ç”¨ç±»åè®¿é—®å³å¯ï¼
      public static void inAddr(){ }
      // 2.å®ä¾‹æ–¹æ³•ï¼šæ— staticä¿®é¥°ï¼Œå±äºå¯¹è±¡ï¼Œå¿…é¡»ç”¨å¯¹è±¡è®¿é—®ï¼
      public void eat(){}
      
      public static void main(String[] args) {
          // a.ç±»å.é™æ€æ–¹æ³•
          Student.inAddr();
          inAddr();
          // b.å¯¹è±¡.å®ä¾‹æ–¹æ³•
          // Student.eat(); // æŠ¥é”™äº†ï¼
          Student zbj = new Student();
          zbj.eat();
      }
  }
  ```
  



***



#### ä¸¤ä¸ªé—®é¢˜

å†…å­˜é—®é¢˜ï¼š

* **æ ˆå†…å­˜å­˜æ”¾mainæ–¹æ³•å’Œåœ°å€**

* **å †å†…å­˜å­˜æ”¾å¯¹è±¡å’Œå˜é‡**

* **æ–¹æ³•åŒºå­˜æ”¾classå’Œé™æ€å˜é‡**

è®¿é—®é—®é¢˜ï¼š

â€‹     a.å®ä¾‹æ–¹æ³•æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å®ä¾‹æˆå‘˜å˜é‡ï¼Ÿå¯ä»¥çš„ï¼Œå› ä¸ºå®ƒä»¬éƒ½å±äºå¯¹è±¡ã€‚
â€‹     b.å®ä¾‹æ–¹æ³•æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®é™æ€æˆå‘˜å˜é‡ï¼Ÿå¯ä»¥çš„ï¼Œé™æ€æˆå‘˜å˜é‡å¯ä»¥è¢«å…±äº«è®¿é—®ã€‚
â€‹     c.å®ä¾‹æ–¹æ³•æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å®ä¾‹æ–¹æ³•? å¯ä»¥çš„ï¼Œå®ä¾‹æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•éƒ½å±äºå¯¹è±¡ã€‚
â€‹     d.å®ä¾‹æ–¹æ³•æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®é™æ€æ–¹æ³•ï¼Ÿå¯ä»¥çš„ï¼Œé™æ€æ–¹æ³•å¯ä»¥è¢«å…±äº«è®¿é—®ï¼

â€‹     a.é™æ€æ–¹æ³•æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å®ä¾‹å˜é‡ï¼Ÿ ä¸å¯ä»¥çš„ï¼Œå®ä¾‹å˜é‡å¿…é¡»ç”¨å¯¹è±¡è®¿é—®ï¼ï¼
â€‹     b.é™æ€æ–¹æ³•æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®é™æ€å˜é‡ï¼Ÿ å¯ä»¥çš„ï¼Œé™æ€æˆå‘˜å˜é‡å¯ä»¥è¢«å…±äº«è®¿é—®ã€‚
â€‹     c.é™æ€æ–¹æ³•æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å®ä¾‹æ–¹æ³•? ä¸å¯ä»¥çš„ï¼Œå®ä¾‹æ–¹æ³•å¿…é¡»ç”¨å¯¹è±¡è®¿é—®ï¼ï¼
â€‹     d.é™æ€æ–¹æ³•æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®é™æ€æ–¹æ³•ï¼Ÿå¯ä»¥çš„ï¼Œé™æ€æ–¹æ³•å¯ä»¥è¢«å…±äº«è®¿é—®ï¼ï¼



------



### ç»§æ‰¿

#### ç»§æ‰¿æ¦‚è¿°

ç»§æ‰¿æ˜¯Javaä¸­ä¸€èˆ¬åˆ°ç‰¹æ®Šçš„å…³ç³»ï¼Œæ˜¯ä¸€ç§å­ç±»åˆ°çˆ¶ç±»çš„å…³ç³»ã€‚

è¢«ç»§æ‰¿çš„ç±»ç§°ä¸ºï¼šçˆ¶ç±»/è¶…ç±»ã€‚
ç»§æ‰¿çˆ¶ç±»çš„ç±»ç§°ä¸ºï¼šå­ç±»ã€‚

ç»§æ‰¿çš„ä½œç”¨ï¼š

* **æé«˜ä»£ç çš„å¤ç”¨**ï¼Œç›¸åŒä»£ç å¯ä»¥å®šä¹‰åœ¨çˆ¶ç±»ä¸­
* å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç±»è¿™äº›ä»£ç ï¼ˆç›¸åŒä»£ç é‡å¤åˆ©ç”¨ï¼‰
* å­ç±»å¾—åˆ°çˆ¶ç±»çš„å±æ€§ï¼ˆæˆå‘˜å˜é‡ï¼‰å’Œè¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰ï¼Œå­ç±»å¾—åˆ°äº†çˆ¶ç±»çš„åŠŸèƒ½ï¼Œè¿˜æœ‰è‡ªå·±çš„åŠŸèƒ½ï¼Œå­ç±»æ›´å¼ºå¤§

ç»§æ‰¿çš„ç‰¹ç‚¹ï¼š

1. å­ç±»çš„å…¨éƒ¨æ„é€ å™¨é»˜è®¤å…ˆè®¿é—®çˆ¶ç±»çš„æ— å‚æ•°æ„é€ å™¨ï¼Œå†æ‰§è¡Œè‡ªå·±çš„æ„é€ å™¨
2. **å•ç»§æ‰¿**ï¼šä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç›´æ¥çˆ¶ç±»
3. å¤šå±‚ç»§æ‰¿ï¼šä¸€ä¸ªç±»å¯ä»¥é—´æ¥ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ï¼ˆå®¶è°±ï¼‰
4. ä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªå­ç±»
5. ä¸€ä¸ªç±»è¦ä¹ˆé»˜è®¤ç»§æ‰¿äº†Objectç±»ï¼Œè¦ä¹ˆé—´æ¥ç»§æ‰¿äº†Objectç±»ï¼ŒObjectç±»æ˜¯Javaä¸­çš„ç¥–å®—ç±»

ç»§æ‰¿çš„æ ¼å¼ï¼š

```java
å­ç±» extends çˆ¶ç±»{

}
```

å­ç±»ä¸èƒ½ç»§æ‰¿çˆ¶ç±»çš„ä¸œè¥¿ï¼š

* å­ç±»ä¸èƒ½ç»§æ‰¿çˆ¶ç±»çš„æ„é€ å™¨ï¼Œå­ç±»æœ‰è‡ªå·±çš„æ„é€ å™¨ã€‚ï¼ˆæ²¡æœ‰äº‰è®®çš„ï¼‰

    * å­ç±»æ˜¯å¦å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„ç§æœ‰æˆå‘˜ï¼ˆç§æœ‰æˆå‘˜å˜é‡ï¼Œç§æœ‰æˆå‘˜æ–¹æ³•ï¼‰?ï¼ˆæœ‰äº‰è®®ï¼‰
        å­ç±»æ˜¯å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„ç§æœ‰æˆå‘˜çš„ï¼Œåªæ˜¯ä¸èƒ½ç›´æ¥è®¿é—®è€Œå·²ã€‚å¯ä»¥åå°„æš´åŠ›å»è®¿é—®ç»§æ‰¿è‡ªçˆ¶ç±»çš„ç§æœ‰æˆå‘˜
    * å­ç±»æ˜¯å¦å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„é™æ€æˆå‘˜ï¼Ÿï¼ˆæœ‰äº‰è®®ï¼‰
        å­ç±»æ˜¯ä¸èƒ½ç»§æ‰¿çˆ¶ç±»çš„é™æ€æˆå‘˜çš„ï¼Œå­ç±»åªæ˜¯å¯ä»¥è®¿é—®çˆ¶ç±»çš„é™æ€æˆå‘˜ï¼Œçˆ¶ç±»é™æ€æˆå‘˜åªæœ‰ä¸€ä»½å¯ä»¥è¢«å­ç±»å…±äº«è®¿é—®ã€‚**å…±äº«å¹¶éç»§æ‰¿**ã€‚
    
    ```java
    public class ExtendsDemo {
        public static void main(String[] args) {
            Cat c = new Cat();
            // c.run();
            Cat.test();
            System.out.println(Cat.schoolName);
        }
    }
    class Cat extends Animal{
    }
    class Animal{
        public static String schoolName ="é»‘é©¬";
        public static void test(){}
        private void run(){}
    }
    ```



***



#### ç»§æ‰¿è®¿é—®

ç»§æ‰¿åæˆå‘˜å˜é‡çš„è®¿é—®ç‰¹ç‚¹ï¼š**å°±è¿‘åŸåˆ™**ï¼Œå­ç±»æœ‰æ‰¾å­ç±»ï¼Œå­ç±»æ²¡æœ‰æ‰¾çˆ¶ç±»ï¼Œçˆ¶ç±»æ²¡æœ‰å°±æŠ¥é”™ï¼

å¦‚æœè¦ç”³æ˜è®¿é—®çˆ¶ç±»çš„æˆå‘˜å˜é‡å¯ä»¥ä½¿ç”¨ï¼šsuper.çˆ¶ç±»æˆå‘˜å˜é‡ã€‚superæŒ‡çˆ¶ç±»å¼•ç”¨ã€‚

```java
public class ExtendsDemo {
    public static void wmain(String[] args) {
        Wolf w = new Wolf();w
        w.showName();
    }
}
class Wolf extends Animal{
    private String name = "å­ç±»ç‹¼";
    public void showName(){
        String name = "å±€éƒ¨åç§°";
        System.out.println(name); // å±€éƒ¨name
        System.out.println(this.name); // å­ç±»å¯¹è±¡çš„name
        System.out.println(super.name); // çˆ¶ç±»çš„
        System.out.println(name1); // çˆ¶ç±»çš„
        //System.out.println(name2); // æŠ¥é”™ã€‚å­ç±»çˆ¶ç±»éƒ½æ²¡æœ‰
    }
}

class Animal{
    public String name = "çˆ¶ç±»åŠ¨ç‰©åç§°";
    public String name1 = "çˆ¶ç±»";
}
```



***



#### æ–¹æ³•é‡å†™

æ–¹æ³•é‡å†™çš„æ¦‚å¿µï¼š
    å­ç±»ç»§æ‰¿äº†çˆ¶ç±»ï¼Œå­ç±»å°±å¾—åˆ°äº†çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•ï¼Œå­ç±»é‡å†™ä¸€ä¸ªä¸çˆ¶ç±»ç”³æ˜ä¸€æ ·çš„æ–¹æ³•æ¥**è¦†ç›–**çˆ¶ç±»çš„è¯¥æ–¹æ³•ã€‚

æ–¹æ³•é‡å†™çš„æ ¡éªŒæ³¨è§£ï¼š @Override
    æ–¹æ³•ä¸€æ—¦åŠ äº†è¿™ä¸ªæ³¨è§£ï¼Œé‚£å°±å¿…é¡»æ˜¯æˆåŠŸé‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¦åˆ™æŠ¥é”™ï¼
    **@Overrideä¼˜åŠ¿ï¼šå¯è¯»æ€§å¥½ï¼Œå®‰å…¨ï¼Œä¼˜é›…ï¼ï¼**

æ–¹æ³•é‡å†™çš„å…·ä½“è¦æ±‚ï¼š
    1.å­ç±»é‡å†™æ–¹æ³•çš„åç§°å’Œå½¢å‚åˆ—è¡¨å¿…é¡»ä¸çˆ¶ç±»è¢«é‡å†™æ–¹æ³•ä¸€æ ·ã€‚
    2.å­ç±»é‡å†™æ–¹æ³•çš„è¿”å›å€¼ç±»å‹è¦ä¹ˆä¸çˆ¶ç±»ä¸€æ ·ï¼Œè¦ä¹ˆæ¯”çˆ¶ç±»æ–¹æ³•èŒƒå›´æ›´å°ã€‚
    3.å­ç±»é‡å†™æ–¹æ³•çš„ä¿®é¥°ç¬¦æƒé™åº”è¯¥ä¸çˆ¶ç±»è¢«é‡å†™æ–¹æ³•çš„ä¿®é¥°ç¬¦æƒé™ç›¸åŒæˆ–è€…æ›´å¤§ã€‚
    4.å­ç±»é‡å†™æ–¹æ³•ç”³æ˜æŠ›å‡ºçš„å¼‚å¸¸åº”è¯¥ä¸çˆ¶ç±»è¢«é‡å†™æ–¹æ³•ç”³æ˜æŠ›å‡ºçš„å¼‚å¸¸ä¸€æ ·æˆ–è€…èŒƒå›´æ›´å°ã€‚

```java
public class ExtendsDemo {
    public static void main(String[] args) {
        Wolf w = new Wolf();
        w.run();
    }
}
class Wolf extends Animal{
    @Override
    public void run(){}//
}
class Animal{
    public void run(){}
}
```



***



#### é¢è¯•é—®é¢˜

* **ä¸ºä»€ä¹ˆå­ç±»æ„é€ å™¨ä¼šå…ˆè°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Ÿ**
      1.å­ç±»çš„æ„é€ å™¨çš„ç¬¬ä¸€è¡Œé»˜è®¤super()è°ƒç”¨çˆ¶ç±»çš„æ— å‚æ•°æ„é€ å™¨ï¼Œå†™ä¸å†™éƒ½å­˜åœ¨!
      2.å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œå­ç±»å°±å¾—åˆ°äº†çˆ¶ç±»çš„å±æ€§å’Œè¡Œä¸ºã€‚
          è°ƒç”¨å­ç±»æ„é€ å™¨åˆå§‹åŒ–å­ç±»å¯¹è±¡æ•°æ®æ—¶ï¼Œå¿…é¡»å…ˆè°ƒç”¨çˆ¶ç±»æ„é€ å™¨åˆå§‹åŒ–ç»§æ‰¿è‡ªçˆ¶ç±»çš„å±æ€§å’Œè¡Œä¸º

  ```java
  class Animal{
      public Animal(){
          System.out.println("==çˆ¶ç±»Animalçš„æ— å‚æ•°æ„é€ å™¨==");
      }
  }
  class Tiger extends Animal{
      public Tiger(){
          super(); // é»˜è®¤å­˜åœ¨çš„ï¼Œæ ¹æ®å‚æ•°å»åŒ¹é…è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ã€‚
          System.out.println("==å­ç±»Tigerçš„æ— å‚æ•°æ„é€ å™¨==");
      }
      public Tiger(String name){
          //super();  é»˜è®¤å­˜åœ¨çš„ï¼Œæ ¹æ®å‚æ•°å»åŒ¹é…è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ã€‚
          System.out.println("==å­ç±»Tigerçš„æœ‰å‚æ•°æ„é€ å™¨==");
      }
  }
  ```

  

* **ä¸ºä»€ä¹ˆJavaæ˜¯å•ç»§æ‰¿çš„ï¼Ÿ**
  ç­”ï¼šåè¯æ³•ï¼Œå‡å¦‚Javaå¯ä»¥å¤šç»§æ‰¿ï¼Œè¯·çœ‹å¦‚ä¸‹ä»£ç ï¼š
  è¡¥å……ï¼šå¤šå®ç°æ˜¯åœ¨å®ç°æ¥å£æ—¶ï¼Œé‡åæ–¹æ³•éœ€è¦å®ç°ç±»æ¥å®ç°

  ```java
  class A{
  	public void test(){
  		System.out.println("A");
  	}
  }
  class B{
  	public void test(){
  		System.out.println("B");
  	}
  }
  class C extends A , B {
  	public static void main(String[] args){
  		C c = new C();
          c.test(); 
          // å‡ºç°äº†ç±»çš„äºŒä¹‰æ€§ï¼æ‰€ä»¥Javaä¸èƒ½å¤šç»§æ‰¿ï¼ï¼
  	}
  }
  ```

  



------



### super

ç»§æ‰¿åsuperè°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œçˆ¶ç±»æ„é€ å™¨åˆå§‹åŒ–ç»§æ‰¿è‡ªçˆ¶ç±»çš„æ•°æ®ã€‚

super(...)ï¼šå¯ä»¥æ ¹æ®å‚æ•°é€‰æ‹©è°ƒç”¨çˆ¶ç±»çš„æŸä¸ªæ„é€ å™¨ã€‚


æ€»ç»“ä¸æ‹“å±•ï¼š

> thisä»£è¡¨äº†å½“å‰å¯¹è±¡çš„å¼•ç”¨ï¼ˆç»§æ‰¿ä¸­æŒ‡ä»£å­ç±»å¯¹è±¡ï¼‰ï¼š
> 	this.å­ç±»æˆå‘˜å˜é‡ã€‚
> 	this.å­ç±»æˆå‘˜æ–¹æ³•ã€‚
>    	this(...):å¯ä»¥æ ¹æ®å‚æ•°åŒ¹é…è®¿é—®æœ¬ç±»å…¶ä»–æ„é€ å™¨ã€‚
> superä»£è¡¨äº†çˆ¶ç±»å¯¹è±¡çš„å¼•ç”¨ï¼ˆç»§æ‰¿ä¸­æŒ‡ä»£äº†çˆ¶ç±»å¯¹è±¡ç©ºé—´ï¼‰
>    	super.çˆ¶ç±»æˆå‘˜å˜é‡ã€‚
>    	super.çˆ¶ç±»çš„æˆå‘˜æ–¹æ³•ã€‚
>    	super(...):å¯ä»¥æ ¹æ®å‚æ•°åŒ¹é…è®¿é—®çˆ¶ç±»çš„æ„é€ å™¨ã€‚

**æ³¨æ„ï¼š**
    this(...)å€Ÿç”¨æœ¬ç±»å…¶ä»–æ„é€ å™¨ï¼Œsuper(...)è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ã€‚
    this(...)å’Œsuper(...)å¿…é¡»æ”¾åœ¨æ„é€ å™¨çš„ç¬¬ä¸€è¡Œï¼Œå¦åˆ™æŠ¥é”™!
    this(...)å’Œsuper(...)ä¸èƒ½åŒæ—¶å‡ºç°åœ¨æ„é€ å™¨ä¸­ï¼Œå› ä¸ºæ„é€ å‡½æ•°å¿…é¡»å‡ºç°åœ¨ç¬¬ä¸€è¡Œä¸Šï¼Œåªèƒ½é€‰æ‹©ä¸€ä¸ªã€‚

```java
public class ThisDemo {
    public static void main(String[] args) {
        // éœ€æ±‚ï¼šå¸Œæœ›å¦‚æœä¸å†™å­¦æ ¡é»˜è®¤å°±æ˜¯â€é»‘é©¬â€œï¼
        Student s1 = new Student("å¤©è“¬å…ƒå¸…", 1000 );
        Student s2 = new Student("é½å¤©å¤§åœ£", 2000, "æ¸…åå¤§å­¦" );
    }
}
class Study extends Student {
   public Study(String name, int age, String schoolName) {
        super(name , age , schoolName) ; 
       // æ ¹æ®å‚æ•°åŒ¹é…è°ƒç”¨çˆ¶ç±»æ„é€ å™¨
   }
}

class Student{
    private String name ;
    private int age ;
    private String schoolName ;

    public Student() {
    }
    public Student(String name , int age){
        // å€Ÿç”¨å…„å¼Ÿæ„é€ å™¨çš„åŠŸèƒ½ï¼
        this(name , age , "é»‘é©¬");
    }
	public Student(String name, int age, String schoolName) {
        this.name = name;
        this.age = age;
        this.schoolName = schoolName;
    }
// .......get + set
}
```



***



### final

#### finalæ¦‚è¿°

finalç”¨äºä¿®é¥°ï¼šç±»ï¼Œæ–¹æ³•ï¼Œå˜é‡

* finalä¿®é¥°ç±»ï¼Œç±»ä¸èƒ½è¢«ç»§æ‰¿äº†ï¼Œç±»ä¸­çš„æ–¹æ³•å’Œå˜é‡å¯ä»¥ä½¿ç”¨
* finalå¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œæ–¹æ³•å°±ä¸èƒ½è¢«é‡å†™äº†
* finalä¿®é¥°å˜é‡æ€»è§„åˆ™ï¼šå˜é‡æœ‰ä¸”ä»…èƒ½è¢«èµ‹å€¼ä¸€æ¬¡

**é¢è¯•é¢˜**ï¼šfinalå’Œabstractçš„å…³ç³»?
      äº’æ–¥å…³ç³»ï¼Œä¸èƒ½åŒæ—¶ä¿®é¥°ç±»æˆ–è€…åŒæ—¶ä¿®é¥°æ–¹æ³•ï¼ï¼



***



#### ä¿®é¥°å˜é‡

ä»£ç å—çš„ç›¸å…³çŸ¥è¯†

>* æˆå‘˜å˜é‡
>      * é™æ€æˆå‘˜å˜é‡ï¼šæœ‰staticä¿®é¥°ï¼Œå±äºç±»ï¼ŒåªåŠ è½½ä¸€ä»½
>      *  å®ä¾‹æˆå‘˜å˜é‡ï¼šæ— staticä¿®é¥°ï¼Œå±äºæ¯ä¸ªå¯¹è±¡,ä¸å¯¹è±¡ä¸€èµ·åŠ è½½
>* å±€éƒ¨å˜é‡
>      * åªèƒ½æ–¹æ³•ä¸­ï¼Œæ„é€ å™¨ä¸­ï¼Œä»£ç å—ä¸­ï¼Œforå¾ªç¯ä¸­ï¼Œç”¨å®Œä½œç”¨èŒƒå›´å°±æ¶ˆå¤±äº†ã€‚ 
>* finalä¿®é¥°å±€éƒ¨å˜é‡ï¼š
>      * è®©å€¼è¢«å›ºå®šæˆ–è€…è¯´ä¿æŠ¤èµ·æ¥ï¼Œæ‰§è¡Œçš„è¿‡ç¨‹ä¸­é˜²æ­¢è¢«ä¿®æ”¹ã€‚

##### é™æ€æˆå‘˜å˜é‡

finalä¿®é¥°é™æ€æˆå‘˜å˜é‡ï¼Œå˜é‡å˜æˆäº†å¸¸é‡

**å¸¸é‡ï¼šæœ‰public static finalä¿®é¥°ï¼Œåç§°å­—æ¯å…¨éƒ¨å¤§å†™ï¼Œå¤šä¸ªå•è¯ç”¨ä¸‹åˆ’çº¿è¿æ¥ã€‚**

finalä¿®é¥°é™æ€æˆå‘˜å˜é‡å¯ä»¥åœ¨å“ªäº›åœ°æ–¹èµ‹å€¼ï¼š

1. å®šä¹‰çš„æ—¶å€™èµ‹å€¼ä¸€æ¬¡

2. å¯ä»¥åœ¨é™æ€ä»£ç å—ä¸­èµ‹å€¼ä¸€æ¬¡ã€‚

```java
public class FinalDemo {
//å¸¸é‡ï¼špublic static finalä¿®é¥°ï¼Œåç§°å­—æ¯å…¨éƒ¨å¤§å†™ï¼Œä¸‹åˆ’çº¿è¿æ¥ã€‚
    public static final String SCHOOL_NAME = "é»‘é©¬" ;
    public static final String SCHOOL_NAME1;

    static{
        //SCHOOL_NAME = "java";//æŠ¥é”™
        SCHOOL_NAME1 = "é»‘é©¬1";
        //SCHOOL_NAME1 = "é»‘é©¬2"; // æŠ¥é”™ï¼Œç¬¬äºŒæ¬¡èµ‹å€¼ï¼
    }
}
```



##### å®ä¾‹æˆå‘˜å˜é‡

finalä¿®é¥°å˜é‡çš„æ€»è§„åˆ™ï¼šæœ‰ä¸”ä»…èƒ½è¢«èµ‹å€¼ä¸€æ¬¡ã€‚

finalä¿®é¥°å®ä¾‹æˆå‘˜å˜é‡å¯ä»¥åœ¨å“ªäº›åœ°æ–¹èµ‹å€¼1æ¬¡ï¼š

1. å®šä¹‰çš„æ—¶å€™èµ‹å€¼ä¸€æ¬¡ã€‚
2. å¯ä»¥åœ¨å®ä¾‹ä»£ç å—ä¸­èµ‹å€¼ä¸€æ¬¡ã€‚
3. å¯ä»¥åœ¨æ¯ä¸ªæ„é€ å™¨ä¸­èµ‹å€¼ä¸€æ¬¡ã€‚

```java
public class FinalDemo {
    private final String name = "é»‘é©¬" ;
    private final String name1;
    private final String name2;
    {
        // å¯ä»¥åœ¨å®ä¾‹ä»£ç å—ä¸­èµ‹å€¼ä¸€æ¬¡ã€‚
        name1 = "é»‘é©¬1";
    }
	//æ„é€ å™¨èµ‹å€¼ä¸€æ¬¡
    public FinalDemo(){
        name2 = "é»‘é©¬2";
    }
    public FinalDemo(String a){
        name2 = "é»‘é©¬2";
    }

    public static void main(String[] args) {
        FinalDemo f1 = new FinalDemo();
        //f1.name = "é»‘é©¬1"; // ç¬¬äºŒæ¬¡èµ‹å€¼ æŠ¥é”™ï¼
    }
}
```



***



### æŠ½è±¡ç±»

#### æ¦‚è¿°

> çˆ¶ç±»çŸ¥é“å­ç±»è¦å®ŒæˆæŸä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯æ¯ä¸ªå­ç±»å®ç°æƒ…å†µä¸ä¸€æ ·ã€‚

æŠ½è±¡æ–¹æ³•ï¼šæ²¡æœ‰æ–¹æ³•ä½“ï¼Œåªæœ‰æ–¹æ³•ç­¾åï¼Œå¿…é¡»ç”¨**abstract**ä¿®é¥°çš„æ–¹æ³•å°±æ˜¯æŠ½è±¡æ–¹æ³•ã€‚
æŠ½è±¡ç±»ï¼šæ‹¥æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»å¿…é¡»å®šä¹‰æˆæŠ½è±¡ç±»ï¼Œå¿…é¡»ç”¨**abstract**ä¿®é¥°ï¼ŒæŠ½è±¡ç±»æ˜¯ä¸ºäº†è¢«ç»§æ‰¿ã€‚

ä¸€ä¸ªç±»ç»§æ‰¿æŠ½è±¡ç±»ï¼Œ**å¿…é¡»é‡å†™æŠ½è±¡ç±»çš„å…¨éƒ¨æŠ½è±¡æ–¹æ³•**ï¼Œå¦åˆ™è¿™ä¸ªç±»å¿…é¡»å®šä¹‰æˆæŠ½è±¡ç±»ï¼Œå› ä¸ºæ‹¥æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»å¿…é¡»å®šä¹‰æˆæŠ½è±¡ç±»ã€‚

```java
public class AbstractDemo {
    public static void main(String[] args) {
        Dog d = new Dog();
        d.run();
    }
}

class Dog extends Animal{
    @Override
    public void run() { 
        System.out.println("ğŸ•è·‘"); 
    }
}

abstract class Animal{
    public abstract void run();
}
```



***



#### é¢è¯•é—®é¢˜

ä¸€ã€æŠ½è±¡ç±»æ˜¯å¦æœ‰æ„é€ å™¨ï¼Œæ˜¯å¦å¯ä»¥åˆ›å»ºå¯¹è±¡ï¼Œä¸ºä»€ä¹ˆ?
ç­”ï¼šæŠ½è±¡ç±»ä½œä¸ºç±»ä¸€å®šæœ‰æ„é€ å™¨ï¼Œè€Œä¸”å¿…é¡»æœ‰æ„é€ å™¨ï¼Œæä¾›ç»™å­ç±»ç»§æ‰¿åè°ƒç”¨çˆ¶ç±»æ„é€ å™¨ä½¿ç”¨çš„ã€‚

1ã€æŠ½è±¡ç±»æœ‰æ„é€ å™¨ï¼Œä½†æ˜¯æŠ½è±¡ç±»ä¸èƒ½åˆ›å»ºå¯¹è±¡ï¼Œç±»çš„å…¶ä»–æˆåˆ†å®ƒéƒ½å…·å¤‡ï¼
2ã€æŠ½è±¡ç±»ä¸­å­˜åœ¨æŠ½è±¡æ–¹æ³•ï¼Œä½†ä¸èƒ½æ‰§è¡Œï¼ŒæŠ½è±¡ç±»ä¸­ä¹Ÿå¯æ²¡æœ‰æŠ½è±¡æ–¹æ³•

> æŠ½è±¡åœ¨å­¦æœ¯ä¸Šæœ¬èº«æ„å‘³ç€ä¸èƒ½å®ä¾‹åŒ–ã€‚

```java
public class AbstractDemo {
    public static void main(String[] args) {
        //Animal a = new Animal(); æŠ½è±¡ç±»ä¸èƒ½åˆ›å»ºå¯¹è±¡ï¼
        //a.run(); // æŠ½è±¡æ–¹æ³•ä¸èƒ½æ‰§è¡Œ
    }
}
abstract class Animal{
    private String name;
    public static String schoolName = "é»‘é©¬";
    public Animal(){ }

    public abstract void run();
    //æ™®é€šæ–¹æ³•
    public void go(){ }
}
```



äºŒã€staticä¸abstractèƒ½åŒæ—¶ä½¿ç”¨å—ï¼Ÿ
ç­”ï¼šä¸èƒ½ï¼Œè¢«staticä¿®é¥°çš„æ–¹æ³•å±äºç±»ï¼Œæ˜¯ç±»è‡ªå·±çš„ä¸œè¥¿ï¼Œä¸æ˜¯ç»™å­ç±»æ¥ç»§æ‰¿çš„ï¼Œè€ŒæŠ½è±¡æ–¹æ³•æœ¬èº«æ²¡æœ‰å®ç°ï¼Œå°±æ˜¯ç”¨æ¥ç»™å­ç±»ç»§æ‰¿ã€‚



***



#### å­˜åœ¨æ„ä¹‰

   * **è¢«ç»§æ‰¿**ï¼ŒæŠ½è±¡ç±»å°±æ˜¯ä¸ºäº†è¢«å­ç±»ç»§æ‰¿ï¼Œå¦åˆ™æŠ½è±¡ç±»å°†æ¯«æ— æ„ä¹‰ã€‚(æ ¸å¿ƒï¼‰
   * æŠ½è±¡ç±»ä½“ç°çš„æ˜¯"æ¨¡æ¿æ€æƒ³"ï¼š**éƒ¨åˆ†å®ç°ï¼Œéƒ¨åˆ†æŠ½è±¡**ã€‚ å¯ä»¥ä½¿ç”¨æŠ½è±¡ç±»è®¾è®¡ä¸€ä¸ªæ¨¡æ¿æ¨¡å¼ã€‚

```java
//ä½œæ–‡æ¨¡æ¿
public class ExtendsDemo {
    public static void main(String[] args) {
        Student xiaoMa = new Student();
        xiaoMa.write();
    }
}
class Student extends Template{
    @Override
    public String writeText() {return "\tå†…å®¹"}
}
// 1.å†™ä¸€ä¸ªæ¨¡æ¿ç±»ï¼šä»£è¡¨äº†ä½œæ–‡æ¨¡æ¿ã€‚
abstract class Template{
    private String title = "\t\t\t\t\tæ ‡é¢˜";
    private String start = "\tå¼€å¤´";
    private String last = "\tç»“å°¾";
    public void write(){
        System.out.println(title+"\n"+start);
        System.out.println(writeText());
        System.out.println(last);
    }
    // æ­£æ–‡éƒ¨åˆ†å®šä¹‰æˆæŠ½è±¡æ–¹æ³•ï¼Œäº¤ç»™å­ç±»é‡å†™ï¼ï¼
    public abstract String writeText();
}
```



***



### æ¥å£

#### æ¦‚è¿°

æ¥å£ï¼Œæ˜¯Javaè¯­è¨€ä¸­ä¸€ç§å¼•ç”¨ç±»å‹ï¼Œæ˜¯æ–¹æ³•çš„é›†åˆã€‚

æ¥å£æ˜¯æ›´åŠ å½»åº•çš„æŠ½è±¡ï¼Œæ¥å£ä¸­åªæœ‰æŠ½è±¡æ–¹æ³•å’Œå¸¸é‡ï¼Œæ²¡æœ‰å…¶ä»–æˆåˆ†ã€‚jdk1.8å‰

> æ¥å£ç§°ä¸º è¢«å®ç°ï¼Œå®ç°æ¥å£çš„ç±»ç§°ä¸º**å®ç°ç±»**ã€‚

```java
 ä¿®é¥°ç¬¦ interface æ¥å£åç§°{
	// æŠ½è±¡æ–¹æ³•
	// é»˜è®¤æ–¹æ³•
	// é™æ€æ–¹æ³•
	// ç§æœ‰æ–¹æ³•
}
```

* æŠ½è±¡æ–¹æ³•ï¼šæ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•é»˜è®¤ä¼šåŠ ä¸Špublic abstractä¿®é¥°ï¼Œæ‰€ä»¥å¯ä»¥çœç•¥ä¸å†™

* é™æ€æ–¹æ³•ï¼šé™æ€æ–¹æ³•å¿…é¡»æœ‰æ–¹æ³•ä½“

* å¸¸é‡ï¼šå¸¸é‡æ˜¯public static finalä¿®é¥°çš„æˆå‘˜å˜é‡ï¼Œä»…èƒ½è¢«èµ‹å€¼ä¸€æ¬¡ï¼Œå€¼ä¸èƒ½æ”¹å˜ã€‚å¸¸é‡çš„åç§°è§„èŒƒä¸Šè¦æ±‚å…¨éƒ¨å¤§å†™ï¼Œå¤šä¸ªå•è¯ä¸‹åˆ’çº¿è¿æ¥ã€‚public static finalå¯ä»¥çœç•¥ä¸å†™ã€‚

  ```java
  public interface InterfaceDemo{
      //public static final String SCHOOL_NAME = "é»‘é©¬";
  	String SCHOOL_NAME = "é»‘é©¬";
      
      //public abstract void run();
      void run();//é»˜è®¤è¡¥å……
  }
  ```




***




#### å®ç°

ä½œç”¨ï¼š**æ¥å£æ˜¯ç”¨æ¥è¢«ç±»å®ç°çš„ã€‚**

ç±»ä¸ç±»æ˜¯ç»§æ‰¿å…³ç³»ï¼šä¸€ä¸ªç±»åªèƒ½ç›´æ¥ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œå•ç»§æ‰¿
ç±»ä¸æ¥å£æ˜¯å®ç°å…³ç³»ï¼šä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œå¤šå®ç°
æ¥å£ä¸æ¥å£ç»§æ‰¿å…³ç³»ï¼š**å¤šç»§æ‰¿**

>å­ç±»   ç»§æ‰¿   çˆ¶ç±»
>å®ç°ç±» å®ç°   æ¥å£

```java
ä¿®é¥°ç¬¦ class å®ç°ç±»åç§° implements æ¥å£1,æ¥å£2,æ¥å£3,....{

}
ä¿®é¥°ç¬¦ interface æ¥å£å extend æ¥å£1,æ¥å£2,æ¥å£3,....{
    
}
```

å®ç°å¤šä¸ªæ¥å£çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼š

1. å½“ä¸€ä¸ªç±»å®ç°å¤šä¸ªæ¥å£æ—¶ï¼Œå¤šä¸ªæ¥å£ä¸­å­˜åœ¨åŒåçš„é™æ€æ–¹æ³•å¹¶ä¸ä¼šå†²çªï¼Œåªèƒ½é€šè¿‡å„è‡ªæ¥å£åè®¿é—®é™æ€æ–¹æ³•

2. å½“ä¸€ä¸ªç±»å®ç°å¤šä¸ªæ¥å£æ—¶ï¼Œå¤šä¸ªæ¥å£ä¸­å­˜åœ¨åŒåçš„é»˜è®¤æ–¹æ³•ï¼Œå®ç°ç±»å¿…é¡»é‡å†™è¿™ä¸ªæ–¹æ³•

3. å½“ä¸€ä¸ªç±»ï¼Œæ—¢ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œåˆå®ç°è‹¥å¹²ä¸ªæ¥å£æ—¶ï¼Œçˆ¶ç±»ä¸­çš„æˆå‘˜æ–¹æ³•ä¸æ¥å£ä¸­çš„é»˜è®¤æ–¹æ³•é‡åï¼Œå­ç±»**å°±è¿‘é€‰æ‹©æ‰§è¡Œçˆ¶ç±»**çš„æˆå‘˜æ–¹æ³•

4. æ¥å£ä¸­ï¼Œæ²¡æœ‰æ„é€ å™¨ï¼Œ**ä¸èƒ½åˆ›å»ºå¯¹è±¡**ï¼Œæ¥å£æ˜¯æ›´å½»åº•çš„æŠ½è±¡ï¼Œè¿æ„é€ å™¨éƒ½æ²¡æœ‰ï¼Œè‡ªç„¶ä¸èƒ½åˆ›å»ºå¯¹è±¡ï¼ï¼

   ```java
   public class InterfaceDemo {
       public static void main(String[] args) {
           Student s = new Student();
           s.run();
           s.rule();
       }
   }
   class Student implements Food, Person{
       @Override
       public void eat() {}
       
       @Override
       public void run() {}
   }
   interface Food{
       void eat();
   }
   interface Person{
       void run();
   }
   //å¯ä»¥ç›´æ¥ interface Person extend Food,
   //ç„¶å class Student implements Person æ•ˆæœä¸€æ ·
   ```

   

***



#### JDK1.8ä»¥å

jdk1.8ä»¥åæ–°å¢çš„åŠŸèƒ½ï¼Œå®é™…å¼€å‘ä¸­å¾ˆå°‘ä½¿ç”¨ã€‚

* é»˜è®¤æ–¹æ³•ï¼ˆå°±æ˜¯ä¹‹å‰å†™çš„æ™®é€šå®ä¾‹æ–¹æ³•ï¼‰
      -- å¿…é¡»ç”¨defaultä¿®é¥°ï¼Œé»˜è®¤ä¼špublicä¿®é¥°
      -- å¿…é¡»ç”¨æ¥å£çš„å®ç°ç±»çš„å¯¹è±¡æ¥è°ƒç”¨ã€‚

* é™æ€æ–¹æ³•
      -- é»˜è®¤ä¼špublicä¿®é¥°
      -- æ³¨æ„ï¼šæ¥å£çš„é™æ€æ–¹æ³•å¿…é¡»ç”¨æ¥å£çš„ç±»åæœ¬èº«æ¥è°ƒç”¨ã€‚
      --è°ƒç”¨æ ¼å¼ï¼šClassName.method();
  
* ç§æœ‰æ–¹æ³•ï¼ˆå°±æ˜¯ç§æœ‰çš„å®ä¾‹æ–¹æ³•ï¼‰: JDK 1.9æ‰å¼€å§‹æœ‰çš„ã€‚
      -- åªèƒ½åœ¨**æœ¬ç±»ä¸­**è¢«å…¶ä»–çš„é»˜è®¤æ–¹æ³•æˆ–è€…ç§æœ‰æ–¹æ³•è®¿é—®ã€‚

```java
public class InterfaceDemo {
    public static void main(String[] args) {
        // 1.é»˜è®¤æ–¹æ³•è°ƒç”¨ï¼šå¿…é¡»ç”¨æ¥å£çš„å®ç°ç±»å¯¹è±¡è°ƒç”¨ã€‚
        Man m = new Man();
        m.run();
        m.work();

        // 2.æ¥å£çš„é™æ€æ–¹æ³•å¿…é¡»ç”¨æ¥å£çš„ç±»åæœ¬èº«æ¥è°ƒç”¨ã€‚
        InterfaceJDK8.inAddr();
    }
}
class Man implements InterfaceJDK8{
    @Override
    public void work() {
        System.out.println("å·¥ä½œä¸­ã€‚ã€‚ã€‚");
    }
}

interface InterfaceJDK8{
    //æŠ½è±¡æ–¹æ³•ï¼ï¼
    void work();
    // a.é»˜è®¤æ–¹æ³•ï¼ˆå°±æ˜¯ä¹‹å‰å†™çš„æ™®é€šå®ä¾‹æ–¹æ³•ï¼‰
    // å¿…é¡»ç”¨æ¥å£çš„å®ç°ç±»çš„å¯¹è±¡æ¥è°ƒç”¨ã€‚
    default void run(){
        go();
        System.out.println("å¼€å§‹è·‘æ­¥ğŸƒâ€");
    }

    // b.é™æ€æ–¹æ³•
    // æ³¨æ„ï¼šæ¥å£çš„é™æ€æ–¹æ³•å¿…é¡»ç”¨æ¥å£çš„ç±»åæœ¬èº«æ¥è°ƒç”¨
    static void inAddr(){
        System.out.println("æˆ‘ä»¬åœ¨æ­¦æ±‰");
    }
    
    // c.ç§æœ‰æ–¹æ³•ï¼ˆå°±æ˜¯ç§æœ‰çš„å®ä¾‹æ–¹æ³•ï¼‰: JDK 1.9æ‰å¼€å§‹æœ‰çš„ã€‚
    //  -- åªèƒ½åœ¨æœ¬æ¥å£ä¸­è¢«å…¶ä»–çš„é»˜è®¤æ–¹æ³•æˆ–è€…ç§æœ‰æ–¹æ³•è®¿é—®ã€‚
    private void go(){
        System.out.println("å¼€å§‹ã€‚ã€‚");
    }
}
```



***



#### æŠ½è±¡ç±»å¯¹æ¯”

| **å‚æ•°**           | **æŠ½è±¡ç±»**                                                   | **æ¥å£**                                                     |
| ------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| é»˜è®¤çš„æ–¹æ³•å®ç°     | å¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°                                         | æ¥å£å®Œå…¨æ˜¯æŠ½è±¡çš„ï¼Œæ ¹æœ¬ä¸å­˜åœ¨æ–¹æ³•çš„å®ç°                       |
| å®ç°               | å­ç±»ä½¿ç”¨**extends**å…³é”®å­—æ¥ç»§æ‰¿æŠ½è±¡ç±»ã€‚å¦‚æœå­ç±»ä¸æ˜¯æŠ½è±¡ç±»çš„è¯ï¼Œå®ƒéœ€è¦æä¾›æŠ½è±¡ç±»ä¸­æ‰€æœ‰å£°æ˜çš„æ–¹æ³•çš„å®ç°ã€‚ | å­ç±»ä½¿ç”¨å…³é”®å­—**implements**æ¥å®ç°æ¥å£ã€‚å®ƒéœ€è¦æä¾›æ¥å£ä¸­æ‰€æœ‰å£°æ˜çš„æ–¹æ³•çš„å®ç° |
| æ„é€ å™¨             | æŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ å™¨                                           | æ¥å£ä¸èƒ½æœ‰æ„é€ å™¨                                             |
| ä¸æ­£å¸¸Javaç±»çš„åŒºåˆ« | é™¤äº†ä¸èƒ½å®ä¾‹åŒ–æŠ½è±¡ç±»ä¹‹å¤–ï¼Œå®ƒå’Œæ™®é€šJavaç±»æ²¡æœ‰ä»»ä½•åŒºåˆ«         | æ¥å£æ˜¯å®Œå…¨ä¸åŒçš„ç±»å‹                                         |
| è®¿é—®ä¿®é¥°ç¬¦         | æŠ½è±¡æ–¹æ³•å¯ä»¥æœ‰**public**ã€**protected**å’Œ**default**è¿™äº›ä¿®é¥°ç¬¦ | æ¥å£æ–¹æ³•é»˜è®¤ä¿®é¥°ç¬¦æ˜¯**public**ï¼Œåˆ«çš„ä¿®é¥°ç¬¦éœ€è¦æœ‰æ–¹æ³•ä½“       |
| mainæ–¹æ³•           | æŠ½è±¡æ–¹æ³•å¯ä»¥æœ‰mainæ–¹æ³•å¹¶ä¸”æˆ‘ä»¬å¯ä»¥è¿è¡Œå®ƒ                     | jdk8ä»¥å‰æ¥å£æ²¡æœ‰mainæ–¹æ³•ï¼Œä¸èƒ½è¿è¡Œï¼›jdk8ä»¥åæ¥å£å¯ä»¥æœ‰defaultå’Œstaticæ–¹æ³•ï¼Œå¯ä»¥è¿è¡Œmainæ–¹æ³• |
| å¤šç»§æ‰¿             | æŠ½è±¡æ–¹æ³•å¯ä»¥ç»§æ‰¿ä¸€ä¸ªç±»å’Œå®ç°å¤šä¸ªæ¥å£                         | æ¥å£åªå¯ä»¥ç»§æ‰¿ä¸€ä¸ªæˆ–å¤šä¸ªå…¶å®ƒæ¥å£                             |
| é€Ÿåº¦               | å®ƒæ¯”æ¥å£é€Ÿåº¦è¦å¿«                                             | æ¥å£æ˜¯ç¨å¾®æœ‰ç‚¹æ…¢çš„ï¼Œå› ä¸ºå®ƒéœ€è¦æ—¶é—´å»å¯»æ‰¾åœ¨ç±»ä¸­å®ç°çš„æ–¹æ³•ã€‚   |
| æ·»åŠ æ–°æ–¹æ³•         | å¦‚æœå¾€æŠ½è±¡ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œå¯ä»¥ç»™å®ƒæä¾›é»˜è®¤çš„å®ç°ï¼Œå› æ­¤ä¸éœ€è¦æ”¹å˜ç°åœ¨çš„ä»£ç  | å¦‚æœä½ å¾€æ¥å£ä¸­æ·»åŠ æ–¹æ³•ï¼Œé‚£ä¹ˆä½ å¿…é¡»æ”¹å˜å®ç°è¯¥æ¥å£çš„ç±»ã€‚       |





------



### å¤šæ€

#### å¤šæ€æ¦‚è¿°

å¤šæ€çš„æ¦‚å¿µï¼šåŒä¸€ä¸ªå®ä½“åŒæ—¶å…·æœ‰å¤šç§å½¢å¼åŒä¸€ä¸ªç±»å‹çš„å¯¹è±¡ï¼Œæ‰§è¡ŒåŒä¸€ä¸ªè¡Œä¸ºï¼Œåœ¨ä¸åŒçš„çŠ¶æ€ä¸‹ä¼šè¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºç‰¹å¾ã€‚

å¤šæ€çš„æ ¼å¼ï¼š

* çˆ¶ç±»ç±»å‹èŒƒå›´ > å­ç±»ç±»å‹èŒƒå›´

```java
çˆ¶ç±»ç±»å‹ å¯¹è±¡åç§° = new å­ç±»æ„é€ å™¨;
æ¥å£	  å¯¹è±¡åç§° = new å®ç°ç±»æ„é€ å™¨;
```

å¤šæ€çš„æ‰§è¡Œï¼š

* å¯¹äºæ–¹æ³•çš„è°ƒç”¨ï¼š**ç¼–è¯‘çœ‹å·¦è¾¹ï¼Œè¿è¡Œçœ‹å³è¾¹ã€‚**
* å¯¹äºå˜é‡çš„è°ƒç”¨ï¼š**ç¼–è¯‘çœ‹å·¦è¾¹ï¼Œè¿è¡Œçœ‹å·¦è¾¹ã€‚**

å¤šæ€çš„ä½¿ç”¨å‰æï¼š

* å¿…é¡»å­˜åœ¨ç»§æ‰¿æˆ–è€…å®ç°å…³ç³»ã€‚
* å¿…é¡»å­˜åœ¨çˆ¶ç±»ç±»å‹çš„å˜é‡å¼•ç”¨å­ç±»ç±»å‹çš„å¯¹è±¡ã€‚
* å­˜åœ¨æ–¹æ³•é‡å†™

å¤šæ€çš„ä¼˜åŠ£ï¼š

* ä¼˜åŠ¿ï¼š
  * åœ¨å¤šæ€å½¢å¼ä¸‹ï¼Œå³è¾¹å¯¹è±¡å¯ä»¥å®ç°ç»„ä»¶åŒ–åˆ‡æ¢ï¼Œä¸šåŠ¡åŠŸèƒ½ä¹Ÿéšä¹‹æ”¹å˜ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤ã€‚å¯ä»¥å®ç°ç±»ä¸ç±»ä¹‹é—´çš„**è§£è€¦**
  * çˆ¶ç±»ç±»å‹ä½œä¸ºæ–¹æ³•å½¢å¼å‚æ•°ï¼Œä¼ é€’å­ç±»å¯¹è±¡ç»™æ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥ä¸€åˆ‡å­ç±»å¯¹è±¡è¿›è¡Œæ–¹æ³•çš„è°ƒç”¨ï¼Œæ›´èƒ½ä½“ç°å‡ºå¤šæ€çš„**æ‰©å±•æ€§**ä¸ä¾¿åˆ©æ€§

* åŠ£åŠ¿ï¼š 
  * å¤šæ€å½¢å¼ä¸‹ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨å­ç±»ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œå› ä¸ºç¼–è¯‘çœ‹å·¦è¾¹ï¼Œçˆ¶ç±»ä¸­æ²¡æœ‰å­ç±»ç‹¬æœ‰çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä»£ç åœ¨ç¼–è¯‘é˜¶æ®µå°±ç›´æ¥æŠ¥é”™äº†ï¼ 

```java
public class PolymorphicDemo {
    public static void main(String[] args) {
        Animal c = new Cat();
        c.run();
        //c.eat();//æŠ¥é”™  ç¼–è¯‘çœ‹å·¦è¾¹ éœ€è¦å¼ºè½¬
        go(c);
        go(new Dog);   
    }
    //ç”¨ Dogæˆ–è€…Cat éƒ½æ²¡åŠæ³•è®©æ‰€æœ‰åŠ¨ç‰©å‚ä¸è¿›æ¥ï¼Œåªèƒ½ç”¨Anima
    public static void go(Animal d){}
    
}
class Dog extends Animal{}

class Cat extends Animal{
    public void eat();
    @Override
    public void run(){}
}

class Animal{
    public void run(){}
}
```



***



#### ä¸Šä¸‹è½¬å‹

>åŸºæœ¬æ•°æ®ç±»å‹çš„è½¬æ¢ï¼š
>    1.å°èŒƒå›´ç±»å‹çš„å˜é‡æˆ–è€…å€¼å¯ä»¥ç›´æ¥èµ‹å€¼ç»™å¤§èŒƒå›´ç±»å‹çš„å˜é‡ã€‚
>    2.å¤§èŒƒå›´ç±»å‹çš„å˜é‡æˆ–è€…å€¼å¿…é¡»å¼ºåˆ¶ç±»å‹è½¬æ¢ç»™å°èŒƒå›´ç±»å‹çš„å˜é‡ã€‚

å¼•ç”¨æ•°æ®ç±»å‹çš„**è‡ªåŠ¨**ç±»å‹è½¬æ¢è¯­æ³•ï¼šå­ç±»ç±»å‹çš„å¯¹è±¡æˆ–è€…å˜é‡å¯ä»¥è‡ªåŠ¨ç±»å‹è½¬æ¢èµ‹å€¼ç»™çˆ¶ç±»ç±»å‹çš„å˜é‡ã€‚

æ ¸å¿ƒï¼š**çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡**

- **å‘ä¸Šè½¬å‹(upcasting)**ï¼šé€šè¿‡å­ç±»å¯¹è±¡(å°èŒƒå›´)å®ä¾‹åŒ–çˆ¶ç±»å¯¹è±¡(å¤§èŒƒå›´)ï¼Œè¿™ç§å±äºè‡ªåŠ¨è½¬æ¢
- **å‘ä¸‹è½¬å‹(downcasting)**ï¼šé€šè¿‡çˆ¶ç±»å¯¹è±¡(å¤§èŒƒå›´)å®ä¾‹åŒ–å­ç±»å¯¹è±¡(å°èŒƒå›´)ï¼Œè¿™ç§å±äºå¼ºåˆ¶è½¬æ¢

```java
public class PolymorphicDemo {
    public static void main(String[] args){
        Animal a = new Cat();//å‘ä¸Šè½¬å‹
        Cat c = (Cat)a;//å‘ä¸‹è½¬å‹
    }
}
class Animal{}
class Cat extends Animal{}
```



***



#### instanceof

* å¼•ç”¨ç±»å‹å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼šçˆ¶ç±»ç±»å‹çš„å˜é‡æˆ–è€…å¯¹è±¡å¼ºåˆ¶ç±»å‹è½¬æ¢æˆå­ç±»ç±»å‹çš„å˜é‡ï¼Œå¦åˆ™æŠ¥é”™!
* å¼ºåˆ¶ç±»å‹è½¬æ¢çš„æ ¼å¼ï¼š**ç±»å‹ å˜é‡åç§° = (ç±»å‹)(å¯¹è±¡æˆ–è€…å˜é‡)**
* æœ‰ç»§æ‰¿/å®ç°å…³ç³»çš„ä¸¤ä¸ªç±»å‹å°±å¯ä»¥è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œç¼–è¯‘é˜¶æ®µä¸€å®šä¸æŠ¥é”™ï¼ä½†æ˜¯è¿è¡Œé˜¶æ®µå¯èƒ½å‡ºç°ï¼šç±»å‹è½¬æ¢å¼‚å¸¸ ClassCastException
* **instanceof**ï¼šåˆ¤æ–­å·¦è¾¹çš„å¯¹è±¡æ˜¯å¦æ˜¯å³è¾¹çš„ç±»çš„å®ä¾‹ï¼Œæˆ–è€…æ˜¯å…¶ç›´æ¥æˆ–é—´æ¥å­ç±»ï¼Œæˆ–è€…æ˜¯å…¶æ¥å£çš„å®ç°ç±»

```java
public class Demo{
    public static void main(String[] args){
		Aniaml a = new Dog();
		//Dog d = (Dog)a;
        //Cat c = (Cat)a; ç¼–è¯‘ä¸æŠ¥é”™ï¼Œè¿è¡ŒæŠ¥ClassCastExceptioné”™è¯¯
        if(a instanceof Cat){
            Cat c = (Cat)a; 
        } else if(a instanceof Dog) {
            Dog d = (Dog)a;
        }
    }
}
class Dog extends Animal{}
class Cat extends Animal{}
class Animal{}
```



***



### å†…éƒ¨ç±»

#### æ¦‚è¿°

> å†…éƒ¨ç±»æ˜¯ç±»çš„äº”å¤§æˆåˆ†ä¹‹ä¸€ï¼šæˆå‘˜å˜é‡ï¼Œæ–¹æ³•ï¼Œæ„é€ å™¨ï¼Œä»£ç å—ï¼Œå†…éƒ¨ç±»ã€‚

* æ¦‚å¿µï¼šå®šä¹‰åœ¨ä¸€ä¸ªç±»é‡Œé¢çš„ç±»å°±æ˜¯å†…éƒ¨ç±»ã€‚
* å†…éƒ¨ç±»ä½œç”¨ï¼šæä¾›æ›´å¥½çš„å°è£…æ€§, å†…éƒ¨ç±»æœ‰æ›´å¤šæƒé™ä¿®é¥°ç¬¦ , å°è£…æ€§æœ‰æ›´å¤šçš„æ§åˆ¶ï¼Œå¯ä»¥ä½“ç°å‡ºç»„ä»¶æ€æƒ³ã€‚**é—´æ¥è§£å†³ç±»æ— æ³•å¤šç»§æ‰¿å¼•èµ·çš„ä¸€ç³»åˆ—é—®é¢˜**
* å†…éƒ¨ç±»çš„åˆ†ç±»ï¼šé™æ€å†…éƒ¨ç±»ã€å®ä¾‹å†…éƒ¨ç±»ï¼ˆæˆå‘˜å†…éƒ¨ç±»ï¼‰ã€å±€éƒ¨å†…éƒ¨ç±»ã€**åŒ¿åå†…éƒ¨ç±»**ï¼ˆé‡ç‚¹ï¼‰



***



#### é™æ€å†…éƒ¨ç±»

å®šä¹‰ï¼šæœ‰staticä¿®é¥°ï¼Œå±äºå¤–éƒ¨ç±»æœ¬èº«ï¼Œä¼šåŠ è½½ä¸€æ¬¡

é™æ€å†…éƒ¨ç±»ä¸­çš„æˆåˆ†ç ”ç©¶ï¼š
    ç±»æœ‰çš„æˆåˆ†å®ƒéƒ½æœ‰ï¼Œé™æ€å†…éƒ¨ç±»å±äºå¤–éƒ¨ç±»æœ¬èº«ï¼Œåªä¼šåŠ è½½ä¸€æ¬¡
    æ‰€ä»¥å®ƒçš„ç‰¹ç‚¹ä¸å¤–éƒ¨ç±»æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªæ˜¯ä½ç½®åœ¨åˆ«äººé‡Œé¢è€Œå·²ã€‚

é™æ€å†…éƒ¨ç±»çš„è®¿é—®æ ¼å¼ï¼šå¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§°

é™æ€å†…éƒ¨ç±»åˆ›å»ºå¯¹è±¡çš„æ ¼å¼ï¼šå¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§° å¯¹è±¡åç§° = new å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»æ„é€ å™¨;

é™æ€å†…éƒ¨ç±»çš„è®¿é—®æ‹“å±•ï¼š
    é™æ€å†…éƒ¨ç±»ä¸­æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜?å¯ä»¥ï¼Œå¤–éƒ¨ç±»çš„é™æ€æˆå‘˜åªæœ‰ä¸€ä»½ï¼Œå¯ä»¥è¢«å…±äº«ï¼
    é™æ€å†…éƒ¨ç±»ä¸­æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹æˆå‘˜?ä¸å¯ä»¥ï¼Œå¤–éƒ¨ç±»çš„æˆå‘˜å¿…é¡»ç”¨å¤–éƒ¨ç±»å¯¹è±¡è®¿é—®ï¼ï¼

```java
public class Demo{
    public static void main(String[] args){
        Outter.Inner in = new Outter.Inner();
    }
}

class Outter{
    public static int age;
    private double salary;
    public static class Inner{
         //æ‹¥æœ‰ç±»çš„æ‰€æœ‰åŠŸèƒ½ æ„é€ å™¨ æ–¹æ³• æˆå‘˜å˜é‡
         System.out.println(age);
         //System.out.println(salary);æŠ¥é”™
	}
}
```



***



#### å®ä¾‹å†…éƒ¨ç±»

å®šä¹‰ï¼š(äº†è§£è¯­æ³•)
	æ— staticä¿®é¥°çš„å†…éƒ¨ç±»ï¼Œå±äºå¤–éƒ¨ç±»çš„æ¯ä¸ªå¯¹è±¡ï¼Œè·Ÿç€å¤–éƒ¨ç±»å¯¹è±¡ä¸€èµ·åŠ è½½ã€‚

å®ä¾‹å†…éƒ¨ç±»çš„æˆåˆ†ç‰¹ç‚¹ï¼š
    å®ä¾‹å†…éƒ¨ç±»ä¸­ä¸èƒ½å®šä¹‰é™æ€æˆå‘˜ï¼Œå…¶ä»–éƒ½å¯ä»¥å®šä¹‰

å®ä¾‹å†…éƒ¨ç±»çš„è®¿é—®æ ¼å¼ï¼š
    å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§°ã€‚

åˆ›å»ºå¯¹è±¡çš„æ ¼å¼ï¼š
    å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§° å¯¹è±¡åç§° = new å¤–éƒ¨ç±»æ„é€ å™¨.new å†…éƒ¨æ„é€ å™¨;
	`Outter.Inner in = new Outter().new Inner();`

æ‹“å±•ï¼š**å®ä¾‹å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„å…¨éƒ¨æˆå‘˜ï¼**

> * å®ä¾‹å†…éƒ¨ç±»ä¸­æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ï¼Ÿ
>   å¯ä»¥ï¼Œå¤–éƒ¨ç±»çš„é™æ€æˆå‘˜å¯ä»¥è¢«å…±äº«è®¿é—®ï¼
> * å®ä¾‹å†…éƒ¨ç±»ä¸­æ˜¯å¦å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹æˆå‘˜ï¼Ÿ
>   å¯ä»¥çš„ï¼Œå®ä¾‹å†…éƒ¨ç±»å±äºå¤–éƒ¨ç±»å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»å¯¹è±¡çš„å®ä¾‹æˆå‘˜ï¼



***



#### å±€éƒ¨å†…éƒ¨ç±»

å±€éƒ¨å†…éƒ¨ç±»ï¼šå®šä¹‰åœ¨æ–¹æ³•ä¸­ï¼Œåœ¨æ„é€ å™¨ä¸­ï¼Œä»£ç å—ä¸­ï¼Œforå¾ªç¯ä¸­å®šä¹‰çš„å†…éƒ¨ç±»ã€‚

å±€éƒ¨å†…éƒ¨ç±»ä¸­çš„æˆåˆ†ç‰¹ç‚¹ï¼šåªèƒ½å®šä¹‰å®ä¾‹æˆå‘˜ï¼Œä¸èƒ½å®šä¹‰é™æ€æˆå‘˜

```java
public class InnerClass{
	public static void main(String[] args){
        String name;
        class{}
    }
    public static void test(){
		class Animal{}
		class Cat extends Animal{}  
	}
}
```



***



#### åŒ¿åå†…éƒ¨ç±»

åŒ¿åå†…éƒ¨ç±»ï¼šå°±æ˜¯ä¸€ä¸ªæ²¡æœ‰åå­—çš„å±€éƒ¨å†…éƒ¨ç±»ã€‚
ä½œç”¨ï¼šç®€åŒ–ä»£ç ï¼Œä¹Ÿæ˜¯å¼€å‘ä¸­å¸¸ç”¨çš„å½¢å¼ã€‚

åŒ¿åå†…éƒ¨ç±»çš„æ ¼å¼ï¼š

```java
new ç±»å|æŠ½è±¡ç±»|æ¥å£(å½¢å‚){
	//æ–¹æ³•é‡å†™ã€‚
}
```
 åŒ¿åå†…éƒ¨ç±»çš„ç‰¹ç‚¹ï¼š

* åŒ¿åå†…éƒ¨ç±»æ˜¯ä¸€ä¸ªæ²¡æœ‰åå­—çš„å†…éƒ¨ç±»ã€‚
* åŒ¿åå†…éƒ¨ç±»ä¸€æ—¦å†™å‡ºæ¥ï¼Œå°±ä¼šç«‹å³åˆ›å»ºä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»çš„å¯¹è±¡è¿”å›
* **åŒ¿åå†…éƒ¨ç±»çš„å¯¹è±¡çš„ç±»å‹ç›¸å½“äºæ˜¯å½“å‰newçš„é‚£ä¸ªçš„ç±»å‹çš„å­ç±»ç±»å‹**

```java
public class Anonymity {
    public static void main(String[] args) {
        Animal a = new Animal(){
            @Override
            public void run() {
                System.out.println("çŒ«è·‘çš„è´¼æºœ~~");
            }
        };
        a.run();
        a.go();
    }
}
abstract class Animal{
    public abstract void run();

    public void go(){
        System.out.println("å¼€å§‹go~~~");
    }
}
```



***



### æƒé™ä¿®é¥°ç¬¦

æƒé™ä¿®é¥°ç¬¦ï¼šæœ‰å››ç§**ï¼ˆprivate -> ç¼ºçœ -> protected - > public ï¼‰**
å¯ä»¥ä¿®é¥°æˆå‘˜å˜é‡ï¼Œä¿®é¥°æ–¹æ³•ï¼Œä¿®é¥°æ„é€ å™¨ï¼Œå†…éƒ¨ç±»ï¼Œä¸åŒä¿®é¥°ç¬¦ä¿®é¥°çš„æˆå‘˜èƒ½å¤Ÿè¢«è®¿é—®çš„æƒé™å°†å—åˆ°é™åˆ¶!

| å››ç§ä¿®é¥°ç¬¦è®¿é—®æƒé™ | private | ç¼ºçœ | protected | public |
| ------------------ | :-----: | :--: | :-------: | :----: |
| æœ¬ç±»ä¸­             |    âˆš    |  âˆš   |     âˆš     |   âˆš    |
| å­ç±»ä¸­             |    X    |  âˆš   |     âˆš     |   âˆš    |
| æœ¬åŒ…ä¸‹å…¶ä»–ç±»ä¸­     |    X    |  âˆš   |     âˆš     |   âˆš    |
| å…¶ä»–åŒ…ä¸‹çš„ç±»ä¸­     |    X    |  X   |     X     |   âˆš    |
| å…¶ä»–åŒ…ä¸‹çš„å­ç±»ä¸­   |    X    |  X   |     âˆš     |   âˆš    |



***



### ä»£ç å—

#### é™æ€ä»£ç å—

é™æ€ä»£ç å—çš„æ ¼å¼ï¼š

 ```java
static {
}
 ```

* é™æ€ä»£ç å—ç‰¹ç‚¹ï¼š 
  * å¿…é¡»æœ‰staticä¿®é¥°ã€‚
  * ä¼šä¸ç±»ä¸€èµ·ä¼˜å…ˆåŠ è½½ï¼Œä¸”è‡ªåŠ¨è§¦å‘æ‰§è¡Œä¸€æ¬¡ã€‚
  * åªèƒ½è®¿é—®é™æ€èµ„æº
* é™æ€ä»£ç å—ä½œç”¨ï¼š
  * å¯ä»¥åœ¨æ‰§è¡Œç±»çš„æ–¹æ³•ç­‰æ“ä½œä¹‹å‰å…ˆåœ¨é™æ€ä»£ç å—ä¸­è¿›è¡Œé™æ€èµ„æºçš„åˆå§‹åŒ– 
  * **å…ˆæ‰§è¡Œé™æ€ä»£ç å—ï¼Œåœ¨æ‰§è¡Œmainå‡½æ•°é‡Œçš„æ“ä½œ**

```java
public class CodeDemo {
    public static String schoolName ;
    public static ArrayList<String> lists = new ArrayList<>();

    // é™æ€ä»£ç å—,å±äºç±»ï¼Œä¸ç±»ä¸€èµ·åŠ è½½ä¸€æ¬¡!
    static {
        System.out.println("é™æ€ä»£ç å—è¢«è§¦å‘æ‰§è¡Œ~~~~~~~");
        // åœ¨é™æ€ä»£ç å—ä¸­è¿›è¡Œé™æ€èµ„æºçš„åˆå§‹åŒ–æ“ä½œ
        schoolName = "é»‘é©¬";
        lists.add("3");
        lists.add("4");
        lists.add("5");
    }
    public static void main(String[] args) {
        System.out.println("mainæ–¹æ³•è¢«æ‰§è¡Œ");
        System.out.println(schoolName);
        System.out.println(lists);
    }
}
/*é™æ€ä»£ç å—è¢«è§¦å‘æ‰§è¡Œ~~~~~~~
mainæ–¹æ³•è¢«æ‰§è¡Œ
é»‘é©¬
[3, 4, 5] */
```



***



#### å®ä¾‹ä»£ç å—

å®ä¾‹ä»£ç å—çš„æ ¼å¼ï¼š

```java
{

}
```

* å®ä¾‹ä»£ç å—çš„ç‰¹ç‚¹ï¼š
  * æ— staticä¿®é¥°ï¼Œå±äºå¯¹è±¡
  * ä¼šä¸ç±»çš„å¯¹è±¡ä¸€èµ·åŠ è½½ï¼Œæ¯æ¬¡åˆ›å»ºç±»çš„å¯¹è±¡çš„æ—¶å€™ï¼Œå®ä¾‹ä»£ç å—éƒ½ä¼šè¢«åŠ è½½ä¸”è‡ªåŠ¨è§¦å‘æ‰§è¡Œä¸€æ¬¡ã€‚
  * å®ä¾‹ä»£ç å—çš„ä»£ç åœ¨åº•å±‚å®é™…ä¸Šæ˜¯æå–åˆ°æ¯ä¸ªæ„é€ å™¨ä¸­å»æ‰§è¡Œçš„ï¼ 
  
* å®ä¾‹ä»£ç å—çš„ä½œç”¨ï¼š
  * å®ä¾‹ä»£ç å—å¯ä»¥åœ¨åˆ›å»ºå¯¹è±¡ä¹‹å‰è¿›è¡Œå®ä¾‹èµ„æºçš„åˆå§‹åŒ–æ“ä½œã€‚ 

```java
public class CodeDemo {
    private String name;
    private ArrayList<String> lists = new ArrayList<>();
    {
        name = "ä»£ç å—";
        lists.add("java");
        System.out.println("å®ä¾‹ä»£ç å—è¢«è§¦å‘æ‰§è¡Œä¸€æ¬¡~~~~~~~~");
    }
    public CodeDemo02(){ }//æ„é€ æ–¹æ³•
    public CodeDemo02(String name){}

    public static void main(String[] args) {
        CodeDemo c = new CodeDemo();//å®ä¾‹ä»£ç å—è¢«è§¦å‘æ‰§è¡Œä¸€æ¬¡
        System.out.println(c.name);
        System.out.println(c.lists);
        new CodeDemo02();//å®ä¾‹ä»£ç å—è¢«è§¦å‘æ‰§è¡Œä¸€æ¬¡
    }
}
```



***






## API

### Object

Objectï¼šjava.lang.Objectï¼ŒObjectç±»æ˜¯Javaä¸­çš„ç¥–å®—ç±»ã€‚ä¸€ä¸ªç±»æˆ–è€…é»˜è®¤ç»§æ‰¿Objectç±»ï¼Œæˆ–è€…é—´æ¥ç»§æ‰¿Objectç±»ï¼ŒObjectç±»çš„æ–¹æ³•æ˜¯ä¸€åˆ‡å­ç±»éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨.

Objectç±»å¸¸ç”¨æ–¹æ³•ï¼š

* `public String toString()`ï¼š
  é»˜è®¤æ˜¯è¿”å›å½“å‰å¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„åœ°å€ä¿¡æ¯ï¼šç±»çš„å…¨é™å@å†…å­˜åœ°å€ï¼Œä¾‹ï¼šStudent@735b478ï¼›
  ç›´æ¥è¾“å‡ºå¯¹è±¡åç§°ï¼Œé»˜è®¤ä¼šè°ƒç”¨toString()æ–¹æ³•ï¼Œæ‰€ä»¥çœç•¥toString()ä¸å†™ï¼›
  å¦‚æœè¾“å‡ºå¯¹è±¡çš„å†…å®¹ï¼Œéœ€è¦é‡å†™toString()æ–¹æ³•ï¼ŒtoStringæ–¹æ³•å­˜åœ¨çš„æ„ä¹‰æ˜¯ä¸ºäº†è¢«å­ç±»é‡å†™

* `public boolean equals(Object o)`ï¼š
  é»˜è®¤æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„åœ°å€æ˜¯å¦ç›¸åŒï¼Œå¦‚æœåªæ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„åœ°å€å¯ä»¥ç”¨â€œ==â€æ›¿ä»£equalsã€‚
  æ‰€ä»¥equalså­˜åœ¨çš„æ„ä¹‰æ˜¯ä¸ºäº†è¢«å­ç±»é‡å†™ï¼Œä»¥ä¾¿ç¨‹åºå‘˜å¯ä»¥è‡ªå·±æ¥å®šåˆ¶æ¯”è¾ƒè§„åˆ™ã€‚

* éœ€æ±‚ï¼šåªè¦ä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹ä¸€æ ·ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºä»–ä»¬æ˜¯ç›¸ç­‰çš„ã€‚

  ```java
  public boolean equals(Object o) {
  	// 1.åˆ¤æ–­æ˜¯å¦è‡ªå·±å’Œè‡ªå·±æ¯”è¾ƒï¼Œå¦‚æœæ˜¯åŒä¸€ä¸ªå¯¹è±¡æ¯”è¾ƒç›´æ¥è¿”å›true
  	if (this == o) return true;
  	// 2.åˆ¤æ–­è¢«æ¯”è¾ƒè€…æ˜¯å¦ä¸ºnull ,ä»¥åŠæ˜¯å¦æ˜¯å­¦ç”Ÿç±»å‹ã€‚
  	if (o == null || this.getClass() != o.getClass()) return false;
  	// 3.oä¸€å®šæ˜¯å­¦ç”Ÿç±»å‹ï¼Œå¼ºåˆ¶è½¬æ¢æˆå­¦ç”Ÿï¼Œå¼€å§‹æ¯”è¾ƒå†…å®¹ï¼
  	Student student = (Student) o;
  	return age == student.age &&
             sex == student.sex &&
             Objects.equals(name, student.name);
  }
  ```



**é¢è¯•é¢˜**ï¼š== å’Œequalsçš„åŒºåˆ«
== æ¯”è¾ƒçš„æ˜¯å˜é‡(æ ˆ)å†…å­˜ä¸­å­˜æ”¾çš„å¯¹è±¡çš„(å †)å†…å­˜åœ°å€ï¼Œç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„**åœ°å€**æ˜¯å¦ç›¸åŒï¼Œå³æ˜¯å¦æ˜¯**æŒ‡ç›¸**åŒä¸€ä¸ªå¯¹è±¡ã€‚æ¯”è¾ƒçš„æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æŒ‡é’ˆæ“ä½œã€‚
equalsç”¨æ¥æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„**å†…å®¹**æ˜¯å¦ç›¸ç­‰ï¼Œç”±äºæ‰€æœ‰çš„ç±»éƒ½æ˜¯ç»§æ‰¿è‡ªjava.lang.Objectç±»çš„ï¼Œæ‰€ä»¥é€‚ç”¨äºæ‰€æœ‰å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å¯¹è¯¥æ–¹æ³•è¿›è¡Œè¦†ç›–çš„è¯ï¼Œè°ƒç”¨çš„ä»ç„¶æ˜¯Objectç±»ä¸­çš„æ–¹æ³•ï¼Œè€ŒObjectä¸­çš„equalsæ–¹æ³•è¿”å›çš„å´æ˜¯==çš„åˆ¤æ–­ã€‚



***



### Objects

* Objectsç±»ä¸Objectæ˜¯ç»§æ‰¿å…³ç³»ã€‚

* Objectsçš„æ–¹æ³•ï¼š
  
   * `public static boolean equals(Object a, Object b)` : æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚
       åº•å±‚è¿›è¡Œéç©ºåˆ¤æ–­ï¼Œä»è€Œå¯ä»¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæ›´å®‰å…¨ï¼ï¼æ¨èä½¿ç”¨ï¼ï¼
   
     ```java
     public static boolean equals(Object a, Object b) {
         return a == b || a != null && a.equals(b);
     }
     ```
   
   * `public static boolean isNull(Object obj)` : åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºnull ,ä¸ºnullè¿”å›true ,åä¹‹ï¼
   
   * `public static String toString(å¯¹è±¡)` : è¿”å›å‚æ•°ä¸­å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼
   
   * `public static String toString(å¯¹è±¡, é»˜è®¤å­—ç¬¦ä¸²)` : è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚

```java
public class ObjectsDemo {
    public static void main(String[] args) {
        Student s1 = null;
        Student s2 = new Student();
        System.out.println(Objects.equals(s1 , s2));//æ¨èä½¿ç”¨
        // System.out.println(s1.equals(s2)); // ç©ºæŒ‡é’ˆå¼‚å¸¸
 
        System.out.println(Objects.isNull(s1));
        System.out.println(s1 == null);//ç›´æ¥åˆ¤æ–­æ¯”è¾ƒå¥½
    }
}

public class Student {
}
```



***



### String

#### æ¦‚è¿°

**String è¢«å£°æ˜ä¸º finalï¼Œå› æ­¤å®ƒä¸å¯è¢«ç»§æ‰¿ (Integer ç­‰åŒ…è£…ç±»ä¹Ÿä¸èƒ½è¢«ç»§æ‰¿ï¼‰**

```java
public final class String implements java.io.Serializable, Comparable<String>, CharSequence {
 	/** The value is used for character storage. */
    private final byte[] value;
    /** The identifier of the encoding used to encode the bytes in {@code value}. */
    private final byte coder;
}
```

åœ¨ Java 9 ä¹‹åï¼ŒString ç±»çš„å®ç°æ”¹ç”¨ byte æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸²ï¼ŒåŒæ—¶ä½¿ç”¨ `coder` æ¥æ ‡è¯†ä½¿ç”¨äº†å“ªç§ç¼–ç ã€‚
value æ•°ç»„è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€ value æ•°ç»„åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†å¼•ç”¨å…¶å®ƒæ•°ç»„ï¼Œå¹¶ä¸” String å†…éƒ¨æ²¡æœ‰æ”¹å˜ value æ•°ç»„çš„æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥**ä¿è¯ String ä¸å¯å˜**

**æ³¨æ„ï¼šä¸èƒ½æ”¹å˜çš„æ„æ€æ˜¯æ¯æ¬¡æ›´æ”¹å­—ç¬¦ä¸²éƒ½ä¼šäº§ç”Ÿæ–°çš„å¯¹è±¡ï¼Œå¹¶ä¸æ˜¯å¯¹åŸå§‹å¯¹è±¡è¿›è¡Œæ”¹å˜**

```java
String s = "abc";
s = s + "cd"; //s = abccd æ–°å¯¹è±¡
```



****



#### æ„é€ 

**æ„é€ æ–¹æ³•**ï¼š
	public String() : åˆ›å»ºä¸€ä¸ªç©ºç™½å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¸å«æœ‰ä»»ä½•å†…å®¹
	public String(char[] chs) : æ ¹æ®å­—ç¬¦æ•°ç»„çš„å†…å®¹ï¼Œæ¥åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡
	public String(String original) : æ ¹æ®ä¼ å…¥çš„å­—ç¬¦ä¸²å†…å®¹ï¼Œæ¥åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡

**ç›´æ¥èµ‹å€¼**ï¼š
	String s = â€œabcâ€;  ç›´æ¥èµ‹å€¼çš„æ–¹å¼åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå†…å®¹å°±æ˜¯abc

ä½¿ç”¨è¿™ç§æ–¹å¼ä¸€å…±ä¼šåˆ›å»ºä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ˆå‰ææ˜¯ String Pool ä¸­è¿˜æ²¡æœ‰ "abc" å­—ç¬¦ä¸²å¯¹è±¡ï¼‰:

- é€šè¿‡æ„é€ æ–¹æ³•åˆ›å»º

  é€šè¿‡ new åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œæ¯ä¸€æ¬¡ new éƒ½ä¼šç”³è¯·ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œè™½ç„¶å†…å®¹ç›¸åŒï¼Œä½†æ˜¯åœ°å€å€¼ä¸åŒ

- ç›´æ¥èµ‹å€¼æ–¹å¼åˆ›å»º

  ä»¥â€œ â€æ–¹å¼ç»™å‡ºçš„å­—ç¬¦ä¸²ï¼Œåªè¦å­—ç¬¦åºåˆ—ç›¸åŒ(é¡ºåºå’Œå¤§å°å†™)ï¼Œæ— è®ºåœ¨ç¨‹åºä»£ç ä¸­å‡ºç°å‡ æ¬¡ï¼ŒJVM éƒ½åªä¼šåœ¨ String Pool ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶åœ¨å­—ç¬¦ä¸²æ± ä¸­ç»´æŠ¤

#### å¸¸ç”¨API

`public boolean equals(String s)` : æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ç›¸åŒã€åŒºåˆ†å¤§å°å†™
`public boolean equalsIgnoreCase(String anotherString)` : æ¯”è¾ƒå­—ç¬¦ä¸²çš„å†…å®¹ï¼Œå¿½ç•¥å¤§å°å†™
`public int length()` : è¿”å›æ­¤å­—ç¬¦ä¸²çš„é•¿åº¦
`public String trim()` : è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸ºæ­¤å­—ç¬¦ä¸²ï¼Œå¹¶åˆ é™¤ä»»ä½•å‰å¯¼å’Œå°¾éšç©ºæ ¼
`public String[] split(String regex)` : å°†å­—ç¬¦ä¸²æŒ‰ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²æˆå­—ç¬¦ä¸²æ•°ç»„ 
`public char charAt(int index)` : å–ç´¢å¼•å¤„çš„å€¼
`public char[] toCharArray()` : å°†å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºå­—ç¬¦æ•°ç»„åè¿”å›
`public boolean startsWith(String prefix)`æµ‹è¯•æ­¤å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šçš„å‰ç¼€å¼€å¤´
`public int lastIndexOf(String str)` : è¿”å›å­—ç¬¦ä¸²æœ€åä¸€æ¬¡å‡ºç°strçš„ç´¢å¼•ï¼Œæ²¡æœ‰è¿”å›-1
`public String substring(int beginIndex)` : è¿”å›å­å­—ç¬¦ä¸²ï¼Œä»¥åŸå­—ç¬¦ä¸²æŒ‡å®šç´¢å¼•å¤„åˆ°ç»“å°¾
`public String substring(int beginIndex, int endIndex)` : è¿”å›åŸå­—ç¬¦ä¸²æŒ‡å®šç´¢å¼•å¤„çš„å­—ç¬¦ä¸²
`public String toLowerCase()` : å°†æ­¤Stringæ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå°å†™ï¼Œä½¿ç”¨é»˜è®¤è¯­è¨€ç¯å¢ƒçš„è§„åˆ™
`public String toUpperCase()` : ä½¿ç”¨é»˜è®¤è¯­è¨€ç¯å¢ƒçš„è§„åˆ™å°†æ­¤Stringæ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™
`public String replace(CharSequence target, CharSequence replacement)` : ä½¿ç”¨æ–°å€¼ï¼Œå°†å­—ç¬¦ä¸²ä¸­çš„æ—§å€¼æ›¿æ¢ï¼Œå¾—åˆ°æ–°çš„å­—ç¬¦ä¸²

```java
String s = 123-78;
s.replace("-","");//12378
```



***



#### String Pool

**å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Pool / StringTable / ä¸²æ± ï¼‰**ä¿å­˜ç€æ‰€æœ‰å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆliteral stringsï¼‰ï¼Œè¿™äº›å­—é¢é‡åœ¨ç¼–è¯‘æ—¶æœŸå°±ç¡®å®š

* StringTableï¼Œhashtable ï¼ˆå“ˆå¸Œè¡¨ + é“¾è¡¨ï¼‰ç»“æ„ï¼Œä¸èƒ½æ‰©å®¹

* å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰å˜ä¸ºå¯¹è±¡
* åˆ©ç”¨ä¸²æ± æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡
* å­—ç¬¦ä¸²**å˜é‡**çš„æ‹¼æ¥çš„åŸç†æ˜¯StringBuilderï¼ˆjdk1.8ï¼‰
* å­—ç¬¦ä¸²**å¸¸é‡**æ‹¼æ¥çš„åŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–
* å¯ä»¥ä½¿ç”¨ String çš„ intern() æ–¹æ³•åœ¨è¿è¡Œè¿‡ç¨‹å°†å­—ç¬¦ä¸²æ·»åŠ åˆ° String Pool ä¸­

 **intern()** ï¼š

* jdk1.8ï¼šå½“ä¸€ä¸ªå­—ç¬¦ä¸²è°ƒç”¨ intern() æ–¹æ³•æ—¶ï¼Œå¦‚æœ String Pool ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²å’Œè¯¥å­—ç¬¦ä¸²å€¼ç›¸ç­‰ï¼ˆä½¿ç”¨ equals() æ–¹æ³•è¿›è¡Œç¡®å®šï¼‰ï¼Œå°±ä¼šè¿”å› String Pool ä¸­å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼›åä¹‹å°±ä¼šåœ¨ String Pool ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›è¿™ä¸ªæ–°å­—ç¬¦ä¸²çš„å¼•ç”¨
* jdk1.6ï¼šå°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰å°±ä¸æ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰ä¼šæŠŠæ­¤å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œæ”¾å…¥ä¸²æ± ï¼ŒæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›

```java
public class Demo {
    // å¸¸é‡æ± ä¸­çš„ä¿¡æ¯éƒ½ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œè¿™æ—¶a b abéƒ½æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·ï¼Œè¿˜æ²¡æœ‰å˜ä¸ºjavaå­—ç¬¦ä¸²å¯¹è±¡ï¼Œæ˜¯æ‡’æƒ°çš„
    // ldc #2 ä¼šæŠŠ a ç¬¦å·å˜ä¸º "a" å­—ç¬¦ä¸²å¯¹è±¡     ldc:åç¼–è¯‘åçš„æŒ‡ä»¤
    // ldc #3 ä¼šæŠŠ b ç¬¦å·å˜ä¸º "b" å­—ç¬¦ä¸²å¯¹è±¡
    // ldc #4 ä¼šæŠŠ ab ç¬¦å·å˜ä¸º "ab" å­—ç¬¦ä¸²å¯¹è±¡
    public static void main(String[] args) {
        String s1 = "a"; // æ‡’æƒ°çš„
        String s2 = "b";
        String s3 = "ab";
        // new StringBuilder().append("a").append("b").toString()  new String("ab")
        String s4 = s1 + s2; 
        String s5 = "a" + "b";  // javac åœ¨ç¼–è¯‘æœŸé—´çš„ä¼˜åŒ–ï¼Œç»“æœå·²ç»åœ¨ç¼–è¯‘æœŸç¡®å®šä¸ºab

        System.out.println(s3 == s4); // false
        System.out.println(s3 == s5); // true
        System.out.println(s3 == s6); // true

        String x2 = new String("c") + new String("d"); // new String("cd")
        x2.intern();
        String x1 = "cd";

        System.out.println(x1 == x2); //true
    }
}
```

- == æ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å…·ä½“çš„å€¼
- == æ¯”è¾ƒå¼•ç”¨æ•°æ®ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å¯¹è±¡åœ°å€å€¼

åœ¨ Java 7ä¹‹å‰ï¼ŒString Pool è¢«æ”¾åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œå®ƒå±äºæ°¸ä¹…ä»£ã€‚è€Œåœ¨ Java 7ä»¥åï¼ŒString Pool è¢«ç§»åˆ°å †ä¸­ï¼Œè¿™æ˜¯å› ä¸ºæ°¸ä¹…ä»£çš„ç©ºé—´æœ‰é™ï¼Œåœ¨å¤§é‡ä½¿ç”¨å­—ç¬¦ä¸²çš„åœºæ™¯ä¸‹ä¼šå¯¼è‡´OutOfMemoryError é”™è¯¯

æ¼”ç¤º StringTable ä½ç½®ï¼š

* `-Xmx10m`è®¾ç½®å †å†…å­˜10m

* åœ¨jdk8ä¸‹è®¾ç½®ï¼š `-Xmx10m -XX:-UseGCOverheadLimit`ï¼ˆè¿è¡Œå‚æ•°åœ¨Run Configurations VM optionsï¼‰

* åœ¨jdk6ä¸‹è®¾ç½®ï¼š `-XX:MaxPermSize=10m`

  ```java
  public static void main(String[] args) throws InterruptedException {
      List<String> list = new ArrayList<String>();
      int i = 0;
      try {
          for (int j = 0; j < 260000; j++) {
              list.add(String.valueOf(j).intern());
              i++;
          }
      } catch (Throwable e) {
          e.printStackTrace();
      } finally {
          System.out.println(i);
      }
  }
  ```

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-å†…å­˜å›¾å¯¹æ¯”.png)

æ¼”ç¤ºåƒåœ¾å›æ”¶ï¼š

è™šæ‹Ÿæœºå‚æ•°è®¾ç½®ï¼š`-Xmx10m -XX:+PrintStringTableStatistics -XX:+PrintGCDetails -verbose:gc`

```java
public static void main(String[] args) throws InterruptedException {
    int i = 0;
    try {
        for (int j = 0; j < 100000; j++) { // j=100, j=10000
            //jå˜å¤§åï¼ŒNumber of entriesä¸ä¼šå˜å¤§é‚£ä¹ˆå¤šï¼Œå› ä¸ºå­˜åœ¨åƒåœ¾å›æ”¶
            String.valueOf(j).intern();
            i++;
        }
    } catch (Throwable e) {
        e.printStackTrace();
    } finally {
        System.out.println(i);
    }
}
```



#### ä¼˜åŒ–å¸¸é‡æ± 

ä¸¤ç§æ–¹å¼ï¼š

* è°ƒæ•´ -XX:StringTableSize=æ¡¶ä¸ªæ•°ï¼Œæ•°é‡è¶Šå°‘ï¼Œæ€§èƒ½è¶Šå·®

* intern å°†å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥å¸¸é‡æ± ï¼Œé€šè¿‡å¤ç”¨å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼Œå‡å°‘å†…å­˜å ç”¨

```java
/**
 * æ¼”ç¤º intern å‡å°‘å†…å­˜å ç”¨
 * -XX:StringTableSize=200000 -XX:+PrintStringTableStatistics
 * -Xsx500m -Xmx500m -XX:+PrintStringTableStatistics -XX:StringTableSize=200000
 */
public class Demo1_25 {
    public static void main(String[] args) throws IOException {
        List<String> address = new ArrayList<>();
        System.in.read();
        for (int i = 0; i < 10; i++) {
            //å¾ˆå¤šæ•°æ®
            try (BufferedReader reader = new BufferedReader(new InputStreamReader(new FileInputStream("linux.words"), "utf-8"))) {
                String line = null;
                long start = System.nanoTime();
                while (true) {
                    line = reader.readLine();
                    if(line == null) {
                        break;
                    }
                    address.add(line.intern());
                }
                System.out.println("cost:" +(System.nanoTime()-start)/1000000);
            }
        }
        System.in.read();
    }
}
```



***



#### ä¸å¯å˜çš„å¥½å¤„

* å¯ä»¥ç¼“å­˜ hash å€¼
  å› ä¸º String çš„ hash å€¼ç»å¸¸è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚ String ç”¨åš HashMap çš„ keyã€‚ä¸å¯å˜çš„ç‰¹æ€§å¯ä»¥ä½¿å¾— hash å€¼ä¹Ÿä¸å¯å˜ï¼Œåªéœ€è¦è¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚
* String Pool çš„éœ€è¦
  å¦‚æœä¸€ä¸ªStringå¯¹è±¡å·²ç»è¢«åˆ›å»ºè¿‡äº†ï¼Œå°±ä¼šä» String Poolä¸­å–å¾—å¼•ç”¨ã€‚åªæœ‰ Stringæ˜¯ä¸å¯å˜çš„ï¼Œæ‰å¯èƒ½ä½¿ç”¨ String Poolã€‚

* å®‰å…¨æ€§
  String ç»å¸¸ä½œä¸ºå‚æ•°ï¼ŒString ä¸å¯å˜æ€§å¯ä»¥ä¿è¯å‚æ•°ä¸å¯å˜ã€‚ä¾‹å¦‚åœ¨ä½œä¸ºç½‘ç»œè¿æ¥å‚æ•°çš„æƒ…å†µä¸‹å¦‚æœ String æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œè¿æ¥è¿‡ç¨‹ä¸­ï¼ŒString è¢«æ”¹å˜ï¼Œæ”¹å˜ String çš„é‚£ä¸€æ–¹ä»¥ä¸ºç°åœ¨è¿æ¥çš„æ˜¯å…¶å®ƒä¸»æœºï¼Œè€Œå®é™…æƒ…å†µå´ä¸ä¸€å®šæ˜¯ã€‚
* String ä¸å¯å˜æ€§å¤©ç”Ÿå…·å¤‡çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å®‰å…¨åœ°ä½¿ç”¨ã€‚



***



### StringBuilder

**String StringBuffer StringBuilderåŒºåˆ«**ï¼š
	String : **ä¸å¯å˜**çš„å­—ç¬¦åºåˆ—ï¼Œçº¿ç¨‹å®‰å…¨
	StringBuffer : **å¯å˜**çš„å­—ç¬¦åºåˆ—ï¼›çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½
	StringBuilder : **å¯å˜**çš„å­—ç¬¦åºåˆ—ï¼ŒJDK5.0æ–°å¢ï¼›çº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜ã€‚
	åŒï¼šåº•å±‚ä½¿ç”¨char[]/byte[]å­˜å‚¨

**æºç åˆ†æ**ï¼š

```java
String str = "abc";
char data[] = {'a', 'b', 'c'};
StringBuffer sb1 = new StringBuffer();//new byte[16] 
sb1.append('a'); //value[0] = 'a';
```

**æ„é€ æ–¹æ³•**ï¼š
	public StringBuilder()ï¼šåˆ›å»ºä¸€ä¸ªç©ºç™½å¯å˜å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¸å«æœ‰ä»»ä½•å†…å®¹  
	public StringBuilder(String   str)ï¼šæ ¹æ®å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œæ¥åˆ›å»ºå¯å˜å­—ç¬¦ä¸²å¯¹è±¡

**å¸¸ç”¨API** : 
	`public StringBuilder append(ä»»æ„ç±»å‹)` : æ·»åŠ æ•°æ®ï¼Œå¹¶è¿”å›å¯¹è±¡æœ¬èº«  
	`public StringBuilder reverse()` : è¿”å›ç›¸åçš„å­—ç¬¦åºåˆ—
	`public String toString()` : é€šè¿‡ toString() å°±å¯ä»¥å®ç°æŠŠ StringBuilder è½¬æ¢ä¸º String



****



### Arrays

å¸¸ç”¨APIï¼š
	`public static String toString(int[] a)` : è¿”å›æŒ‡å®šæ•°ç»„çš„å†…å®¹çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼
	`public static void sort(int[] a)` : æŒ‰ç…§æ•°å­—é¡ºåºæ’åˆ—æŒ‡å®šçš„æ•°ç»„
	`public static int binarySearch(int[] a, int key)` : åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾è¿”å›æŒ‡å®šå…ƒç´ çš„ç´¢å¼•
	`public static <T> List<T> asList(T... a)` : è¿”å›ç”±æŒ‡å®šæ•°ç»„æ”¯æŒçš„åˆ—è¡¨ã€‚

```java
public class MyArraysDemo {
      public static void main(String[] args) {
		//æŒ‰ç…§æ•°å­—é¡ºåºæ’åˆ—æŒ‡å®šçš„æ•°ç»„
        int [] arr = {3,2,4,6,7};
        Arrays.sort(arr);
        System.out.println(Arrays.toString(arr));
		
        int [] arr = {1,2,3,4,5,6,7,8,9,10};
        int index = Arrays.binarySearch(arr, 0);
        System.out.println(index);
        //1,æ•°ç»„å¿…é¡»æœ‰åº
        //2.å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ å­˜åœ¨,é‚£ä¹ˆè¿”å›çš„æ˜¯è¿™ä¸ªå…ƒç´ å®é™…çš„ç´¢å¼•
        //3.å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ ä¸å­˜åœ¨,é‚£ä¹ˆè¿”å›çš„æ˜¯ (-æ’å…¥ç‚¹-1)
            //æ’å…¥ç‚¹:å¦‚æœè¿™ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­,ä»–åº”è¯¥åœ¨å“ªä¸ªç´¢å¼•ä¸Š.
      }
  }
```





***



### Random

ç”¨äºç”Ÿæˆä¼ªéšæœºæ•°ã€‚

ä½¿ç”¨æ­¥éª¤ï¼š
1. å¯¼å…¥åŒ…ï¼š`import java.util.Random;`
2. åˆ›å»ºå¯¹è±¡ï¼š`Random r = new Random();`
3. éšæœºæ•´æ•°ï¼š`int num = r.nextInt(10);`
è§£é‡Šï¼š10ä»£è¡¨çš„æ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œå¦‚æœæ‹¬å·å†™10ï¼Œäº§ç”Ÿçš„éšæœºæ•°å°±æ˜¯0-9ï¼Œæ‹¬å·å†™20çš„éšæœºæ•°åˆ™æ˜¯0-19
è·å–0-10ï¼š`int num = r.nextInt(10) + 1`

4. éšæœºå°æ•°ï¼š`public double nextDouble()`ä»èŒƒå›´`0.0d`(å«)è‡³`1.0d` (ä¸åŒ…æ‹¬)ï¼Œä¼ªéšæœºåœ°ç”Ÿæˆå¹¶è¿”å›



***



### Date

åŒ…ï¼šjava.util.Dateã€‚
æ„é€ å™¨ï¼š
         `public Date()`:åˆ›å»ºå½“å‰ç³»ç»Ÿçš„æ­¤åˆ»æ—¥æœŸæ—¶é—´å¯¹è±¡ã€‚
         `public Date(long time)`:æŠŠæ—¶é—´æ¯«ç§’å€¼è½¬æ¢æˆæ—¥æœŸå¯¹è±¡ã€‚
æ–¹æ³•ï¼š
        `public long getTime()`:è¿”å›è‡ª 1970 å¹´ 1 æœˆ 1 æ—¥ 00:00:00 GMT ä»¥æ¥æ€»çš„æ¯«ç§’æ•°ã€‚

æ—¶é—´è®°å½•çš„ä¸¤ç§æ–¹å¼ï¼š
	1.Dateæ—¥æœŸå¯¹è±¡ã€‚
	2.æ—¶é—´æ¯«ç§’å€¼ï¼šä»1970-01-01 00:00:00å¼€å§‹èµ°åˆ°æ­¤åˆ»çš„æ€»çš„æ¯«ç§’å€¼ã€‚ 1s = 1000ms

```java
public class DateDemo {
    public static void main(String[] args) {
        Date d = new Date();
        System.out.println(d);//Fri Oct 16 21:58:44 CST 2020
        long time = d.getTime() + 121*1000;//è¿‡121sæ˜¯ä»€ä¹ˆæ—¶é—´
        System.out.println(time);//1602856875485
        
        Date d1 = new Date(time);
        System.out.println(d1);//Fri Oct 16 22:01:15 CST 2020
    }
}
```

```java
public static void main(String[] args){
    Date d = new Date();
    long startTime = d.getTime();
    for(int i = 0; i < 10000; i++){è¾“å‡ºi}
    long endTime = new Date().getTime();
    System.out.println( (endTime - startTime) / 1000.0 +"s");
    //è¿è¡Œä¸€ä¸‡æ¬¡è¾“å‡ºéœ€è¦å¤šé•¿æ—¶é—´
}
```



***



### DateFormat

DateFormatä½œç”¨ï¼š
1.å¯ä»¥æŠŠâ€œæ—¥æœŸå¯¹è±¡â€æˆ–è€…â€œæ—¶é—´æ¯«ç§’å€¼â€æ ¼å¼åŒ–æˆæˆ‘ä»¬å–œæ¬¢çš„æ—¶é—´å½¢å¼ã€‚ï¼ˆæ ¼å¼åŒ–æ—¶é—´ï¼‰
2.å¯ä»¥æŠŠå­—ç¬¦ä¸²çš„æ—¶é—´å½¢å¼è§£ææˆæ—¥æœŸå¯¹è±¡ã€‚ï¼ˆè§£æå­—ç¬¦ä¸²æ—¶é—´ï¼‰

DateFormatæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œè¦æ‰¾å®ƒçš„å­ç±»ï¼šSimpleDateFormat

SimpleDateFormatç®€å•æ—¥æœŸæ ¼å¼åŒ–ç±»ï¼š
	åŒ…ï¼šjava.text.SimpleDateFormat
    æ„é€ å™¨ï¼špublic SimpleDateFormat(String pattern) : æŒ‡å®šæ—¶é—´çš„æ ¼å¼åˆ›å»ºç®€å•æ—¥æœŸå¯¹è±¡
    æ–¹æ³•ï¼š
      `public String format(Date date) `: æŠŠæ—¥æœŸå¯¹è±¡æ ¼å¼åŒ–æˆæˆ‘ä»¬å–œæ¬¢çš„æ—¶é—´å½¢å¼ï¼Œè¿”å›å­—ç¬¦ä¸²!
      `public String format(Object time)` : æŠŠæ—¶é—´æ¯«ç§’å€¼æ ¼å¼åŒ–æˆè®¾å®šçš„æ—¶é—´å½¢å¼ï¼Œè¿”å›å­—ç¬¦ä¸²!
      `public Date parse(String date) throws ParseException` : æŠŠå­—ç¬¦ä¸²çš„æ—¶é—´è§£ææˆæ—¥æœŸå¯¹è±¡

>yyyyå¹´MMæœˆddæ—¥ HH:mm:ss EEE a" å‘¨å‡  ä¸Šåˆä¸‹åˆ

```java
public static void main(String[] args){
	Date date = new Date();
    SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss);
    String time = sdf.format(date);
    System.out.println(time);//2020-10-18 19:58:34
    //è¿‡121såæ˜¯ä»€ä¹ˆæ—¶é—´
    long time = date.getTime();
    time+=121;
    System.out.println(sdf.formate(time));
    String d = "2020-10-18 20:20:20";//æ ¼å¼ä¸€è‡´
    Date newDate = sdf.parse(d);
    System.out.println(sdf.format(newDate)); //æŒ‰ç…§å‰é¢çš„æ–¹æ³•è¾“å‡º
}
```




****



### Calendar

Calendarä»£è¡¨äº†ç³»ç»Ÿæ­¤åˆ»æ—¥æœŸå¯¹åº”çš„æ—¥å†å¯¹è±¡ã€‚
Calendaræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥åˆ›å»ºå¯¹è±¡ã€‚
Calendaræ—¥å†ç±»åˆ›å»ºæ—¥å†å¯¹è±¡çš„è¯­æ³•ï¼š
		`Calendar rightNow = Calendar.getInstance();`(**é¥¿æ±‰å•ä¾‹æ¨¡å¼**)
Calendarçš„æ–¹æ³•ï¼š
    	`public static Calendar getInstance()`: è¿”å›ä¸€ä¸ªæ—¥å†ç±»çš„å¯¹è±¡ã€‚
    	`public int get(int field)`ï¼šå–æ—¥æœŸä¸­çš„æŸä¸ªå­—æ®µä¿¡æ¯ã€‚
    	`public void set(int field,int value)`ï¼šä¿®æ”¹æ—¥å†çš„æŸä¸ªå­—æ®µä¿¡æ¯ã€‚
    	`public void add(int field,int amount)`ï¼šä¸ºæŸä¸ªå­—æ®µå¢åŠ /å‡å°‘æŒ‡å®šçš„å€¼
    	`public final Date getTime()`: æ‹¿åˆ°æ­¤åˆ»æ—¥æœŸå¯¹è±¡ã€‚
   	 `public long getTimeInMillis()`: æ‹¿åˆ°æ­¤åˆ»æ—¶é—´æ¯«ç§’å€¼

```java
public static void main(String[] args){
	Calendar rightNow = Calendar.getInsance(); 
	int year = rightNow.get(Calendar.YEAR);//è·å–å¹´
    int month = rightNow.get(Calendar.MONTH) + 1;//æœˆè¦+1
    int days = rightNow.get(Calendar.DAY_OF_YEAR);
    rightNow.set(Calendar.YEAR , 2099);//ä¿®æ”¹æŸä¸ªå­—æ®µ
    rightNow.add(Calendar.HOUR , 15);//åŠ 15å°æ—¶  -15å°±æ˜¯å‡å»15å°æ—¶
    Date date = rightNow.getTime();//æ—¥å†å¯¹è±¡
    long time = rightNow.getTimeInMillis();//æ—¶é—´æ¯«ç§’å€¼
    //700å¤©åæ˜¯ä»€ä¹ˆæ—¥å­
    rightNow.add(Calendar.DAY_OF_YEAR , 701);
    Date date d = rightNow.getTime();
    SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    System.out.println(sdf.format(d));//è¾“å‡º700å¤©åçš„æ—¥æœŸ
}
```



***



### LocalDateTime

>  JDK1.8æ–°å¢ï¼Œçº¿ç¨‹å®‰å…¨ã€‚

+ LocalDate       è¡¨ç¤ºæ—¥æœŸï¼ˆå¹´æœˆæ—¥ï¼‰  
+ LocalTime       è¡¨ç¤ºæ—¶é—´ï¼ˆæ—¶åˆ†ç§’ï¼‰
+ LocalDateTime    è¡¨ç¤ºæ—¶é—´+ æ—¥æœŸ ï¼ˆå¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼‰

æ„é€ æ–¹æ³•ï¼š
  public static LocalDateTime now()  è·å–å½“å‰ç³»ç»Ÿæ—¶é—´ 
  public static LocalDateTime of  (å¹´, æœˆ , æ—¥, æ—¶, åˆ†, ç§’)  ä½¿ç”¨æŒ‡å®šå¹´æœˆæ—¥å’Œæ—¶åˆ†ç§’åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡

å¸¸ç”¨APIï¼š

| æ–¹æ³•å                                                       | è¯´æ˜                                                        |
| ------------------------------------------------------------ | ----------------------------------------------------------- |
| public int getYear()                                         | è·å–å¹´                                                      |
| public int getMonthValue()                                   | è·å–æœˆä»½ï¼ˆ1-12ï¼‰                                            |
| public int getDayOfMonth()                                   | è·å–æœˆä»½ä¸­çš„ç¬¬å‡ å¤©ï¼ˆ1-31ï¼‰                                  |
| public int getDayOfYear()                                    | è·å–ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼ˆ1-366ï¼‰                                 |
| public DayOfWeek getDayOfWeek()                              | è·å–æ˜ŸæœŸ                                                    |
| public int getMinute()                                       | è·å–åˆ†é’Ÿ                                                    |
| public int getHour()                                         | è·å–å°æ—¶                                                    |
| public LocalDate  toLocalDate ()                             | è½¬æ¢æˆä¸ºä¸€ä¸ªLocalDateå¯¹è±¡ï¼ˆå¹´æœˆæ—¥ï¼‰                         |
| public LocalTime toLocalTime ()                              | è½¬æ¢æˆä¸ºä¸€ä¸ªLocalTimeå¯¹è±¡ï¼ˆæ—¶åˆ†ç§’ï¼‰                         |
| public String format (æŒ‡å®šæ ¼å¼)                              | æŠŠä¸€ä¸ªLocalDateTimeæ ¼å¼åŒ–æˆä¸ºä¸€ä¸ªå­—ç¬¦ä¸²                     |
| public LocalDateTime parse (å‡†å¤‡è§£æçš„å­—ç¬¦ä¸², è§£ææ ¼å¼)      | æŠŠä¸€ä¸ªæ—¥æœŸå­—ç¬¦ä¸²è§£ææˆä¸ºä¸€ä¸ªLocalDateTimeå¯¹è±¡               |
| **public static DateTimeFormatter ofPattern(String pattern)** | ä½¿ç”¨æŒ‡å®šçš„æ—¥æœŸæ¨¡æ¿è·å–ä¸€ä¸ªæ—¥æœŸæ ¼å¼åŒ–å™¨DateTimeFormatterå¯¹è±¡ |

```java
public class JDK8DateDemo2 {
    public static void main(String[] args) {
        LocalDateTime now = LocalDateTime.now();
        System.out.println(now);

        LocalDateTime localDateTime = LocalDateTime.of(2020, 11, 11, 11, 11, 11);
        System.out.println(localDateTime);
        DateTimeFormatter pattern = DateTimeFormatter.ofPattern("yyyyå¹´MMæœˆddæ—¥ HH:mm:ss");
        String s = localDateTime.format(pattern);
         LocalDateTime parse = LocalDateTime.parse(s, pattern);
    }
}
```

| æ–¹æ³•å                                              | è¯´æ˜                           |
| --------------------------------------------------- | ------------------------------ |
| public LocalDateTime plusYears (long years)         | æ·»åŠ æˆ–è€…å‡å»å¹´                 |
| public LocalDateTime plusMonths(long months)        | æ·»åŠ æˆ–è€…å‡å»æœˆ                 |
| public LocalDateTime plusDays(long days)            | æ·»åŠ æˆ–è€…å‡å»æ—¥                 |
| public LocalDateTime plusHours(long hours)          | æ·»åŠ æˆ–è€…å‡å»æ—¶                 |
| public LocalDateTime plusMinutes(long minutes)      | æ·»åŠ æˆ–è€…å‡å»åˆ†                 |
| public LocalDateTime plusSeconds(long seconds)      | æ·»åŠ æˆ–è€…å‡å»ç§’                 |
| public LocalDateTime plusWeeks(long weeks)          | æ·»åŠ æˆ–è€…å‡å»å‘¨                 |
| public LocalDateTime  minusYears (long years)       | å‡å»æˆ–è€…æ·»åŠ å¹´                 |
| public LocalDateTime withYear(int year)             | ç›´æ¥ä¿®æ”¹å¹´                     |
| public LocalDateTime withMonth(int month)           | ç›´æ¥ä¿®æ”¹æœˆ                     |
| public LocalDateTime withDayOfMonth(int dayofmonth) | ç›´æ¥ä¿®æ”¹æ—¥æœŸ(ä¸€ä¸ªæœˆä¸­çš„ç¬¬å‡ å¤©) |
| public LocalDateTime withDayOfYear(int dayOfYear)   | ç›´æ¥ä¿®æ”¹æ—¥æœŸ(ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©)   |
| public LocalDateTime withHour(int hour)             | ç›´æ¥ä¿®æ”¹å°æ—¶                   |
| public LocalDateTime withMinute(int minute)         | ç›´æ¥ä¿®æ”¹åˆ†é’Ÿ                   |
| public LocalDateTime withSecond(int second)         | ç›´æ¥ä¿®æ”¹ç§’                     |



**æ—¶é—´é—´éš”**

| æ–¹æ³•å                                           | è¯´æ˜                 |
| ------------------------------------------------ | -------------------- |
| public static Period between(å¼€å§‹æ—¶é—´,ç»“æŸæ—¶é—´)  | è®¡ç®—ä¸¤ä¸ªâ€œæ—¶é—´"çš„é—´éš” |
| public int getYears()                            | è·å¾—è¿™æ®µæ—¶é—´çš„å¹´æ•°   |
| public int getMonths()                           | è·å¾—æ­¤æœŸé—´çš„æ€»æœˆæ•°   |
| public int getDays()                             | è·å¾—æ­¤æœŸé—´çš„å¤©æ•°     |
| public long toTotalMonths()                      | è·å–æ­¤æœŸé—´çš„æ€»æœˆæ•°   |
| public static Durationbetween(å¼€å§‹æ—¶é—´,ç»“æŸæ—¶é—´) | è®¡ç®—ä¸¤ä¸ªâ€œæ—¶é—´"çš„é—´éš” |
| public long toSeconds()                          | è·å¾—æ­¤æ—¶é—´é—´éš”çš„ç§’   |
| public int toMillis()                            | è·å¾—æ­¤æ—¶é—´é—´éš”çš„æ¯«ç§’ |
| public int toNanos()                             | è·å¾—æ­¤æ—¶é—´é—´éš”çš„çº³ç§’ |

```java
//è®¡ç®—ä¸¤ä¸ªæ—¶é—´çš„é—´éš”
public class JDK8DateDemo9 {
    public static void main(String[] args) {
        //public static Period between(å¼€å§‹æ—¶é—´,ç»“æŸæ—¶é—´)  è®¡ç®—ä¸¤ä¸ª"æ—¶é—´"çš„é—´éš”
        LocalDate localDate1 = LocalDate.of(2020, 1, 1);
        LocalDate localDate2 = LocalDate.of(2048, 12, 12);
        Period period = Period.between(localDate1, localDate2);
        System.out.println(period);//P28Y11M11D
		Duration duration = Duration.between(localDateTime1, localDateTime2);
        System.out.println(duration);//PT21H57M58S
    }
}
```



***



### Math

Mathç”¨äºåšæ•°å­¦è¿ç®—ã€‚
Mathç±»ä¸­çš„æ–¹æ³•å…¨éƒ¨æ˜¯é™æ€æ–¹æ³•ï¼Œç›´æ¥ç”¨ç±»åè°ƒç”¨å³å¯ã€‚
æ–¹æ³•ï¼š

| æ–¹æ³•                                         | è¯´æ˜                            |
| -------------------------------------------- | ------------------------------- |
| public static int abs(int a)                 | è·å–å‚æ•°açš„ç»å¯¹å€¼               |
| public static double ceil(double a)          | å‘ä¸Šå–æ•´                        |
| public static double floor(double a)         | å‘ä¸‹å–æ•´                        |
| public static double pow(double a, double b) | è·å–açš„bæ¬¡å¹‚                    |
| public static long round(double a)           | å››èˆäº”å…¥å–æ•´                    |
| public static int max(int a,int b)           | è¿”å›è¾ƒå¤§å€¼                      |
| public static int min(int a,int b)           | è¿”å›è¾ƒå°å€¼                      |
| public   static double random()              | è¿”å›å€¼ä¸ºdoubleçš„æ­£å€¼ï¼Œ[0.0,1.0) |

```java
public class MathDemo {
    public static void main(String[] args) {
        // 1.å–ç»å¯¹å€¼:è¿”å›æ­£æ•°ã€‚
        System.out.println(Math.abs(10));
        System.out.println(Math.abs(-10.3));
        // 2.å‘ä¸Šå–æ•´: 5
        System.out.println(Math.ceil(4.00000001)); // 5.0
        System.out.println(Math.ceil(-4.00000001));//4.0
        // 3.å‘ä¸‹å–æ•´ï¼š4
        System.out.println(Math.floor(4.99999999)); // 4.0
        System.out.println(Math.floor(-4.99999999)); // 5.0
        // 4.æ±‚æŒ‡æ•°æ¬¡æ–¹
        System.out.println(Math.pow(2 , 3)); // 2^3 = 8.0
        // 5.å››èˆäº”å…¥ 10
        System.out.println(Math.round(4.49999)); // 4
        System.out.println(Math.round(4.500001)); // 5
        System.out.println(Math.round(5.5));//6
    }
}
```



### DecimalFormat

ä½¿ä»»ä½•å½¢å¼çš„æ•°å­—è§£æå’Œæ ¼å¼åŒ–

```java
public static void main(String[]args){
ã€€ã€€ã€€ã€€double pi = 3.1415927;ã€€//åœ†å‘¨ç‡
ã€€ã€€ã€€ã€€//å–ä¸€ä½æ•´æ•°
ã€€ã€€ã€€ã€€System.out.println(new DecimalFormat("0").format(pi));ã€€ã€€ã€€//3
ã€€ã€€ã€€ã€€//å–ä¸€ä½æ•´æ•°å’Œä¸¤ä½å°æ•°
ã€€ã€€ã€€ã€€System.out.println(new DecimalFormat("0.00").format(pi));ã€€//3.14
ã€€ã€€ã€€ã€€//å–ä¸¤ä½æ•´æ•°å’Œä¸‰ä½å°æ•°ï¼Œæ•´æ•°ä¸è¶³éƒ¨åˆ†ä»¥0å¡«è¡¥ã€‚
ã€€ã€€ã€€ã€€System.out.println(new DecimalFormat("00.000").format(pi));// 03.142
ã€€ã€€ã€€ã€€//å–æ‰€æœ‰æ•´æ•°éƒ¨åˆ†
ã€€ã€€ã€€ã€€System.out.println(new DecimalFormat("#").format(pi));ã€€ã€€ã€€//3
ã€€ã€€ã€€ã€€//ä»¥ç™¾åˆ†æ¯”æ–¹å¼è®¡æ•°ï¼Œå¹¶å–ä¸¤ä½å°æ•°
ã€€ã€€ã€€ã€€System.out.println(new DecimalFormat("#.##%").format(pi));ã€€//314.16%
    
ã€€ã€€ ã€€ long c =299792458;ã€€ã€€//å…‰é€Ÿ
ã€€ã€€ã€€ã€€//æ˜¾ç¤ºä¸ºç§‘å­¦è®¡æ•°æ³•ï¼Œå¹¶å–äº”ä½å°æ•°
ã€€ã€€ã€€ã€€System.out.println(new DecimalFormat("#.#####E0").format(c));//2.99792E8
ã€€ã€€ã€€ã€€//æ˜¾ç¤ºä¸ºä¸¤ä½æ•´æ•°çš„ç§‘å­¦è®¡æ•°æ³•ï¼Œå¹¶å–å››ä½å°æ•°
ã€€ã€€ã€€ã€€System.out.println(new DecimalFormat("00.####E0").format(c));//29.9792E7
ã€€ã€€ã€€ã€€//æ¯ä¸‰ä½ä»¥é€—å·è¿›è¡Œåˆ†éš”ã€‚
ã€€ã€€ã€€ã€€System.out.println(new DecimalFormat(",###").format(c));//299,792,458
ã€€ã€€ã€€ã€€//å°†æ ¼å¼åµŒå…¥æ–‡æœ¬
ã€€ã€€ã€€ã€€System.out.println(new DecimalFormat("å…‰é€Ÿå¤§å°ä¸ºæ¯ç§’,###ç±³ã€‚").format(c));
  
ã€€ã€€}
```



***



### System

Systemä»£è¡¨å½“å‰ç³»ç»Ÿã€‚
é™æ€æ–¹æ³•ï¼š

1. `public static void exit(int status)` : ç»ˆæ­¢JVMè™šæ‹Ÿæœºï¼Œé0æ˜¯å¼‚å¸¸ç»ˆæ­¢
2. `public static long currentTimeMillis()` : è·å–å½“å‰ç³»ç»Ÿæ­¤åˆ»æ—¶é—´æ¯«ç§’å€¼
3. `static void arraycopy(Object var0, int var1, Object var2, int var3, int var4)` : æ•°ç»„æ‹·è´
   å‚æ•°ä¸€ï¼šåŸæ•°ç»„
   å‚æ•°äºŒï¼šä»åŸæ•°ç»„çš„å“ªä¸ªä½ç½®å¼€å§‹èµ‹å€¼ã€‚
   å‚æ•°ä¸‰ï¼šç›®æ ‡æ•°ç»„
   å‚æ•°å››ï¼šä»ç›®æ ‡æ•°ç»„çš„å“ªä¸ªä½ç½®å¼€å§‹èµ‹å€¼
   å‚æ•°äº”ï¼šèµ‹å€¼å‡ ä¸ªã€‚

```java
public class SystemDemo {
    public static void main(String[] args) {
        //System.exit(0); // 0ä»£è¡¨æ­£å¸¸ç»ˆæ­¢!!
        long startTime = System.currentTimeMillis();//å®šä¹‰sdf æŒ‰ç…§æ ¼å¼è¾“å‡º
        for(int i = 0; i < 10000; i++){è¾“å‡ºi}
		long endTime = new Date().getTime();
		System.out.println( (endTime - startTime)/1000.0 +"s");//ç¨‹åºç”¨æ—¶

        int[] arr1 = new int[]{10 ,20 ,30 ,40 ,50 ,60 ,70};
        int[] arr2 = new int[6]; // [ 0 , 0 , 0 , 0 , 0 , 0]
        // å˜æˆarrs2 = [0 , 30 , 40 , 50 , 0 , 0 ]
        System.arraycopy(arr1, 2, arr2, 1, 3);
    }
}
```



***



### BigDecimal

åŒ…ï¼šjava.math.
æ„é€ æ–¹æ³•ï¼š
	`public static BigDecimal valueOf(double val)` : åŒ…è£…æµ®ç‚¹æ•°æˆä¸ºå¤§æ•°æ®å¯¹è±¡ã€‚
	`public BigDecimal(double val)` : 
	`public BigDecimal(String val)` : 

æ–¹æ³•å£°æ˜ï¼š
	`public BigDecimal add(BigDecimal value)` : åŠ æ³•è¿ç®—
	`public BigDecimal subtract(BigDecimal value)` : å‡æ³•è¿ç®— 
	`public BigDecimal multiply(BigDecimal value)` : ä¹˜æ³•è¿ç®— 
	`public BigDecimal divide(BigDecimal value)` : é™¤æ³•è¿ç®—
	`public double doubleValue()` : æŠŠBigDecimalè½¬æ¢æˆdoubleç±»å‹ã€‚
	`public int intValue()` : è½¬ä¸ºint  å…¶ä»–ç±»å‹ç›¸åŒ
	`public BigDecimal divide (BigDecimal valueï¼Œç²¾ç¡®å‡ ä½ï¼Œèˆå…¥æ¨¡å¼)` : é™¤æ³•

```java
public class BigDecimalDemo {
    public static void main(String[] args) {
        // æµ®ç‚¹å‹è¿ç®—çš„æ—¶å€™ç›´æ¥+ - * / å¯èƒ½ä¼šå‡ºç°æ•°æ®å¤±çœŸï¼ˆç²¾åº¦é—®é¢˜ï¼‰ã€‚
        System.out.println(0.1 + 0.2);
        System.out.println(1.301 / 100);
        
        double a = 0.1 ;
        double b = 0.2 ;
        double c = a + b ;
        System.out.println(c);//0.30000000000000004
        
        // 1.æŠŠæµ®ç‚¹æ•°è½¬æ¢æˆå¤§æ•°æ®å¯¹è±¡è¿ç®—
        BigDecimal a1 = BigDecimal.valueOf(a);
        BigDecimal b1 = BigDecimal.valueOf(b);
        BigDecimal c1 = a1.add(b1);//a1.divide(b1);ä¹Ÿå¯ä»¥
		System.out.println(c1);

        // BigDecimalåªæ˜¯è§£å†³ç²¾åº¦é—®é¢˜çš„æ‰‹æ®µï¼Œdoubleæ•°æ®æ‰æ˜¯æˆ‘ä»¬çš„ç›®çš„ï¼ï¼
        double d = c1.doubleValue();
    }
}
```

+ æ€»ç»“

  1. BigDecimalæ˜¯ç”¨æ¥è¿›è¡Œç²¾ç¡®è®¡ç®—çš„
  2. åˆ›å»ºBigDecimalçš„å¯¹è±¡ï¼Œæ„é€ æ–¹æ³•ä½¿ç”¨å‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²çš„ã€‚
  3. å››åˆ™è¿ç®—ä¸­çš„é™¤æ³•ï¼Œå¦‚æœé™¤ä¸å°½è¯·ä½¿ç”¨divideçš„ä¸‰ä¸ªå‚æ•°çš„æ–¹æ³•ã€‚

  ```java
BigDecimal divide = bd1.divide(å‚ä¸è¿ç®—çš„å¯¹è±¡,å°æ•°ç‚¹åç²¾ç¡®åˆ°å¤šå°‘ä½,èˆå…¥æ¨¡å¼);
  å‚æ•°1ï¼šè¡¨ç¤ºå‚ä¸è¿ç®—çš„BigDecimal å¯¹è±¡ã€‚
  å‚æ•°2ï¼šè¡¨ç¤ºå°æ•°ç‚¹åé¢ç²¾ç¡®åˆ°å¤šå°‘ä½
  å‚æ•°3ï¼šèˆå…¥æ¨¡å¼  
    BigDecimal.ROUND_UP  è¿›ä¸€æ³•
    BigDecimal.ROUND_FLOOR å»å°¾æ³•
    BigDecimal.ROUND_HALF_UP å››èˆäº”å…¥
  ```
  
  

***



### Regex

#### æ¦‚è¿°

æ­£åˆ™è¡¨è¾¾å¼çš„ä½œç”¨ï¼š
	æ˜¯ä¸€äº›ç‰¹æ®Šå­—ç¬¦ç»„æˆçš„æ ¡éªŒè§„åˆ™ï¼Œå¯ä»¥æ ¡éªŒä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œæ ¡éªŒé‚®ç®±ã€ç”µè¯å·ç ã€é‡‘é¢ç­‰ã€‚

æ¯”å¦‚æ£€éªŒqqå·ï¼š

```java
public static boolean checkQQRegex(String qq){
    return qq!=null && qq.matches("\\d{4,}");//å³æ˜¯æ•°å­— å¿…é¡»å¤§äº4ä½æ•°
}// ç”¨\\d  æ˜¯å› ä¸º\ç”¨æ¥å‘Šè¯‰å®ƒæ˜¯ä¸€ä¸ªæ ¡éªŒç±»ï¼Œä¸æ˜¯æ™®é€šçš„å­—ç¬¦ æ¯”å¦‚ \t \n
```

java.util.regex åŒ…ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªç±»ï¼š

- Pattern ç±»ï¼š

  pattern å¯¹è±¡æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ç¼–è¯‘è¡¨ç¤ºã€‚Pattern ç±»æ²¡æœ‰å…¬å…±æ„é€ æ–¹æ³•ã€‚è¦åˆ›å»ºä¸€ä¸ª Pattern å¯¹è±¡ï¼Œå¿…é¡»é¦–å…ˆè°ƒç”¨å…¶å…¬å…±é™æ€ç¼–è¯‘æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª Pattern å¯¹è±¡ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä½œä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

- Matcher ç±»ï¼š

  Matcher å¯¹è±¡æ˜¯å¯¹è¾“å…¥å­—ç¬¦ä¸²è¿›è¡Œè§£é‡Šå’ŒåŒ¹é…æ“ä½œçš„å¼•æ“ã€‚ä¸Pattern ç±»ä¸€æ ·ï¼ŒMatcher ä¹Ÿæ²¡æœ‰å…¬å…±æ„é€ æ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨ Pattern å¯¹è±¡çš„ matcher æ–¹æ³•æ¥è·å¾—ä¸€ä¸ª Matcher å¯¹è±¡ã€‚

- PatternSyntaxExceptionï¼š

  PatternSyntaxException æ˜¯ä¸€ä¸ªéå¼ºåˆ¶å¼‚å¸¸ç±»ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­çš„è¯­æ³•é”™è¯¯ã€‚



***



#### å­—ç¬¦åŒ¹é…

##### æ™®é€šå­—ç¬¦

å­—æ¯ã€æ•°å­—ã€æ±‰å­—ã€ä¸‹åˆ’çº¿ã€ä»¥åŠæ²¡æœ‰ç‰¹æ®Šå®šä¹‰çš„æ ‡ç‚¹ç¬¦å·ï¼Œéƒ½æ˜¯â€œæ™®é€šå­—ç¬¦â€ã€‚è¡¨è¾¾å¼ä¸­çš„æ™®é€šå­—ç¬¦ï¼Œåœ¨åŒ¹é…ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ—¶å€™ï¼ŒåŒ¹é…ä¸ä¹‹ç›¸åŒçš„ä¸€ä¸ªå­—ç¬¦ã€‚å…¶ä»–ç»Ÿç§°**å…ƒå­—ç¬¦**



##### ç‰¹æ®Šå­—ç¬¦

\r\n æ˜¯Windowsä¸­çš„æ–‡æœ¬è¡Œç»“æŸæ ‡ç­¾ï¼Œåœ¨Unix/Linuxåˆ™æ˜¯ \n

| å…ƒå­—ç¬¦ | è¯´æ˜                                                         |
| ------ | ------------------------------------------------------------ |
| \      | å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºä¸€ä¸ªç‰¹æ®Šå­—ç¬¦æˆ–åŸä¹‰å­—ç¬¦ï¼Œå‘Šè¯‰å®ƒæ˜¯ä¸€ä¸ªæ ¡éªŒç±»ï¼Œä¸æ˜¯æ™®é€šå­—ç¬¦ |
| \f     | æ¢é¡µç¬¦                                                       |
| \n     | æ¢è¡Œç¬¦                                                       |
| \r     | å›è½¦ç¬¦                                                       |
| \t     | åˆ¶è¡¨ç¬¦                                                       |
| \\     | ä»£è¡¨\æœ¬èº«                                                    |
| ()     | ä½¿ç”¨( )å®šä¹‰ä¸€ä¸ªå­è¡¨è¾¾å¼ã€‚å­è¡¨è¾¾å¼çš„å†…å®¹å¯ä»¥å½“æˆä¸€ä¸ªç‹¬ç«‹å…ƒç´   |



##### æ ‡å‡†å­—ç¬¦

æ ‡å‡†å­—ç¬¦é›†åˆ
èƒ½å¤Ÿä¸â€å¤šç§å­—ç¬¦â€œåŒ¹é…çš„è¡¨è¾¾å¼ã€‚æ³¨æ„åŒºåˆ†å¤§å°å†™ï¼Œå¤§å†™æ˜¯ç›¸åçš„æ„æ€ã€‚åªèƒ½æ ¡éªŒ"å•"ä¸ªå­—ç¬¦ã€‚

| å…ƒå­—ç¬¦ | è¯´æ˜                                                         |
| ------ | ------------------------------------------------------------ |
| .      | åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦(é™¤äº†æ¢è¡Œç¬¦)ï¼Œå¦‚æœè¦åŒ¹é…åŒ…æ‹¬â€œ\nâ€åœ¨å†…çš„æ‰€æœ‰å­—ç¬¦ï¼Œä¸€èˆ¬ç”¨[\s\S] |
| \d     | æ•°å­—å­—ç¬¦ï¼Œ0~9 ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œç­‰ä»·äº [0-9]                     |
| \D     | éæ•°å­—å­—ç¬¦ï¼Œç­‰ä»·äº  [ ^0-9]                                  |
| \w     | å¤§å°å†™å­—æ¯æˆ–æ•°å­—æˆ–ä¸‹åˆ’çº¿ï¼Œç­‰ä»·äº[a-zA-Z_0-9_]                |
| \W     | å¯¹\wå–éï¼Œç­‰ä»·äº[ ^\w]                                       |
| \s     | ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ç©ºç™½å­—ç¬¦çš„å…¶ä¸­ä»»æ„ä¸€ä¸ªï¼Œç­‰ä»·äº[\f\n\r\t\v] |
| \S     | å¯¹ \s å–é                                                   |

\x åŒ¹é…åå…­è¿›åˆ¶å­—ç¬¦ï¼Œ\0 åŒ¹é…å…«è¿›åˆ¶ï¼Œä¾‹å¦‚ \xA å¯¹åº”å€¼ä¸º 10 çš„ ASCII å­—ç¬¦ ï¼Œå³ \n



##### è‡ªå®šä¹‰ç¬¦

è‡ªå®šä¹‰ç¬¦å·é›†åˆï¼Œ[ ]æ–¹æ‹¬å·åŒ¹é…æ–¹å¼ï¼Œèƒ½å¤ŸåŒ¹é…æ–¹æ‹¬å·ä¸­**ä»»æ„ä¸€ä¸ª**å­—ç¬¦

| å…ƒå­—ç¬¦       | è¯´æ˜                                      |
| ------------ | ----------------------------------------- |
| [ab5@]       | åŒ¹é… "a" æˆ– "b" æˆ– "5" æˆ– "@"             |
| [^ abc]      | åŒ¹é… "a","b","c" ä¹‹å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦       |
| [f-k]        | åŒ¹é… "f"~"k" ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªå­—æ¯           |
| [^A-F0-3]    | åŒ¹é… "A","F","0"~"3" ä¹‹å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦   |
| [a-d[m-p]]   | åŒ¹é… a åˆ° d æˆ–è€… m åˆ° pï¼š[a-dm-p]ï¼ˆå¹¶é›†ï¼‰ |
| [a-z&&[m-p]] | åŒ¹é… a åˆ° z å¹¶ä¸” m åˆ° pï¼š[a-dm-p]ï¼ˆäº¤é›†ï¼‰ |
| [^]          | å–å                                      |

* æ­£åˆ™è¡¨è¾¾å¼çš„ç‰¹æ®Šç¬¦å·ï¼Œè¢«åŒ…å«åˆ°ä¸­æ‹¬å·ä¸­ï¼Œåˆ™å¤±å»ç‰¹æ®Šæ„ä¹‰ï¼Œé™¤äº†^,-ä¹‹å¤–

* æ ‡å‡†å­—ç¬¦é›†åˆï¼Œé™¤å°æ•°ç‚¹å¤–ï¼Œå¦‚æœè¢«åŒ…å«äºä¸­æ‹¬å·ï¼Œè‡ªå®šä¹‰å­—ç¬¦é›†åˆå°†åŒ…å«è¯¥é›†åˆã€‚
  æ¯”å¦‚ï¼š[\d. \ -+]å°†åŒ¹é…ï¼šæ•°å­—ã€å°æ•°ç‚¹ã€+ã€-



##### é‡è¯å­—ç¬¦

ä¿®é¥°åŒ¹é…æ¬¡æ•°çš„ç‰¹æ®Šç¬¦å·ã€‚

* åŒ¹é…æ¬¡æ•°ä¸­çš„è´ªå©ªæ¨¡å¼(åŒ¹é…å­—ç¬¦è¶Šå¤šè¶Šå¥½ï¼Œé»˜è®¤ï¼)ï¼Œ\* å’Œ + éƒ½æ˜¯è´ªå©ªå‹å…ƒå­—ç¬¦ã€‚
* åŒ¹é…æ¬¡æ•°ä¸­çš„éè´ªå©ªæ¨¡å¼ï¼ˆåŒ¹é…å­—ç¬¦è¶Šå°‘è¶Šå¥½ï¼Œä¿®é¥°åŒ¹é…æ¬¡æ•°çš„ç‰¹æ®Šç¬¦å·åå†åŠ ä¸Šä¸€ä¸ª "?" å·ï¼‰

| å…ƒå­—ç¬¦ | è¯´æ˜                             |
| ------ | -------------------------------- |
| X?     | Xä¸€æ¬¡æˆ–ä¸€æ¬¡ä¹Ÿæ²¡ï¼Œæœ‰ç›¸å½“äº {0,1}  |
| X*     | Xä¸å‡ºç°æˆ–å‡ºç°ä»»æ„æ¬¡ï¼Œç›¸å½“äº {0,} |
| X+     | Xè‡³å°‘ä¸€æ¬¡ï¼Œç›¸å½“äº {1,}           |
| X{n}   | Xæ°å¥½ n æ¬¡                       |
| {n,}   | Xè‡³å°‘ n æ¬¡                       |
| {n,m}  | Xè‡³å°‘ n æ¬¡ï¼Œä½†æ˜¯ä¸è¶…è¿‡ m æ¬¡      |



***



#### ä½ç½®åŒ¹é…

##### å­—ç¬¦è¾¹ç•Œ

æœ¬ç»„æ ‡è®°åŒ¹é…çš„ä¸æ˜¯å­—ç¬¦è€Œæ˜¯ä½ç½®ï¼Œç¬¦åˆæŸç§æ¡ä»¶çš„ä½ç½®

| å…ƒå­—ç¬¦ | è¯´æ˜                                                         |
| ------ | ------------------------------------------------------------ |
| ^      | ä¸å­—ç¬¦ä¸²å¼€å§‹çš„åœ°æ–¹åŒ¹é…ã€‚(åœ¨å­—ç¬¦é›†åˆä¸­ç”¨æ¥æ±‚éï¼Œåœ¨å­—ç¬¦é›†åˆå¤–ç”¨ä½œåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´) |
| $      | ä¸å­—ç¬¦ä¸²ç»“æŸçš„åœ°æ–¹åŒ¹é…                                       |
| \b     | åŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œ                                             |



##### æ•è·ç»„

æ•è·ç»„æ˜¯æŠŠå¤šä¸ªå­—ç¬¦å½“ä¸€ä¸ªå•ç‹¬å•å…ƒè¿›è¡Œå¤„ç†çš„æ–¹æ³•ï¼Œå®ƒé€šè¿‡å¯¹æ‹¬å·å†…çš„å­—ç¬¦åˆ†ç»„æ¥åˆ›å»ºã€‚

åœ¨è¡¨è¾¾å¼( ( A ) ( B ( C ) ) )ï¼Œæœ‰å››ä¸ªè¿™æ ·çš„ç»„ï¼š((A)(B(C)))ã€(A)ã€(B(C))ã€(C)ï¼ˆæŒ‰ç…§æ‹¬å·ä»å·¦åˆ°å³ï¼‰

* è°ƒç”¨ matcher å¯¹è±¡çš„groupCount æ–¹æ³•è¿”å›ä¸€ä¸ª intå€¼ï¼Œè¡¨ç¤ºmatcherå¯¹è±¡å½“å‰æœ‰å¤šä¸ªæ•è·ç»„ã€‚
* ç‰¹æ®Šçš„ç»„ï¼ˆgroup(0)ï¼‰ï¼Œå®ƒä»£è¡¨æ•´ä¸ªè¡¨è¾¾å¼ã€‚è¯¥ç»„ä¸åŒ…æ‹¬åœ¨ groupCount çš„è¿”å›å€¼ä¸­ã€‚ 

| è¡¨è¾¾å¼                    | è¯´æ˜                                                         |
| ------------------------- | ------------------------------------------------------------ |
| \|  (åˆ†æ”¯ç»“æ„)            | å·¦å³ä¸¤è¾¹è¡¨è¾¾å¼ä¹‹é—´ "æˆ–" å…³ç³»ï¼ŒåŒ¹é…å·¦è¾¹æˆ–è€…å³è¾¹               |
| ()  (æ•è·ç»„)              | (1) åœ¨è¢«ä¿®é¥°åŒ¹é…æ¬¡æ•°çš„æ—¶å€™ï¼Œæ‹¬å·ä¸­çš„è¡¨è¾¾å¼å¯ä»¥ä½œä¸ºæ•´ä½“è¢«ä¿®é¥°<br/>(2) å–åŒ¹é…ç»“æœçš„æ—¶å€™ï¼Œæ‹¬å·ä¸­çš„è¡¨è¾¾å¼åŒ¹é…åˆ°çš„å†…å®¹å¯ä»¥è¢«å•ç‹¬å¾—åˆ°<br/>(3) æ¯ä¸€å¯¹æ‹¬å·åˆ†é…ä¸€ä¸ªç¼–å·,()çš„æ•è·æ ¹æ®å·¦æ‹¬å·çš„é¡ºåºä»1å¼€å§‹è‡ªåŠ¨ç¼–å·ã€‚æ•è·å…ƒç´ ç¼–å·ä¸ºé›¶çš„ç¬¬ä¸€ä¸ªæ•è·æ˜¯ç”±æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…çš„æ–‡æœ¬ |
| (?:Expression)   éæ•è·ç»„ | ä¸€äº›è¡¨è¾¾å¼ä¸­ï¼Œä¸å¾—ä¸ä½¿ç”¨( )ï¼Œä½†åˆä¸éœ€è¦ä¿å­˜( )ä¸­å­è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ï¼Œè¿™æ—¶å¯ä»¥ç”¨éæ•è·ç»„æ¥æŠµæ¶ˆä½¿ç”¨( )å¸¦æ¥çš„å‰¯ä½œç”¨ã€‚ |



##### åå‘å¼•ç”¨

åå‘å¼•ç”¨ï¼ˆ\numberï¼‰ï¼Œåˆå«å›æº¯å¼•ç”¨ï¼š

* æ¯ä¸€å¯¹()ä¼šåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œä½¿ç”¨ () çš„æ•è·æ ¹æ®å·¦æ‹¬å·çš„é¡ºåºä»1å¼€å§‹è‡ªåŠ¨ç¼–å·ã€‚

* é€šè¿‡åå‘å¼•ç”¨ï¼Œå¯ä»¥å¯¹åˆ†ç»„å·²æ•è·çš„å­—ç¬¦ä¸²è¿›è¡Œå¼•ç”¨ï¼Œç»§ç»­åŒ¹é…ã€‚

* **æŠŠåŒ¹é…åˆ°çš„å­—ç¬¦é‡å¤ä¸€éåœ¨è¿›è¡ŒåŒ¹é…**

* åº”ç”¨1ï¼š

  ```java
  String regex = "((\d)3)\1[0-9](\w)\2{2}";
  ```

  * é¦–å…ˆåŒ¹é…((\d)3)ï¼Œå…¶æ¬¡\1åŒ¹é…((\d)3)å·²ç»åŒ¹é…åˆ°çš„å†…å®¹ï¼Œ\2åŒ¹é…ï¼ˆ\dï¼‰ï¼Œ {2}æŒ‡çš„æ˜¯\2çš„å€¼å‡ºç°ä¸¤æ¬¡
  * å®ä¾‹ï¼š23238n22ï¼ˆåŒ¹é…åˆ°2æœªæ¥å°±ç»§ç»­åŒ¹é…2ï¼‰
  * å®ä¾‹ï¼š43438n44

* åº”ç”¨2ï¼šçˆ¬è™«

  ```java
  String regex = "<(h[1-6])>\w*?<\/\1>";
  ```

  * åŒ¹é…ç»“æœ

    ```java
    <h1>x</h1>//åŒ¹é…
    <h2>x</h2>//åŒ¹é…
    <h3>x</h1>//ä¸åŒ¹é…
    ```

    





##### é›¶å®½æ–­è¨€

é¢„æœç´¢ï¼ˆé›¶å®½æ–­è¨€ï¼‰ï¼ˆç¯è§†ï¼‰

* åªè¿›è¡Œå­è¡¨è¾¾å¼çš„åŒ¹é…ï¼ŒåŒ¹é…å†…å®¹ä¸è®¡å…¥æœ€ç»ˆçš„åŒ¹é…ç»“æœï¼Œæ˜¯é›¶å®½åº¦

* åˆ¤æ–­å½“å‰ä½ç½®çš„å‰åå­—ç¬¦ï¼Œæ˜¯å¦ç¬¦åˆæŒ‡å®šçš„æ¡ä»¶ï¼Œä½†ä¸åŒ¹é…å‰åçš„å­—ç¬¦ã€‚**æ˜¯å¯¹ä½ç½®çš„åŒ¹é…**ã€‚

* æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå­è¡¨è¾¾å¼åŒ¹é…åˆ°çš„æ˜¯å­—ç¬¦å†…å®¹ï¼Œè€Œéä½ç½®ï¼Œå¹¶è¢«ä¿å­˜åˆ°æœ€ç»ˆçš„åŒ¹é…ç»“æœä¸­ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¿™ä¸ªå­è¡¨è¾¾å¼æ˜¯å æœ‰å­—ç¬¦çš„ï¼›å¦‚æœå­è¡¨è¾¾å¼åŒ¹é…çš„ä»…ä»…æ˜¯ä½ç½®ï¼Œæˆ–è€…åŒ¹é…çš„å†…å®¹å¹¶ä¸ä¿å­˜åˆ°æœ€ç»ˆçš„åŒ¹é…ç»“æœä¸­ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¿™ä¸ªå­è¡¨è¾¾å¼æ˜¯**é›¶å®½åº¦**çš„ã€‚å æœ‰å­—ç¬¦è¿˜æ˜¯é›¶å®½åº¦ï¼Œæ˜¯é’ˆå¯¹åŒ¹é…çš„å†…å®¹æ˜¯å¦ä¿å­˜åˆ°æœ€ç»ˆçš„åŒ¹é…ç»“æœä¸­è€Œè¨€çš„

  | è¡¨è¾¾å¼   | è¯´æ˜                                    |
  | -------- | --------------------------------------- |
  | (?=exp)  | æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„åé¢èƒ½åŒ¹é…è¡¨è¾¾å¼exp |
  | (?<=exp) | æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„å‰é¢èƒ½åŒ¹é…è¡¨è¾¾å¼exp |
  | (?!exp)  | æ–­è¨€æ­¤ä½ç½®çš„åé¢ä¸èƒ½åŒ¹é…è¡¨è¾¾å¼exp       |
  | (?<!exp) | æ–­è¨€æ­¤ä½ç½®çš„å‰é¢ä¸èƒ½åŒ¹é…è¡¨è¾¾å¼exp       |




***



#### åŒ¹é…æ¨¡å¼

æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ¨¡å¼ï¼š

* IGNORECASE å¿½ç•¥å¤§å°å†™æ¨¡å¼
  * åŒ¹é…æ—¶å¿½ç•¥å¤§å°å†™ã€‚
  * é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯è¦åŒºåˆ†å¤§å°å†™çš„ã€‚
* SINGLELINE å•è¡Œæ¨¡å¼
  * æ•´ä¸ªæ–‡æœ¬çœ‹ä½œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåªæœ‰ä¸€ä¸ªå¼€å¤´ï¼Œä¸€ä¸ªç»“å°¾ã€‚
  * ä½¿å°æ•°ç‚¹ "." å¯ä»¥åŒ¹é…åŒ…å«æ¢è¡Œç¬¦ï¼ˆ\nï¼‰åœ¨å†…çš„ä»»æ„å­—ç¬¦ã€‚
* MULTILINE å¤šè¡Œæ¨¡å¼
  * æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œéƒ½æœ‰å¼€å¤´å’Œç»“å°¾ã€‚
  * åœ¨æŒ‡å®šäº† MULTILINE ä¹‹åï¼Œå¦‚æœéœ€è¦ä»…åŒ¹é…å­—ç¬¦ä¸²å¼€å§‹å’Œç»“æŸä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨ \A å’Œ \Z



***



#### åº”ç”¨

##### åŸºæœ¬éªŒè¯

```java
public static void main(String[] args){
	System.out.println("a".matches("[abc]"));//trueåˆ¤æ–­aæ˜¯å¦åœ¨abc
    System.out.println("a".matches("[^abc]"));//false åˆ¤æ–­aæ˜¯å¦åœ¨abcä¹‹å¤–çš„
    System.out.println("a".matches("\\d")); //false æ˜¯å¦aæ˜¯æ•´æ•°
    System.out.println("a".matches("\\w")); //true æ˜¯å¦æ˜¯å­—ç¬¦
    System.out.println("ä½ ".matches("\\w")); // false
    System.out.println("aa".matches("\\w"));//false åªèƒ½æ£€éªŒå•ä¸ªå­—ç¬¦
    
    // å¯†ç  å¿…é¡»æ˜¯æ•°å­— å­—æ¯ ä¸‹åˆ’çº¿ è‡³å°‘ 6ä½
	System.out.println("ssds3c".matches("\\w{6,}")); // true
    // éªŒè¯ã€‚å¿…é¡»æ˜¯æ•°å­—å’Œå­—ç¬¦  å¿…é¡»æ˜¯4ä½
    System.out.println("dsd22".matches("[a-zA-Z0-9]{4}")); // false
    System.out.println("A3dy".matches("[a-zA-Z0-9]{4}")); // true
}
```



##### éªŒè¯å·ç 

```java
//1å¼€å¤´ ç¬¬äºŒä½æ˜¯2-9çš„æ•°å­—
public static void checkPhone(String phone){
    if(phone.matches("1[3-9]\\d{9}")){
        System.out.println("æ‰‹æœºå·ç æ ¼å¼æ­£ç¡®ï¼");
    } else {.......}
}
//1111@qq.com zhy980823@163.com  zhy@pic.com.cn
public static void checkEmail(String email){
    if(email.matches("\\w{1,}@\\w{1,}(\\.\\w{2,5}){1,2}")){
        System.out.println("é‚®ç®±æ ¼å¼æ­£ç¡®ï¼");
    } else {......}// .æ˜¯ä»»æ„å­—ç¬¦ \\.å°±æ˜¯ç‚¹
}
```



##### æŸ¥æ‰¾æ›¿æ¢

* `public String[] split(String regex)`ï¼š
      -- æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹è¿›è¡Œåˆ†å‰²å­—ç¬¦ä¸²ï¼Œåå›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚
* `public String replaceAll(String regex,String newStr)`
      -- æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹è¿›è¡Œæ›¿æ¢

```java
//æ•°ç»„åˆ†å‰²
public static void main(String[] args) {
	// 1.splitçš„åŸºç¡€ç”¨æ³•
	String names = "è´¾ä¹ƒäº®,ç‹å®å¼º,é™ˆç¾½å‡¡";
	// ä»¥â€œï¼Œâ€åˆ†å‰²æˆå­—ç¬¦ä¸²æ•°ç»„
    String[] nameArrs = names.split(",");

    // 2.splité›†åˆæ­£åˆ™è¡¨è¾¾å¼åšåˆ†å‰²
    String names1 = "è´¾ä¹ƒäº®lv434fda324ç‹å®å¼º87632fad2342423é™ˆç¾½å‡¡";
    // ä»¥åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å†…å®¹ä¸ºåˆ†å‰²ç‚¹åˆ†å‰²æˆå­—ç¬¦ä¸²æ•°ç»„
	String[] nameArrs1 = names1.split("\\w+");
    
	// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®šä½å‡ºå†…å®¹ï¼Œæ›¿æ¢æˆ/
	System.out.println(names1.replaceAll("\\w+","/"));//è´¾ä¹ƒäº®/ç‹å®å¼º/ç¾½å‡¡

	String names3 = "è´¾ä¹ƒäº®,ç‹å®å¼º,ç¾½å‡¡";
	System.out.println(names3.replaceAll(",","-"));//è´¾ä¹ƒäº®-ç‹å®å¼º-ç¾½å‡¡
}
```



##### åˆ†ç»„é—®é¢˜

Patternç±»ï¼š
	`static Pattern compile(String regex)` : å°†ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘ä¸ºæ¨¡å¼ã€‚
	`Matcher matcher(CharSequence input)` : åˆ›å»ºä¸€ä¸ªåŒ¹é…å™¨ï¼ŒåŒ¹é…ç»™å®šçš„è¾“å…¥ä¸æ­¤æ¨¡å¼ã€‚
	`static boolean matches(String regex, CharSequence input)` : ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶åŒ¹é…è¾“å…¥

Matcherç±»ï¼š
	`boolean find()` : æ‰«æè¾“å…¥çš„åºåˆ—ï¼ŒæŸ¥æ‰¾ä¸è¯¥æ¨¡å¼åŒ¹é…çš„ä¸‹ä¸€ä¸ªå­åºåˆ—ã€‚ 
	`String group()` : è¿”å›ä¸ä¸Šä¸€ä¸ªåŒ¹é…çš„è¾“å…¥å­åºåˆ—ã€‚åŒgroup(0)ï¼ŒåŒ¹é…æ•´ä¸ªè¡¨è¾¾å¼çš„å­å­—ç¬¦ä¸²
	`String group(int group)` : è¿”å›åœ¨ä¸Šä¸€æ¬¡åŒ¹é…æ“ä½œæœŸé—´ç”±ç»™å®šç»„æ•è·çš„è¾“å…¥å­åºåˆ—ã€‚ 

```java
public class Demo01{
	public static void main(String[] args) {
		//è¡¨è¾¾å¼å¯¹è±¡
		Pattern p = Pattern.compile("\\w+");
		//åˆ›å»ºMatcherå¯¹è±¡
		Matcher m = p.matcher("asfsdf2&&3323");
		//boolean b = m.matches();//å°è¯•å°†æ•´ä¸ªå­—ç¬¦åºåˆ—ä¸è¯¥æ¨¡å¼åŒ¹é…
		//System.out.println(b);//false
		//boolean b2 = m.find();//è¯¥æ–¹æ³•æ‰«æè¾“å…¥çš„åºåˆ—ï¼ŒæŸ¥æ‰¾ä¸è¯¥æ¨¡å¼åŒ¹é…çš„ä¸‹ä¸€ä¸ªå­åºåˆ—
		//System.out.println(b2);//true
		
		//System.out.println(m.find());
		//System.out.println(m.group());//asfsdf2
		//System.out.println(m.find());
		//System.out.println(m.group());//3323
		
		while(m.find()){
			System.out.println(m.group());	//group(),group(0)åŒ¹é…æ•´ä¸ªè¡¨è¾¾å¼çš„å­å­—ç¬¦ä¸²
			System.out.println(m.group(0));
		}
		
	}
}
```

```java
public class Demo02 {
	public static void main(String[] args) {
		//åœ¨è¿™ä¸ªå­—ç¬¦ä¸²ï¼šasfsdf23323ï¼Œæ˜¯å¦ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼š\w+
		//è¡¨è¾¾å¼å¯¹è±¡
		//Pattern p = Pattern.compile("([a-z]+)([0-9]+)");
        Pattern p = Pattern.compile("(([a-z]+)([0-9]+))");//ä¸éœ€è¦åŠ å¤šä½™çš„æ‹¬å·
		//åˆ›å»ºMatcherå¯¹è±¡
		Matcher m = p.matcher("aa232**ssd445*sds223");
	
		while(m.find()){
			System.out.println(m.group());//aa232  ssd445
			System.out.println(m.group(1));//aa232  ssd445
			System.out.println(m.group(2));//aa     ssd
            System.out.println(m.group(3));//232    445 
		}
	}
}
```

æ³¨ï¼š

* æ­£åˆ™è¡¨è¾¾å¼æ”¹ä¸º`"(([a-z]+)(?:[0-9]+))"`   No group(3) éæ•è·
* æ­£åˆ™è¡¨è¾¾å¼æ”¹ä¸º`"([a-z]+)([0-9]+)"`  No group(3)    aa232  - aa  --232



##### é¢è¯•é—®é¢˜

æ‰¾å‡ºæ‰€æœ‰189å’Œ132å¼€å¤´çš„æ‰‹æœºå·

```java
public class RegexDemo {
    public static void main(String[] args) {
        String rs = "189asjk65as1891898777745gkkkk189745612318936457894";
        String regex = "(?=((189|132)\\d{8}))";
        Pattern pattern = Pattern.compile(regex);
        Matcher matcher = pattern.matcher(rs);
        while (matcher.find()) {
            System.out.println(matcher.group(1));
        }
    }
}
```





***



## é›†åˆ

### æ¦‚è¿°

ä»€ä¹ˆæ˜¯é›†åˆ?
	é›†åˆæ˜¯ä¸€ä¸ªå¤§å°å¯å˜çš„å®¹å™¨ï¼Œå®¹å™¨ä¸­çš„æ¯ä¸ªæ•°æ®ç§°ä¸ºä¸€ä¸ªå…ƒç´ ã€‚æ•°æ®==å…ƒç´ 
    é›†åˆç‰¹ç‚¹ï¼šç±»å‹å¯ä»¥ä¸ç¡®å®šï¼Œå¤§å°ä¸å›ºå®šï¼›é›†åˆæœ‰å¾ˆå¤šï¼Œä¸åŒçš„é›†åˆç‰¹ç‚¹å’Œä½¿ç”¨åœºæ™¯ä¸åŒ
    æ•°ç»„ï¼šç±»å‹å’Œé•¿åº¦ä¸€æ—¦å®šä¹‰å‡ºæ¥å°±éƒ½å›ºå®š

é›†åˆæœ‰å•¥ç”¨ï¼Ÿ
    åœ¨å¼€å‘ä¸­ï¼Œå¾ˆå¤šæ—¶å€™å…ƒç´ çš„ä¸ªæ•°æ˜¯ä¸ç¡®å®šçš„ã€‚ 
    è€Œä¸”ç»å¸¸è¦è¿›è¡Œå…ƒç´ çš„å¢åˆ è¯¥æŸ¥æ“ä½œï¼Œé›†åˆéƒ½æ˜¯éå¸¸åˆé€‚çš„ã€‚å¼€å‘ä¸­é›†åˆç”¨çš„æ›´å¤š!!



****



### æ•°æ®ç»“æ„

#### æ¦‚è¿°

ä»€ä¹ˆæ˜¯æ•°æ®ç»“æ„ï¼Ÿ
    æ•°æ®ç»“æ„æŒ‡çš„æ˜¯æ•°æ®ä»¥ä»€ä¹ˆæ–¹å¼ç»„ç»‡åœ¨ä¸€èµ·ã€‚
    ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œå¢åˆ æŸ¥çš„æ€§èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚
    ä¸åŒçš„é›†åˆåº•å±‚ä¼šé‡‡ç”¨ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œäº†è§£é›†åˆçš„åº•å±‚æ˜¯åŸºäºå“ªç§æ•°æ®ç»“æ„æ“ä½œæ•°æ®æ‰èƒ½çŸ¥é“å…·ä½“åœºæ™¯

Javaå¸¸è§çš„æ•°æ®ç»“æ„æœ‰å“ªäº›?
	æ•°æ®å­˜å‚¨çš„å¸¸ç”¨ç»“æ„æœ‰ï¼šæ ˆã€é˜Ÿåˆ—ã€æ•°ç»„ã€é“¾è¡¨å’Œçº¢é»‘æ ‘

* é˜Ÿåˆ—ï¼ˆqueueï¼‰ï¼šå…ˆè¿›å…ˆå‡ºï¼Œåè¿›åå‡ºã€‚(FIFO)
  åœºæ™¯ï¼šå„ç§æ’é˜Ÿã€å«å·ç³»ç»Ÿï¼Œæœ‰å¾ˆå¤šé›†åˆå¯ä»¥å®ç°é˜Ÿåˆ—

* æ ˆï¼ˆstackï¼‰ï¼šåè¿›å…ˆå‡ºï¼Œå…ˆè¿›åå‡º ï¼ˆLIFOï¼‰
  å‹æ ˆ == å…¥æ ˆã€å¼¹æ ˆ == å‡ºæ ˆ
  åœºæ™¯ï¼šæ‰‹æªçš„å¼¹å¤¹ 

* æ•°ç»„ï¼šæ•°ç»„æ˜¯å†…å­˜ä¸­çš„è¿ç»­å­˜å‚¨åŒºåŸŸï¼Œåˆ†æˆè‹¥å¹²ç­‰åˆ†çš„å°åŒºåŸŸï¼ˆæ¯ä¸ªåŒºåŸŸå¤§å°æ˜¯ä¸€æ ·çš„ï¼‰ã€‚å…ƒç´ å­˜åœ¨ç´¢å¼•
  ç‰¹ç‚¹ï¼š**æŸ¥è¯¢å…ƒç´ å¿«**ï¼ˆæ ¹æ®ç´¢å¼•å¿«é€Ÿè®¡ç®—å‡ºå…ƒç´ çš„åœ°å€ï¼Œç„¶åç«‹å³å»å®šä½ï¼‰
              **å¢åˆ å…ƒç´ æ…¢**ï¼ˆåˆ›å»ºæ–°æ•°ç»„ï¼Œè¿ç§»å…ƒç´ ï¼‰

* é“¾è¡¨ï¼šå…ƒç´ ä¸æ˜¯å†…å­˜ä¸­çš„è¿ç»­åŒºåŸŸå­˜å‚¨ï¼Œå…ƒç´ æ˜¯æ¸¸ç¦»å­˜å‚¨çš„ã€‚æ¯ä¸ªå…ƒç´ ä¼šè®°å½•ä¸‹ä¸ªå…ƒç´ çš„åœ°å€
  ç‰¹ç‚¹ï¼š**æŸ¥è¯¢å…ƒç´ æ…¢ï¼Œå¢åˆ å…ƒç´ å¿«**ï¼ˆé’ˆå¯¹äºé¦–å°¾å…ƒç´ ï¼Œé€Ÿåº¦æå¿«ï¼Œä¸€èˆ¬æ˜¯åŒé“¾è¡¨ï¼‰

* æ ‘

  * äºŒå‰æ ‘ï¼šbinary tree æ°¸è¿œåªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹,æ˜¯æ¯ä¸ªç»“ç‚¹ä¸è¶…è¿‡2ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼ˆtreeï¼‰ 
    ç‰¹ç‚¹ï¼šæŸ¥æ‰¾äºŒå‰æ ‘,æ’åºäºŒå‰æ ‘ï¼šå°çš„å·¦è¾¹ï¼Œå¤§çš„å³è¾¹ï¼Œä½†æ˜¯å¯èƒ½æ ‘å¾ˆé«˜ï¼Œæ€§èƒ½å˜å·®
                ä¸ºäº†åšæ’åºå’Œæœç´¢ä¼šè¿›è¡Œå·¦æ—‹å’Œå³æ—‹å®ç°å¹³è¡¡æŸ¥æ‰¾äºŒå‰æ ‘ï¼Œè®©æ ‘çš„é«˜åº¦å·®ä¸å¤§äº1

  * çº¢é»‘æ ‘ï¼ˆåŸºäºçº¢é»‘è§„åˆ™å®ç°è‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ï¼‰ï¼šæ ‘ä¿è¯åˆ°äº†å¾ˆçŸ®å°ï¼Œä½†æ˜¯åˆæ’å¥½åºï¼Œæ€§èƒ½æœ€é«˜çš„æ ‘

    ç‰¹ç‚¹ï¼š**çº¢é»‘æ ‘çš„å¢åˆ æŸ¥æ”¹æ€§èƒ½éƒ½å¥½**



#### äºŒå‰æ ‘

äºŒå‰æ ‘ä¸­ï¼Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„åº¦è¦å°äºç­‰äº2

+ èŠ‚ç‚¹ï¼šåœ¨æ ‘ç»“æ„ä¸­,æ¯ä¸€ä¸ªå…ƒç´ ç§°ä¹‹ä¸ºèŠ‚ç‚¹
+ åº¦ï¼šæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°é‡ç§°ä¹‹ä¸ºåº¦

![äºŒå‰æ ‘ç»“æ„å›¾](https://gitee.com/seazean/images/raw/master/JavaSE/äºŒå‰æ ‘ç»“æ„å›¾.png)

#### äºŒå‰æŸ¥æ‰¾æ ‘

+ äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œåˆç§°äºŒå‰æ’åºæ ‘æˆ–è€…äºŒå‰æœç´¢æ ‘
+ æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹
+ å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½å°äºæ ¹èŠ‚ç‚¹çš„å€¼
+ å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæ ¹èŠ‚ç‚¹çš„å€¼

![äºŒå‰æŸ¥æ‰¾æ ‘](https://gitee.com/seazean/images/raw/master/JavaSE/äºŒå‰æŸ¥æ‰¾æ ‘ç»“æ„å›¾.png)

äºŒå‰æŸ¥æ‰¾æ ‘æ·»åŠ èŠ‚ç‚¹è§„åˆ™

+ å°çš„å­˜å·¦è¾¹
+ å¤§çš„å­˜å³è¾¹
+ ä¸€æ ·çš„ä¸å­˜

![äºŒå‰æŸ¥æ‰¾æ ‘æ·»åŠ èŠ‚ç‚¹è§„åˆ™](https://gitee.com/seazean/images/raw/master/JavaSE/äºŒå‰æŸ¥æ‰¾æ ‘æ·»åŠ èŠ‚ç‚¹è§„åˆ™.png)

#### å¹³è¡¡äºŒå‰æ ‘

å¹³è¡¡äºŒå‰æ ‘çš„ç‰¹ç‚¹

+ äºŒå‰æ ‘å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®ä¸è¶…è¿‡1
+ ä»»æ„èŠ‚ç‚¹çš„å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€é¢—å¹³è¡¡äºŒå‰æ ‘

å¹³è¡¡äºŒå‰æ ‘æ—‹è½¬

+ æ—‹è½¬è§¦å‘æ—¶æœºï¼šå½“æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ä¹‹åï¼Œè¯¥æ ‘ä¸å†æ˜¯ä¸€é¢—å¹³è¡¡äºŒå‰æ ‘

+ å¹³è¡¡äºŒå‰æ ‘å’ŒäºŒå‰æŸ¥æ‰¾æ ‘å¯¹æ¯”ç»“æ„å›¾

![å¹³è¡¡äºŒå‰æ ‘å’ŒäºŒå‰æŸ¥æ‰¾æ ‘å¯¹æ¯”](https://gitee.com/seazean/images/raw/master/JavaSE/å¹³è¡¡äºŒå‰æ ‘å’ŒäºŒå‰æŸ¥æ‰¾æ ‘å¯¹æ¯”ç»“æ„å›¾.png)

+ å·¦æ—‹
  å°†æ ¹èŠ‚ç‚¹çš„å³ä¾§å¾€å·¦æ‹‰ï¼ŒåŸå…ˆçš„å³å­èŠ‚ç‚¹å˜æˆæ–°çš„çˆ¶èŠ‚ç‚¹ï¼Œå¹¶æŠŠå¤šä½™çš„å·¦å­èŠ‚ç‚¹å‡ºè®©ï¼Œç»™å·²ç»é™çº§çš„æ ¹èŠ‚ç‚¹å½“å³å­èŠ‚ç‚¹

  ![å¹³è¡¡äºŒå‰æ ‘å·¦æ—‹](https://gitee.com/seazean/images/raw/master/JavaSE/å¹³è¡¡äºŒå‰æ ‘å·¦æ—‹01.png)

* å³æ—‹
  å°†æ ¹èŠ‚ç‚¹çš„å·¦ä¾§å¾€å³æ‹‰ï¼Œå·¦å­èŠ‚ç‚¹å˜æˆäº†æ–°çš„çˆ¶èŠ‚ç‚¹ï¼Œå¹¶æŠŠå¤šä½™çš„å³å­èŠ‚ç‚¹å‡ºè®©ï¼Œç»™å·²ç»é™çº§æ ¹èŠ‚ç‚¹å½“å·¦å­èŠ‚ç‚¹

  ![å¹³è¡¡äºŒå‰æ ‘å³æ—‹](https://gitee.com/seazean/images/raw/master/JavaSE/å¹³è¡¡äºŒå‰æ ‘å³æ—‹01.png)

* å¹³è¡¡äºŒå‰æ ‘æ—‹è½¬çš„å››ç§æƒ…å†µ
  * å·¦å·¦ï¼šå½“æ ¹èŠ‚ç‚¹å·¦å­æ ‘çš„å·¦å­æ ‘æœ‰èŠ‚ç‚¹æ’å…¥ï¼Œå¯¼è‡´äºŒå‰æ ‘ä¸å¹³è¡¡
  * å¦‚ä½•æ—‹è½¬ï¼šç›´æ¥å¯¹æ•´ä½“è¿›è¡Œå³æ—‹å³å¯
    ![å¹³è¡¡äºŒå‰æ ‘å·¦å·¦](https://gitee.com/seazean/images/raw/master/JavaSE/å¹³è¡¡äºŒå‰æ ‘å·¦å·¦.png)
  * å·¦å³ï¼šå½“æ ¹èŠ‚ç‚¹å·¦å­æ ‘çš„å³å­æ ‘æœ‰èŠ‚ç‚¹æ’å…¥ï¼Œå¯¼è‡´äºŒå‰æ ‘ä¸å¹³è¡¡
  * å¦‚ä½•æ—‹è½¬ï¼šå…ˆåœ¨å·¦å­æ ‘å¯¹åº”çš„èŠ‚ç‚¹ä½ç½®è¿›è¡Œå·¦æ—‹ï¼Œåœ¨å¯¹æ•´ä½“è¿›è¡Œå³æ—‹
    ![å¹³è¡¡äºŒå‰æ ‘å·¦å³](https://gitee.com/seazean/images/raw/master/JavaSE/å¹³è¡¡äºŒå‰æ ‘å·¦å³.png)
  * å³å³ï¼šå½“æ ¹èŠ‚ç‚¹å³å­æ ‘çš„å³å­æ ‘æœ‰èŠ‚ç‚¹æ’å…¥,å¯¼è‡´äºŒå‰æ ‘ä¸å¹³è¡¡
  * å¦‚ä½•æ—‹è½¬ï¼šç›´æ¥å¯¹æ•´ä½“è¿›è¡Œå·¦æ—‹å³å¯
    ![å¹³è¡¡äºŒå‰æ ‘å³å³](https://gitee.com/seazean/images/raw/master/JavaSE/å¹³è¡¡äºŒå‰æ ‘å³å³.png)
  * å³å·¦ï¼šå½“æ ¹èŠ‚ç‚¹å³å­æ ‘çš„å·¦å­æ ‘æœ‰èŠ‚ç‚¹æ’å…¥ï¼Œå¯¼è‡´äºŒå‰æ ‘ä¸å¹³è¡¡
  * å¦‚ä½•æ—‹è½¬ï¼šå…ˆåœ¨å³å­æ ‘å¯¹åº”çš„èŠ‚ç‚¹ä½ç½®è¿›è¡Œå³æ—‹ï¼Œåœ¨å¯¹æ•´ä½“è¿›è¡Œå·¦æ—‹
    ![å¹³è¡¡äºŒå‰æ ‘å³å·¦](https://gitee.com/seazean/images/raw/master/JavaSE/å¹³è¡¡äºŒå‰æ ‘å³å·¦.png)



#### çº¢é»‘æ ‘

+ çº¢é»‘æ ‘çš„ç‰¹ç‚¹

  + å¹³è¡¡äºŒå‰Bæ ‘
  + æ¯ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ˜¯çº¢æˆ–è€…é»‘
  + çº¢é»‘æ ‘ä¸æ˜¯é«˜åº¦å¹³è¡¡çš„ï¼Œå®ƒçš„å¹³è¡¡æ˜¯é€šè¿‡"è‡ªå·±çš„çº¢é»‘è§„åˆ™"è¿›è¡Œå®ç°çš„

+ çº¢é»‘æ ‘çš„çº¢é»‘è§„åˆ™æœ‰å“ªäº›

  1. æ¯ä¸€ä¸ªèŠ‚ç‚¹æˆ–æ˜¯çº¢è‰²çš„ï¼Œæˆ–è€…æ˜¯é»‘è‰²çš„

  2. æ ¹èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²

  3. å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹æˆ–è€…çˆ¶èŠ‚ç‚¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹ç›¸åº”çš„æŒ‡é’ˆå±æ€§å€¼ä¸ºNilï¼Œè¿™äº›Nilè§†ä¸ºå¶èŠ‚ç‚¹ï¼Œæ¯ä¸ªå¶èŠ‚ç‚¹(Nil)æ˜¯é»‘è‰²çš„

  4. å¦‚æœæŸä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²,é‚£ä¹ˆå®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²(ä¸èƒ½å‡ºç°ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹ç›¸è¿ çš„æƒ…å†µ)

  5. å¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»è¯¥èŠ‚ç‚¹åˆ°å…¶æ‰€æœ‰åä»£å¶èŠ‚ç‚¹çš„ç®€å•è·¯å¾„ä¸Šï¼Œå‡åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹

![çº¢é»‘æ ‘](https://gitee.com/seazean/images/raw/master/JavaSE/çº¢é»‘æ ‘ç»“æ„å›¾.png)



* çº¢é»‘æ ‘æ·»åŠ èŠ‚ç‚¹çš„é»˜è®¤é¢œè‰²ä¸ºçº¢è‰²,æ•ˆç‡é«˜
  ![](https://gitee.com/seazean/images/raw/master/JavaSE/çº¢é»‘æ ‘æ·»åŠ èŠ‚ç‚¹é¢œè‰².png)



**çº¢é»‘æ ‘æ·»åŠ èŠ‚ç‚¹åå¦‚ä½•ä¿æŒçº¢é»‘è§„åˆ™ï¼š**

+ æ ¹èŠ‚ç‚¹ä½ç½®
  + ç›´æ¥å˜ä¸ºé»‘è‰²
+ éæ ¹èŠ‚ç‚¹ä½ç½®
  + çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰²
    + ä¸éœ€è¦ä»»ä½•æ“ä½œ,é»˜è®¤çº¢è‰²å³å¯
  + çˆ¶èŠ‚ç‚¹ä¸ºçº¢è‰²
    + å”å”èŠ‚ç‚¹ä¸ºçº¢è‰²
      1. å°†"çˆ¶èŠ‚ç‚¹"è®¾ä¸ºé»‘è‰²,å°†"å”å”èŠ‚ç‚¹"è®¾ä¸ºé»‘è‰²
      2. å°†"ç¥–çˆ¶èŠ‚ç‚¹"è®¾ä¸ºçº¢è‰²
      3. å¦‚æœ"ç¥–çˆ¶èŠ‚ç‚¹"ä¸ºæ ¹èŠ‚ç‚¹,åˆ™å°†æ ¹èŠ‚ç‚¹å†æ¬¡å˜æˆé»‘è‰²
    + å”å”èŠ‚ç‚¹ä¸ºé»‘è‰²
      1. å°†"çˆ¶èŠ‚ç‚¹"è®¾ä¸ºé»‘è‰²
      2. å°†"ç¥–çˆ¶èŠ‚ç‚¹"è®¾ä¸ºçº¢è‰²
      3. ä»¥"ç¥–çˆ¶èŠ‚ç‚¹"ä¸ºæ”¯ç‚¹è¿›è¡Œæ—‹è½¬



***



### Collection

#### æ¦‚è¿°

> Javaä¸­é›†åˆçš„ä»£è¡¨æ˜¯ï¼šCollection.
> Collectioné›†åˆæ˜¯Javaä¸­é›†åˆçš„ç¥–å®—ç±»ã€‚
> å­¦ä¹ Collectioné›†åˆçš„åŠŸèƒ½ï¼Œé‚£ä¹ˆä¸€åˆ‡é›†åˆéƒ½å¯ä»¥ç”¨è¿™äº›åŠŸèƒ½ï¼ï¼

Collectioné›†åˆåº•å±‚ä¸ºæ•°ç»„ï¼š`[value1, value2, ....]`

```java
Collectioné›†åˆçš„ä½“ç³»:
                      Collection<E>(æ¥å£)
                 /                         \
          Set<E>(æ¥å£)                    List<E>(æ¥å£)
      /               \                  /             \
 HashSet<E>(å®ç°ç±») TreeSet<>(å®ç°ç±»)  ArrayList<E>(å®ç°ç±»)  LinekdList<>(å®ç°ç±»)
 /
LinkedHashSet<>(å®ç°ç±»)
```

**é›†åˆçš„ç‰¹ç‚¹ï¼š**(éå¸¸é‡è¦)
		Setç³»åˆ—é›†åˆï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æ— åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•çš„ã€‚
            -- HashSet: æ·»åŠ çš„å…ƒç´ æ˜¯æ— åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•çš„ã€‚
            -- LinkedHashSet: æ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•çš„ã€‚
            -- TreeSet: ä¸é‡å¤ï¼Œæ— ç´¢å¼•ï¼ŒæŒ‰ç…§å¤§å°é»˜è®¤å‡åºæ’åº!!
		Listç³»åˆ—é›†åˆï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œå¯é‡å¤ï¼Œæœ‰ç´¢å¼•ã€‚
            -- ArrayListï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œå¯é‡å¤ï¼Œæœ‰ç´¢å¼•ã€‚
            -- LinekdListï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œå¯é‡å¤ï¼Œæœ‰ç´¢å¼•ã€‚



***



#### å¸¸ç”¨API

Collectionæ˜¯é›†åˆçš„ç¥–å®—ç±»ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯å…¨éƒ¨é›†åˆéƒ½å¯ä»¥ç»§æ‰¿ä½¿ç”¨çš„ï¼Œæ‰€ä»¥è¦å­¦ä¹ å®ƒã€‚

Collectionå­ç±»çš„æ„é€ å™¨éƒ½æœ‰å¯ä»¥åŒ…è£…å…¶ä»–å­ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¦‚ï¼š
	`public ArrayList(Collection<? extends E> c)` : æ„é€ æ–°é›†åˆï¼Œå…ƒç´ æŒ‰ç…§ç”±é›†åˆçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåº
	`public HashSet(Collection<? extends E> c)` : æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆä¸­çš„å…ƒç´ çš„æ–°é›†åˆ

Collection APIå¦‚ä¸‹ï¼š
     `public boolean add(E e)` : æŠŠç»™å®šçš„å¯¹è±¡æ·»åŠ åˆ°å½“å‰é›†åˆä¸­ ã€‚
     `public void clear()` : æ¸…ç©ºé›†åˆä¸­æ‰€æœ‰çš„å…ƒç´ ã€‚
     `public boolean remove(E e)` : æŠŠç»™å®šçš„å¯¹è±¡åœ¨å½“å‰é›†åˆä¸­åˆ é™¤ã€‚
     `public boolean contains(Object obj)` : åˆ¤æ–­å½“å‰é›†åˆä¸­æ˜¯å¦åŒ…å«ç»™å®šçš„å¯¹è±¡ã€‚
     `public boolean isEmpty()` : åˆ¤æ–­å½“å‰é›†åˆæ˜¯å¦ä¸ºç©ºã€‚
     `public int size()` : è¿”å›é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚
     `public Object[] toArray()` : æŠŠé›†åˆä¸­çš„å…ƒç´ ï¼Œå­˜å‚¨åˆ°æ•°ç»„ä¸­
	 `public boolean addAll(Collection<? extends E> c)` : å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æ­¤é›†åˆ

```java
public class CollectionDemo {
    public static void main(String[] args) {
        Collection<String> sets = new HashSet<>();
        sets.add("MyBatis");
        System.out.println(sets.add("Java"));//true
        System.out.println(sets.add("Java"));//false
        sets.add("Spring");
        sets.add("MySQL");
        System.out.println(sets)//[]æ— åºçš„;
        System.out.println(sets.contains("java"));//true å­˜åœ¨
        Object[] arrs = sets.toArray();
        System.out.println("æ•°ç»„ï¼š"+ Arrays.toString(arrs));
        
        Collection<String> c1 = new ArrayList<>();
        c1.add("java");
        Collection<String> c2 = new ArrayList<>();
        c2.add("ee");
        c1.addAll(c2);// c1:[java,ee]  c2:[ee];
    }
}
```



***



#### éå†æ–¹å¼

Collectioné›†åˆçš„éå†æ–¹å¼æœ‰ä¸‰ç§:

é›†åˆå¯ä»¥ç›´æ¥è¾“å‡ºå†…å®¹ï¼Œå› ä¸ºåº•å±‚é‡å†™äº†toString()æ–¹æ³•ã€‚

1. è¿­ä»£å™¨
   `public Iterator iterator()` : è·å–é›†åˆå¯¹åº”çš„è¿­ä»£å™¨ï¼Œç”¨æ¥éå†é›†åˆä¸­çš„å…ƒç´ çš„
   `E next()` : è·å–ä¸‹ä¸€ä¸ªå…ƒç´ å€¼ï¼
   `boolean hasNext()` : åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæœ‰è¿”å›true ,åä¹‹
   `default void remove()` : ä»åº•å±‚é›†åˆä¸­åˆ é™¤æ­¤è¿­ä»£å™¨è¿”å›çš„æœ€åä¸€ä¸ªå…ƒ, è¿™ç§æ–¹æ³•åªèƒ½åœ¨æ¯æ¬¡è°ƒç”¨next()æ—¶è°ƒç”¨ä¸€æ¬¡ã€‚

2. foreach(å¢å¼ºforå¾ªç¯)
   foreachæ˜¯ä¸€ç§éå†å½¢å¼ï¼Œå¯ä»¥éå†é›†åˆæˆ–è€…æ•°ç»„ã€‚
   foreachéå†é›†åˆå®é™…ä¸Šæ˜¯è¿­ä»£å™¨éå†çš„ç®€åŒ–å†™æ³•

   ```java
   for(è¢«éå†é›†åˆæˆ–è€…æ•°ç»„ä¸­å…ƒç´ çš„ç±»å‹ å˜é‡åç§° : è¢«éå†é›†åˆæˆ–è€…æ•°ç»„){
   
   }
   ```

   ç¼ºç‚¹ï¼šforeachéå†æ— æ³•çŸ¥é“éå†åˆ°äº†å“ªä¸ªå…ƒç´ äº†ï¼Œå› ä¸ºæ²¡æœ‰ç´¢å¼•ã€‚

3. JDK 1.8å¼€å§‹ä¹‹åçš„æ–°æŠ€æœ¯Lambdaè¡¨è¾¾å¼

   ```java
   public class CollectionDemo {
       public static void main(String[] args) {
           Collection<String> lists = new ArrayList<>();
           lists.add("aa");
           lists.add("bb");
           lists.add("cc");
           System.out.println(lists); // lists = [aa, bb, cc]
   		//è¿­ä»£å™¨æµç¨‹
           // 1.å¾—åˆ°é›†åˆçš„è¿­ä»£å™¨å¯¹è±¡ã€‚
           Iterator<String> it = lists.iterator();
           // 2.ä½¿ç”¨whileå¾ªç¯éå†ã€‚
           while(it.hasNext()){
               String ele = it.next();
               System.out.println(ele);
           }
           
   		//å¢å¼ºfor
           for (String ele : lists) {
               System.out.println(ele);
           }
           //lambdaè¡¨è¾¾å¼
           lists.forEach(s -> {
               System.out.println(s);
           });
       }
   }
   ```

   



***



#### List

##### Listæ¦‚è¿°

Listé›†åˆç»§æ‰¿äº†Collectioné›†åˆå…¨éƒ¨çš„åŠŸèƒ½ã€‚

Listç³»åˆ—é›†åˆæœ‰ç´¢å¼•ï¼Œæ‰€ä»¥å¤šäº†å¾ˆå¤šæŒ‰ç…§ç´¢å¼•æ“ä½œå…ƒç´ çš„åŠŸèƒ½ï¼šforå¾ªç¯éå†ï¼ˆ4ç§éå†ï¼‰

Listç³»åˆ—é›†åˆï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œå¯é‡å¤ï¼Œæœ‰ç´¢å¼•ã€‚

* ArrayListï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œå¯é‡å¤ï¼Œæœ‰ç´¢å¼•ã€‚

* LinekdListï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œå¯é‡å¤ï¼Œæœ‰ç´¢å¼•ã€‚

  

***



##### ArrayList

ArrayListæ·»åŠ çš„å…ƒç´ ï¼Œæ˜¯æœ‰åºï¼Œå¯é‡å¤ï¼Œæœ‰ç´¢å¼•çš„ã€‚
ArrayListå®ç°ç±»é›†åˆåº•å±‚**åŸºäºæ•°ç»„å­˜å‚¨æ•°æ®**çš„ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ï¼

`public boolean add(E e)` : å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤é›†åˆçš„æœ«å°¾
`public void add(int index, E element)` : å°†æŒ‡å®šçš„å…ƒç´ ï¼Œæ·»åŠ åˆ°è¯¥é›†åˆä¸­çš„æŒ‡å®šä½ç½®ä¸Šã€‚
`public E get(int index)` : è¿”å›é›†åˆä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚
`public E remove(int index)` : ç§»é™¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ , è¿”å›çš„æ˜¯è¢«ç§»é™¤çš„å…ƒç´ ã€‚
`public E set(int index, E element)` : ç”¨æŒ‡å®šå…ƒç´ æ›¿æ¢é›†åˆä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ,è¿”å›æ›´æ–°å‰çš„å…ƒç´ å€¼ã€‚
`int indexOf(Object o)` : è¿”å›åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœä¸åŒ…å«æ­¤å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚

```java
public static void main(String[] args){
    List<String> lists = new ArrayList<>();//å¤šæ€
    lists.add("java1");
    lists.add("java1");//å¯ä»¥é‡å¤
    lists.add("java2");
    for(int i = 0 ; i < lists.size() ; i++ ) {
            String ele = lists.get(i);
            System.out.println(ele);
   }
}
```

![ArrayListæºç åˆ†æ](https://gitee.com/seazean/images/raw/master/JavaSE/ArrayListæ·»åŠ å…ƒç´ æºç è§£æ.png)

****



##### LinkedList

LinkedListä¹Ÿæ˜¯Listçš„å®ç°ç±»ï¼šåº•å±‚æ˜¯**åŸºäºé“¾è¡¨**çš„ï¼Œå¢åˆ æ¯”è¾ƒå¿«ï¼ŒæŸ¥è¯¢æ…¢ï¼ï¼
LinkedListæ˜¯æ”¯æŒåŒé“¾è¡¨ï¼Œå®šä½å‰åçš„å…ƒç´ æ˜¯éå¸¸å¿«çš„ï¼Œå¢åˆ é¦–å°¾çš„å…ƒç´ ä¹Ÿæ˜¯æœ€å¿«çš„

LinkedListé™¤äº†æ‹¥æœ‰Listé›†åˆçš„å…¨éƒ¨åŠŸèƒ½è¿˜å¤šäº†å¾ˆå¤šæ“ä½œé¦–å°¾å…ƒç´ çš„ç‰¹æ®ŠåŠŸèƒ½ï¼š
    `public void addFirst(E e)` : å°†æŒ‡å®šå…ƒç´ æ’å…¥æ­¤åˆ—è¡¨çš„å¼€å¤´ã€‚
    `public void addLast(E e)` : å°†æŒ‡å®šå…ƒç´ æ·»åŠ åˆ°æ­¤åˆ—è¡¨çš„ç»“å°¾ã€‚
    `public E getFirst()` : è¿”å›æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚
    `public E getLast()` : è¿”å›æ­¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚
    `public E removeFirst()` : ç§»é™¤å¹¶è¿”å›æ­¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚
    `public E removeLast()` : ç§»é™¤å¹¶è¿”å›æ­¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚
    `public E pop()` : ä»æ­¤åˆ—è¡¨æ‰€è¡¨ç¤ºçš„å †æ ˆå¤„å¼¹å‡ºä¸€ä¸ªå…ƒç´ ã€‚
    `public void push(E e)` : å°†å…ƒç´ æ¨å…¥æ­¤åˆ—è¡¨æ‰€è¡¨ç¤ºçš„å †æ ˆã€‚

```java
public class ListDemo {
    public static void main(String[] args) {
        // 1.ç”¨LinkedListåšä¸€ä¸ªé˜Ÿåˆ—:å…ˆè¿›å…ˆå‡ºï¼Œåè¿›åå‡ºã€‚
        LinkedList<String> queue = new LinkedList<>();
        // å…¥é˜Ÿ
        queue.addLast("1å·");
        queue.addLast("2å·");
        queue.addLast("3å·");
        System.out.println(queue); // [1å·, 2å·, 3å·]
        // å‡ºé˜Ÿ
        System.out.println(queue.removeFirst());//1å·
        System.out.println(queue.removeFirst());//2å·
        System.out.println(queue);//[3å·]

        // åšä¸€ä¸ªæ ˆ å…ˆè¿›åå‡º
        LinkedList<String> stack = new LinkedList<>();
        // å‹æ ˆ
        stack.push("ç¬¬1é¢—å­å¼¹");//addFirst(e);
        stack.push("ç¬¬2é¢—å­å¼¹");
        stack.push("ç¬¬3é¢—å­å¼¹");
        System.out.println(stack); // [ ç¬¬3é¢—å­å¼¹, ç¬¬2é¢—å­å¼¹, ç¬¬1é¢—å­å¼¹]
        // å¼¹æ ˆ
        System.out.println(stack.pop());//removeFirst(); ç¬¬3é¢—å­å¼¹
        System.out.println(stack.pop());
        System.out.println(stack);// [ç¬¬1é¢—å­å¼¹]
    }
}
```

![](https://gitee.com/seazean/images/raw/master/JavaSE/LinkedListæ·»åŠ å…ƒç´ æºç è§£æ.png)



***





#### Set

##### Setæ¦‚è¿°

Setç³»åˆ—é›†åˆï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æ— åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•çš„ã€‚

* HashSetï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æ— åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•çš„ã€‚
*  LinkedHashSetï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•çš„ã€‚
* TreeSetï¼šä¸é‡å¤ï¼Œæ— ç´¢å¼•ï¼ŒæŒ‰ç…§å¤§å°é»˜è®¤å‡åºæ’åº!!

**é¢è¯•é—®é¢˜**ï¼šæ²¡æœ‰ç´¢å¼•,ä¸èƒ½ä½¿ç”¨æ™®é€šforå¾ªç¯éå†



##### HashSet

å“ˆå¸Œå€¼ï¼š

- å“ˆå¸Œå€¼ï¼šJDKæ ¹æ®å¯¹è±¡çš„åœ°å€æˆ–è€…å­—ç¬¦ä¸²æˆ–è€…æ•°å­—è®¡ç®—å‡ºæ¥çš„æ•°å€¼

- è·å–å“ˆå¸Œå€¼ï¼šObjectç±»ä¸­çš„public int hashCode()

- å“ˆå¸Œå€¼çš„ç‰¹ç‚¹

  - åŒä¸€ä¸ªå¯¹è±¡å¤šæ¬¡è°ƒç”¨hashCode()æ–¹æ³•è¿”å›çš„å“ˆå¸Œå€¼æ˜¯ç›¸åŒçš„
  - é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸åŒå¯¹è±¡çš„å“ˆå¸Œå€¼æ˜¯ä¸åŒçš„ã€‚è€Œé‡å†™hashCode()æ–¹æ³•ï¼Œå¯ä»¥å®ç°è®©ä¸åŒå¯¹è±¡çš„å“ˆå¸Œå€¼ç›¸åŒ



**HashSetåº•å±‚å°±æ˜¯åŸºäºHashMapå®ç°ï¼Œåªæ˜¯æ²¡æœ‰å€¼**

Seté›†åˆæ·»åŠ çš„å…ƒç´ æ˜¯æ— åºï¼Œä¸é‡å¤çš„ã€‚

* æ˜¯å¦‚ä½•å»é‡å¤çš„ï¼Ÿ

  ```java
  1.å¯¹äºæœ‰å€¼ç‰¹æ€§çš„ï¼ŒSeté›†åˆå¯ä»¥ç›´æ¥åˆ¤æ–­è¿›è¡Œå»é‡å¤ã€‚
  2.å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹çš„ç±»å¯¹è±¡ï¼ŒSeté›†åˆæ˜¯æŒ‰ç…§å¦‚ä¸‹æµç¨‹è¿›è¡Œæ˜¯å¦é‡å¤çš„åˆ¤æ–­ã€‚
      Seté›†åˆä¼šè®©ä¸¤ä¸¤å¯¹è±¡ï¼Œå…ˆè°ƒç”¨è‡ªå·±çš„hashCode()æ–¹æ³•å¾—åˆ°å½¼æ­¤çš„å“ˆå¸Œå€¼ï¼ˆæ‰€è°“çš„å†…å­˜åœ°å€ï¼‰
      ç„¶åæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å“ˆå¸Œå€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒåˆ™ç›´æ¥è®¤ä¸ºä¸¤ä¸ªå¯¹è±¡ä¸é‡å¤ã€‚
      å¦‚æœå“ˆå¸Œå€¼ç›¸åŒï¼Œä¼šç»§ç»­è®©ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œequalsæ¯”è¾ƒå†…å®¹æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒè®¤ä¸ºçœŸçš„é‡å¤äº†
      å¦‚æœä¸ç›¸åŒè®¤ä¸ºä¸é‡å¤ã€‚
  
              Seté›†åˆä¼šå…ˆè®©å¯¹è±¡è°ƒç”¨hashCode()æ–¹æ³•è·å–ä¸¤ä¸ªå¯¹è±¡çš„å“ˆå¸Œå€¼æ¯”è¾ƒ
                 /                     \
              false                    true
              /                          \
          ä¸é‡å¤                        ç»§ç»­è®©ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œequalsæ¯”è¾ƒ
                                         /          \
                                       false        true
                                        /             \
                                      ä¸é‡å¤          é‡å¤äº†
  ```

* Setç³»åˆ—é›†åˆå…ƒç´ æ— åºçš„æ ¹æœ¬åŸå› 

  Setç³»åˆ—é›†åˆæ·»åŠ å…ƒç´ æ— åºçš„æ ¹æœ¬åŸå› æ˜¯å› ä¸º**åº•å±‚é‡‡ç”¨äº†å“ˆå¸Œè¡¨å­˜å‚¨å…ƒç´ **ã€‚
  		JDK 1.8ä¹‹å‰ï¼šå“ˆå¸Œè¡¨ = æ•°ç»„ï¼ˆåˆå§‹å®¹é‡16) + é“¾è¡¨  + ï¼ˆå“ˆå¸Œç®—æ³•ï¼‰
  		JDK 1.8ä¹‹åï¼šå“ˆå¸Œè¡¨ = æ•°ç»„ï¼ˆåˆå§‹å®¹é‡16) + é“¾è¡¨ + çº¢é»‘æ ‘  + ï¼ˆå“ˆå¸Œç®—æ³•ï¼‰
      	å½“é“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼8ä¸”å½“å‰æ•°ç»„çš„é•¿åº¦ > 64æ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œå‡å°‘äº†æŸ¥æ‰¾æ—¶é—´
  		å½“é“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼8ä¸”å½“å‰æ•°ç»„çš„é•¿åº¦ < 64æ—¶ï¼Œæ‰©å®¹

  ![](https://gitee.com/seazean/images/raw/master/JavaSE/HashSetåº•å±‚ç»“æ„å“ˆå¸Œè¡¨.png)
  
  æ¯ä¸ªå…ƒç´ çš„hashcode()çš„å€¼è¿›è¡Œå“åº”çš„ç®—æ³•è¿ç®—ï¼Œè®¡ç®—å‡ºçš„å€¼ç›¸åŒçš„å­˜å…¥ä¸€ä¸ªæ•°ç»„å—ä¸­ï¼Œä»¥é“¾è¡¨çš„å½¢å¼å­˜å‚¨ï¼Œå¦‚æœé“¾è¡¨é•¿åº¦è¶…è¿‡8å°±é‡‡å–çº¢é»‘æ ‘å­˜å‚¨ï¼Œæ‰€ä»¥è¾“å‡ºçš„å…ƒç´ æ˜¯æ— åºçš„ã€‚

* å¦‚ä½•è®¾ç½®åªè¦å¯¹è±¡å†…å®¹ä¸€æ ·ï¼Œå°±å¸Œæœ›é›†åˆè®¤ä¸ºå®ƒä»¬é‡å¤äº†ï¼š**é‡å†™hashCodeå’Œequalsæ–¹æ³•**



****



##### Linked

**LinkedHashSet**ä¸ºä»€ä¹ˆæ˜¯æœ‰åºçš„ï¼Ÿ

LinkedHashSetåº•å±‚ä¾ç„¶æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨å…ƒç´ çš„ï¼Œä½†æ˜¯æ¯ä¸ªå…ƒç´ éƒ½é¢å¤–å¸¦ä¸€ä¸ªé“¾æ¥ç»´æŠ¤æ·»åŠ é¡ºåºã€‚ä¸å…‰å¢åˆ æŸ¥å¿«ï¼Œè¿˜æœ‰åºã€‚ç¼ºç‚¹æ˜¯å¤šäº†ä¸€ä¸ªå­˜å‚¨é¡ºåºçš„é“¾ä¼šå å†…å­˜ç©ºé—´!!è€Œä¸”ä¸å…è®¸é‡å¤ï¼Œæ— ç´¢å¼•ã€‚



****



##### TreeSet

TreeSeté›†åˆè‡ªè‡ªæ’åºçš„æ–¹å¼ï¼š(é‡ç‚¹)

1. æœ‰å€¼ç‰¹æ€§çš„å…ƒç´ ç›´æ¥å¯ä»¥å‡åºæ’åºã€‚ï¼ˆæµ®ç‚¹å‹ï¼Œæ•´å‹ï¼‰
2. å­—ç¬¦ä¸²ç±»å‹çš„å…ƒç´ ä¼šæŒ‰ç…§é¦–å­—ç¬¦çš„ç¼–å·æ’åºã€‚
3. å¯¹äºè‡ªå®šä¹‰çš„å¼•ç”¨æ•°æ®ç±»å‹ï¼ŒTreeSeté»˜è®¤æ— æ³•æ’åºï¼Œæ‰§è¡Œçš„æ—¶å€™æŠ¥é”™ï¼Œå› ä¸ºä¸çŸ¥é“æ’åºè§„åˆ™ã€‚

è‡ªå®šä¹‰çš„å¼•ç”¨æ•°æ®ç±»å‹ï¼ŒTreeSeté»˜è®¤æ— æ³•æ’åº æ‰€ä»¬éœ€è¦å®šåˆ¶æ’åºçš„è§„åˆ™ï¼Œå®šä¹‰å¤§å°è§„åˆ™çš„æ–¹æ¡ˆæœ‰2ç§ï¼š

   * ç›´æ¥ä¸º**å¯¹è±¡çš„ç±»**å®ç°æ¯”è¾ƒå™¨è§„åˆ™æ¥å£Comparableï¼Œé‡å†™æ¯”è¾ƒæ–¹æ³•
            `public int compareTo(Employee o): thisæ˜¯æ¯”è¾ƒè€…, oæ˜¯è¢«æ¯”è¾ƒè€…     `
            æ¯”è¾ƒè€…å¤§äºè¢«æ¯”è¾ƒè€… è¿”å›æ­£æ•°ï¼ 
            æ¯”è¾ƒè€…å°äºè¢«æ¯”è¾ƒè€… è¿”å›è´Ÿæ•°ï¼
            æ¯”è¾ƒè€…ç­‰äºè¢«æ¯”è¾ƒè€… è¿”å›0ï¼
   * ç›´æ¥ä¸º**é›†åˆ**è®¾ç½®æ¯”è¾ƒå™¨Comparatorå¯¹è±¡ï¼Œé‡å†™æ¯”è¾ƒæ–¹æ³•
     `public int compare(Employee o1, Employee o2): o1æ¯”è¾ƒè€…, o2è¢«æ¯”è¾ƒè€…`
     æ¯”è¾ƒè€…å¤§äºè¢«æ¯”è¾ƒè€… è¿”å›æ­£æ•°ï¼
     æ¯”è¾ƒè€…å°äºè¢«æ¯”è¾ƒè€… è¿”å›è´Ÿæ•°ï¼
     æ¯”è¾ƒè€…ç­‰äºè¢«æ¯”è¾ƒè€… è¿”å›0ï¼
     â€‹       

æ³¨æ„ï¼šå¦‚æœç±»å’Œé›†åˆéƒ½å¸¦æœ‰æ¯”è¾ƒè§„åˆ™ï¼Œä¼˜å…ˆä½¿ç”¨é›†åˆè‡ªå¸¦çš„æ¯”è¾ƒè§„åˆ™ã€‚

```java
public class TreeSetDemo{
    public static void main(String[] args){
        Set<Student> students = new TreeSet<>();
		Collections.add(students,s1,s2,s3);
        System.out.println(students);//æŒ‰ç…§å¹´é¾„æ¯”è¾ƒ å‡åº
        
        Set<Student> s = new TreeSet<>(new Comparator<Student>(){
            @Override
            public int compare(Student o1, Student o2) {
                // o1æ¯”è¾ƒè€…   o2è¢«æ¯”è¾ƒè€…
                return o2.getAge() - o1.getAge();//é™åº
            }
        });
    }
}

public class Student implements Comparable<Student>{
    private String name;
    private int age;
    // é‡å†™äº†æ¯”è¾ƒæ–¹æ³•ã€‚
    // e1.compareTo(o)
    // æ¯”è¾ƒè€…ï¼šthis
    // è¢«æ¯”è¾ƒè€…ï¼šo
    // éœ€æ±‚ï¼šæŒ‰ç…§å¹´é¾„æ¯”è¾ƒ å‡åºï¼Œå¹´é¾„ç›¸åŒæŒ‰ç…§å§“å
    @Override
    public int compareTo(Student o) {
        int result = this.age - o.age;
        return result == 0 ? this.getName().compareTo(o.getName):result;
}
```



****



####  æ¯”è¾ƒå™¨

ç”¨æ¥æ’åºï¼Œçœ‹TreeSetã€‚

åº•å±‚æ˜¯ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºåŸºå‡†ï¼ŒåŠ ä¸€ä¸ªæ–°å…ƒç´ ï¼Œå°±ä¼šå’Œç¬¬ä¸€ä¸ªå…ƒç´ æ¯”ï¼Œå¦‚æœå¤§äºï¼Œå°±ç»§ç»­å’Œå¤§äºçš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°é‡åˆ°æ¯”æ–°å…ƒç´ å¤§çš„å…ƒç´ ä¸ºæ­¢ï¼Œæ”¾åœ¨è¯¥ä½ç½®çš„å·¦è¾¹ã€‚**çº¢é»‘æ ‘**






***



#### Collections

java.utils.Collectionsï¼šé›†åˆå·¥å…·ç±»ã€‚Collectionså¹¶ä¸å±äºé›†åˆï¼Œæ˜¯ç”¨æ¥æ“ä½œé›†åˆçš„å·¥å…·ç±»ã€‚
Collectionsæœ‰å‡ ä¸ªå¸¸ç”¨çš„API:
     public static <T> boolean addAll(Collection<? super T> c, T... elements) : ç»™é›†åˆå¯¹è±¡æ‰¹é‡æ·»åŠ å…ƒç´ 
     public static void shuffle(List<?> list) : æ‰“ä¹±é›†åˆé¡ºåºã€‚
     public static <T> void sort(List<T> list) : å°†é›†åˆä¸­å…ƒç´ æŒ‰ç…§é»˜è®¤è§„åˆ™æ’åºã€‚
     public static <T> void sort(List<T> listï¼ŒComparator<? super T> ) : é›†åˆä¸­å…ƒç´ æŒ‰ç…§æŒ‡å®šè§„åˆ™æ’åº

```java
public class CollectionsDemo {
    public static void main(String[] args) {
        Collection<String> names = new ArrayList<>();
        Collections.addAll(names,"å¼ ","ç‹","æ","èµµ");
        
        List<Double> scores = new ArrayList<>();
        Collections.addAll(scores, 98.5, 66.5 , 59.5 , 66.5 , 99.5 );
        Collections.shuffle(scores);
        Collections.sort(scores); // é»˜è®¤å‡åºæ’åºï¼
        System.out.println(scores);
        
        List<Student> students = new ArrayList<>();
        Collections.addAll(students,s1,s2,s3,s4);
        Collections.sort(students,new Comparator<Student>(){
            
        })
    }
}

public class Student{
    private String name;
    private int age;
}
```



***



### Map

#### æ¦‚è¿°

>Collectionæ˜¯å•å€¼é›†åˆä½“ç³»ã€‚
>Mapé›†åˆæ˜¯ä¸€ç§åŒåˆ—é›†åˆï¼Œæ¯ä¸ªå…ƒç´ åŒ…å«ä¸¤ä¸ªå€¼ã€‚

Mapé›†åˆçš„æ¯ä¸ªå…ƒç´ çš„æ ¼å¼ï¼škey=value(é”®å€¼å¯¹å…ƒç´ )ã€‚Mapé›†åˆä¹Ÿè¢«ç§°ä¸ºâ€œé”®å€¼å¯¹é›†åˆâ€ã€‚

Mapé›†åˆçš„å®Œæ•´æ ¼å¼ï¼š`{key1=value1 , key2=value2 , key3=value3 , ...}`

```
Mapé›†åˆçš„ä½“ç³»ï¼š
        Map<K , V>(æ¥å£,Mapé›†åˆçš„ç¥–å®—ç±»)
       /                      \
      TreeMap<K , V>           HashMap<K , V>(å®ç°ç±»,ç»å…¸çš„ï¼Œç”¨çš„æœ€å¤š)
                                 \
                                  LinkedHashMap<K, V>(å®ç°ç±»)
```

Mapé›†åˆçš„ç‰¹ç‚¹ï¼š

1. Mapé›†åˆçš„ç‰¹ç‚¹éƒ½æ˜¯ç”±é”®å†³å®šçš„ã€‚
2. Mapé›†åˆçš„é”®æ˜¯æ— åº,ä¸é‡å¤çš„,æ— ç´¢å¼•çš„ã€‚(Set)
3. Mapé›†åˆçš„å€¼æ— è¦æ±‚ã€‚(List)
4. Mapé›†åˆçš„é”®å€¼å¯¹éƒ½å¯ä»¥ä¸ºnullã€‚
5. Mapé›†åˆåé¢é‡å¤çš„é”®å¯¹åº”å…ƒç´ ä¼šè¦†ç›–å‰é¢çš„å…ƒç´ 

HashMapï¼šå…ƒç´ æŒ‰ç…§é”®æ˜¯æ— åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•ï¼Œå€¼ä¸åšè¦æ±‚ã€‚

LinkedHashMapï¼šå…ƒç´ æŒ‰ç…§é”®æ˜¯æœ‰åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•ï¼Œå€¼ä¸åšè¦æ±‚ã€‚

```java
//ç»å…¸ä»£ç 
Map<String , Integer> maps = new HashMap<>();
maps.put("æ‰‹æœº",1);
System.out.println(maps);
```



***



#### å¸¸ç”¨API

Mapé›†åˆçš„å¸¸ç”¨API
     `public V put(K key, V value)` :  æŠŠæŒ‡å®šçš„é”®ä¸å€¼æ·»åŠ åˆ°Mapé›†åˆä¸­ï¼Œ**é‡å¤çš„é”®ä¼šè¦†ç›–å‰é¢çš„å€¼å…ƒç´ **
     `public V remove(Object key)` : æŠŠæŒ‡å®šçš„é”®å¯¹åº”çš„é”®å€¼å¯¹å…ƒç´ åœ¨é›†åˆä¸­åˆ é™¤ï¼Œè¿”å›è¢«åˆ é™¤å…ƒç´ çš„å€¼
     `public V get(Object key)` : æ ¹æ®æŒ‡å®šçš„é”®ï¼Œåœ¨Mapé›†åˆä¸­è·å–å¯¹åº”çš„å€¼ã€‚
     `public Set<K> keySet()` : è·å–Mapé›†åˆä¸­æ‰€æœ‰çš„é”®ï¼Œå­˜å‚¨åˆ°**Seté›†åˆ**ä¸­ã€‚
     `public Collection<V> values()` : è·å–å…¨éƒ¨å€¼çš„é›†åˆï¼Œå­˜å‚¨åˆ°**Collectioné›†åˆ**
     `public Set<Map.Entry<K,V>> entrySet()` : è·å–Mapé›†åˆä¸­æ‰€æœ‰çš„é”®å€¼å¯¹å¯¹è±¡çš„é›†åˆ(Seté›†åˆ)
     `public boolean containKey(Object key)` : åˆ¤æ–­è¯¥é›†åˆä¸­æ˜¯å¦æœ‰æ­¤é”®ã€‚
	 `public boolean containsKey(Object key)` : åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©ºã€‚

```java
public class MapDemo {
    public static void main(String[] args) {
        Map<String , Integer> maps = new HashMap<>();
        maps.put(.....);
        System.out.println(maps.isEmpty());//false
        Integer value = maps.get("....");//è¿”å›é”®å€¼å¯¹è±¡
        Set<String> keys = maps.keySet();//è·å–Mapé›†åˆä¸­æ‰€æœ‰çš„é”®ï¼Œ
        //Mapé›†åˆçš„é”®æ˜¯æ— åºä¸é‡å¤çš„ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯ä¸€ä¸ªSeté›†åˆ
        Collection<Integer> values = maps.values();
        //Mapé›†åˆçš„å€¼æ˜¯ä¸åšè¦æ±‚çš„ï¼Œå¯èƒ½é‡å¤ï¼Œæ‰€ä»¥å€¼è¦ç”¨Collectioné›†åˆæ¥æ”¶!
    }
}
```



***



#### éå†æ–¹å¼

Mapé›†åˆçš„éå†æ–¹å¼æœ‰ï¼š3ç§ã€‚
    ï¼ˆ1ï¼‰â€œé”®æ‰¾å€¼â€çš„æ–¹å¼éå†ï¼šå…ˆè·å–Mapé›†åˆå…¨éƒ¨çš„é”®ï¼Œå†æ ¹æ®éå†é”®æ‰¾å€¼ã€‚
    ï¼ˆ2ï¼‰â€œé”®å€¼å¯¹â€çš„æ–¹å¼éå†ï¼šéš¾åº¦è¾ƒå¤§ï¼Œé‡‡ç”¨å¢å¼ºforæˆ–è€…è¿­ä»£å™¨
    ï¼ˆ3ï¼‰JDK 1.8å¼€å§‹ä¹‹åçš„æ–°æŠ€æœ¯ï¼šforeachï¼Œé‡‡ç”¨Lambdaè¡¨è¾¾å¼

é›†åˆå¯ä»¥ç›´æ¥è¾“å‡ºå†…å®¹ï¼Œå› ä¸ºåº•å±‚é‡å†™äº†toString()æ–¹æ³•ã€‚

```java
public static void main(String[] args){
    Map<String , Integer> maps = new HashMap<>();
	//(1)é”®æ‰¾å€¼
    Set<String> keys = maps.keySet();
    //Iterator<String> iterator = hm.keySet().iterator();
    for(String key : keys) {
        System.out.println(key + "=" + maps.get(key));
    }
    //(2)é”®å€¼å¯¹
    //(2.1)æ™®é€šæ–¹å¼
    Set<Map.Entry<String,Integer>> entries = maps.entrySet();
    for (Map.Entry<String, Integer> entry : entries) {
             System.out.println(entry.getKey() + "=>" + entry.getValue());
    }
    //(2.2)è¿­ä»£å™¨æ–¹å¼
    Iterator<Map.Entry<String, Integer>> iterator = maps.entrySet().iterator();
    while (iterator.hasNext()) {
        Map.Entry<String, Integer> entry = iterator.next();
        System.out.println(entry.getKey() + "=" + entry.getValue());

    }
    //(3) Lamda
    maps.forEach((k,v) -> {
        System.out.println(k + "==>" + v);
    })
}
```



***



#### HashMap

##### é›†åˆæ¦‚è¿°

HashMapåŸºäºå“ˆå¸Œè¡¨çš„Mapæ¥å£å®ç°ï¼Œæ˜¯ä»¥key-valueå­˜å‚¨å½¢å¼å­˜åœ¨ï¼Œä¸»è¦ç”¨æ¥å­˜æ”¾é”®å€¼å¯¹

ç‰¹ç‚¹ï¼š

* HashMapçš„å®ç°ä¸æ˜¯åŒæ­¥çš„ï¼Œè¿™æ„å‘³ç€å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„

* keyæ˜¯å”¯ä¸€ä¸é‡å¤çš„ï¼Œåº•å±‚çš„å“ˆå¸Œè¡¨ç»“æ„ï¼Œä¾èµ–hashCodeæ–¹æ³•å’Œequalsæ–¹æ³•ä¿è¯é”®çš„å”¯ä¸€

* keyã€valueéƒ½å¯ä»¥ä¸ºnullï¼Œä½†æ˜¯é”®ä½ç½®åªèƒ½æ˜¯ä¸€ä¸ªnull

* HashMapä¸­çš„æ˜ å°„ä¸æ˜¯æœ‰åºçš„ï¼Œå³å­˜å–æ˜¯æ— åºçš„

* å¦‚æœé”®è¦å­˜å‚¨çš„æ˜¯è‡ªå®šä¹‰å¯¹è±¡ï¼Œéœ€è¦é‡å†™hashCodeå’Œequalsæ–¹æ³•


ç›¸åŒç‚¹ï¼š å®ç°åŸç†ç›¸åŒï¼Œåº•å±‚å®ç°éƒ½æ˜¯æ•°ç»„+é“¾è¡¨ç»“æ„å®ç°ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹å¯ä»¥äº’ç”¨ 

ä¸åŒç‚¹ï¼š 

1. Hashtableæ˜¯æ—©æœŸæä¾›çš„æ¥å£ï¼ŒHashMapæ˜¯æ–°ç‰ˆJDKæä¾›çš„æ¥å£
2. Hashtableç»§æ‰¿Dictionaryç±»ï¼ŒHashMapç»§æ‰¿AbstractMapï¼Œä¸¤è€…å‡å®ç°Mapæ¥å£
3. HashMapçº¿ç¨‹éå®‰å…¨ï¼ŒHashtableçº¿ç¨‹å®‰å…¨ï¼ŒHashtableçš„å®ç°æ–¹æ³•éƒ½æ·»åŠ äº†synchronizedå…³é”®å­—æ¥ç¡®ä¿çº¿ç¨‹åŒæ­¥
4. Hashtableä¸å…è®¸nullå€¼ï¼ŒHashMapå…è®¸nullå€¼
5. HashMapçš„åˆå§‹å®¹é‡ä¸º16ï¼ŒHashtableåˆå§‹å®¹é‡ä¸º11ï¼Œä¸¤è€…çš„å¡«å……å› å­é»˜è®¤éƒ½æ˜¯0.75ï¼ŒHashMapæ‰©å®¹æ—¶æ˜¯å½“å‰å®¹é‡ç¿»å€å³ï¼šcapacity * 2ï¼ŒHashtableæ‰©å®¹æ—¶æ˜¯å®¹é‡ç¿»å€+1å³ï¼šcapacity*2 + 1

åº•å±‚æ•°æ®ç»“æ„ï¼š

* å“ˆå¸Œè¡¨ï¼ˆHash tableï¼Œä¹Ÿå«æ•£åˆ—è¡¨ï¼‰ï¼Œæ ¹æ®å…³é”®ç å€¼(Key value)è€Œç›´æ¥è®¿é—®çš„æ•°æ®ç»“æ„ã€‚é€šè¿‡æŠŠå…³é”®ç å€¼æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œä»¥åŠ å¿«æŸ¥æ‰¾çš„é€Ÿåº¦ï¼Œè¿™ä¸ªæ˜ å°„å‡½æ•°å«åšæ•£åˆ—å‡½æ•°ï¼Œå­˜æ”¾è®°å½•çš„æ•°ç»„å«åšæ•£åˆ—è¡¨

* JDK1.8 ä¹‹å‰ HashMap ç”± **æ•°ç»„+é“¾è¡¨** ç»„æˆ

  * æ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“
  * é“¾è¡¨åˆ™æ˜¯ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€è§£å†³å†²çªï¼‰
    **ä¸¤ä¸ªå¯¹è±¡è°ƒç”¨çš„hashCodeæ–¹æ³•è®¡ç®—çš„å“ˆå¸Œç å€¼ï¼ˆé”®çš„å“ˆå¸Œï¼‰ä¸€è‡´å¯¼è‡´è®¡ç®—çš„æ•°ç»„ç´¢å¼•å€¼ç›¸åŒ**

* JDK1.8 ä»¥å HashMap ç”± **æ•°ç»„+é“¾è¡¨ +çº¢é»‘æ ‘**æ•°æ®ç»“æ„ç»„æˆ

  * è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–
  * **å½“é“¾è¡¨é•¿åº¦è¶…è¿‡ï¼ˆå¤§äºï¼‰é˜ˆå€¼ï¼ˆæˆ–è€…çº¢é»‘æ ‘çš„è¾¹ç•Œå€¼ï¼Œé»˜è®¤ä¸º 8ï¼‰å¹¶ä¸”å½“å‰æ•°ç»„çš„é•¿åº¦å¤§äºç­‰äº64æ—¶ï¼Œæ­¤ç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰æ•°æ®æ”¹ä¸ºçº¢é»‘æ ‘å­˜å‚¨ã€‚**

  * å°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œå³ä½¿é˜ˆå€¼å¤§äº8ï¼Œä½†æ˜¯æ•°ç»„é•¿åº¦å°äº64ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šå°†é“¾è¡¨å˜ä¸ºçº¢é»‘æ ‘ï¼Œè€Œæ˜¯é€‰æ‹©è¿›è¡Œæ•°ç»„æ‰©å®¹ã€‚å› ä¸ºæ•°ç»„æ¯”è¾ƒå°ï¼Œè¿™ç§æƒ…å†µä¸‹å˜ä¸ºçº¢é»‘æ ‘ç»“æ„ï¼Œåè€Œä¼šé™ä½æ•ˆç‡ï¼Œçº¢é»‘æ ‘éœ€è¦è¿›è¡Œå·¦æ—‹ï¼Œå³æ—‹ï¼Œå˜è‰²è¿™äº›æ“ä½œæ¥ä¿æŒå¹³è¡¡ã€‚åŒæ—¶æ•°ç»„é•¿åº¦å°äº64æ—¶ï¼Œæœç´¢æ—¶é—´ç›¸å¯¹å¿«äº›ã€‚æ‰€ä»¥ä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘æœç´¢æ—¶é—´ï¼Œåº•å±‚åœ¨é˜ˆå€¼å¤§äº8å¹¶ä¸”æ•°ç»„é•¿åº¦å¤§äº64æ—¶ï¼Œé“¾è¡¨æ‰è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæ•ˆç‡ä¹Ÿå˜çš„æ›´é«˜æ•ˆã€‚ 



***



##### å­˜å‚¨è¿‡ç¨‹

å­˜å‚¨è¿‡ç¨‹å›¾ï¼š

![](https://gitee.com/seazean/images/raw/master/JavaSE/HashMapå“ˆå¸Œè¡¨å­˜å‚¨è¿‡ç¨‹.png)

å­˜å‚¨è¿‡ç¨‹è§£æï¼š

```java
1. HashMap<String, Integer> map = new HashMap<>(),å½“åˆ›å»ºHashMapé›†åˆå¯¹è±¡æ—¶ï¼Œåœ¨jdk8ä¹‹å‰ï¼Œæ„é€ æ–¹æ³•åˆ›å»ºä¸€ä¸ªé•¿åº¦æ˜¯16çš„Entry[] table ç”¨æ¥å­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚åœ¨jdk1.8ä¹‹åä¸åœ¨HashMapæ„é€ æ–¹æ³•åˆ›å»ºæ•°ç»„ï¼Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨putæ–¹æ³•æ—¶åˆ›å»ºæ•°ç»„Node[] table
2. å‘å“ˆå¸Œè¡¨å­˜å‚¨æ•°æ® åˆ˜å¾·å-53ï¼Œæ ¹æ®åˆ˜å¾·åè°ƒç”¨Stringç±»ä¸­çš„hashCode()æ–¹æ³•æ ¹æ®é”®è®¡ç®—å“ˆå¸Œå€¼ï¼Œç»è¿‡ç®—æ³•è®¡ç®—ä»¥åï¼Œå¾—åˆ°åœ¨Nodeæ•°ç»„ä¸­çš„å­˜æ”¾ä½ç½®ï¼Œå›¾ç¤ºç´¢å¼•ä¸º2ï¼Œå¦‚æœæ­¤ä½ç½®ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ·»åŠ æ•°æ®
3. å‘å“ˆå¸Œè¡¨ä¸­å­˜å‚¨æ•°æ®å¼ å­¦å‹-55ï¼Œæ ¹æ®å¼ å­¦å‹è®¡ç®—å‡ºNodeçš„ç´¢å¼•æ˜¯2ï¼Œæ­¤ä½ç½®ä¸ä¸ºç©ºï¼Œæ¯”è¾ƒåˆ˜å¾·åå’Œå¼ å­¦å‹çš„å“ˆå¸Œå€¼ï¼Œä¸åŒåˆ™åœ¨æ­¤ç©ºé—´åˆ’å‡ºä¸€ä¸ªèŠ‚ç‚¹å˜ä¸ºé“¾è¡¨å­˜å‚¨
4. å‘å“ˆå¸Œè¡¨ä¸­å­˜å‚¨æ•°æ®åˆ˜å¾·å-50ï¼Œæ ¹æ®é”®è®¡ç®—ç´¢å¼•ä¸º2ï¼Œç„¶åå’Œå·²ç»å­˜åœ¨çš„å“ˆå¸Œå€¼æ¯”è¾ƒï¼Œç›¸åŒåˆ™ç»§ç»­ç”¨equals()æ–¹æ³•æ¯”è¾ƒï¼Œè¿”å›falseåˆ™ç»§ç»­æ·»åŠ ï¼Œè¿”å›trueåˆ™åæ·»åŠ çš„æ•°æ®50æ›¿æ¢ä¹‹å‰çš„æ•°æ®53
```

å¸¸è§é¢è¯•é¢˜ï¼š

* HashMapä¸­hashå‡½æ•°æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿè¿˜æœ‰å“ªäº›hashå‡½æ•°çš„å®ç°æ–¹å¼ï¼Ÿ
  å¯¹äºkeyçš„hashCodeåšhashæ“ä½œï¼Œ**æ— ç¬¦å·å³ç§»16ä½ç„¶ååšå¼‚æˆ–è¿ç®—**ã€‚è¿˜æœ‰å¹³æ–¹å–ä¸­æ³•ï¼Œä¼ªéšæœºæ•°æ³•å’Œå–ä½™æ•°æ³•ï¼Œè¿™ä¸‰ç§æ•ˆç‡éƒ½æ¯”è¾ƒä½ã€‚æ— ç¬¦å·å³ç§»16ä½å¼‚æˆ–è¿ç®—æ•ˆç‡æ˜¯æœ€é«˜çš„
* è®¡ç®—ç´¢å¼•çš„æ–¹æ³•ï¼Ÿ
  å“ˆå¸Œå€¼å’Œé“¾è¡¨é•¿åº¦**å–æ¨¡ (å–ä½™) hash%length**ï¼Œè®¡ç®—æœºä¸­æ±‚ä½™æ•ˆç‡ä¸å¦‚ä½è¿ç®—ï¼Œæ‰€ä»¥é‡‡ç”¨ hash & (length-1)
* å½“ä¸¤ä¸ªå¯¹è±¡çš„hashCodeç›¸ç­‰æ—¶ä¼šæ€ä¹ˆæ ·ï¼Ÿ
  ä¼šäº§ç”Ÿå“ˆå¸Œç¢°æ’ï¼Œè‹¥keyå€¼å†…å®¹ç›¸åŒåˆ™æ›¿æ¢æ—§çš„valueï¼Œå¦åˆ™è¿æ¥åˆ°é“¾è¡¨åé¢ï¼Œé“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼8å°±è½¬æ¢ä¸ºçº¢é»‘æ ‘å­˜å‚¨
* ä»€ä¹ˆæ˜¯å“ˆå¸Œç¢°æ’ï¼Ÿå¦‚ä½•è§£å†³å“ˆå¸Œç¢°æ’ï¼Ÿ
  åªè¦ä¸¤ä¸ªå…ƒç´ çš„keyè®¡ç®—çš„å“ˆå¸Œç å€¼ç›¸åŒå°±ä¼šå‘ç”Ÿ**å“ˆå¸Œç¢°æ’**
  jdk8å‰ä½¿ç”¨é“¾è¡¨è§£å†³å“ˆå¸Œç¢°æ’ï¼Œjdk8ä¹‹åä½¿ç”¨é“¾è¡¨+çº¢é»‘æ ‘è§£å†³å“ˆå¸Œç¢°æ’
* å¦‚æœä¸¤ä¸ªé”®çš„hashcodeç›¸åŒï¼Œå¦‚ä½•å­˜å‚¨é”®å€¼å¯¹ï¼Ÿ
  hashcodeç›¸åŒï¼Œé€šè¿‡equalsæ¯”è¾ƒå†…å®¹æ˜¯å¦ç›¸åŒã€‚
  ç›¸åŒï¼šåˆ™æ–°çš„valueè¦†ç›–ä¹‹å‰çš„value
  ä¸ç›¸åŒï¼šåˆ™å°†æ–°çš„é”®å€¼å¯¹æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­
* ä¸ºä»€ä¹ˆè¦æ‰©å®¹ï¼Ÿ
  åœ¨ä¸æ–­çš„æ·»åŠ æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ¶‰åŠåˆ°æ‰©å®¹é—®é¢˜ï¼Œå½“è¶…å‡ºä¸´ç•Œå€¼ (ä¸”è¦å­˜æ”¾çš„ä½ç½®éç©º) æ—¶ï¼Œæ‰©å®¹ã€‚é»˜è®¤çš„æ‰©å®¹æ–¹å¼ï¼š**æ‰©å®¹ä¸ºåŸæ¥å®¹é‡çš„2å€ï¼Œå¹¶å°†åŸæœ‰çš„æ•°æ®å¤åˆ¶è¿‡æ¥**
* å¼•å…¥çº¢é»‘æ ‘çš„åŸå› ï¼Ÿ
  JDK 1.8 ä»¥å‰ HashMap çš„å®ç°æ˜¯ æ•°ç»„+é“¾è¡¨ï¼Œå³ä½¿å“ˆå¸Œå‡½æ•°å–å¾—å†å¥½ï¼Œä¹Ÿå¾ˆéš¾è¾¾åˆ°å…ƒç´ ç™¾åˆ†ç™¾å‡åŒ€åˆ†å¸ƒã€‚å½“ HashMap ä¸­æœ‰å¤§é‡çš„å…ƒç´ éƒ½å­˜æ”¾åˆ°åŒä¸€ä¸ªæ¡¶ä¸­æ—¶ï¼Œå°±ç›¸å½“äºä¸€ä¸ªé•¿çš„å•é“¾è¡¨ï¼Œå‡å¦‚å•é“¾è¡¨æœ‰ n ä¸ªå…ƒç´ ï¼Œéå†çš„**æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)**ï¼Œå®Œå…¨å¤±å»äº†å®ƒçš„ä¼˜åŠ¿ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒJDK 1.8 ä¸­å¼•å…¥äº† çº¢é»‘æ ‘ï¼ˆæŸ¥æ‰¾æ—¶**é—´å¤æ‚åº¦ä¸º O(logn)**ï¼‰æ¥ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ï¼Œä½¿å¾—æŸ¥æ‰¾æ•ˆç‡æ›´é«˜ã€‚

![](https://gitee.com/seazean/images/raw/master/JavaSE/å“ˆå¸Œè¡¨.png)



***



##### ç»§æ‰¿å…³ç³»

HashMapç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://gitee.com/seazean/images/raw/master/JavaSE/HashMapç»§æ‰¿å…³ç³».bmp)



è¯´æ˜ï¼š

* Cloneable ç©ºæ¥å£ï¼Œè¡¨ç¤ºå¯ä»¥å…‹éš†ï¼Œ åˆ›å»ºå¹¶è¿”å›HashMapå¯¹è±¡çš„ä¸€ä¸ªå‰¯æœ¬ã€‚
* Serializable åºåˆ—åŒ–æ¥å£ï¼Œå±äºæ ‡è®°æ€§æ¥å£ï¼ŒHashMapå¯¹è±¡å¯ä»¥è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚
* AbstractMap çˆ¶ç±»æä¾›äº†Mapå®ç°æ¥å£ï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘å®ç°æ­¤æ¥å£æ‰€éœ€çš„å·¥ä½œ

```java
è¡¥å……ï¼šé€šè¿‡ä¸Šè¿°ç»§æ‰¿å…³ç³»æˆ‘ä»¬å‘ç°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ç°è±¡ï¼Œ å°±æ˜¯HashMapå·²ç»ç»§æ‰¿äº†AbstractMapè€ŒAbstractMapç±»å®ç°äº†Mapæ¥å£ï¼Œé‚£ä¸ºä»€ä¹ˆHashMapè¿˜è¦åœ¨å®ç°Mapæ¥å£å‘¢ï¼ŸåŒæ ·åœ¨ArrayListä¸­LinkedListä¸­éƒ½æ˜¯è¿™ç§ç»“æ„ã€‚
æ® java é›†åˆæ¡†æ¶çš„åˆ›å§‹äººJosh Blochæè¿°ï¼Œè¿™æ ·çš„å†™æ³•æ˜¯ä¸€ä¸ªå¤±è¯¯ã€‚åœ¨javaé›†åˆæ¡†æ¶ä¸­ï¼Œç±»ä¼¼è¿™æ ·çš„å†™æ³•å¾ˆå¤šï¼Œæœ€å¼€å§‹å†™javaé›†åˆæ¡†æ¶çš„æ—¶å€™ï¼Œä»–è®¤ä¸ºè¿™æ ·å†™ï¼Œåœ¨æŸäº›åœ°æ–¹å¯èƒ½æ˜¯æœ‰ä»·å€¼çš„ï¼Œç›´åˆ°ä»–æ„è¯†åˆ°é”™äº†ã€‚æ˜¾ç„¶çš„ï¼ŒJDKçš„ç»´æŠ¤è€…ï¼Œåæ¥ä¸è®¤ä¸ºè¿™ä¸ªå°å°çš„å¤±è¯¯å€¼å¾—å»ä¿®æ”¹ï¼Œæ‰€ä»¥å°±è¿™æ ·å­˜åœ¨ä¸‹æ¥äº†ã€‚
```



***



##### æ„é€ æ–¹æ³•

1. æ„é€ ä¸€ä¸ªç©ºçš„ HashMap ï¼Œé»˜è®¤åˆå§‹å®¹é‡ï¼ˆ16ï¼‰å’Œé»˜è®¤è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰

   ```java
   public HashMap() {
   	this.loadFactor = DEFAULT_LOAD_FACTOR; 
   	//å°†é»˜è®¤çš„åŠ è½½å› å­0.75èµ‹å€¼ç»™loadFactorï¼Œå¹¶æ²¡æœ‰åˆ›å»ºæ•°ç»„
   }
   ```

2. æ„é€ ä¸€ä¸ªå…·æœ‰æŒ‡å®šçš„åˆå§‹å®¹é‡å’Œé»˜è®¤è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰ HashMap

   ```java
   // æŒ‡å®šâ€œå®¹é‡å¤§å°â€çš„æ„é€ å‡½æ•°
   public HashMap(int initialCapacity) {
       this(initialCapacity, DEFAULT_LOAD_FACTOR);
   }
   ```

3. æ„é€ ä¸€ä¸ªå…·æœ‰æŒ‡å®šçš„åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­çš„HashMap

   ```java
   public HashMap(int initialCapacity, float loadFactor) {
       //åˆ¤æ–­åˆå§‹åŒ–å®¹é‡initialCapacityæ˜¯å¦å°äº0
       if (initialCapacity < 0)
           //å¦‚æœå°äº0ï¼Œåˆ™æŠ›å‡ºéæ³•çš„å‚æ•°å¼‚å¸¸IllegalArgumentException
           throw new IllegalArgumentException("Illegal initial capacity: " +
                                              initialCapacity);
       //åˆ¤æ–­åˆå§‹åŒ–å®¹é‡initialCapacityæ˜¯å¦å¤§äºé›†åˆçš„æœ€å¤§å®¹é‡MAXIMUM_CAPACITY-ã€‹2çš„30æ¬¡å¹‚
       if (initialCapacity > MAXIMUM_CAPACITY)
           //å¦‚æœè¶…è¿‡MAXIMUM_CAPACITYï¼Œä¼šå°†MAXIMUM_CAPACITYèµ‹å€¼ç»™initialCapacity
           initialCapacity = MAXIMUM_CAPACITY;
       //åˆ¤æ–­è´Ÿè½½å› å­loadFactoræ˜¯å¦å°äºç­‰äº0æˆ–è€…æ˜¯å¦æ˜¯ä¸€ä¸ªéæ•°å€¼
       if (loadFactor <= 0 || Float.isNaN(loadFactor))
           //å¦‚æœæ»¡è¶³ä¸Šè¿°å…¶ä¸­ä¹‹ä¸€ï¼Œåˆ™æŠ›å‡ºéæ³•çš„å‚æ•°å¼‚å¸¸IllegalArgumentException
           throw new IllegalArgumentException("Illegal load factor: " +
                                              loadFactor);
       //å°†æŒ‡å®šçš„åŠ è½½å› å­èµ‹å€¼ç»™HashMapæˆå‘˜å˜é‡çš„è´Ÿè½½å› å­loadFactor
       this.loadFactor = loadFactor;
     	//æœ€åè°ƒç”¨äº†tableSizeFor
       this.threshold = tableSizeFor(initialCapacity);
   }
   ```

   * å¯¹äº`this.threshold = tableSizeFor(initialCapacity);` 

     tableSizeFor(initialCapacity) åˆ¤æ–­æŒ‡å®šçš„åˆå§‹åŒ–å®¹é‡æ˜¯å¦æ˜¯2çš„næ¬¡å¹‚ï¼Œå¦‚æœä¸æ˜¯ä¼šå˜ä¸ºæ¯”æŒ‡å®šåˆå§‹åŒ–å®¹é‡å¤§çš„æœ€å°çš„2çš„næ¬¡å¹‚ã€‚ä½†æ˜¯åœ¨tableSizeForæ–¹æ³•ä½“å†…éƒ¨å°†è®¡ç®—åçš„æ•°æ®è¿”å›åˆ°è¿™é‡Œï¼Œå¹¶èµ‹å€¼ç»™thresholdè¾¹ç•Œå€¼ã€‚æœ‰äº›äººä¼šè§‰å¾—è¿™é‡Œæ˜¯ä¸€ä¸ªbugåº”è¯¥è¿™æ ·ä¹¦å†™ï¼š
     `this.threshold = tableSizeFor(initialCapacity) * this.loadFactor;`
     è¿™æ ·æ‰ç¬¦åˆthresholdçš„æ¦‚å¿µï¼ˆå½“HashMapçš„sizeåˆ°è¾¾thresholdè¿™ä¸ªé˜ˆå€¼æ—¶ä¼šæ‰©å®¹ï¼‰ã€‚
     ä½†æ˜¯åœ¨jdk8ä»¥åçš„æ„é€ æ–¹æ³•ä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹tableè¿™ä¸ªæˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œtableçš„åˆå§‹åŒ–è¢«æ¨è¿Ÿåˆ°äº†putæ–¹æ³•ä¸­ï¼Œåœ¨putæ–¹æ³•ä¸­ä¼šå¯¹thresholdé‡æ–°è®¡ç®—ã€‚

4. åŒ…å«å¦ä¸€ä¸ª`Map`çš„æ„é€ å‡½æ•° 

   ```java
   //æ„é€ ä¸€ä¸ªæ˜ å°„å…³ç³»ä¸æŒ‡å®š Map ç›¸åŒçš„æ–° HashMapã€‚
   public HashMap(Map<? extends K, ? extends V> m) {
       //è´Ÿè½½å› å­loadFactorå˜ä¸ºé»˜è®¤çš„è´Ÿè½½å› å­0.75
       this.loadFactor = DEFAULT_LOAD_FACTOR;
       putMapEntries(m, false);
   }
   ```

   putMapEntriesæºç åˆ†æï¼š

   ```java
   final void putMapEntries(Map<? extends K, ? extends V> m, boolean evict) {
       //è·å–å‚æ•°é›†åˆçš„é•¿åº¦
       int s = m.size();
       if (s > 0)
       {
           //åˆ¤æ–­å‚æ•°é›†åˆçš„é•¿åº¦æ˜¯å¦å¤§äº0
           if (table == null)  // åˆ¤æ–­tableæ˜¯å¦å·²ç»åˆå§‹åŒ–
           { // pre-size
                   // æœªåˆå§‹åŒ–ï¼Œsä¸ºmçš„å®é™…å…ƒç´ ä¸ªæ•°
                   float ft = ((float)s / loadFactor) + 1.0F;
                   int t = ((ft < (float)MAXIMUM_CAPACITY) ?
                           (int)ft : MAXIMUM_CAPACITY);
                   // è®¡ç®—å¾—åˆ°çš„tå¤§äºé˜ˆå€¼ï¼Œåˆ™åˆå§‹åŒ–é˜ˆå€¼
                   if (t > threshold)
                       threshold = tableSizeFor(t);
           }
           // å·²åˆå§‹åŒ–ï¼Œå¹¶ä¸”må…ƒç´ ä¸ªæ•°å¤§äºé˜ˆå€¼ï¼Œè¿›è¡Œæ‰©å®¹å¤„ç†
           else if (s > threshold)
               resize();
           // å°†mä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ è‡³HashMapä¸­
           for (Map.Entry<? extends K, ? extends V> e : m.entrySet()) {
               K key = e.getKey();
               V value = e.getValue();
               putVal(hash(key), key, value, false, evict);
           }
       }
   }
   ```

   * `float ft = ((float)s / loadFactor) + 1.0F;`è¿™ä¸€è¡Œä»£ç ä¸­ä¸ºä»€ä¹ˆè¦åŠ 1.0F ï¼Ÿ

     s/loadFactorçš„ç»“æœæ˜¯å°æ•°ï¼ŒåŠ 1.0Fä¸(int)ftç›¸å½“äºæ˜¯å¯¹å°æ•°åšä¸€ä¸ªå‘ä¸Šå–æ•´ä»¥å°½å¯èƒ½çš„ä¿è¯æ›´å¤§å®¹é‡ï¼Œæ›´å¤§çš„å®¹é‡èƒ½å¤Ÿå‡å°‘resizeçš„è°ƒç”¨æ¬¡æ•°ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ•°ç»„çš„æ‰©å®¹



***



##### æˆå‘˜å˜é‡

1. åºåˆ—åŒ–ç‰ˆæœ¬å·

   ```java
   private static final long serialVersionUID = 362498820763181265L;
   ```

2. é›†åˆçš„åˆå§‹åŒ–å®¹é‡( **å¿…é¡»æ˜¯äºŒçš„næ¬¡å¹‚** )

   ```java
   //é»˜è®¤çš„åˆå§‹å®¹é‡æ˜¯16 -- 1<<4ç›¸å½“äº1*2çš„4æ¬¡æ–¹---1*16
   static final int DEFAULT_INITIAL_CAPACITY = 1 << 4;   
   ```

   HashMapæ„é€ æ–¹æ³•æŒ‡å®šé›†åˆçš„åˆå§‹åŒ–å®¹é‡å¤§å°ï¼š

   ```java
   HashMap(int initialCapacity)//æ„é€ ä¸€ä¸ªå¸¦æŒ‡å®šåˆå§‹å®¹é‡å’Œé»˜è®¤åŠ è½½å› å­ (0.75) çš„ç©º HashMap
   ```

   * ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯2çš„næ¬¡å¹‚ï¼Ÿ

     å½“å‘HashMapä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œéœ€è¦æ ¹æ®keyçš„hashå€¼ï¼Œå»ç¡®å®šå…¶åœ¨æ•°ç»„ä¸­çš„å…·ä½“ä½ç½®ã€‚HashMapä¸ºäº†å­˜å–é«˜æ•ˆï¼Œè¦å°½é‡è¾ƒå°‘ç¢°æ’ï¼ŒæŠŠæ•°æ®å°½å¯èƒ½åˆ†é…å‡åŒ€ï¼Œæ¯ä¸ªé“¾è¡¨é•¿åº¦å¤§è‡´ç›¸åŒï¼Œå®ç°è¯¥æ–¹æ³•çš„ç®—æ³•å°±æ˜¯å–æ¨¡ï¼Œhash%lengthï¼Œè®¡ç®—æœºä¸­ç›´æ¥æ±‚ä½™æ•ˆç‡ä¸å¦‚ä½ç§»è¿ç®—ï¼Œæ‰€ä»¥æºç ä¸­ä½¿ç”¨ hash&(length-1)ï¼Œå®é™…ä¸Š**hash % length == hash & (length-1)çš„å‰ææ˜¯lengthæ˜¯2çš„næ¬¡å¹‚**

     èƒ½å‡åŒ€åˆ†å¸ƒå‡å°‘ç¢°æ’ï¼š2çš„næ¬¡æ–¹å°±æ˜¯1åé¢nä¸ª0ï¼Œ2çš„næ¬¡æ–¹-1  å®é™…æ˜¯nä¸ª1ï¼Œå¯ä»¥**ä¿è¯æ•£åˆ—çš„å‡åŒ€æ€§**
   

  è¯´æ˜ï¼š**æŒ‰ä½ä¸è¿ç®—ï¼šç›¸åŒçš„äºŒè¿›åˆ¶æ•°ä½ä¸Šï¼Œéƒ½æ˜¯1çš„æ—¶å€™ï¼Œç»“æœä¸º1ï¼Œå¦åˆ™ä¸ºé›¶**
     æ³¨æ„ï¼š å½“ç„¶å¦‚æœä¸è€ƒè™‘æ•ˆç‡ç›´æ¥æ±‚ä½™å³å¯ï¼ˆå°±ä¸éœ€è¦è¦æ±‚é•¿åº¦å¿…é¡»æ˜¯2çš„næ¬¡æ–¹äº†ï¼‰

  ```java
     ä¾‹å¦‚é•¿åº¦ä¸º8æ—¶å€™ï¼Œ3&(8-1)=3  2&(8-1)=2 ï¼Œä¸åŒä½ç½®ä¸Šï¼Œä¸ç¢°æ’ï¼›
     ä¾‹å¦‚é•¿åº¦ä¸º9æ—¶å€™ï¼Œ3&(9-1)=0  2&(9-1)=0 ï¼Œéƒ½åœ¨0ä¸Šï¼Œç¢°æ’äº†ï¼›
     ä¸¾ä¾‹ï¼š  
     é•¿åº¦lengthä¸º8æ—¶å€™ï¼Œ8æ˜¯2çš„3æ¬¡å¹‚ã€‚äºŒè¿›åˆ¶æ˜¯ï¼š1000
     å¦‚ä¸‹æ‰€ç¤ºï¼š
     hash&(length-1)
     3   &(8    - 1)=3  
     	00000011  3 hash
     &   00000111  7 length-1
     ---------------------
     	00000011-----ã€‹3 æ•°ç»„ä¸‹æ ‡
     	
     hash&(length-1)
     2 &  (8 -    1) = 2  
     	00000010  2 hash
     &   00000111  7 length-1
     ---------------------
     	00000010-----ã€‹2  æ•°ç»„ä¸‹æ ‡
     è¯´æ˜ï¼šä¸Šè¿°è®¡ç®—ç»“æœæ˜¯ä¸åŒä½ç½®ä¸Šï¼Œä¸ç¢°æ’ï¼›
  ```

* å¦‚æœè¾“å…¥å€¼ä¸æ˜¯2çš„å¹‚ä¼šæ€ä¹ˆæ ·ï¼Ÿ
  
  åˆ›å»ºHashMapå¯¹è±¡æ—¶ï¼Œè¾“å…¥çš„æ•°ç»„é•¿åº¦æ˜¯10ï¼Œä¸æ˜¯2çš„å¹‚ï¼ŒHashMapé€šè¿‡ä½ç§»è¿ç®—å’Œæˆ–è¿ç®—å¾—åˆ°çš„è‚¯å®šæ˜¯2çš„å¹‚æ¬¡æ•°ï¼Œå¹¶ä¸”æ˜¯ç¦»é‚£ä¸ªæ•°æœ€è¿‘çš„æ•°å­—ã€‚
  
  ```java
     /**
     * Returns a power of two size for the given target capacity.
      è¿”å›æ¯”æŒ‡å®šåˆå§‹åŒ–å®¹é‡å¤§çš„æœ€å°çš„2çš„næ¬¡å¹‚
      */
     static final int tableSizeFor(int cap) {//int cap = 10
         int n = cap - 1;
         n |= n >>> 1;
         n |= n >>> 2;
         n |= n >>> 4;
         n |= n >>> 8;
         n |= n >>> 16;
         return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
     }
  ```
  
  åˆ†æç®—æ³•ï¼š
  
  1. `int n = cap - 1;`
        é˜²æ­¢capå·²ç»æ˜¯2çš„å¹‚ã€‚å¦‚æœcapå·²ç»æ˜¯2çš„å¹‚ï¼Œ ä¸æ‰§è¡Œå‡1æ“ä½œï¼Œåˆ™æ‰§è¡Œå®Œåé¢çš„æ— ç¬¦å·å³ç§»æ“ä½œä¹‹åï¼Œè¿”å›çš„capacityå°†æ˜¯è¿™ä¸ªcapçš„2å€
     2. n=0æ—¶ï¼ˆç»è¿‡äº†cap-1ä¹‹åï¼‰ï¼Œåˆ™ç»è¿‡åé¢çš„å‡ æ¬¡æ— ç¬¦å·å³ç§»ä¾ç„¶æ˜¯0ï¼Œæœ€åè¿”å›çš„capacityæ˜¯1ï¼Œæœ€åæœ‰n+1
     3. **|ï¼ˆæŒ‰ä½æˆ–è¿ç®—ï¼‰ï¼šç›¸åŒçš„äºŒè¿›åˆ¶æ•°ä½ä¸Šï¼Œéƒ½æ˜¯0çš„æ—¶å€™ï¼Œç»“æœä¸º0ï¼Œå¦åˆ™ä¸º1**
  
  * ç¬¬ä¸€æ¬¡å³ç§»
  
    ```java
       int n = cap - 1;//cap=10  n=9
       n |= n >>> 1;
       	00000000 00000000 00000000 00001001 //9
       	00000000 00000000 00000000 00000100 //9å³ç§»ä¹‹åå˜ä¸º4
       --------------------------------------------------
          	00000000 00000000 00000000 00001101 //æŒ‰ä½æˆ–ä¹‹åæ˜¯13
       	//ä½¿å¾—nçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ä¸æœ€é«˜ä½çš„1ç´§é‚»çš„å³è¾¹ä¸€ä½ä¸º1
    ```
  
  *  ç¬¬äºŒæ¬¡å³ç§»
  
    ```java
        n |= n >>> 2;//né€šè¿‡ç¬¬ä¸€æ¬¡å³ç§»å˜ä¸ºäº†ï¼šn=13
       	00000000 00000000 00000000 00001101  // 13
           00000000 00000000 00000000 00000011  //13å³ç§»ä¹‹åå˜ä¸º3
       -------------------------------------------------
         	00000000 00000000 00000000 00001111	 //æŒ‰ä½æˆ–ä¹‹åæ˜¯15
       //æ— ç¬¦å·å³ç§»ä¸¤ä½ï¼Œä¼šå°†æœ€é«˜ä½ä¸¤ä¸ªè¿ç»­çš„1å³ç§»ä¸¤ä½ï¼Œç„¶åå†ä¸åŸæ¥çš„nåšæˆ–æ“ä½œï¼Œè¿™æ ·nçš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„é«˜ä½ä¸­ä¼šæœ‰4ä¸ªè¿ç»­çš„1
    ```
  
  * ç¬¬ä¸‰æ¬¡å³ç§»
  
    ```java
       n |= n >>> 4;//né€šè¿‡ç¬¬ä¸€ã€äºŒæ¬¡å³ç§»å˜ä¸ºäº†ï¼šn=15
       	00000000 00000000 00000000 00001111  // 15
           00000000 00000000 00000000 00000000  //15å³ç§»ä¹‹åå˜ä¸º0
       ----------------------------------------
           00000000 00000000 00000000 00001111  //æŒ‰å¼‚æˆ–ä¹‹åæ˜¯15
       	//é«˜ä½ä¸­çš„è¿ç»­çš„4ä¸ª1ï¼Œå³ç§»4ä½ï¼Œå†åšæˆ–æ“ä½œï¼Œè¿™æ ·nçš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„é«˜ä½ä¸­ä¼šæœ‰8ä¸ªè¿ç»­çš„1
    ```
  
    æ³¨æ„ï¼šå®¹é‡æœ€å¤§æ˜¯32bitçš„æ­£æ•°ï¼Œå› æ­¤æœ€ån |= n >>> 16ï¼Œæœ€å¤šä¹Ÿå°±32ä¸ª1ï¼ˆä½†æ˜¯è¿™å·²ç»æ˜¯è´Ÿæ•°äº†ï¼‰ã€‚åœ¨æ‰§è¡ŒtableSizeForä¹‹å‰ï¼Œå¯¹initialCapacityåšäº†åˆ¤æ–­ï¼Œå¦‚æœå¤§äºMAXIMUM_CAPACITY(2 ^ 30)ï¼Œåˆ™å–MAXIMUM_CAPACITYï¼›å¦‚æœå°äºMAXIMUM_CAPACITY(2 ^ 30)ï¼Œä¼šæ‰§è¡Œç§»ä½æ“ä½œã€‚æ‰€ä»¥ç§»ä½æ“ä½œä¹‹åï¼Œæœ€å¤§30ä¸ª1ï¼ŒåŠ 1ä¹‹åå¾—2 ^ 30
  
  * å¾—åˆ°çš„capacityå´è¢«èµ‹å€¼ç»™äº†threshold
  
    ```java
       this.threshold = tableSizeFor(initialCapacity);//initialCapacity=10
    ```
  
3. é»˜è®¤çš„è´Ÿè½½å› å­ï¼Œé»˜è®¤å€¼æ˜¯0.75 

    ```java
    static final float DEFAULT_LOAD_FACTOR = 0.75f;
    ```

4. é›†åˆæœ€å¤§å®¹é‡ 

    ```java
    //é›†åˆæœ€å¤§å®¹é‡çš„ä¸Šé™æ˜¯ï¼š2çš„30æ¬¡å¹‚
    static final int MAXIMUM_CAPACITY = 1 << 30;
    ```

5. å½“é“¾è¡¨çš„å€¼è¶…è¿‡8åˆ™ä¼šè½¬çº¢é»‘æ ‘(**1.8æ–°å¢**)

    ```java
     //å½“æ¡¶(bucket)ä¸Šçš„ç»“ç‚¹æ•°å¤§äºè¿™ä¸ªå€¼æ—¶ä¼šè½¬æˆçº¢é»‘æ ‘
     static final int TREEIFY_THRESHOLD = 8;
    ```

    * ä¸ºä»€ä¹ˆMapæ¡¶ä¸­èŠ‚ç‚¹ä¸ªæ•°å¤§äº8æ‰è½¬ä¸ºçº¢é»‘æ ‘ï¼Ÿ

      åœ¨HashMapä¸­æœ‰ä¸€æ®µæ³¨é‡Šè¯´æ˜ï¼š**ç©ºé—´å’Œæ—¶é—´çš„æƒè¡¡**

      ```java
      TreeNodeså ç”¨ç©ºé—´å¤§çº¦æ˜¯æ™®é€šèŠ‚ç‚¹çš„ä¸¤å€ï¼Œæ‰€ä»¥æˆ‘ä»¬åªåœ¨ç®±å­åŒ…å«è¶³å¤Ÿçš„èŠ‚ç‚¹æ—¶æ‰ä½¿ç”¨æ ‘èŠ‚ç‚¹ã€‚å½“èŠ‚ç‚¹å˜å°‘(ç”±äºåˆ é™¤æˆ–è°ƒæ•´å¤§å°)æ—¶ï¼Œå°±ä¼šè¢«è½¬æ¢å›æ™®é€šçš„æ¡¶ã€‚åœ¨ä½¿ç”¨åˆ†å¸ƒè‰¯å¥½çš„ç”¨æˆ·hashcodeæ—¶ï¼Œå¾ˆå°‘ä½¿ç”¨æ ‘ç®±ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œåœ¨éšæœºå“ˆå¸Œç ä¸‹ï¼Œç®±å­ä¸­èŠ‚ç‚¹çš„é¢‘ç‡æœä»æ³Šæ¾åˆ†å¸ƒï¼Œé»˜è®¤è°ƒæ•´é˜ˆå€¼ä¸º0.75ï¼Œå¹³å‡å‚æ•°çº¦ä¸º0.5ï¼Œå°½ç®¡ç”±äºè°ƒæ•´ç²’åº¦çš„å·®å¼‚å¾ˆå¤§ã€‚å¿½ç•¥æ–¹å·®ï¼Œåˆ—è¡¨å¤§å°kçš„é¢„æœŸå‡ºç°æ¬¡æ•°æ˜¯(exp(-0.5)*pow(0.5, k)/factorial(k))
      0:    0.60653066
      1:    0.30326533
      2:    0.07581633
      3:    0.01263606
      4:    0.00157952
      5:    0.00015795
      6:    0.00001316
      7:    0.00000094
      8:    0.00000006
      more: less than 1 in ten million
          
      å½“hashCodeç¦»æ•£æ€§å¾ˆå¥½çš„æ—¶å€™ï¼Œæ ‘å‹binç”¨åˆ°çš„æ¦‚ç‡éå¸¸å°ï¼Œå› ä¸ºæ•°æ®å‡åŒ€åˆ†å¸ƒåœ¨æ¯ä¸ªbinä¸­ï¼Œå‡ ä¹ä¸ä¼šæœ‰binä¸­é“¾è¡¨é•¿åº¦ä¼šè¾¾åˆ°é˜ˆå€¼ã€‚ä½†æ˜¯åœ¨éšæœºhashCodeä¸‹ï¼Œç¦»æ•£æ€§å¯èƒ½ä¼šå˜å·®ï¼Œç„¶è€ŒJDKåˆä¸èƒ½é˜»æ­¢ç”¨æˆ·å®ç°è¿™ç§ä¸å¥½çš„hashç®—æ³•ï¼Œå› æ­¤å°±å¯èƒ½å¯¼è‡´ä¸å‡åŒ€çš„æ•°æ®åˆ†å¸ƒã€‚ä¸è¿‡ç†æƒ³æƒ…å†µä¸‹éšæœºhashCodeç®—æ³•ä¸‹æ‰€æœ‰binä¸­èŠ‚ç‚¹çš„åˆ†å¸ƒé¢‘ç‡ä¼šéµå¾ªæ³Šæ¾åˆ†å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªbinä¸­é“¾è¡¨é•¿åº¦è¾¾åˆ°8ä¸ªå…ƒç´ çš„æ¦‚ç‡ä¸º0.00000006ï¼Œå‡ ä¹æ˜¯ä¸å¯èƒ½äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©8è¿™ä¸ªæ•°å­—
      ```

    * å…¶ä»–è¯´æ³•
      çº¢é»‘æ ‘çš„å¹³å‡æŸ¥æ‰¾é•¿åº¦æ˜¯log(n)ï¼Œå¦‚æœé•¿åº¦ä¸º8ï¼Œå¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸ºlog(8)=3ï¼Œé“¾è¡¨çš„å¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸ºn/2ï¼Œå½“é•¿åº¦ä¸º8æ—¶ï¼Œå¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸º8/2=4ï¼Œè¿™æ‰æœ‰è½¬æ¢æˆæ ‘çš„å¿…è¦ï¼›é“¾è¡¨é•¿åº¦å¦‚æœæ˜¯å°äºç­‰äº6ï¼Œ6/2=3ï¼Œè€Œlog(6)=2.6ï¼Œè™½ç„¶é€Ÿåº¦ä¹Ÿå¾ˆå¿«çš„ï¼Œä½†è½¬åŒ–ä¸ºæ ‘ç»“æ„å’Œç”Ÿæˆæ ‘çš„æ—¶é—´å¹¶ä¸çŸ­

6. å½“é“¾è¡¨çš„å€¼å°äº6åˆ™ä¼šä»çº¢é»‘æ ‘è½¬å›é“¾è¡¨

    ```java
    //å½“æ¡¶(bucket)ä¸Šçš„ç»“ç‚¹æ•°å°äºè¿™ä¸ªå€¼æ—¶æ ‘è½¬é“¾è¡¨
    static final int UNTREEIFY_THRESHOLD = 6;
    ```

7. å½“Mapé‡Œé¢çš„æ•°é‡**å¤§äºç­‰äº**è¿™ä¸ªé˜ˆå€¼æ—¶ï¼Œè¡¨ä¸­çš„æ¡¶æ‰èƒ½è¿›è¡Œæ ‘å½¢åŒ– ï¼Œå¦åˆ™æ¡¶å†…å…ƒç´ å¤ªå¤šæ—¶ä¼šæ‰©å®¹ï¼Œè€Œä¸æ˜¯æ ‘å½¢åŒ–ã€‚ä¸ºäº†é¿å…è¿›è¡Œæ‰©å®¹ã€æ ‘å½¢åŒ–é€‰æ‹©çš„å†²çªï¼Œè¿™ä¸ªå€¼ä¸èƒ½å°äº 4 * TREEIFY_THRESHOLD (8)

    ```java
    //æ¡¶ä¸­ç»“æ„è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹åº”çš„æ•°ç»„é•¿åº¦æœ€å°çš„å€¼ 
    static final int MIN_TREEIFY_CAPACITY = 64;
    ```

8. **tableç”¨æ¥åˆå§‹åŒ–(å¿…é¡»æ˜¯äºŒçš„næ¬¡å¹‚)(é‡ç‚¹)**

    ```java
    //å­˜å‚¨å…ƒç´ çš„æ•°ç»„ 
    transient Node<K,V>[] table;
    ```

    jdk8ä¹‹å‰æ•°ç»„ç±»å‹æ˜¯Entry<K,V>ç±»å‹ã€‚ä»jdk1.8ä¹‹åæ˜¯Node<K,V>ç±»å‹ã€‚åªæ˜¯æ¢äº†ä¸ªåå­—ï¼Œéƒ½å®ç°äº†ä¸€æ ·çš„æ¥å£ï¼šMap.Entry<K,V>ï¼Œè´Ÿè´£å­˜å‚¨é”®å€¼å¯¹æ•°æ®çš„

 9. å­˜æ”¾ç¼“å­˜ 

    ```java
    //å­˜æ”¾å…·ä½“å…ƒç´ çš„é›†åˆ
    transient Set<Map.Entry<K,V>> entrySet;
    ```

 10. HashMapä¸­å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°(**é‡ç‚¹**)

```java
//å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼ŒHashMapä¸­K-Vçš„å®æ—¶æ•°é‡ï¼Œä¸æ˜¯tableæ•°ç»„çš„é•¿åº¦ã€‚
transient int size;
```

11. è®°å½•HashMapçš„ä¿®æ”¹æ¬¡æ•° 

       ```java
      //æ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹mapç»“æ„çš„è®¡æ•°å™¨
      transient int modCount;  
       ```

12. è°ƒæ•´å¤§å°ä¸‹ä¸€ä¸ªå®¹é‡çš„å€¼è®¡ç®—æ–¹å¼ä¸º(å®¹é‡*è´Ÿè½½å› å­) 

       ```java
      //ä¸´ç•Œå€¼,å½“å®é™…å¤§å°(å®¹é‡*è´Ÿè½½å› å­)è¶…è¿‡ä¸´ç•Œå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹
      int threshold;
       ```

13. **å“ˆå¸Œè¡¨çš„åŠ è½½å› å­(é‡ç‚¹)**

      ```java
      // åŠ è½½å› å­
      final float loadFactor;
      ```

      * åŠ è½½å› å­çš„æ¦‚è¿°

        loadFactoråŠ è½½å› å­ï¼Œæ˜¯ç”¨æ¥è¡¡é‡ HashMap æ»¡çš„ç¨‹åº¦ï¼Œè¡¨ç¤º**HashMapçš„ç–å¯†ç¨‹åº¦**ï¼Œå½±å“hashæ“ä½œåˆ°åŒä¸€ä¸ªæ•°ç»„ä½ç½®çš„æ¦‚ç‡ï¼Œè®¡ç®—HashMapçš„å®æ—¶åŠ è½½å› å­çš„æ–¹æ³•ä¸ºï¼šsize/capacityï¼Œè€Œä¸æ˜¯å ç”¨æ¡¶çš„æ•°é‡å»é™¤ä»¥capacityï¼Œcapacity æ˜¯æ¡¶çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯ table çš„é•¿åº¦lengthã€‚

        å½“HashMapé‡Œé¢å®¹çº³çš„å…ƒç´ å·²ç»è¾¾åˆ°HashMapæ•°ç»„é•¿åº¦çš„75%æ—¶ï¼Œè¡¨ç¤ºHashMapæ‹¥æŒ¤ï¼Œéœ€è¦æ‰©å®¹ï¼Œè€Œæ‰©å®¹è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° rehashã€å¤åˆ¶æ•°æ®ç­‰æ“ä½œï¼Œéå¸¸æ¶ˆè€—æ€§èƒ½ï¼Œæ‰€ä»¥å¼€å‘ä¸­å°½é‡å‡å°‘æ‰©å®¹çš„æ¬¡æ•°ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºHashMapé›†åˆå¯¹è±¡æ—¶æŒ‡å®šåˆå§‹å®¹é‡æ¥å°½é‡é¿å…ã€‚

        ```java
        HashMap(int initialCapacity, float loadFactor)//æ„é€ æŒ‡å®šåˆå§‹å®¹é‡å’ŒåŠ è½½å› å­çš„ç©ºHashMap
        ```

      * ä¸ºä»€ä¹ˆåŠ è½½å› å­è®¾ç½®ä¸º0.75ï¼Œåˆå§‹åŒ–ä¸´ç•Œå€¼æ˜¯12ï¼Ÿ

        loadFactorå¤ªå¤§å¯¼è‡´æŸ¥æ‰¾å…ƒç´ æ•ˆç‡ä½ï¼Œå­˜æ”¾çš„æ•°æ®æ‹¥æŒ¤ï¼Œå¤ªå°å¯¼è‡´æ•°ç»„çš„åˆ©ç”¨ç‡ä½ï¼Œå­˜æ”¾çš„æ•°æ®ä¼šå¾ˆåˆ†æ•£ã€‚loadFactorçš„é»˜è®¤å€¼ä¸º**0.75fæ˜¯å®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¸´ç•Œå€¼**ã€‚

      * **threshold**è®¡ç®—å…¬å¼ï¼šcapacity(æ•°ç»„é•¿åº¦é»˜è®¤16) * loadFactor(è´Ÿè½½å› å­é»˜è®¤0.75)ã€‚è¿™ä¸ªå€¼æ˜¯å½“å‰å·²å ç”¨æ•°ç»„é•¿åº¦çš„æœ€å¤§å€¼ã€‚**å½“Size>=threshold**çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±è¦è€ƒè™‘å¯¹æ•°ç»„çš„resize(æ‰©å®¹)ï¼Œè¿™å°±æ˜¯ **è¡¡é‡æ•°ç»„æ˜¯å¦éœ€è¦æ‰©å¢çš„ä¸€ä¸ªæ ‡å‡†**ï¼Œ æ‰©å®¹åçš„ HashMap å®¹é‡æ˜¯ä¹‹å‰å®¹é‡çš„**ä¸¤å€**.



***



##### æˆå‘˜æ–¹æ³•

1. put

   ç¬¬ä¸€æ¬¡è°ƒç”¨putæ–¹æ³•æ—¶åˆ›å»ºæ•°ç»„Node[] tableï¼Œæ•£åˆ—è¡¨è€—è´¹å†…å­˜ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜æµªè´¹ï¼Œæ‰€ä»¥**å»¶è¿Ÿåˆå§‹åŒ–**

   å­˜å‚¨æ•°æ®æ­¥éª¤ï¼ˆå­˜å‚¨è¿‡ç¨‹ï¼‰ï¼š

   1. å…ˆé€šè¿‡hashå€¼è®¡ç®—å‡ºkeyæ˜ å°„åˆ°å“ªä¸ªæ¡¶

   2. å¦‚æœæ¡¶ä¸Šæ²¡æœ‰ç¢°æ’å†²çªï¼Œåˆ™ç›´æ¥æ’å…¥

   3. å¦‚æœå‡ºç°ç¢°æ’å†²çªäº†ï¼Œåˆ™éœ€è¦å¤„ç†å†²çªï¼šå¦‚æœè¯¥æ¡¶ä½¿ç”¨çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ’å…¥æ•°æ®ï¼›å¦åˆ™é‡‡ç”¨ä¼ ç»Ÿçš„é“¾å¼æ–¹æ³•æ’å…¥ï¼Œå¦‚æœé“¾çš„é•¿åº¦è¾¾åˆ°ä¸´ç•Œå€¼ï¼Œåˆ™æŠŠé“¾è½¬å˜ä¸ºçº¢é»‘æ ‘

   4. å¦‚æœæ¡¶ä¸­å­˜åœ¨é‡å¤çš„é”®ï¼Œåˆ™ä¸ºè¯¥é”®æ›¿æ¢æ–°å€¼value
   5. å¦‚æœsizeå¤§äºé˜ˆå€¼thresholdï¼Œåˆ™è¿›è¡Œæ‰©å®¹

   ```java
   public V put(K key, V value) {
       return putVal(hash(key), key, value, false, true);
   }
   ```

   putVal()æ–¹æ³•ä¸­keyåœ¨è¿™é‡Œæ‰§è¡Œäº†ä¸€ä¸‹hash()ï¼š	
       &ï¼ˆæŒ‰ä½ä¸è¿ç®—ï¼‰ï¼šç›¸åŒçš„äºŒè¿›åˆ¶æ•°ä½ä¸Šï¼Œéƒ½æ˜¯1çš„æ—¶å€™ï¼Œç»“æœä¸º1ï¼Œå¦åˆ™ä¸ºé›¶ã€‚
   	^ï¼ˆæŒ‰ä½å¼‚æˆ–è¿ç®—ï¼‰ï¼šç›¸åŒçš„äºŒè¿›åˆ¶æ•°ä½ä¸Šï¼Œæ•°å­—ç›¸åŒï¼Œç»“æœä¸º0ï¼Œä¸åŒä¸º1ã€‚

   * **æ³¨æ„**ï¼šHashMapæ˜¯æ”¯æŒKeyä¸ºç©ºçš„ï¼›HashTableæ˜¯ç›´æ¥ç”¨Keyæ¥è·å–HashCodeï¼Œkeyä¸ºç©ºä¼šæŠ›å¼‚å¸¸

   ```java
   static final int hash(Object key) {
       int h;
       // 1ï¼‰å¦‚æœkeyç­‰äºnullï¼šå¯ä»¥çœ‹åˆ°å½“keyç­‰äºnullçš„æ—¶å€™ä¹Ÿæ˜¯æœ‰å“ˆå¸Œå€¼çš„ï¼Œè¿”å›çš„æ˜¯0.
       // 2ï¼‰å¦‚æœkeyä¸ç­‰äºnullï¼šé¦–å…ˆè®¡ç®—å‡ºkeyçš„hashCodeèµ‹å€¼ç»™h,ç„¶åä¸hæ— ç¬¦å·å³ç§»16ä½åçš„äºŒè¿›åˆ¶è¿›è¡ŒæŒ‰ä½å¼‚æˆ–å¾—åˆ°æœ€åçš„hashå€¼
       return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
   }
   ```

   åœ¨putValå‡½æ•°ä¸­ä½¿ç”¨åˆ°äº†ä¸Šè¿°hashå‡½æ•°è®¡ç®—çš„å“ˆå¸Œå€¼ï¼š

   ```java
   final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) {
   	//ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
   	if ((p = tab[i = (n - 1) & hash]) == null)//è¿™é‡Œçš„nè¡¨ç¤ºæ•°ç»„é•¿åº¦16
   	//ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
   }
   ```

   ![](https://gitee.com/seazean/images/raw/master/JavaSE/HashMap-putValå“ˆå¸Œè¿ç®—.png)

   æ€»ç»“ï¼š hashcode è½¬åŒ–ä¸º32ä½äºŒè¿›åˆ¶ï¼Œé«˜16 bitå’Œä½16 bitåšäº†ä¸€ä¸ªå¼‚æˆ–

   * **ä¸ºä»€ä¹ˆè¿™æ ·æ“ä½œï¼Ÿ**

     å¦‚æœå½“nå³æ•°ç»„é•¿åº¦å¾ˆå°ï¼Œå‡è®¾æ˜¯16ï¼Œé‚£ä¹ˆn-1å³ä¸º  --> 1111 ï¼Œè¿™æ ·çš„å€¼å’ŒhashCode()ç›´æ¥åšæŒ‰ä½ä¸æ“ä½œï¼Œå®é™…ä¸Šåªä½¿ç”¨äº†å“ˆå¸Œå€¼çš„å4ä½ã€‚å¦‚æœå½“å“ˆå¸Œå€¼çš„é«˜ä½å˜åŒ–å¾ˆå¤§ï¼Œä½ä½å˜åŒ–å¾ˆå°ï¼Œå°±å¾ˆå®¹æ˜“é€ æˆå“ˆå¸Œå†²çªäº†ï¼Œæ‰€ä»¥è¿™é‡Œ**æŠŠé«˜ä½ä½éƒ½åˆ©ç”¨èµ·æ¥ï¼Œè®©é«˜16ä½ä¹Ÿå‚ä¸è¿ç®—**ï¼Œä»è€Œè§£å†³äº†è¿™ä¸ªé—®é¢˜

   * **ä½™æ•°æœ¬è´¨æ˜¯ä¸æ–­åšé™¤æ³•ï¼ŒæŠŠå‰©ä½™çš„æ•°å‡å»ï¼Œè¿ç®—æ•ˆç‡è¦æ¯”ä½è¿ç®—ä½**

2. treeifyBin

   èŠ‚ç‚¹æ·»åŠ å®Œæˆä¹‹ååˆ¤æ–­æ­¤æ—¶èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¦å¤§äºTREEIFY_THRESHOLDä¸´ç•Œå€¼8ï¼Œå¦‚æœå¤§äºç­‰äºåˆ™å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œè½¬æ¢çº¢é»‘æ ‘çš„æ–¹æ³•  treeifyBinï¼Œæ•´ä½“ä»£ç å¦‚ä¸‹ï¼š

   ```java
   if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
      //è½¬æ¢ä¸ºçº¢é»‘æ ‘ tabè¡¨ç¤ºæ•°ç»„å  hashè¡¨ç¤ºå“ˆå¸Œå€¼
      treeifyBin(tab, hash);
   ```

   1. å¦‚æœå½“å‰æ•°ç»„ä¸ºç©ºæˆ–è€…æ•°ç»„çš„é•¿åº¦å°äºè¿›è¡Œæ ‘å½¢åŒ–çš„é˜ˆå€¼(MIN_TREEIFY_CAPACITY = 64)ï¼Œå°±å»æ‰©å®¹ã€‚è€Œä¸æ˜¯å°†èŠ‚ç‚¹å˜ä¸ºçº¢é»‘æ ‘
   2. å¦‚æœæ˜¯æ ‘å½¢åŒ–éå†æ¡¶ä¸­çš„å…ƒç´ ï¼Œåˆ›å»ºç›¸åŒä¸ªæ•°çš„æ ‘å½¢èŠ‚ç‚¹ï¼Œå¤åˆ¶å†…å®¹ï¼Œå»ºç«‹èµ·è”ç³»ã€‚ç±»ä¼¼å•å‘é“¾è¡¨è½¬æ¢ä¸ºåŒå‘é“¾è¡¨
   3. è®©æ¡¶ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å³æ•°ç»„ä¸­çš„å…ƒç´ æŒ‡å‘æ–°å»ºçš„çº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼Œä»¥åè¿™ä¸ªæ¡¶é‡Œçš„å…ƒç´ å°±æ˜¯çº¢é»‘æ ‘è€Œä¸æ˜¯é“¾è¡¨æ•°æ®ç»“æ„äº†

3. resize

   å½“HashMapä¸­çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡æ•°ç»„å¤§å°(æ•°ç»„é•¿åº¦)*loadFactor(è´Ÿè½½å› å­)æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ•°ç»„æ‰©å®¹ã€‚è¿›è¡Œæ‰©å®¹ï¼Œä¼šä¼´éšç€ä¸€æ¬¡é‡æ–°hashåˆ†é…ï¼Œå¹¶ä¸”ä¼šéå†hashè¡¨ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œæ˜¯éå¸¸è€—æ—¶çš„ï¼Œæ‰€ä»¥è¦å°½é‡é¿å…resize

   HashMapåœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œä½¿ç”¨çš„rehashæ–¹å¼éå¸¸å·§å¦™ï¼Œå› ä¸ºæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ç¿»å€ï¼Œä¸åŸæ¥è®¡ç®—çš„ (n-1)&hashçš„ç»“æœç›¸æ¯”ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªbitä½ï¼ŒèŠ‚ç‚¹**è¦ä¹ˆå°±åœ¨åŸæ¥çš„ä½ç½®ï¼Œè¦ä¹ˆå°±è¢«åˆ†é…åˆ°"åŸä½ç½®+æ—§å®¹é‡"çš„ä½ç½®**
   
   æ³¨æ„ï¼šè¿™é‡Œä¹Ÿè¦æ±‚**æ•°ç»„é•¿åº¦2çš„å¹‚**

![](https://gitee.com/seazean/images/raw/master/JavaSE/HashMap-resizeæ‰©å®¹.png)

4. remove
   åˆ é™¤æ˜¯é¦–å…ˆå…ˆæ‰¾åˆ°å…ƒç´ çš„ä½ç½®ï¼Œå¦‚æœæ˜¯é“¾è¡¨å°±éå†é“¾è¡¨æ‰¾åˆ°å…ƒç´ ä¹‹ååˆ é™¤ã€‚å¦‚æœæ˜¯ç”¨çº¢é»‘æ ‘å°±éå†æ ‘ç„¶åæ‰¾åˆ°ä¹‹ååšåˆ é™¤ï¼Œæ ‘å°äº6çš„æ—¶å€™è¦è½¬é“¾è¡¨

5. get

   1. é€šè¿‡hashå€¼è·å–è¯¥keyæ˜ å°„åˆ°çš„æ¡¶
   2. æ¡¶ä¸Šçš„keyå°±æ˜¯è¦æŸ¥æ‰¾çš„keyï¼Œåˆ™ç›´æ¥æ‰¾åˆ°å¹¶è¿”å›
   3. æ¡¶ä¸Šçš„keyä¸æ˜¯è¦æ‰¾çš„keyï¼Œåˆ™æŸ¥çœ‹åç»­çš„èŠ‚ç‚¹ï¼š

      * å¦‚æœåç»­èŠ‚ç‚¹æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œé€šè¿‡è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ ¹æ®keyè·å–value

      * å¦‚æœåç»­èŠ‚ç‚¹æ˜¯é“¾è¡¨èŠ‚ç‚¹ï¼Œåˆ™é€šè¿‡å¾ªç¯éå†é“¾è¡¨æ ¹æ®keyè·å–value 

   4. çº¢é»‘æ ‘èŠ‚ç‚¹è°ƒç”¨çš„æ˜¯getTreeNodeæ–¹æ³•é€šè¿‡æ ‘å½¢èŠ‚ç‚¹çš„findæ–¹æ³•è¿›è¡ŒæŸ¥

      * æŸ¥æ‰¾çº¢é»‘æ ‘ï¼Œç”±äºä¹‹å‰æ·»åŠ æ—¶å·²ç»ä¿è¯è¿™ä¸ªæ ‘æ˜¯æœ‰åºçš„äº†ï¼Œå› æ­¤æŸ¥æ‰¾æ—¶åŸºæœ¬å°±æ˜¯æŠ˜åŠæŸ¥æ‰¾ï¼Œæ•ˆç‡æ›´é«˜ã€‚
      * è¿™é‡Œå’Œæ’å…¥æ—¶ä¸€æ ·ï¼Œå¦‚æœå¯¹æ¯”èŠ‚ç‚¹çš„å“ˆå¸Œå€¼å’Œè¦æŸ¥æ‰¾çš„å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œå°±ä¼šåˆ¤æ–­keyæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰å°±ç›´æ¥è¿”å›ï¼Œä¸ç›¸ç­‰å°±ä»å­æ ‘ä¸­é€’å½’æŸ¥æ‰¾

   5. è‹¥ä¸ºæ ‘ï¼Œåˆ™åœ¨æ ‘ä¸­é€šè¿‡key.equals(k)æŸ¥æ‰¾ï¼Œ**O(logn)** 

      è‹¥ä¸ºé“¾è¡¨ï¼Œåˆ™åœ¨é“¾è¡¨ä¸­é€šè¿‡key.equals(k)æŸ¥æ‰¾ï¼Œ**O(n)**



***



#### LinkedMap

LinkedHashMapæ˜¯HashMapçš„å­ç±»ï¼Œæ·»åŠ çš„å…ƒç´ æŒ‰ç…§é”®æœ‰åºï¼Œä¸é‡å¤çš„

HashSeté›†åˆç›¸å½“äºæ˜¯HashMapé›†åˆçš„é”®ï¼Œä¸å¸¦å€¼
LinkedHashSeté›†åˆç›¸å½“äºæ˜¯LinkedHashMapé›†åˆçš„é”®ï¼Œä¸å¸¦å€¼

> åº•å±‚åŸç†å®Œå…¨ä¸€æ ·ï¼Œéƒ½æ˜¯åŸºäºå“ˆå¸Œè¡¨æŒ‰ç…§é”®å­˜å‚¨æ•°æ®çš„ï¼Œ
> åªæ˜¯HashMapæˆ–è€…LinkedHashMapçš„é”®éƒ½å¤šä¸€ä¸ªé™„å±å€¼



***



#### TreeMap

TreeMapé›†åˆæŒ‰ç…§é”®æ˜¯å¯æ’åºä¸é‡å¤çš„é”®å€¼å¯¹é›†åˆã€‚(é»˜è®¤å‡åº)
TreeMapé›†åˆå’ŒTreeSeté›†åˆéƒ½æ˜¯æ’åºä¸é‡å¤é›†åˆ
TreeSeté›†åˆçš„åº•å±‚æ˜¯åŸºäºTreeMapï¼Œåªæ˜¯é”®æ²¡æœ‰é™„å±å€¼è€Œå·²

TreeMapé›†åˆæŒ‡å®šå¤§å°è§„åˆ™æœ‰2ç§æ–¹å¼ï¼š
     a.ç›´æ¥ä¸ºå¯¹è±¡çš„ç±»å®ç°æ¯”è¾ƒå™¨è§„åˆ™æ¥å£Comparableï¼Œé‡å†™æ¯”è¾ƒæ–¹æ³•ï¼ˆæ‹“å±•æ–¹å¼ï¼‰
     b.ç›´æ¥ä¸ºé›†åˆè®¾ç½®æ¯”è¾ƒå™¨Comparatorå¯¹è±¡,é‡å†™æ¯”è¾ƒæ–¹æ³•



***



#### é¢è¯•é¢˜

è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ã€‚

```java
/*
    ï¼ˆ1ï¼‰é”®ç›˜å½•å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚aabbccddaa123ã€‚
    ï¼ˆ2ï¼‰å®šä¹‰ä¸€ä¸ªMapé›†åˆï¼Œé”®æ˜¯æ¯ä¸ªå­—ç¬¦ï¼Œå€¼æ˜¯å…¶å‡ºç°çš„æ¬¡æ•°ã€‚ {a=4 , b=2 ,...}
    ï¼ˆ3ï¼‰éå†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ã€‚
    ï¼ˆ4ï¼‰æ‹¿ç€è¿™ä¸ªå­—ç¬¦å»Mapé›†åˆä¸­çœ‹æ˜¯å¦æœ‰è¿™ä¸ªå­—ç¬¦é”®ï¼Œæœ‰è¯´æ˜ä¹‹å‰ç»Ÿè®¡è¿‡ï¼Œå…¶å€¼+1
         æ²¡æœ‰è¿™ä¸ªå­—ç¬¦é”®ï¼Œè¯´æ˜è¯¥å­—ç¬¦æ˜¯ç¬¬ä¸€æ¬¡ç»Ÿè®¡ï¼Œç›´æ¥å­˜å…¥â€œè¯¥å­—ç¬¦=1â€
*/
public class MapDemo{
    public static void main(String[] args){
        String s = "aabbccddaa123";
        Map<Character, Integer> infos = new HashMap<>();
        for (int i = 0; i < s.length(); i++){
            char ch = datas.charAt(i);
            if(infos.containsKey(ch)){
                infos.put(ch,infos.get(ch) + 1);
            } else {
                infos.put(ch,1);
            }
        }
        System.out.println("ç»“æœï¼š"+infos);
    }
}
```



***



### æ³›å‹

#### æ¦‚è¿°

æ³›å‹ï¼ˆGenericï¼‰ï¼š
    æ³›å‹å°±æ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼š<æ•°æ®ç±»å‹>
    æ³›å‹å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µçº¦æŸåªèƒ½æ“ä½œæŸç§æ•°æ®ç±»å‹ã€‚

æ³¨æ„ï¼š JDK 1.7å¼€å§‹ä¹‹åï¼Œæ³›å‹åé¢çš„ç”³æ˜å¯ä»¥çœç•¥ä¸å†™!!
    		**æ³›å‹å’Œé›†åˆéƒ½åªèƒ½æ”¯æŒå¼•ç”¨æ•°æ®ç±»å‹ï¼Œä¸æ”¯æŒåŸºæœ¬æ•°æ®ç±»å‹ã€‚**

```java
{
    ArrayList<Object> lists = new ArrayList<>(); 
    lists.add(99.9);
    lists.add('a');
    lists.add("Java");
    ArrayList<Integer> list = new ArrayList<>();
    lists1.add(10);
    lists1.add(20);
}
```

ä¼˜ç‚¹ï¼šæ³›å‹åœ¨ç¼–è¯‘é˜¶æ®µçº¦æŸäº†æ“ä½œçš„æ•°æ®ç±»å‹ï¼Œä»è€Œä¸ä¼šå‡ºç°ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚
			ä½“ç°çš„æ˜¯Javaçš„ä¸¥è°¨æ€§å’Œè§„èŒƒæ€§ï¼Œæ•°æ®ç±»å‹ï¼Œç»å¸¸éœ€è¦è¿›è¡Œç»Ÿä¸€ï¼



****



#### è‡ªå®šä¹‰

##### è‡ªå®šä¹‰æ³›å‹ç±»

æ³›å‹ç±»ï¼šä½¿ç”¨äº†æ³›å‹å®šä¹‰çš„ç±»å°±æ˜¯æ³›å‹ç±»ã€‚

æ³›å‹ç±»æ ¼å¼ï¼š

```java
ä¿®é¥°ç¬¦ class ç±»å<æ³›å‹å˜é‡>{

}
æ³›å‹å˜é‡å»ºè®®ä½¿ç”¨ E , T , K , V
```

```java
public class GenericDemo {
    public static void main(String[] args) {
        MyArrayList<String> list = new MyArrayList<String>();
        MyArrayList<Integer> list1 = new MyArrayList<Integer>();
        list.add("è‡ªå®šä¹‰æ³›å‹ç±»");
    }
}
class MyArrayList<E>{
	public void add(E e){}
    public void remove(E e){}
}
```



##### è‡ªå®šä¹‰æ³›å‹æ–¹æ³•

æ³›å‹æ–¹æ³•ï¼šå®šä¹‰äº†æ³›å‹çš„æ–¹æ³•å°±æ˜¯æ³›å‹æ–¹æ³•ã€‚
æ³›å‹æ–¹æ³•çš„å®šä¹‰æ ¼å¼ï¼š

```java
ä¿®é¥°ç¬¦ <æ³›å‹å˜é‡> è¿”å›å€¼ç±»å‹ æ–¹æ³•åç§°(å½¢å‚åˆ—è¡¨){

}
```

æ–¹æ³•å®šä¹‰äº†æ˜¯ä»€ä¹ˆæ³›å‹å˜é‡ï¼Œåé¢å°±åªèƒ½ç”¨ä»€ä¹ˆæ³›å‹å˜é‡ã€‚
æ³›å‹ç±»çš„æ ¸å¿ƒæ€æƒ³ï¼šæŠŠå‡ºç°æ³›å‹å˜é‡çš„åœ°æ–¹å…¨éƒ¨æ›¿æ¢æˆä¼ è¾“çš„çœŸå®æ•°æ®ç±»å‹

```java
public class GenericDemo {
    public static void main(String[] args) {
        Integer[] num = {10 , 20 , 30 , 40 , 50};
        String s1 = arrToString(nums);
     
        String[] name = {"è´¾ä¹ƒäº®","ç‹å®ç»¿","é™ˆç¾½å‡¡"};
        String s2 = arrToString(names);
    }

    public static <T> String arrToString(T[] arr){
        --------------
    }
}
```



è‡ªå®šä¹‰æ³›å‹æ¥å£

æ³›å‹æ¥å£ï¼šä½¿ç”¨äº†æ³›å‹å®šä¹‰çš„æ¥å£å°±æ˜¯æ³›å‹æ¥å£ã€‚
æ³›å‹æ¥å£çš„æ ¼å¼ï¼š

```java
ä¿®é¥°ç¬¦ interface æ¥å£åç§°<æ³›å‹å˜é‡>{

}
```

```java
public class GenericDemo {
    public static void main(String[] args) {
        Data d = new StudentData();
        d.add(new Student());
        ................
    }
}

public interface Data<E>{
    void add(E e);
    void delete(E e);
    void update(E e);
    E query(int index);
}
class Student{}
class StudentData implements Data<Student>{é‡å†™æ‰€æœ‰æ–¹æ³•}
```



****



#### æ³›å‹é€šé…ç¬¦

* é€šé…ç¬¦ï¼šï¼Ÿ
      ?å¯ä»¥ç”¨åœ¨ä½¿ç”¨æ³›å‹çš„æ—¶å€™ä»£è¡¨ä¸€åˆ‡ç±»å‹ã€‚
      E , T , K , Væ˜¯åœ¨å®šä¹‰æ³›å‹çš„æ—¶å€™ä½¿ç”¨ä»£è¡¨ä¸€åˆ‡ç±»å‹ã€‚

* æ³›å‹çš„ä¸Šä¸‹é™ï¼š
      ? extends Car : é‚£ä¹ˆ?å¿…é¡»æ˜¯Caræˆ–è€…å…¶å­ç±»ã€‚(æ³›å‹çš„ä¸Šé™)
      ? super  Car :é‚£ä¹ˆ?å¿…é¡»æ˜¯Caræˆ–è€…å…¶çˆ¶ç±»ã€‚ï¼ˆæ³›å‹çš„ä¸‹é™ã€‚ä¸æ˜¯å¾ˆå¸¸è§ï¼‰

```java
//éœ€æ±‚ï¼šå¼€å‘ä¸€ä¸ªæå“é£è½¦çš„æ¸¸æˆï¼Œæ‰€æœ‰çš„æ±½è½¦éƒ½èƒ½ä¸€èµ·å‚ä¸æ¯”èµ›ã€‚
public class GenericDemo {
    public static void main(String[] args) {
        ArrayList<BMW> bmws = new ArrayList<>();
        ArrayList<AD> ads = new ArrayList<>();
        ArrayList<Dog> dogs = new ArrayList<>();
        run(bmws);
        //run(dogs);
    }
    //public static void run(ArrayList<?> car){}//è¿™æ · douå¯¹è±¡ä¹Ÿèƒ½è¿›å…¥
    public static void run(ArrayList<? extends Car> car){}
}

class Car{}
class BMW extends Car{}
class AD extends Car{}
class Dog{}
```





***



### ä¸å¯å˜é›†åˆ

+ åœ¨Listã€Setã€Mapæ¥å£ä¸­éƒ½å­˜åœ¨ofæ–¹æ³•ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸å¯å˜çš„é›†åˆ
  + è¿™ä¸ªé›†åˆä¸èƒ½æ·»åŠ ï¼Œä¸èƒ½åˆ é™¤ï¼Œä¸èƒ½ä¿®æ”¹
  + ä½†æ˜¯å¯ä»¥ç»“åˆé›†åˆçš„å¸¦å‚æ„é€ ï¼Œå®ç°é›†åˆçš„æ‰¹é‡æ·»åŠ 
+ åœ¨Mapæ¥å£ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªofEntriesæ–¹æ³•å¯ä»¥æé«˜ä»£ç çš„é˜…è¯»æ€§
  + é¦–å…ˆä¼šæŠŠé”®å€¼å¯¹å°è£…æˆä¸€ä¸ªEntryå¯¹è±¡ï¼Œå†æŠŠè¿™ä¸ªEntryå¯¹è±¡æ·»åŠ åˆ°é›†åˆå½“ä¸­

````java
public class MyVariableParameter4 {
    public static void main(String[] args) {
        // static <E>  List<E>  of(Eâ€¦elements)  åˆ›å»ºä¸€ä¸ªå…·æœ‰æŒ‡å®šå…ƒç´ çš„Listé›†åˆå¯¹è±¡
        //static <E>  Set<E>  of(Eâ€¦elements)    åˆ›å»ºä¸€ä¸ªå…·æœ‰æŒ‡å®šå…ƒç´ çš„Seté›†åˆå¯¹è±¡
        //static <K , V>   Map<Kï¼ŒV>  of(Eâ€¦elements) åˆ›å»ºä¸€ä¸ªå…·æœ‰æŒ‡å®šå…ƒç´ çš„Mapé›†åˆå¯¹è±¡

        //method1();
        //method2();
        //method3();
        //method4();

    }

    private static void method4() {
        Map<String, String> map = Map.ofEntries(
                Map.entry("zhangsan", "æ±Ÿè‹"),
                Map.entry("lisi", "åŒ—äº¬"));
        System.out.println(map);
    }

    private static void method3() {
        Map<String, String> map = Map.of("zhangsan", "æ±Ÿè‹", "lisi", "åŒ—äº¬");
        System.out.println(map);
    }

    private static void method2() {
        //ä¼ é€’çš„å‚æ•°å½“ä¸­ï¼Œä¸èƒ½å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚
        Set<String> set = Set.of("a", "b", "c", "d","a");
        System.out.println(set);
    }

    private static void method1() {
        List<String> list = List.of("a", "b", "c", "d");
        System.out.println(list);

        //é›†åˆçš„æ‰¹é‡æ·»åŠ ã€‚
        //é¦–å…ˆæ˜¯é€šè¿‡è°ƒç”¨List.ofæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªä¸å¯å˜çš„é›†åˆï¼Œofæ–¹æ³•çš„å½¢å‚å°±æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°ã€‚
        //å†åˆ›å»ºä¸€ä¸ªArrayListé›†åˆï¼Œå¹¶æŠŠè¿™ä¸ªä¸å¯å˜çš„é›†åˆä¸­æ‰€æœ‰çš„æ•°æ®ï¼Œéƒ½æ·»åŠ åˆ°ArrayListä¸­ã€‚
        ArrayList<String> list3 = new ArrayList<>(List.of("a", "b", "c", "d"));
        System.out.println(list3);
    }
}
````





***



## å¼‚å¸¸

### æ¦‚è¿°

å¼‚å¸¸ï¼šç¨‹åºåœ¨"ç¼–è¯‘"æˆ–è€…"æ‰§è¡Œ"çš„è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼ŒJavaä¸ºå¸¸è§çš„ä»£ç å¼‚å¸¸éƒ½è®¾è®¡ä¸€ä¸ªç±»æ¥ä»£è¡¨ã€‚

é”™è¯¯ï¼šError ï¼Œç¨‹åºå‘˜æ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œåªèƒ½é‡å¯ç³»ç»Ÿï¼Œæ¯”å¦‚å†…å­˜å¥”æºƒï¼ŒJVMæœ¬èº«çš„å¥”æºƒ

Javaä¸­å¼‚å¸¸ç»§æ‰¿çš„æ ¹ç±»æ˜¯ï¼šThrowable

```
å¼‚å¸¸çš„ä½“ç³»:
         Throwable(æ ¹ç±»ï¼Œä¸æ˜¯å¼‚å¸¸ç±»)
      /              \
    Error           Exceptionï¼ˆå¼‚å¸¸ï¼Œéœ€è¦ç ”ç©¶å’Œå¤„ç†ï¼‰
                    /            \
                   ç¼–è¯‘æ—¶å¼‚å¸¸     RuntimeException(è¿è¡Œæ—¶å¼‚å¸¸)
                   
```

Exceptionå¼‚å¸¸çš„åˆ†ç±»:

* ç¼–è¯‘æ—¶å¼‚å¸¸ï¼šç»§æ‰¿è‡ªExceptionçš„å¼‚å¸¸æˆ–è€…å…¶å­ç±»ï¼Œç¼–è¯‘é˜¶æ®µå°±ä¼šæŠ¥é”™ï¼Œ
                å¿…é¡»ç¨‹åºå‘˜å¤„ç†çš„ã€‚å¦åˆ™ä»£ç ç¼–è¯‘å°±ä¸èƒ½é€šè¿‡ï¼ï¼
* è¿è¡Œæ—¶å¼‚å¸¸: ç»§æ‰¿è‡ªRuntimeExceptionçš„å¼‚å¸¸æˆ–è€…å…¶å­ç±»ï¼Œç¼–è¯‘é˜¶æ®µæ˜¯ä¸ä¼šå‡ºé”™çš„ï¼Œå®ƒæ˜¯åœ¨
            è¿è¡Œæ—¶é˜¶æ®µå¯èƒ½å‡ºç°ï¼Œç¼–è¯‘é˜¶æ®µæ˜¯ä¸ä¼šå‡ºé”™çš„ï¼Œä½†æ˜¯è¿è¡Œé˜¶æ®µå¯èƒ½å‡ºç°ï¼Œå»ºè®®æå‰å¤„ç†ï¼ï¼



***



### å¤„ç†è¿‡ç¨‹

å¼‚å¸¸çš„äº§ç”Ÿé»˜è®¤çš„å¤„ç†è¿‡ç¨‹è§£æã€‚(è‡ªåŠ¨å¤„ç†çš„è¿‡ç¨‹ï¼)

ï¼ˆ1ï¼‰é»˜è®¤ä¼šåœ¨å‡ºç°å¼‚å¸¸çš„ä»£ç é‚£é‡Œè‡ªåŠ¨çš„åˆ›å»ºä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ï¼šArithmeticExceptionï¼ˆç®—æœ¯å¼‚å¸¸ï¼‰
ï¼ˆ2ï¼‰å¼‚å¸¸ä¼šä»æ–¹æ³•ä¸­å‡ºç°çš„ç‚¹è¿™é‡ŒæŠ›å‡ºç»™è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…æœ€ç»ˆæŠ›å‡ºç»™JVMè™šæ‹Ÿæœºã€‚
ï¼ˆ3ï¼‰è™šæ‹Ÿæœºæ¥æ”¶åˆ°å¼‚å¸¸å¯¹è±¡åï¼Œå…ˆåœ¨æ§åˆ¶å°ç›´æ¥è¾“å‡º**å¼‚å¸¸æ ˆ**ä¿¡æ¯æ•°æ®ã€‚
ï¼ˆ4ï¼‰ç›´æ¥ä»å½“å‰æ‰§è¡Œçš„å¼‚å¸¸ç‚¹å¹²æ‰å½“å‰ç¨‹åºã€‚
ï¼ˆ5ï¼‰åç»­ä»£ç æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†ï¼Œå› ä¸ºç¨‹åºå·²ç»æ­»äº¡ã€‚

```java
public class ExceptionDemo {
    public static void main(String[] args) {
        System.out.println("ç¨‹åºå¼€å§‹ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚");
        chu( 10 ,0 );
        System.out.println("ç¨‹åºç»“æŸã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚");//ä¸æ‰§è¡Œ
    }
    public static void chu(int a , int b){
        int c = a / b ;// å‡ºç°äº†è¿è¡Œæ—¶å¼‚å¸¸,è‡ªåŠ¨åˆ›å»ºå¼‚å¸¸å¯¹è±¡ï¼šArithmeticException
        System.out.println("ç»“æœæ˜¯ï¼š"+c);
    }
}
```



***



### ç¼–è¯‘æ—¶å¼‚å¸¸

#### æ¦‚å¿µ

ç¼–è¯‘æ—¶å¼‚å¸¸ï¼šç»§æ‰¿è‡ªExceptionçš„å¼‚å¸¸æˆ–è€…å…¶å­ç±»ï¼Œæ²¡æœ‰ç»§æ‰¿RuntimeException
           "ç¼–è¯‘æ—¶å¼‚å¸¸æ˜¯ç¼–è¯‘é˜¶æ®µå°±ä¼šæŠ¥é”™"ï¼Œ
            å¿…é¡»ç¨‹åºå‘˜ç¼–è¯‘é˜¶æ®µå°±å¤„ç†çš„ã€‚å¦åˆ™ä»£ç ç¼–è¯‘å°±æŠ¥é”™ï¼ï¼

ç¼–è¯‘æ—¶å¼‚å¸¸çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼š
        æ˜¯æ‹…å¿ƒç¨‹åºå‘˜çš„æŠ€æœ¯ä¸è¡Œï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±çˆ†å‡ºä¸€ä¸ªé”™è¯¯, ç›®çš„åœ¨äºæé†’!
        æé†’ç¨‹åºå‘˜è¿™é‡Œå¾ˆå¯èƒ½å‡ºé”™ï¼Œè¯·æ£€æŸ¥å¹¶æ³¨æ„ä¸è¦å‡ºbugã€‚

```java
public static void main(String[] args) throws ParseException {
	String date = "2015-01-12 10:23:21";
	SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
	Date d = sdf.parse(date);
	System.out.println(d);
}
```



#### å¤„ç†æœºåˆ¶

##### throws

åœ¨å‡ºç°ç¼–è¯‘æ—¶å¼‚å¸¸çš„åœ°æ–¹å±‚å±‚æŠŠå¼‚å¸¸æŠ›å‡ºå»ç»™è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…æœ€ç»ˆæŠ›å‡ºç»™JVMè™šæ‹Ÿæœºã€‚
JVMè™šæ‹Ÿæœºè¾“å‡ºå¼‚å¸¸ä¿¡æ¯ï¼Œç›´æ¥å¹²æ‰ç¨‹åºï¼Œè¿™ç§æ–¹å¼ä¸é»˜è®¤æ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚

* ä¼˜ç‚¹ï¼šå¯ä»¥è§£å†³ä»£ç ç¼–è¯‘æ—¶çš„é”™è¯¯
* è¿è¡Œæ—¶å‡ºç°å¼‚å¸¸ï¼Œç¨‹åºè¿˜æ˜¯ä¼šç«‹å³æ­»äº¡ï¼

**Exceptionæ˜¯å¼‚å¸¸æœ€é«˜ç±»å‹å¯ä»¥æŠ›å‡ºä¸€åˆ‡å¼‚å¸¸ï¼**

```java
public static void main(String[] args) throws Exception {
    System.out.println("ç¨‹åºå¼€å§‹ã€‚ã€‚ã€‚ã€‚");
    String s = "2013-03-23 10:19:23";
    SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    Date date = sdf.parse(s);
    System.out.println("ç¨‹åºç»“æŸã€‚ã€‚ã€‚ã€‚ã€‚");
}
```



##### try/catch

å¯ä»¥å¤„ç†å¼‚å¸¸ï¼Œå¹¶ä¸”å‡ºç°å¼‚å¸¸åä»£ç ä¹Ÿä¸ä¼šæ­»äº¡ã€‚

* è‡ªå·±æ•è·å¼‚å¸¸å’Œå¤„ç†å¼‚å¸¸çš„æ ¼å¼ï¼š**æ•è·å¤„ç†**

  ```java
  try{
    // ç›‘è§†å¯èƒ½å‡ºç°å¼‚å¸¸çš„ä»£ç ï¼
  }catch(å¼‚å¸¸ç±»å‹1 å˜é‡){
    // å¤„ç†å¼‚å¸¸
  }catch(å¼‚å¸¸ç±»å‹2 å˜é‡){
    // å¤„ç†å¼‚å¸¸
  }...finall{
  //èµ„æºé‡Šæ”¾
  }
  ```

* ç›‘è§†æ•è·å¤„ç†å¼‚å¸¸ä¼ä¸šçº§å†™æ³•ï¼š
  Exceptionå¯ä»¥æ•è·å¤„ç†ä¸€åˆ‡å¼‚å¸¸ç±»å‹ï¼

  ```java
  try{
      // å¯èƒ½å‡ºç°å¼‚å¸¸çš„ä»£ç ï¼
  }catch (Exception e){
      e.printStackTrace(); // **ç›´æ¥æ‰“å°å¼‚å¸¸æ ˆä¿¡æ¯**
  }
  ```

**Throwableæˆå‘˜æ–¹æ³•:**
	`public String getMessage()` : è¿”å›æ­¤ throwable çš„è¯¦ç»†æ¶ˆæ¯å­—ç¬¦ä¸²
	`public String toString()` : è¿”å›æ­¤å¯æŠ›å‡ºçš„ç®€çŸ­æè¿°
	`public void printStackTrace()` : æŠŠå¼‚å¸¸çš„é”™è¯¯ä¿¡æ¯è¾“å‡ºåœ¨æ§åˆ¶å°

```java
public static void main(String[] args) {
    System.out.println("ç¨‹åºå¼€å§‹ã€‚ã€‚ã€‚ã€‚");
    try {
        String s = "2013-03-23 10:19:23";
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        Date date = sdf.parse(s);
        InputStream is = new FileInputStream("D:/meinv.png");
    } catch (Exception e) {
        e.printStackTrace();
    }
    System.out.println("ç¨‹åºç»“æŸã€‚ã€‚ã€‚ã€‚ã€‚");
}
```



##### æ–¹æ³•ä¸‰

åœ¨å‡ºç°å¼‚å¸¸çš„åœ°æ–¹æŠŠå¼‚å¸¸ä¸€å±‚ä¸€å±‚çš„æŠ›å‡ºç»™æœ€å¤–å±‚è°ƒç”¨è€…ï¼Œæœ€å¤–å±‚è°ƒç”¨è€…é›†ä¸­æ•è·å¤„ç†ï¼ï¼ˆ**è§„èŒƒåšæ³•**ï¼‰
è¿™ç§æ–¹æ¡ˆæœ€å¤–å±‚è°ƒç”¨è€…å¯ä»¥çŸ¥é“åº•å±‚æ‰§è¡Œçš„æƒ…å†µï¼ŒåŒæ—¶ç¨‹åºåœ¨å‡ºç°å¼‚å¸¸åä¹Ÿä¸ä¼šç«‹å³æ­»äº¡ï¼ˆæœ€å¥½çš„æ–¹æ¡ˆï¼‰

```java
public class ExceptionDemo{
	public static void main(String[] args){
        System.out.println("ç¨‹åºå¼€å§‹ã€‚ã€‚ã€‚ã€‚");
        try {
            parseDate("2013-03-23 10:19:23");
        }catch (Exception e){
            e.printStackTrace();
        }
        System.out.println("ç¨‹åºç»“æŸã€‚ã€‚ã€‚ã€‚");
    }
    public static void parseDate(String time) throws Exception{...}
}
```



***



### è¿è¡Œæ—¶å¼‚å¸¸

#### æ¦‚å¿µ

â€‹    ç»§æ‰¿è‡ªRuntimeExceptionçš„å¼‚å¸¸æˆ–è€…å…¶å­ç±»ï¼Œ
â€‹    ç¼–è¯‘é˜¶æ®µæ˜¯ä¸ä¼šå‡ºé”™çš„ï¼Œå®ƒæ˜¯åœ¨è¿è¡Œæ—¶é˜¶æ®µå¯èƒ½å‡ºç°çš„é”™è¯¯
â€‹    è¿è¡Œæ—¶å¼‚å¸¸ç¼–è¯‘é˜¶æ®µå¯ä»¥å¤„ç†ä¹Ÿå¯ä»¥ä¸å¤„ç†,ä»£ç ç¼–è¯‘éƒ½èƒ½é€šè¿‡ï¼ï¼

**å¸¸è§çš„è¿è¡Œæ—¶å¼‚å¸¸ã€‚ï¼ˆé¢è¯•é¢˜ï¼‰**

â€‹    1.æ•°ç»„ç´¢å¼•è¶Šç•Œå¼‚å¸¸: ArrayIndexOutOfBoundsException
â€‹    2.ç©ºæŒ‡é’ˆå¼‚å¸¸ : NullPointerExceptionï¼Œç›´æ¥è¾“å‡ºæ²¡é—®é¢˜ï¼Œè°ƒç”¨ç©ºæŒ‡é’ˆçš„å˜é‡çš„åŠŸèƒ½å°±ä¼šæŠ¥é”™ï¼
â€‹    3.ç±»å‹è½¬æ¢å¼‚å¸¸ï¼šClassCastException
â€‹    4.è¿­ä»£å™¨éå†æ²¡æœ‰æ­¤å…ƒç´ å¼‚å¸¸ï¼šNoSuchElementException
â€‹    5.ç®—æœ¯å¼‚å¸¸ï¼ˆæ•°å­¦æ“ä½œå¼‚å¸¸ï¼‰ï¼šArithmeticException
â€‹    6.æ•°å­—è½¬æ¢å¼‚å¸¸ï¼š NumberFormatException

```java
public class ExceptionDemo {
    public static void main(String[] args) {
        System.out.println("ç¨‹åºå¼€å§‹ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚");
        // 1.æ•°ç»„ç´¢å¼•è¶Šç•Œå¼‚å¸¸: ArrayIndexOutOfBoundsExceptionã€‚
        int[] arrs = {10 ,20 ,30};
        System.out.println(arrs[3]); //å‡ºç°äº†æ•°ç»„ç´¢å¼•è¶Šç•Œå¼‚å¸¸ã€‚ä»£ç åœ¨æ­¤å¤„ç›´æ¥æ‰§è¡Œæ­»äº¡ï¼

        // 2.ç©ºæŒ‡é’ˆå¼‚å¸¸ : NullPointerExceptionã€‚
        String name = null ;
        System.out.println(name); // ç›´æ¥è¾“å‡ºæ²¡æœ‰é—®é¢˜
        System.out.println(name.length());//å‡ºç°äº†ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ä»£ç ç›´æ¥æ‰§è¡Œæ­»äº¡ï¼

        /** 3.ç±»å‹è½¬æ¢å¼‚å¸¸ï¼šClassCastExceptionã€‚ */
        Object o = "é½å¤©å¤§åœ£";
        Integer s = (Integer) o;  // æ­¤å¤„å‡ºç°äº†ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚ä»£ç åœ¨æ­¤å¤„ç›´æ¥æ‰§è¡Œæ­»äº¡ï¼

        /** 5.æ•°å­¦æ“ä½œå¼‚å¸¸ï¼šArithmeticExceptionã€‚ */
        int c = 10 / 0 ; // æ­¤å¤„å‡ºç°äº†æ•°å­¦æ“ä½œå¼‚å¸¸ã€‚ä»£ç åœ¨æ­¤å¤„ç›´æ¥æ‰§è¡Œæ­»äº¡ï¼

        /** 6.æ•°å­—è½¬æ¢å¼‚å¸¸ï¼š NumberFormatExceptionã€‚ */
        String num = "23aa";
        Integer it = Integer.valueOf(num); //å‡ºç°äº†æ•°å­—è½¬æ¢å¼‚å¸¸ã€‚ä»£ç åœ¨æ­¤å¤„æ‰§è¡Œæ­»äº¡ï¼

        System.out.println("ç¨‹åºç»“æŸã€‚ã€‚ã€‚ã€‚ã€‚ã€‚");
    }
}
```



#### å¤„ç†æœºåˆ¶

è¿è¡Œæ—¶å¼‚å¸¸åœ¨ç¼–è¯‘é˜¶æ®µæ˜¯ä¸ä¼šæŠ¥é”™ï¼Œåœ¨è¿è¡Œé˜¶æ®µæ‰ä¼šå‡ºé”™ã€‚
è¿è¡Œæ—¶å¼‚å¸¸åœ¨ç¼–è¯‘é˜¶æ®µä¸å¤„ç†ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯è¿è¡Œæ—¶å‡ºé”™äº†ç¨‹åºè¿˜æ˜¯ä¼šæ­»äº¡ï¼Œè¿è¡Œæ—¶å¼‚å¸¸ä¹Ÿå»ºè®®è¦å¤„ç†ã€‚
è¿è¡Œæ—¶å¼‚å¸¸æ˜¯è‡ªåŠ¨å¾€å¤–æŠ›å‡ºçš„ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹å·¥æŠ›å‡ºã€‚

**è¿è¡Œæ—¶å¼‚å¸¸çš„å¤„ç†è§„èŒƒ**ï¼šç›´æ¥åœ¨æœ€å¤–å±‚æ•è·å¤„ç†å³å¯ï¼Œåº•å±‚ä¼šè‡ªåŠ¨æŠ›å‡ºï¼ï¼

```java
public class ExceptionDemo{
    public static void main(String[] args){
        System.out.println("ç¨‹åºå¼€å§‹ã€‚ã€‚ã€‚ã€‚");
        try{
            chu(10 / 0);//ArithmeticException: / by zero
            System.out.println("æ“ä½œæˆåŠŸï¼");//æ²¡è¾“å‡º
        }catch (Exception e){
            e.printStackTrace();
            System.out.println("æ“ä½œå¤±è´¥ï¼");//è¾“å‡ºäº†
        }
        System.out.println("ç¨‹åºç»“æŸã€‚ã€‚ã€‚ã€‚");//è¾“å‡ºäº†
    }
    
    public static void chu(int a , int b)  { System.out.println( a / b );}
}
```



***



### Finallyå…³é”®å­—

ç”¨åœ¨æ•è·å¤„ç†çš„å¼‚å¸¸æ ¼å¼ä¸­çš„ï¼Œæ”¾åœ¨æœ€åé¢ã€‚

```java
try{
    // å¯èƒ½å‡ºç°å¼‚å¸¸çš„ä»£ç ï¼
}catch(Exception e){
    e.printStackTrace();
}finally{
    // æ— è®ºä»£ç æ˜¯å‡ºç°å¼‚å¸¸è¿˜æ˜¯æ­£å¸¸æ‰§è¡Œï¼Œæœ€ç»ˆä¸€å®šè¦æ‰§è¡Œè¿™é‡Œçš„ä»£ç ï¼ï¼
}
try: 1æ¬¡ã€‚
catchï¼š0-Næ¬¡  (å¦‚æœæœ‰finallyé‚£ä¹ˆcatchå¯ä»¥æ²¡æœ‰!!)
finally: 0-1æ¬¡
```



**finallyçš„ä½œç”¨**ï¼šå¯ä»¥åœ¨ä»£ç æ‰§è¡Œå®Œæ¯•ä»¥åè¿›è¡Œèµ„æºçš„é‡Šæ”¾æ“ä½œã€‚
èµ„æºï¼šèµ„æºéƒ½æ˜¯å®ç°äº†Closeableæ¥å£çš„ï¼Œéƒ½è‡ªå¸¦close()å…³é—­æ–¹æ³•ï¼

```java
public class FinallyDemo {
    public static void main(String[] args) {
        System.out.println(chu());//ä¸€å®šä¼šè¾“å‡º finally,ä¼˜å…ˆçº§æ¯”returné«˜
    }

    public static int chu(){
        try{
            int a = 10 / 2 ;
            return a ;
        }catch (Exception e){
            e.printStackTrace();
            return -1;
        }finally {
            System.out.println("=====finallyè¢«æ‰§è¡Œ");
            //return 111; // ä¸å»ºè®®åœ¨finallyä¸­å†™returnï¼Œä¼šè¦†ç›–å‰é¢æ‰€æœ‰çš„returnå€¼!
        }
    }
    public static void test(){
        InputStream is = null;
        try{
            is = new FileInputStream("D:/cang.png");
        }catch (Exception e){
            e.printStackTrace();
        }finally {
            System.out.println("==finallyè¢«æ‰§è¡Œ===");
            // å›æ”¶èµ„æºã€‚ç”¨äºåœ¨ä»£ç æ‰§è¡Œå®Œæ¯•ä»¥åè¿›è¡Œèµ„æºçš„å›æ”¶æ“ä½œï¼
            try {
                if(is!=null)is.close();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
}
```



****



### æ³¨æ„äº‹é¡¹

å¼‚å¸¸çš„è¯­æ³•æ³¨æ„ï¼š

1. è¿è¡Œæ—¶å¼‚å¸¸è¢«æŠ›å‡ºå¯ä»¥ä¸å¤„ç†ï¼Œå¯ä»¥è‡ªåŠ¨æŠ›å‡ºï¼›**ç¼–è¯‘æ—¶å¼‚å¸¸å¿…é¡»å¤„ç†**ï¼›æŒ‰ç…§è§„èŒƒéƒ½åº”è¯¥å¤„ç†
2.  **é‡å†™æ–¹æ³•ç”³æ˜æŠ›å‡ºçš„å¼‚å¸¸ï¼Œåº”è¯¥ä¸çˆ¶ç±»è¢«é‡å†™æ–¹æ³•ç”³æ˜æŠ›å‡ºçš„å¼‚å¸¸ä¸€æ ·æˆ–è€…èŒƒå›´æ›´å°**
3. æ–¹æ³•é»˜è®¤éƒ½å¯ä»¥è‡ªåŠ¨æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œ throws RuntimeExceptionå¯ä»¥çœç•¥ä¸å†™
4. å½“å¤šå¼‚å¸¸å¤„ç†æ—¶ï¼Œæ•è·å¤„ç†ï¼Œå‰é¢çš„å¼‚å¸¸ç±»ä¸èƒ½æ˜¯åé¢å¼‚å¸¸ç±»çš„çˆ¶ç±»ã€‚
5. åœ¨try/catchåå¯ä»¥è¿½åŠ finallyä»£ç å—ï¼Œå…¶ä¸­çš„ä»£ç ä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œé€šå¸¸ç”¨äºèµ„æºå›æ”¶æ“ä½œã€‚ 



***



### è‡ªå®šä¹‰å¼‚å¸¸

è‡ªå®šä¹‰å¼‚å¸¸:

* è‡ªå®šä¹‰ç¼–è¯‘æ—¶å¼‚å¸¸.
  1. å®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»ç»§æ‰¿Exception.
  2. é‡å†™æ„é€ å™¨ã€‚
  3. åœ¨å‡ºç°å¼‚å¸¸çš„åœ°æ–¹ç”¨throw new è‡ªå®šä¹‰å¯¹è±¡æŠ›å‡º!
* è‡ªå®šä¹‰è¿è¡Œæ—¶å¼‚å¸¸.
    1. å®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»ç»§æ‰¿RuntimeException.
    2. é‡å†™æ„é€ å™¨ã€‚
    3. åœ¨å‡ºç°å¼‚å¸¸çš„åœ°æ–¹ç”¨throw new è‡ªå®šä¹‰å¯¹è±¡æŠ›å‡º! 

**throws: ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œç”¨äºæŠ›å‡ºæ–¹æ³•ä¸­çš„å¼‚å¸¸ã€‚**
				ç”¨äºå‘Šè¯‰è°ƒç”¨è€…,æœ¬æ–¹æ³•å†…éƒ¨å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸,è¯·ä½ å¤„ç†ä¸€ä¸‹
**throw:  ç”¨åœ¨å‡ºç°å¼‚å¸¸çš„åœ°æ–¹ï¼Œåˆ›å»ºå¼‚å¸¸å¯¹è±¡ä¸”ç«‹å³ä»æ­¤å¤„æŠ›å‡ºã€‚**
				å°†è¿™ä¸ªå¼‚å¸¸å¯¹è±¡ä¼ é€’åˆ°è°ƒç”¨è€…å¤„ï¼Œå¹¶ç»“æŸå½“å‰æ–¹æ³•çš„æ‰§è¡Œ

```java
//éœ€æ±‚ï¼šè®¤ä¸ºå¹´é¾„å°äº0å²ï¼Œå¤§äº200å²å°±æ˜¯ä¸€ä¸ªå¼‚å¸¸ã€‚
public class ExceptionDemo {
    public static void main(String[] args) {
        try {
            checkAge(101);
        } catch (AgeIllegalException e) {
            e.printStackTrace();
        }
    }

    public static void checkAge(int age) throws ItheimaAgeIllegalException {
        if(age < 0 || age > 200){//å¹´é¾„åœ¨0-200ä¹‹é—´
            throw new AgeIllegalException("/ age is illegal!");
            //throw new AgeIllegalRuntimeException("/ age is illegal!");
        }else{
            System.out.println("å¹´é¾„æ˜¯ï¼š" + age);
        }
    }
}

public class AgeIllegalException extends Exception{
    Alt + Insert->Constructor 
}//ç¼–è¯‘æ—¶å¼‚å¸¸
public class AgeIllegalRuntimeException extends RuntimeException{
	public AgeIllegalRuntimeException() {
    }

    public AgeIllegalRuntimeException(String message) {
        super(message);
    }
}//è¿è¡Œæ—¶å¼‚å¸¸
```



***



### å¼‚å¸¸çš„ä½œç”¨

1ã€å¯ä»¥å¤„ç†ä»£ç é—®é¢˜ï¼Œé˜²æ­¢ç¨‹åºå‡ºç°å¼‚å¸¸åçš„æ­»äº¡ã€‚
2ã€æé«˜äº†ç¨‹åºçš„å¥å£®æ€§å’Œå®‰å…¨æ€§ã€‚

```java
public class Demo{
    public static void main(String[] args){
        //è¯·è¾“å…¥ä¸€ä¸ªåˆæ³•çš„å¹´é¾„
        while(true){
            try{
                Scanner sc = new Scanner(System.in);
                System.out.println("è¯·æ‚¨è¾“å…¥æ‚¨çš„å¹´å¹´é¾„ï¼š");
                int age = sc.nextInt();
                System.out.println("å¹´é¾„ï¼š"+age);
                break;
            }catch(Exception e){
                System.err.println("æ‚¨çš„å¹´é¾„æ˜¯çè¾“å…¥çš„ï¼");
            }
        }
    }
}
```



***



## çº¿ç¨‹

### æ¦‚å¿µ

è¿›ç¨‹ï¼šç¨‹åºæ˜¯é™æ­¢çš„ï¼Œè¿›ç¨‹å®ä½“çš„è¿è¡Œè¿‡ç¨‹å°±æ˜¯è¿›ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ç‹¬ç«‹å•ä½ã€‚

è¿›ç¨‹çš„ç‰¹å¾ï¼šåŠ¨æ€æ€§ã€å¹¶å‘æ€§ã€ç‹¬ç«‹æ€§ã€å¼‚æ­¥æ€§ã€ç»“æ„æ€§

**å¹¶è¡Œ**ï¼šåœ¨åŒä¸€æ—¶åˆ»ï¼Œæœ‰å¤šä¸ªæŒ‡ä»¤åœ¨å¤šä¸ªCPUä¸ŠåŒæ—¶æ‰§è¡Œã€‚
**å¹¶å‘**ï¼šåœ¨åŒä¸€æ—¶åˆ»ï¼Œæœ‰å¤šä¸ªæŒ‡ä»¤åœ¨å•ä¸ªCPUä¸Šäº¤æ›¿æ‰§è¡Œã€‚

**çº¿ç¨‹**ï¼šçº¿ç¨‹æ˜¯å±äºè¿›ç¨‹çš„ï¼Œæ˜¯ä¸€ä¸ªåŸºæœ¬çš„CPUæ‰§è¡Œå•å…ƒï¼Œæ˜¯ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒã€‚çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªå®ä½“ï¼Œæ˜¯è¢«ç³»ç»Ÿç‹¬ç«‹è°ƒåº¦å’Œåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹æœ¬èº«ä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œåªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æºï¼Œä½†å®ƒå¯ä¸åŒå±ä¸€ä¸ªè¿›ç¨‹çš„å…¶ä»–çº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æºã€‚

å…³ç³»ï¼šä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œè¿™å°±æ˜¯å¤šçº¿ç¨‹ï¼Œæ¯”å¦‚çœ‹è§†é¢‘æ˜¯è¿›ç¨‹ï¼Œå›¾ç”»ã€å£°éŸ³ã€å¹¿å‘Šç­‰å°±æ˜¯å¤šä¸ªçº¿ç¨‹

çº¿ç¨‹çš„ä½œç”¨ï¼šä½¿å¤šé“ç¨‹åºæ›´å¥½çš„å¹¶å‘æ‰§è¡Œï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡ï¼Œå¢å¼ºæ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚



***



### åˆ›å»ºçº¿ç¨‹

#### åˆ›å»ºæ–¹å¼

å¤šçº¿ç¨‹æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œæˆ‘ä»¬åœ¨è¿›ç¨‹ä¸­åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰ä¸‰ç§:

1. ç›´æ¥å®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿çº¿ç¨‹ç±»Threadï¼Œé‡å†™run()æ–¹æ³•ï¼Œåˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œè°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚
2. å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ç±»å®ç°Runnableæ¥å£ï¼Œé‡å†™run()æ–¹æ³•ï¼Œåˆ›å»ºçº¿ç¨‹ä»»åŠ¡å¯¹è±¡ï¼ŒæŠŠçº¿ç¨‹ä»»åŠ¡å¯¹è±¡åŒ…è£…æˆçº¿ç¨‹å¯¹è±¡ï¼Œ è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚
3. å®ç°Callableæ¥å£ï¼ˆæ‹“å±•ï¼‰ã€‚





#### ç»§æ‰¿Thread

ç»§æ‰¿Threadç±»çš„æ–¹å¼ï¼š
	1.å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ç±»ç»§æ‰¿Threadç±»ã€‚
	2.é‡å†™run()æ–¹æ³•
	3.åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å¯¹è±¡ã€‚
	4.è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹

* **start()æ–¹æ³•åº•å±‚å…¶å®æ˜¯ç»™CPUæ³¨å†Œå½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”è§¦å‘run()æ–¹æ³•æ‰§è¡Œ**ã€‚çº¿ç¨‹çš„å¯åŠ¨å¿…é¡»è°ƒç”¨start()æ–¹æ³•ï¼Œå¦‚æœçº¿ç¨‹ç›´æ¥è°ƒç”¨run()æ–¹æ³•ï¼Œç›¸å½“äºå˜æˆäº†æ™®é€šç±»çš„æ‰§è¡Œï¼Œæ­¤æ—¶å°†åªæœ‰ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œè¯¥çº¿ç¨‹ã€‚
*  å»ºè®®çº¿ç¨‹å…ˆåˆ›å»ºå­çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹çš„ä»»åŠ¡æ”¾åœ¨ä¹‹åï¼Œå¦åˆ™ä¸»çº¿ç¨‹æ°¸è¿œæ˜¯å…ˆæ‰§è¡Œå®Œï¼

Threadæ„é€ å™¨ï¼š
    `public Thread()`
	`public Thread(String name)`

```java
puclic class ThreadDemo{
    public static void main(String[] args) {
        Thread t = new MyThread();
        t.start();
       	for(int i = 0 ; i < 100 ; i++ ){
            System.out.println("mainçº¿ç¨‹"+i)
        }
        //   mainçº¿ç¨‹è¾“å‡ºæ”¾åœ¨ä¸Šé¢ å°±å˜æˆæœ‰å…ˆåé¡ºåºäº†
    }
}
class MyThread extends Thread{
    @Override
    public void run() {
        for(int i = 0 ; i < 100 ; i++ ){System.out.println("å­çº¿ç¨‹è¾“å‡ºï¼š"+i)}
    }
}
```

ç»§æ‰¿Threadç±»çš„ä¼˜ç¼ºç‚¹ï¼š
    ä¼˜ç‚¹ï¼šç¼–ç ç®€å•ã€‚
    ç¼ºç‚¹ï¼šçº¿ç¨‹ç±»å·²ç»ç»§æ‰¿äº†Threadç±»æ— æ³•ç»§æ‰¿å…¶ä»–ç±»äº†ï¼ŒåŠŸèƒ½ä¸èƒ½é€šè¿‡ç»§æ‰¿æ‹“å±•ï¼ˆå•ç»§æ‰¿çš„å±€é™æ€§ï¼‰





#### Runnableæ¥å£

å®ç°Runnableæ¥å£çš„æ–¹å¼ï¼š
	1.åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ç±»å®ç°Runnableæ¥å£ã€‚
    2.é‡å†™run()æ–¹æ³•
    3.åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡å¯¹è±¡ã€‚
    4.æŠŠçº¿ç¨‹ä»»åŠ¡å¯¹è±¡åŒ…è£…æˆçº¿ç¨‹å¯¹è±¡
	5.è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚

**Threadç±»æœ¬èº«ä¹Ÿæ˜¯å®ç°äº†Runnableæ¥å£**ã€‚

```java
public class Thread implements Runnable {}
```

Threadçš„æ„é€ å™¨ï¼š
	`public Thread(Runnable target)`
	`public Thread(Runnable target, String name)`

* æ™®é€šå†™æ³•

  ```java
  public class ThreadDemo {
      public static void main(String[] args) {
          Runnable target = new MyRunnable();
          Thread t1 = new Thread(target,"1å·çº¿ç¨‹");
  		t1.start();
          Thread t2 = new Thread(target);//Thread-0
      }
  }
  
  public class MyRunnable implements Runnable{
      @Override
      public void run() {
          for(int i = 0 ; i < 10 ; i++ ){
              System.out.println(Thread.currentThread().getName()+"->"+i);
          }
      }
  }
  ```

* åŒ¿åå†…éƒ¨ç±»å†™æ³•

  ```java
  public static void main(String[] args){
      //ç¬¬ä¸€ç§
      new Thread(new Runnable(){
          @Override
          public void run() {
  			for(int i = 0 ; i < 10 ; i++ ){
              	System.out.println(Thread.currentThread().getName()+"->"+i);
          	}
          }
      },"1å·çº¿ç¨‹").start();
      //ç¬¬äºŒç§  
      Runnable target = new Runnable() {
          //é‡å†™runæ–¹æ³•
      };//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡å¯¹è±¡
      Thread t = new Thread(target);// æŠŠçº¿ç¨‹ä»»åŠ¡å¯¹è±¡åŒ…è£…æˆçº¿ç¨‹å¯¹è±¡.ä¸”å¯ä»¥æŒ‡å®šçº¿ç¨‹åç§°
  }
  ```

* ç¼ºç‚¹ï¼šä»£ç å¤æ‚ä¸€ç‚¹ã€‚

* ä¼˜ç‚¹ï¼š

  1. çº¿ç¨‹ä»»åŠ¡ç±»åªæ˜¯å®ç°äº†Runnableæ¥å£ï¼Œå¯ä»¥ç»§ç»­ç»§æ‰¿å…¶ä»–ç±»,é¿å…äº†å•ç»§æ‰¿çš„å±€é™æ€§

  2. åŒä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡å¯¹è±¡å¯ä»¥è¢«åŒ…è£…æˆå¤šä¸ªçº¿ç¨‹å¯¹è±¡

  3. é€‚åˆå¤šä¸ªå¤šä¸ªçº¿ç¨‹å»å…±äº«åŒä¸€ä¸ªèµ„æº

  4. å®ç°è§£è€¦æ“ä½œï¼Œçº¿ç¨‹ä»»åŠ¡ä»£ç å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œçº¿ç¨‹ä»»åŠ¡ä»£ç å’Œçº¿ç¨‹ç‹¬ç«‹

  5. çº¿ç¨‹æ± å¯ä»¥æ”¾å…¥å®ç°Runnableæˆ–Callableçº¿ç¨‹ä»»åŠ¡å¯¹è±¡ã€‚


â€‹     

#### Callableæ¥å£

å®ç°Callableæ¥å£ï¼š
	1,å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ç±»å®ç°Callableæ¥å£ ï¼Œ ç”³æ˜çº¿ç¨‹æ‰§è¡Œçš„ç»“æœç±»å‹
	2,é‡å†™çº¿ç¨‹ä»»åŠ¡ç±»çš„callæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ç›´æ¥è¿”å›æ‰§è¡Œçš„ç»“æœ
    3,åˆ›å»ºä¸€ä¸ªCallableçš„çº¿ç¨‹ä»»åŠ¡å¯¹è±¡
    4,æŠŠCallableçš„çº¿ç¨‹ä»»åŠ¡å¯¹è±¡åŒ…è£…æˆä¸€ä¸ªæœªæ¥ä»»åŠ¡å¯¹è±¡
	5.æŠŠæœªæ¥ä»»åŠ¡å¯¹è±¡åŒ…è£…æˆçº¿ç¨‹å¯¹è±¡
	6.è°ƒç”¨çº¿ç¨‹çš„start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹

public FutureTask(Callable<V> callable)ï¼šæœªæ¥ä»»åŠ¡å¯¹è±¡ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œè¿™æ ·å°±è¢«åŒ…è£…æˆçº¿ç¨‹å¯¹è±¡ï¼Œæœªæ¥ä»»åŠ¡å¯¹è±¡å¯ä»¥åœ¨çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åå»**å¾—åˆ°çº¿ç¨‹çš„æ‰§è¡Œç»“æœ**

ä¼˜ç¼ºç‚¹ï¼š

* ä¼˜ç‚¹ï¼š
  çº¿ç¨‹ä»»åŠ¡ç±»åªæ˜¯å®ç°äº†Callableæ¥å£ï¼Œå¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ï¼Œä¹Ÿå¯ä»¥å®ç°å…¶ä»–æ¥å£é¿å…äº†å•ç»§æ‰¿çš„å±€é™æ€§
  åŒä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡å¯¹è±¡å¯ä»¥è¢«åŒ…è£…æˆå¤šä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œé€‚åˆå¤šä¸ªçº¿ç¨‹å»å…±äº«åŒä¸€ä¸ªèµ„æº
  å®ç°è§£è€¦æ“ä½œï¼Œçº¿ç¨‹ä»»åŠ¡ä»£ç å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œçº¿ç¨‹ä»»åŠ¡ä»£ç å’Œçº¿ç¨‹ç‹¬ç«‹
  çº¿ç¨‹æ± å¯ä»¥æ”¾å…¥å®ç°Runableæˆ–Callableçº¿ç¨‹ä»»åŠ¡å¯¹è±¡ã€‚
  èƒ½ç›´æ¥å¾—åˆ°çº¿ç¨‹æ‰§è¡Œçš„ç»“æœ
* ç¼ºç‚¹ï¼šç¼–ç å¤æ‚

```java
public class ThreadDemo {
    public static void main(String[] args) {
        Callable call = new MyCallable();
        FutureTask<String> task = new FutureTask<>(call);
        Thread t = new Thread(task);
        t.start();
        try {
            String s = task.get(); // è·å–callæ–¹æ³•è¿”å›çš„ç»“æœï¼ˆæ­£å¸¸/å¼‚å¸¸ç»“æœï¼‰
            System.out.println(s);
        }  catch (Exception e) {
            e.printStackTrace();
        }
    }

public class MyCallable implements Callable<String> {
    @Override//é‡å†™çº¿ç¨‹ä»»åŠ¡ç±»æ–¹æ³•
    public String call() throws Exception {
        //è®¡ç®— 1 + 10 çš„å’Œ
        return Thread.currentThread().getName() + "->" + sum;
    }
}
```



***



### å¸¸ç”¨API

#### Threadç±»API

| æ–¹æ³•                                           | è¯´æ˜                                                         |
| ---------------------------------------------- | ------------------------------------------------------------ |
| public void start()                            | å¯¼è‡´æ­¤çº¿ç¨‹å¼€å§‹æ‰§è¡Œ; Javaè™šæ‹Ÿæœºè°ƒç”¨æ­¤çº¿ç¨‹çš„runæ–¹æ³•            |
| public void setName(String name)               | ç»™å½“å‰çº¿ç¨‹å–åå­—                                             |
| public void getName()                          | è·å–å½“å‰çº¿ç¨‹çš„åå­—ã€‚<br />çº¿ç¨‹å­˜åœ¨é»˜è®¤åç§°ï¼šå­çº¿ç¨‹æ˜¯Thread-ç´¢å¼•ï¼Œä¸»çº¿ç¨‹æ˜¯main |
| public static Thread currentThread()           | è·å–å½“å‰çº¿ç¨‹å¯¹è±¡ï¼Œä»£ç åœ¨å“ªä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ                       |
| public static void sleep(long time)            | è®©å½“å‰çº¿ç¨‹ä¼‘çœ å¤šå°‘æ¯«ç§’å†ç»§ç»­æ‰§è¡Œ<br />**Thread.sleep(0)** : è®©æ“ä½œç³»ç»Ÿç«‹åˆ»é‡æ–°è¿›è¡Œä¸€æ¬¡cpuç«äº‰ |
| public final void join()                       | ç­‰å¾…è¿™ä¸ªçº¿ç¨‹ç»“æŸ                                             |
| public final void join(long millis)            | ç­‰å¾…è¿™ä¸ªçº¿ç¨‹æ­»äº¡millisæ¯«ç§’,0æ„å‘³ç€æ°¸è¿œç­‰å¾…                   |
| public void interrupt()                        | ä¸­æ–­è¿™ä¸ªçº¿ç¨‹,å¼‚å¸¸å¤„ç†æœºåˆ¶                                    |
| public final int getPriority()                 | è¿”å›æ­¤çº¿ç¨‹çš„ä¼˜å…ˆçº§                                           |
| public final void setPriority(int newPriority) | æ›´æ”¹æ­¤çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå¸¸ç”¨1 5 10                               |
| public final void setDaemon(boolean on)        | å°†æ­¤çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚<br />å½“è¿è¡Œçš„çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼ŒJavaè™šæ‹Ÿæœºå°†é€€å‡ºã€‚<br />å½“æ™®é€šçº¿ç¨‹æ‰§è¡Œå®Œåï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿæ²¡æœ‰ç»§ç»­è¿è¡Œä¸‹å»çš„å¿…è¦ |



**é¢è¯•é—®é¢˜**ï¼š
run()æ–¹æ³•ä¸­çš„å¼‚å¸¸ä¸èƒ½æŠ›å‡ºï¼Œåªèƒ½try/catchï¼Œå› ä¸ºçˆ¶ç±»ä¸­æ²¡æœ‰æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œå­ç±»ä¸èƒ½æ¯”çˆ¶ç±»æŠ›å‡ºæ›´å¤šçš„å¼‚å¸¸

```java
puclic class ThreadDemo{
    public static void main(String[] args) {
        Thread t1 = new MyThread();
        t1.setName("1å·çº¿ç¨‹");
        t1.start();
        //.....t2 åŒ t1
        
       	for(int i = 0 ; i < 100 ; i++ ){
            System.out.println(Thread.currentThread().getName() + "->"+ i)
        }
    }
}
class MyThread extends Thread{
    @Override
    public void run() {
        for(int i = 0 ; i < 100 ; i++ ){
            System.out.println(Thread.currentThread().getName() + "->"+ i)
        }
    }
}
```

```java
for(int i = 0 ; i < 10 ; i++ ) {
            System.out.println(i);
            try {
                Thread.sleep(1000); // è®©å½“å‰çº¿ç¨‹ä¼‘çœ 1s.
            } catch (Exception e) {
                e.printStackTrace();
            }
}//1sè¾“å‡ºä¸€ä¸ªæ•°å­—
```





#### Objectç±»API

```java
public final void notify():å”¤é†’æ­£åœ¨ç­‰å¾…å¯¹è±¡ç›‘è§†å™¨çš„å•ä¸ªçº¿ç¨‹ã€‚
public final void notifyAll():å”¤é†’æ­£åœ¨ç­‰å¾…å¯¹è±¡ç›‘è§†å™¨çš„æ‰€æœ‰çº¿ç¨‹ã€‚
public final void wait():å¯¼è‡´å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¯¥å¯¹è±¡çš„notify()æ–¹æ³•æˆ– notifyAll()æ–¹æ³•ã€‚
```





#### å‚æ•°æ„é€ 

é€šè¿‡Threadç±»çš„æœ‰å‚æ•°æ„é€ å™¨ä¸ºå½“å‰çº¿ç¨‹å¯¹è±¡å–åå­—ï¼š
	public Thread()
	public Thread(String name):åˆ›å»ºçº¿ç¨‹å¯¹è±¡å¹¶å–åå­—ã€‚

```java
public class ThreadDemo{
    public static void main(String[] args) {
        Thread t1 = new MyThread("1å·çº¿ç¨‹");
        t1.start();
        Thread t2 = new MyThread("2å·çº¿ç¨‹");
        t2.start();
        
        Thread.currentThread().setName("ä¸»çº¿ç¨‹");
        for(int i = 0 ; i < 10 ; i++ ) {
            System.out.println(Thread.currentThread().getName()+"->"+i);
        }
    }
}

public class MyThread extends Thread{
    public MyThread(String name){
        //  public Thread(String name):çˆ¶ç±»çš„æœ‰å‚æ•°æ„é€ å™¨
        super(name);// è°ƒç”¨çˆ¶ç±»çš„æœ‰å‚æ•°æ„é€ å™¨åˆå§‹åŒ–å½“å‰çº¿ç¨‹å¯¹è±¡çš„åç§°ï¼å¿«æ·é”®ç”Ÿæˆ
    }
    for(int i=0;i<10;i++){sout(Thread.currentThread().getName()+"->"+i)}//
}
```



****



### çº¿ç¨‹å®‰å…¨

çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€ä¸ªå…±äº«èµ„æºçš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

æ¨¡æ‹Ÿå‡ºå–æ¬¾é—®é¢˜çš„æ¡ˆä¾‹ï¼š
    æ³¨æ„ï¼šç”¨é«˜åº¦é¢å‘å¯¹è±¡çš„æ€æƒ³è®¾è®¡ã€‚
    åˆ†æï¼š
        ï¼ˆ1ï¼‰æä¾›ä¸€ä¸ªè´¦æˆ·ç±»Account.javaä½œä¸ºåˆ›å»ºå…±äº«èµ„æºè´¦æˆ·å¯¹è±¡çš„ç±»ã€‚
        ï¼ˆ2ï¼‰å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ç±»æ¥ç”¨äºåˆ›å»º2ä¸ªçº¿ç¨‹åˆ†åˆ«ä»£è¡¨å°æ˜å’Œå°çº¢æ¥å–é’±ã€‚

```java
public class ThreadSafe {
    public static void main(String[] args) {
        Account account = new Account("123456",10000);
        Thread xm = new DrawMoneyThread("å°æ˜",account,10000);
        xm.start();
        Thread xh = new DrawMoneyThread("å°çº¢",account,10000);
        xh.start();
    }
}

public class DrawMoneyThread extends Thread{
    private Account acc;
    private double money;
    public DrawMoneyThread(String name,Account acc,double money){
        super(name);
        this.acc = acc;
        this.money = money;
    }
    
    @Override
    public void run() {
        acc.drawMoney(this.money);
    }
}

public class Account{
    private String ID;
    private double money;
    
    public void drawMoney(double moeny) {
        // å¼€å§‹åˆ¤æ–­å–é’±é€»è¾‘
        // 1.å…ˆçŸ¥é“æ˜¯è°æ¥å–é’±
        String name = Thread.currentThread().getName();
        // 2.åˆ¤æ–­ä½™é¢æ˜¯å¦è¶³å¤Ÿ
        if(this.moeny >= moeny){
            System.out.println(name+"æ¥å–é’±ï¼Œä½™é¢è¶³å¤Ÿï¼Œå–å‡º"+money);
            // 3.æ›´æ–°ä½™é¢
            this.moeny -= moeny;
            System.out.println(name+"æ¥å–é’±åï¼Œä½™é¢å‰©ä½™"+ this.money);
        }else{
            System.out.println(name+"æ¥å–é’±ï¼Œä½™é¢ä¸è¶³ï¼");
        }
    }
    //Construct
}
```



****



### çº¿ç¨‹åŒæ­¥

çº¿ç¨‹åŒæ­¥çš„ä½œç”¨ï¼šå°±æ˜¯ä¸ºäº†è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ–¹æ¡ˆã€‚

çº¿ç¨‹åŒæ­¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ ¸å¿ƒæ€æƒ³ï¼šè®©å¤šä¸ªçº¿ç¨‹å®ç°å…ˆåä¾æ¬¡è®¿é—®å…±äº«èµ„æº

çº¿ç¨‹åŒæ­¥çš„åšæ³•ï¼šåŠ é”ã€‚æŠŠå…±äº«èµ„æºä¸Šé”ï¼Œæ¯æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è®¿é—®å®Œæ¯•ä»¥åï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½è¿›æ¥

çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æœ‰ä¸‰ç§ï¼š
    ï¼ˆ1ï¼‰åŒæ­¥ä»£ç å—ã€‚
    ï¼ˆ2ï¼‰åŒæ­¥æ–¹æ³•ã€‚
    ï¼ˆ3ï¼‰lockæ˜¾ç¤ºé”ã€‚

æ€»ç»“ï¼š
     **çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å·®**ã€‚
     **çº¿ç¨‹ä¸å®‰å…¨æ€§èƒ½å¥½**ã€‚å‡å¦‚å¼€å‘ä¸­ä¸ä¼šå­˜åœ¨å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨çº¿ç¨‹ä¸å®‰å…¨çš„è®¾è®¡ç±»ã€‚



#### åŒæ­¥ä»£ç å—

æŠŠå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ ¸å¿ƒä»£ç ä¸Šé”ï¼Œæ¯æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨è§£é”ï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯ä»¥è¿›æ¥æ‰§è¡Œ

æ ¼å¼ï¼š

```java
synchronized(é”å¯¹è±¡){
	// è®¿é—®å…±äº«èµ„æºçš„æ ¸å¿ƒä»£ç 
}
```

é”å¯¹è±¡ï¼šç†è®ºä¸Šå¯ä»¥æ˜¯ä»»æ„çš„â€œå”¯ä¸€â€å¯¹è±¡å³å¯

åŸåˆ™ä¸Šï¼šé”å¯¹è±¡å»ºè®®ä½¿ç”¨å…±äº«èµ„æºã€‚
			åœ¨å®ä¾‹æ–¹æ³•ä¸­å»ºè®®ç”¨thisä½œä¸ºé”å¯¹è±¡ã€‚æ­¤æ—¶thisæ­£å¥½æ˜¯å…±äº«èµ„æºï¼å¿…é¡»ä»£ç é«˜åº¦é¢å‘å¯¹è±¡
			åœ¨é™æ€æ–¹æ³•ä¸­å»ºè®®ç”¨ç±»å.classå­—èŠ‚ç ä½œä¸ºé”å¯¹è±¡ã€‚

```java
//çº¿ç¨‹å®‰å…¨ä»£ç é—®é¢˜è§£å†³
public class Account{
    private String ID;
    private double money;
    
    public void drawMoney(double moeny) {
         // 1.å…ˆæ‹¿åˆ°æ˜¯è°æ¥å–é’±ï¼šå–å½“å‰çº¿ç¨‹å¯¹è±¡çš„åç§°
    	String name = Thread.currentThread().getName();
    	// å°æ˜ã€å°çº¢
    	// this == å½“å‰å…±äº«è´¦æˆ·acc !!!!
   	 	// 2.åˆ¤æ–­ä½™é¢æ˜¯å¦è¶³å¤Ÿ
		synchronized (this){
			if(this.money >= money){
            System.out.println(name+"æ¥å–é’±ï¼Œåå‡ºï¼š"+money);
            this.money -= money;
        }else{
            // ä½™é¢ä¸è¶³
            System.out.println(name+"æ¥å–é’±ï¼Œä½™é¢ä¸è¶³ï¼Œå‰©ä½™"+this.money);
        }
    }
    //Construct
}
```



**å–ç¥¨é—®é¢˜**
	new ä¸€ä¸ªobjå¯¹è±¡é”ä½ã€‚
	staticä¿®é¥°ï¼Œåˆ™å…ƒç´ æ˜¯å±äºç±»æœ¬èº«çš„ï¼Œä¸å±äºå¯¹è±¡  ï¼Œä¸ç±»ä¸€èµ·åŠ è½½**ä¸€æ¬¡**ï¼Œåªæœ‰ä¸€ä¸ªã€‚

```java
public class SellTicketDemo {
    public static void main(String[] args) {
        SellTicket st = new SellTicket();

        Thread t1 = new Thread(st, "çª—å£1");
        Thread t2 = new Thread(st, "çª—å£2");
        Thread t3 = new Thread(st, "çª—å£3");

        t1.start();
        t2.start();
        t3.start();
    }
}

public class SellTicket implements Runnable {
    private static int tickets = 100;
    private static Object obj = new Object();

    @Override
    public void run() {
        while (true) {
            synchronized (obj) { // å¯¹å¯èƒ½æœ‰å®‰å…¨é—®é¢˜çš„ä»£ç åŠ é”,å¤šä¸ªçº¿ç¨‹å¿…é¡»ä½¿ç”¨åŒä¸€æŠŠé”
                //t1è¿›æ¥åï¼Œå°±ä¼šæŠŠè¿™æ®µä»£ç ç»™é”èµ·æ¥
                if (tickets > 0) {
                    try {
                        Thread.sleep(100);
                        //t1ä¼‘æ¯100æ¯«ç§’
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    //çª—å£1æ­£åœ¨å‡ºå”®ç¬¬100å¼ ç¥¨
                    System.out.println(Thread.currentThread().getName() 
                                       + "æ­£åœ¨å‡ºå”®ç¬¬" + tickets + "å¼ ç¥¨");
                    tickets--; //tickets = 99;
                }
            }
            //t1å‡ºæ¥äº†ï¼Œè¿™æ®µä»£ç çš„é”å°±è¢«é‡Šæ”¾äº†
        }
    }
}
```



#### åŒæ­¥æ–¹æ³•

ä½œç”¨ï¼šæŠŠå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ ¸å¿ƒæ–¹æ³•é”èµ·æ¥ï¼Œæ¯æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è®¿é—®

ç”¨æ³•ï¼šç›´æ¥ç»™æ–¹æ³•åŠ ä¸Šä¸€ä¸ªä¿®é¥°ç¬¦ synchronized.

åŸç†:  åŒæ­¥æ–¹æ³•çš„åŸç†å’ŒåŒæ­¥ä»£ç å—çš„åº•å±‚åŸç†æ˜¯ä¸€æ ·çš„ï¼ŒåŒæ­¥æ–¹æ³•æ˜¯æŠŠæ•´ä¸ªæ–¹æ³•çš„ä»£ç éƒ½é”èµ·æ¥çš„ã€‚

åŒæ­¥æ–¹æ³•å…¶å®åº•å±‚ä¹Ÿæ˜¯æœ‰é”å¯¹è±¡çš„ï¼š
	å¦‚æœæ–¹æ³•æ˜¯å®ä¾‹æ–¹æ³•ï¼šåŒæ­¥æ–¹æ³•é»˜è®¤ç”¨thisä½œä¸ºçš„é”å¯¹è±¡ã€‚
	å¦‚æœæ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼šåŒæ­¥æ–¹æ³•é»˜è®¤ç”¨ç±»å.classä½œä¸ºçš„é”å¯¹è±¡ã€‚
	æ³¨ï¼šå› ä¸ºé™æ€æ–¹æ³•åªèƒ½é€šè¿‡ç±»å.æ–¹æ³•åè°ƒç”¨ï¼Œæ‰€ä»¥è¦é”ç€æ•´ä½class

```java
//åŒæ­¥æ–¹æ³•
ä¿®é¥°ç¬¦ synchronized è¿”å›å€¼ç±»å‹ æ–¹æ³•å(æ–¹æ³•å‚æ•°) { 
	æ–¹æ³•ä½“ï¼›
}
//åŒæ­¥é™æ€æ–¹æ³•
ä¿®é¥°ç¬¦ static synchronized è¿”å›å€¼ç±»å‹ æ–¹æ³•å(æ–¹æ³•å‚æ•°) { 
	æ–¹æ³•ä½“ï¼›
}
//ä»£ç æ¼”ç¤º
public synchronized void drawMoney(double money){
    //ä¸çº¿ç¨‹åŒæ­¥Accountå†…ä¸€æ ·
}
```

```java
//å–ç¥¨æ¡ˆä¾‹
public class Demo {
	public static void main(String[] args) {
		MyRunnable mr = new MyRunnable();
		Thread t1 = new Thread(mr);
        Thread t2 = new Thread(mr);
    
        t1.setName("çª—å£ä¸€");
        t2.setName("çª—å£äºŒ");
        t1.start();
        t2.start();
    }
}

public class MyRunnable implements Runnable {
    private static int ticketCount = 100;

    @Override
    public void run() {
        while(true){
            if("çª—å£ä¸€".equals(Thread.currentThread().getName())){
                //åŒæ­¥æ–¹æ³•
                boolean result = synchronizedMthod();
                if(result){
                    break;
                }
            }
            if("çª—å£äºŒ".equals(Thread.currentThread().getName())){
                //åŒæ­¥ä»£ç å—
                synchronized (MyRunnable.class){
                    if(ticketCount == 0){
                       break;
                    }else{
                        try {
                            Thread.sleep(10);
                        } catch (InterruptedException e) {
                            e.printStackTrace();
                        }
                        ticketCount--;
                        System.out.println(Thread.currentThread().getName() 
                                           + "åœ¨å–ç¥¨,è¿˜å‰©ä¸‹" + ticketCount + "å¼ ç¥¨");
                    }
                }
            }
        }
    }

    private static synchronized boolean synchronizedMthod() {
        if(ticketCount == 0){
            return true;
        }else{
            try {
                Thread.sleep(10);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            ticketCount--;
            System.out.println(Thread.currentThread().getName() 
                               + "åœ¨å–ç¥¨,è¿˜å‰©ä¸‹" + ticketCount + "å¼ ç¥¨");
            return false;
        }
    }
}
```



#### Locké”

java.util.concurrent.locks.Lockæœºåˆ¶æä¾›äº†æ¯”synchronizedä»£ç å—å’Œsynchronizedæ–¹æ³•æ›´å¹¿æ³›çš„é”å®šæ“ä½œ,åŒæ­¥ä»£ç å—/åŒæ­¥æ–¹æ³•å…·æœ‰çš„åŠŸèƒ½Lockéƒ½æœ‰ï¼Œé™¤æ­¤ä¹‹å¤–æ›´å¼ºå¤§

Locké”ä¹Ÿç§°åŒæ­¥é”ï¼ŒåŠ é”ä¸é‡Šæ”¾é”æ–¹æ³•åŒ–äº†ï¼Œå¦‚ä¸‹ï¼š
	`public void lock()` :  åŠ åŒæ­¥é”ã€‚
	`public void unlock()`: é‡Šæ”¾åŒæ­¥é”ã€‚

```java
public class Demo {
	public static void main(String[] args) {
		Ticket ticket = new Ticket();
		Thread t1 = new Thread(ticket);
		Thread t2 = new Thread(ticket);

		t1.setName("çª—å£ä¸€");
	  	t2.setName("çª—å£äºŒ");
	 	t1.start();
	  	t2.start();
  	}
}
public class Ticket implements Runnable {
  	//ç¥¨çš„æ•°é‡
  	private int ticket = 100;
	private Object obj = new Object();
  	private ReentrantLock lock = new ReentrantLock();

  	@Override
  	public void run() {
	  	while (true) {
		  	//synchronized (obj){//å¤šä¸ªçº¿ç¨‹å¿…é¡»ä½¿ç”¨åŒä¸€æŠŠé”.
		  	try {
				lock.lock();
   				if (ticket <= 0) {
					//å–å®Œäº†
				  	break;
			  	} else {
				  	Thread.sleep(100);
				  	ticket--;
				  	System.out.println(Thread.currentThread().getName() 
                                     + "åœ¨å–ç¥¨,è¿˜å‰©ä¸‹" + ticket + "å¼ ç¥¨");
			  	}
		  	} catch (InterruptedException e) {
			  	e.printStackTrace();
		  	} finally {
			  	lock.unlock();//ä½¿ç”¨finally é˜²æ­¢tryé‡Œçš„å†…å®¹å‡ºç°å¼‚å¸¸ï¼Œå¯¼è‡´ç¨‹åºæ°¸è¿œè¢«é”ä½ã€‚
		  	}
	  	}
  	}
}
```



***



### çº¿ç¨‹çŠ¶æ€

**çº¿ç¨‹ç”±ç”Ÿåˆ°æ­»çš„å®Œæ•´è¿‡ç¨‹ï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰ï¼š**

å½“çº¿ç¨‹è¢«åˆ›å»ºå¹¶å¯åŠ¨ä»¥åï¼Œå®ƒæ—¢ä¸æ˜¯ä¸€å¯åŠ¨å°±è¿›å…¥äº†æ‰§è¡ŒçŠ¶æ€ï¼Œä¹Ÿä¸æ˜¯ä¸€ç›´å¤„äºæ‰§è¡ŒçŠ¶æ€ã€‚åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæœ‰å‡ ç§çŠ¶æ€å‘¢ï¼Ÿåœ¨APIä¸­`java.lang.Thread.State`è¿™ä¸ªæšä¸¾ä¸­ç»™å‡ºäº†å…­ç§çº¿ç¨‹çŠ¶æ€ï¼š

| çº¿ç¨‹çŠ¶æ€                | å¯¼è‡´çŠ¶æ€å‘ç”Ÿæ¡ä»¶                                             |
| ----------------------- | ------------------------------------------------------------ |
| NEW(æ–°å»º)               | çº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯å¹¶æœªå¯åŠ¨ã€‚è¿˜æ²¡è°ƒç”¨startæ–¹æ³•ã€‚MyThread t = new MyThreadåªæœ‰çº¿ç¨‹å¯¹è±¡ï¼Œæ²¡æœ‰çº¿ç¨‹ç‰¹å¾ã€‚ |
| Runnable(å¯è¿è¡Œ)        | çº¿ç¨‹å¯ä»¥åœ¨javaè™šæ‹Ÿæœºä¸­è¿è¡Œçš„çŠ¶æ€ï¼Œå¯èƒ½æ­£åœ¨è¿è¡Œè‡ªå·±ä»£ç ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼Œè¿™å–å†³äºæ“ä½œç³»ç»Ÿå¤„ç†å™¨ã€‚è°ƒç”¨äº†t.start()æ–¹æ³•   ï¼šå°±ç»ªï¼ˆç»å…¸æ•™æ³•ï¼‰ |
| Blocked(é”é˜»å¡)         | å½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è·å–ä¸€ä¸ªå¯¹è±¡é”ï¼Œè€Œè¯¥å¯¹è±¡é”è¢«å…¶ä»–çš„çº¿ç¨‹æŒæœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥BlockedçŠ¶æ€ï¼›å½“è¯¥çº¿ç¨‹æŒæœ‰é”æ—¶ï¼Œè¯¥çº¿ç¨‹å°†å˜æˆRunnableçŠ¶æ€ã€‚ |
| Waiting(æ— é™ç­‰å¾…)       | ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªï¼ˆå”¤é†’ï¼‰åŠ¨ä½œæ—¶ï¼Œè¯¥çº¿ç¨‹è¿›å…¥WaitingçŠ¶æ€ã€‚è¿›å…¥è¿™ä¸ªçŠ¶æ€åæ˜¯ä¸èƒ½è‡ªåŠ¨å”¤é†’çš„ï¼Œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨notifyæˆ–è€…notifyAllæ–¹æ³•æ‰èƒ½å¤Ÿå”¤é†’ã€‚ |
| Timed Waiting(è®¡æ—¶ç­‰å¾…) | åŒwaitingçŠ¶æ€ï¼Œæœ‰å‡ ä¸ªæ–¹æ³•æœ‰è¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨ä»–ä»¬å°†è¿›å…¥Timed WaitingçŠ¶æ€ã€‚è¿™ä¸€çŠ¶æ€å°†ä¸€ç›´ä¿æŒåˆ°è¶…æ—¶æœŸæ»¡æˆ–è€…æ¥æ”¶åˆ°å”¤é†’é€šçŸ¥ã€‚å¸¦æœ‰è¶…æ—¶å‚æ•°çš„å¸¸ç”¨æ–¹æ³•æœ‰Thread.sleep ã€Object.waitã€‚ |
| Teminated(è¢«ç»ˆæ­¢)       | å› ä¸ºrunæ–¹æ³•æ­£å¸¸é€€å‡ºè€Œæ­»äº¡ï¼Œæˆ–è€…å› ä¸ºæ²¡æœ‰æ•è·çš„å¼‚å¸¸ç»ˆæ­¢äº†runæ–¹æ³•è€Œæ­»äº¡ã€‚ |

***



### çº¿ç¨‹é€šä¿¡

çº¿ç¨‹é€šä¿¡ï¼šå¤šä¸ªçº¿ç¨‹å› ä¸ºåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ‰€ä»¥äº’ç›¸é€šä¿¡æ¯”è¾ƒå®¹æ˜“çš„ã€‚ç­‰å¾…å”¤é†’æœºåˆ¶

çº¿ç¨‹é€šä¿¡çš„ç»å…¸æ¨¡å‹ï¼šç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…é—®é¢˜ã€‚
     ç”Ÿäº§è€…è´Ÿè´£ç”Ÿæˆå•†å“ï¼Œæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹å•†å“ã€‚ç”Ÿäº§ä¸èƒ½è¿‡å‰©ï¼Œæ¶ˆè´¹ä¸èƒ½æ²¡æœ‰ã€‚

æ³¨æ„ï¼šçº¿ç¨‹é€šä¿¡ä¸€å®šæ˜¯å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œåŒä¸€ä¸ªèµ„æºæ‰éœ€è¦è¿›è¡Œé€šä¿¡ã€‚
      çº¿ç¨‹é€šä¿¡å¿…é¡»å…ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¦åˆ™æ¯«æ— æ„ä¹‰ï¼Œä»£ç ä¹Ÿä¼šæŠ¥é”™ï¼

çº¿ç¨‹é€šä¿¡çš„æ ¸å¿ƒæ–¹æ³•ï¼š
    `public void wait()`: è®©å½“å‰çº¿ç¨‹è¿›å…¥åˆ°ç­‰å¾…çŠ¶æ€ æ­¤æ–¹æ³•å¿…é¡»é”å¯¹è±¡è°ƒç”¨.
    `public void notify()` : å”¤é†’å½“å‰é”å¯¹è±¡ä¸Šç­‰å¾…çŠ¶æ€çš„æŸä¸ªçº¿ç¨‹  æ­¤æ–¹æ³•å¿…é¡»é”å¯¹è±¡è°ƒç”¨
    `public void notifyAll()` : å”¤é†’å½“å‰é”å¯¹è±¡ä¸Šç­‰å¾…çŠ¶æ€çš„å…¨éƒ¨çº¿ç¨‹  æ­¤æ–¹æ³•å¿…é¡»é”å¯¹è±¡è°ƒç”¨

```java
/*æ¨¡æ‹Ÿä¸€ä¸ªæ¡ˆä¾‹ï¼š
    å°æ˜å’Œå°çº¢æœ‰ä¸€ä¸ªå…±åŒè´¦æˆ·ï¼šå…±äº«èµ„æº
    ä»–ä»¬æœ‰3ä¸ªçˆ¸çˆ¸ï¼ˆäº²çˆ¸ï¼Œå²³çˆ¶ï¼Œå¹²çˆ¹ï¼‰ç»™ä»–ä»¬å­˜é’±ã€‚
æ¨¡å‹ï¼šå°æ˜å’Œå°çº¢å»å–é’±ï¼Œå¦‚æœæœ‰é’±å°±å–å‡ºï¼Œç„¶åç­‰å¾…è‡ªå·±ï¼Œå”¤é†’ä»–ä»¬3ä¸ªçˆ¸çˆ¸æ¥å­˜é’±ä»–ä»¬çš„çˆ¸çˆ¸ä»¬å­˜é’±ï¼Œ
	 å¦‚æœå‘ç°æœ‰é’±å°±ä¸å­˜ï¼Œæ²¡é’±å°±å­˜é’±ï¼Œç„¶åç­‰å¾…è‡ªå·±ï¼Œå”¤é†’å­©å­ä»¬æ¥å–é’±ã€‚åšæ•´å­˜æ•´å–ï¼š10000å…ƒã€‚*/
public class ThreadCommunication {
    public static void main(String[] args) {
        // 1.åˆ›å»ºä¸€ä¸ªè´¦æˆ·å¯¹è±¡ã€‚
        Account acc = new Account("ICBC-1313113",0);
        // 2.åˆ›å»º2ä¸ªå–é’±çº¿ç¨‹ã€‚
        new DrawThread(acc , "å°æ˜").start();
        new DrawThread(acc , "å°çº¢").start();
        // 3.åˆ›å»º3ä¸ªå­˜é’±çº¿ç¨‹ã€‚
        new SaveThread(acc , "äº²çˆ¹").start();
        new SaveThread(acc , "å¹²çˆ¹").start();
        new SaveThread(acc , "å²³çˆ¶").start();
    }
}
public class Account {
    private String cardId ;
    private double money ; // ä½™é¢ã€‚

    public Account() {
    }

    public Account(String cardId, double money) {
        this.cardId = cardId;
        this.money = money;
    }
    public synchronized void saveMony(double money) {
        try{
			String name = Thread.currentThread().getName(); 
            if(this.money > 0){
                this.notifyAll();
                this.wait();
            } else {
                this.money = money;
                System.out.println(name+"æ¥å­˜é’±ï¼Œå­˜å…¥äº†"+money+"å‰©										ä½™ï¼š"+this.money);				
                this.notifyAll();
                this.wait();
            }
        }catch (Exception e){
            e.printStackTrace();
        }
    }
    public synchronized void drawMoney(double money) {
        try{
            // 1.çŸ¥é“æ˜¯è°æ¥å–é’±
            String name = Thread.currentThread().getName();
            // 2.åˆ¤æ–­ä½™é¢æ˜¯å¦è¶³å¤Ÿ
            if(this.money > 0){
                // 3.è´¦æˆ·æœ‰é’±ï¼Œæœ‰é’±å¯ä»¥å–
                this.money -= money;
                System.out.println(name+"æ¥å–é’±"+money+"å–é’±åå‰©										ä½™ï¼š"+this.money);
                // 4.æ²¡é’±ï¼Œå…ˆå”¤é†’åˆ«äººï¼Œç­‰å¾…è‡ªå·±ï¼Œã€‚
                this.notifyAll();
                this.wait();
            }else{
                // 5.ä½™é¢ä¸è¶³ï¼Œæ²¡é’±ï¼Œå…ˆå”¤é†’åˆ«äººï¼Œç­‰å¾…è‡ªå·±ï¼Œã€‚
                this.notifyAll();
                this.wait();
            }
        }catch (Exception e){
            e.printStackTrace();
        }
    }
	//get + setæ–¹æ³•
}
public class SaveThread extends Thread {
    private Account acc ; // å®šä¹‰äº†ä¸€ä¸ªè´¦æˆ·ç±»å‹çš„æˆå‘˜å˜é‡æ¥æ”¶å–æ¬¾çš„è´¦æˆ·å¯¹è±¡ï¼
    public SaveThread(Account acc , String name){
        super(name); // ä¸ºå½“å‰çº¿ç¨‹å¯¹è±¡å–åå­—
        this.acc = acc ;
    }
    @Override
    public void run() {
        while(true){
            try {
                Thread.sleep(4000);
                acc.saveMoney(10000);
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
}
DrawThreadåŒ
```

***



### çº¿ç¨‹æ± 

#### æ¦‚å¿µ

çº¿ç¨‹æ± ï¼šä¸€ä¸ªå®¹çº³å¤šä¸ªçº¿ç¨‹çš„å®¹å™¨ï¼Œå®¹å™¨ä¸­çš„çº¿ç¨‹å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œçœå»äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹å¯¹è±¡çš„æ“ä½œ

çº¿ç¨‹æ± ä½œç”¨ï¼š

1. é™ä½èµ„æºæ¶ˆè€—ï¼Œå‡å°‘äº†åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ¬¡æ•°ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½å¯ä»¥è¢«é‡å¤åˆ©ç”¨ï¼Œå¯æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚
2. æé«˜å“åº”é€Ÿåº¦ï¼Œä¸éœ€è¦é¢‘ç¹çš„åˆ›å»ºçº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹å¯ä»¥ç›´æ¥ç”¨ï¼Œä¸ä¼šå‡ºç°ç³»ç»Ÿåƒµæ­»ï¼
3. æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼Œçº¿ç¨‹æ± å¯ä»¥çº¦æŸç³»ç»Ÿæœ€å¤šåªèƒ½æœ‰å¤šå°‘ä¸ªçº¿ç¨‹ï¼Œä¸ä¼šå› ä¸ºçº¿ç¨‹è¿‡å¤šè€Œæ­»æœº

çº¿ç¨‹æ± çš„æ ¸å¿ƒæ€æƒ³ï¼š**çº¿ç¨‹å¤ç”¨**ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¢«é‡å¤ä½¿ç”¨ï¼Œæ¥å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚



#### åˆ›å»ºçº¿ç¨‹æ± 

çº¿ç¨‹æ± åœ¨Javaä¸­çš„ä»£è¡¨ç±»ï¼šExecutorService(æ¥å£)

Javaåœ¨Executorsç±»ä¸‹æä¾›äº†é™æ€æ–¹æ³•å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹æ± çš„å¯¹è±¡ï¼š
	`static ExecutorService newFixedThreadPool(int nThreads)` : åˆ›å»ºä¸€ä¸ªæŒ‡å®šæœ€å¤šçº¿ç¨‹æ•°é‡çº¿ç¨‹æ± è¿”å›
	`static ExecutorService newCachedThreadPool()` : åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„çº¿ç¨‹æ± 

ExecutorServiceæäº¤çº¿ç¨‹ä»»åŠ¡å¯¹è±¡æ‰§è¡Œçš„æ–¹æ³•ï¼š
	`Future<?> submit(Runnable task)` : æäº¤ä¸€ä¸ªRunnableçš„ä»»åŠ¡å¯¹è±¡ç»™çº¿ç¨‹æ± æ‰§è¡Œã€‚
	`Future<?> submit(Callable task)` : æäº¤ä¸€ä¸ªCallableçš„ä»»åŠ¡å¯¹è±¡ç»™çº¿ç¨‹æ± æ‰§è¡Œã€‚

å¸¸ç”¨æ–¹æ³•ï¼š
	`pools.shutdown()` : ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä»¥åæ‰ä¼šå…³é—­çº¿ç¨‹æ± 
	`pools.shutdownNow()` : ç«‹å³å…³é—­çº¿ç¨‹æ± çš„ä»£ç ï¼Œæ— è®ºä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼

```java
//Runnable
public class ThreadPoolsDemo {
    public static void main(String[] args) {
        //åˆ›å»ºçº¿ç¨‹æ± ï¼Œçº¿ç¨‹å›ºå®šæ•°é‡æ˜¯3
        ExecutorService pools = Executors.newFixedThreadPool(3);
        //åˆ›å»ºä»»åŠ¡å¯¹è±¡
        Runnable target = new MyRunnable(); 
        //æŠŠçº¿ç¨‹ä»»åŠ¡æ”¾åˆ°çº¿ç¨‹æ± 
        pools.submit(target);//æäº¤ä»»åŠ¡ï¼Œæ­¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹,è‡ªåŠ¨å¯åŠ¨çº¿ç¨‹æ‰§è¡Œï¼
        pools.submit(target);//æäº¤ä»»åŠ¡ï¼Œæ­¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹,è‡ªåŠ¨å¯åŠ¨çº¿ç¨‹æ‰§è¡Œï¼
        pools.submit(target);//æäº¤ä»»åŠ¡ï¼Œæ­¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹,è‡ªåŠ¨å¯åŠ¨çº¿ç¨‹æ‰§è¡Œï¼
        pools.submit(target);//ä¸ä¼šå†åˆ›å»ºæ–°çº¿ç¨‹ï¼Œä¼šå¤ç”¨ä¹‹å‰çš„çº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡
        
        pools.shutdown(); // ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä»¥åæ‰ä¼šå…³é—­çº¿ç¨‹æ± 
    }
}
class MyRunnable implements Runnable{
    @Override
    public void run() {
        for(int i  = 0 ; i < 5 ; i++ ){
         System.out.println(Thread.currentThread().getName()+"->"+i);
        }
    }
}
```

```java
//Callable
public class ThreadPoolsDemo {
    public static void main(String[] args) {
        // a.åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼ŒæŒ‡å®šçº¿ç¨‹çš„å›ºå®šæ•°é‡æ˜¯3.
		ExecutorService pools = Executors.newFixedThreadPool(3);
		Future<String> t1 = pools.submit(new MyCallable(10));
        pools.submit(new MyCallable(20)); 
        pools.submit(new MyCallable(30)); 
        try{
            // b.å¯ä»¥å¾—åˆ°çº¿ç¨‹æ± æ‰§è¡Œçš„ä»»åŠ¡ç»“æ„
            String rs1 = t1.get();
            System.out.println(rs1);
        }catch (Exception e){
            e.printStackTrace();
        }
    }
}

class MyCallable implements Callable<String>{
    private int n;
    public MyCallable(int n){
        this.n = n;
    }
    @Override
    public String call() throws Exception {
        int sum = 0 ;
        for(int i = 1 ; i <= n ; i++){
          System.out.println(Thread.currentThread().getName()+"->"+i);
          sum += i ;
        }
        return Thread.currentThread().getName()+"è®¡ç®—1-"+n+"çš„å’Œï¼š"+sum;
    }
}
```



#### ThreadPoolExecutor

**åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡ :** 
ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(æ ¸å¿ƒçº¿ç¨‹æ•°é‡,æœ€å¤§çº¿ç¨‹æ•°é‡,ç©ºé—²çº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´,ä»»åŠ¡é˜Ÿåˆ—,åˆ›å»ºçº¿ç¨‹å·¥å‚,ä»»åŠ¡çš„æ‹’ç»ç­–ç•¥);

````java
public class MyThreadPoolDemo {
//å‚æ•°ä¸€ï¼šcorePoolSize:    æ ¸å¿ƒçº¿ç¨‹çš„æœ€å¤§å€¼ï¼Œä¸èƒ½å°äº0
//å‚æ•°äºŒï¼šmaximumPoolSize: æœ€å¤§çº¿ç¨‹æ•°ï¼Œä¸èƒ½å°äºç­‰äº0ï¼ŒmaximumPoolSize >= corePoolSize
//å‚æ•°ä¸‰ï¼škeepAliveTime:   ç©ºé—²çº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´,ä¸èƒ½å°äº0
//å‚æ•°å››ï¼šunit:            æ—¶é—´å•ä½
//å‚æ•°äº”ï¼šworkQueue:       ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸èƒ½ä¸ºnull
//å‚æ•°å…­ï¼šthreadFactory:   åˆ›å»ºçº¿ç¨‹å·¥å‚,ä¸èƒ½ä¸ºnull 
//å‚æ•°ä¸ƒï¼šhandler:         ä»»åŠ¡çš„æ‹’ç»ç­–ç•¥,ä¸èƒ½ä¸ºnull  
    public static void main(String[] args) {
        ThreadPoolExecutor pool = new ThreadPoolExecutor(2,5,2,TimeUnit.SECONDS,new ArrayBlockingQueue<>(10), Executors.defaultThreadFactory(),new ThreadPoolExecutor.AbortPolicy());
        pool.submit(new MyRunnable());
        pool.submit(new MyRunnable());
        pool.shutdown();
    }
}
````



#### ä»»åŠ¡æ‹’ç»ç­–ç•¥

éé»˜è®¤ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼ŒRejectedExecutionHandleræ˜¯jdkæä¾›çš„ä¸€ä¸ªä»»åŠ¡æ‹’ç»ç­–ç•¥æ¥å£ï¼Œå®ƒä¸‹é¢å­˜åœ¨4ä¸ªå­ç±»ã€‚

```java
ThreadPoolExecutor.AbortPolicy:ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚æ˜¯é»˜è®¤çš„ç­–ç•¥ã€‚
ThreadPoolExecutor.DiscardPolicy:ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ è¿™æ˜¯ä¸æ¨èçš„åšæ³•ã€‚
ThreadPoolExecutor.DiscardOldestPolicy:æŠ›å¼ƒé˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡ ç„¶åæŠŠå½“å‰ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ä¸­ã€‚
ThreadPoolExecutor.CallerRunsPolicy:è°ƒç”¨ä»»åŠ¡çš„run()æ–¹æ³•ç»•è¿‡çº¿ç¨‹æ± ç›´æ¥æ‰§è¡Œã€‚
```

æ³¨ï¼šæ˜ç¡®çº¿ç¨‹æ± å¯¹å¤šå¯æ‰§è¡Œçš„ä»»åŠ¡æ•° = é˜Ÿåˆ—å®¹é‡ + æœ€å¤§çº¿ç¨‹æ•°

**æ¡ˆä¾‹æ¼”ç¤º1**ï¼šæ¼”ç¤ºThreadPoolExecutor.AbortPolicyä»»åŠ¡å¤„ç†ç­–ç•¥

```java
public class ThreadPoolExecutorDemo01 {
    public static void main(String[] args) {
		//æ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º1 ï¼Œ æœ€å¤§çº¿ç¨‹æ± æ•°é‡ä¸º3, ä»»åŠ¡å®¹å™¨çš„å®¹é‡ä¸º1 ,ç©ºé—²çº¿ç¨‹çš„æœ€å¤§å­˜åœ¨æ—¶é—´ä¸º20s
        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(1,3 ,20 , 	 				 TimeUnit.SECONDS,new ArrayBlockingQueue<>(1) , 
				Executors.defaultThreadFactory() , 
				new ThreadPoolExecutor.AbortPolicy()) ;
// æäº¤5ä¸ªä»»åŠ¡ï¼Œè€Œè¯¥çº¿ç¨‹æ± æœ€å¤šå¯ä»¥å¤„ç†4ä¸ªä»»åŠ¡ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨AbortPolicyè¿™ä¸ªä»»åŠ¡å¤„ç†ç­–ç•¥çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸
        for(int x = 0 ; x < 5 ; x++) {
            threadPoolExecutor.submit(() -> {
                System.out.println(Thread.currentThread().getName() + "---->> æ‰§è¡Œäº†ä»»åŠ¡");
            });
        }
    }
}
```

**æ§åˆ¶å°è¾“å‡ºç»“æœ**

```java
pool-1-thread-1---->> æ‰§è¡Œäº†ä»»åŠ¡
pool-1-thread-3---->> æ‰§è¡Œäº†ä»»åŠ¡
pool-1-thread-2---->> æ‰§è¡Œäº†ä»»åŠ¡
pool-1-thread-3---->> æ‰§è¡Œäº†ä»»åŠ¡
//æ§åˆ¶å°æŠ¥é”™ï¼Œä»…ä»…æ‰§è¡Œäº†4ä¸ªä»»åŠ¡ï¼Œæœ‰ä¸€ä¸ªä»»åŠ¡è¢«ä¸¢å¼ƒäº†
```



**æ¡ˆä¾‹æ¼”ç¤º2**ï¼šæ¼”ç¤ºThreadPoolExecutor.DiscardPolicyä»»åŠ¡å¤„ç†ç­–ç•¥

```java
public class ThreadPoolExecutorDemo02 {
    public static void main(String[] args) {
        //æ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º1 ï¼Œ æœ€å¤§çº¿ç¨‹æ± æ•°é‡ä¸º3, ä»»åŠ¡å®¹å™¨çš„å®¹é‡ä¸º1 ,ç©ºé—²çº¿ç¨‹çš„æœ€å¤§å­˜åœ¨æ—¶é—´ä¸º20s
        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(1,3,20, 						TimeUnit.SECONDS,new ArrayBlockingQueue<>(1) , 
				Executors.defaultThreadFactory() ,
				 new ThreadPoolExecutor.DiscardPolicy()) ;
        // æäº¤5ä¸ªä»»åŠ¡ï¼Œè€Œè¯¥çº¿ç¨‹æ± æœ€å¤šå¯ä»¥å¤„ç†4ä¸ªä»»åŠ¡ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨DiscardPolicyè¿™ä¸ªä»»åŠ¡å¤„ç†ç­–ç•¥çš„æ—¶å€™ï¼Œæ§åˆ¶å°ä¸ä¼šæŠ¥é”™
        for(int x = 0 ; x < 5 ; x++) {
            threadPoolExecutor.submit(() -> {
                sout(Thread.currentThread().getName()+ "-->> æ‰§è¡Œäº†ä»»åŠ¡");
            });
        }
    }
}
```

**æ§åˆ¶å°è¾“å‡ºç»“æœ**

```java
pool-1-thread-1---->> æ‰§è¡Œäº†ä»»åŠ¡
pool-1-thread-1---->> æ‰§è¡Œäº†ä»»åŠ¡
pool-1-thread-3---->> æ‰§è¡Œäº†ä»»åŠ¡
pool-1-thread-2---->> æ‰§è¡Œäº†ä»»åŠ¡
//æ§åˆ¶å°æ²¡æœ‰æŠ¥é”™ï¼Œä»…ä»…æ‰§è¡Œäº†4ä¸ªä»»åŠ¡ï¼Œæœ‰ä¸€ä¸ªä»»åŠ¡è¢«ä¸¢å¼ƒäº†
```



**æ¡ˆä¾‹æ¼”ç¤º3**ï¼šæ¼”ç¤ºThreadPoolExecutor.DiscardOldestPolicyä»»åŠ¡å¤„ç†ç­–ç•¥

```java
public class ThreadPoolExecutorDemo02 {
    public static void main(String[] args) {
        //æ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º1 ï¼Œ æœ€å¤§çº¿ç¨‹æ± æ•°é‡ä¸º3, ä»»åŠ¡å®¹å™¨çš„å®¹é‡ä¸º1 ,ç©ºé—²çº¿ç¨‹çš„æœ€å¤§å­˜åœ¨æ—¶é—´ä¸º20s
        ThreadPoolExecutor threadPoolExecutor;
        threadPoolExecutor = new ThreadPoolExecutor(1 , 3 , 20 , TimeUnit.SECONDS ,
                new ArrayBlockingQueue<>(1) , Executors.defaultThreadFactory() , new ThreadPoolExecutor.DiscardOldestPolicy());
        // æäº¤5ä¸ªä»»åŠ¡
        for(int x = 0 ; x < 5 ; x++) {
            // å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œæ¥æŒ‡å®šæŒ‡å®šå½“å‰æ‰§è¡Œçš„ä»»åŠ¡;è¿™ä¸ªå˜é‡éœ€è¦è¢«finalä¿®é¥°
            final int y = x ;
            threadPoolExecutor.submit(() -> {
                System.out.println(Thread.currentThread().getName() + "---->> æ‰§è¡Œäº†ä»»åŠ¡" + y);
            });     
        }
    }
}
```

**æ§åˆ¶å°è¾“å‡ºç»“æœ**

```java
pool-1-thread-2---->> æ‰§è¡Œäº†ä»»åŠ¡2
pool-1-thread-1---->> æ‰§è¡Œäº†ä»»åŠ¡0
pool-1-thread-3---->> æ‰§è¡Œäº†ä»»åŠ¡3
pool-1-thread-1---->> æ‰§è¡Œäº†ä»»åŠ¡4
//ç”±äºä»»åŠ¡1åœ¨çº¿ç¨‹æ± ä¸­ç­‰å¾…æ—¶é—´æœ€é•¿ï¼Œå› æ­¤ä»»åŠ¡1è¢«ä¸¢å¼ƒã€‚
```



**æ¡ˆä¾‹æ¼”ç¤º4**ï¼šæ¼”ç¤ºThreadPoolExecutor.CallerRunsPolicyä»»åŠ¡å¤„ç†ç­–ç•¥

```java
public class ThreadPoolExecutorDemo04 {
    public static void main(String[] args) {

        /**
         * æ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º1 ï¼Œ æœ€å¤§çº¿ç¨‹æ± æ•°é‡ä¸º3, ä»»åŠ¡å®¹å™¨çš„å®¹é‡ä¸º1 ,ç©ºé—²çº¿ç¨‹çš„æœ€å¤§å­˜åœ¨æ—¶é—´ä¸º20s
         */
        ThreadPoolExecutor threadPoolExecutor;
        threadPoolExecutor = new ThreadPoolExecutor(1 , 3 , 20 , TimeUnit.SECONDS ,
                new ArrayBlockingQueue<>(1) , Executors.defaultThreadFactory() , new ThreadPoolExecutor.CallerRunsPolicy());

        // æäº¤5ä¸ªä»»åŠ¡
        for(int x = 0 ; x < 5 ; x++) {
            threadPoolExecutor.submit(() -> {
                System.out.println(Thread.currentThread().getName() + "---->> æ‰§è¡Œäº†ä»»åŠ¡");
            });
        }
    }
}
```

**æ§åˆ¶å°è¾“å‡ºç»“æœ**

```java
pool-1-thread-1---->> æ‰§è¡Œäº†ä»»åŠ¡
pool-1-thread-3---->> æ‰§è¡Œäº†ä»»åŠ¡
pool-1-thread-2---->> æ‰§è¡Œäº†ä»»åŠ¡
pool-1-thread-1---->> æ‰§è¡Œäº†ä»»åŠ¡
main---->> æ‰§è¡Œäº†ä»»åŠ¡
```

é€šè¿‡æ§åˆ¶å°çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¬¡ç­–ç•¥æ²¡æœ‰é€šè¿‡çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨ä»»åŠ¡çš„run()æ–¹æ³•ç»•è¿‡çº¿ç¨‹æ± ç›´æ¥æ‰§è¡Œã€‚



***



### æ­»é”

æ­»é”ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«é˜»å¡ï¼Œå®ƒä»¬ä¸­çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨éƒ½åœ¨ç­‰å¾…æŸä¸ªèµ„æºè¢«é‡Šæ”¾ï¼Œç”±äºçº¿ç¨‹è¢«æ— é™æœŸåœ°é˜»å¡ï¼Œå› æ­¤ç¨‹åºä¸å¯èƒ½æ­£å¸¸ç»ˆæ­¢ã€‚

ä¾‹å¦‚ï¼šå®¢æˆ·ï¼ˆå ç”¨èµ„é‡‘ï¼Œç­‰å¾…ç»é”€å•†çš„è´§å“èµ„æºï¼‰   ç»é”€å•†ï¼ˆå ç”¨è´§å“èµ„æºï¼Œç­‰å¾…å®¢æˆ·çš„èµ„é‡‘ï¼‰

java æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š
    1ã€äº’æ–¥ä½¿ç”¨ï¼Œå³å½“èµ„æºè¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨(å æœ‰)æ—¶ï¼Œåˆ«çš„çº¿ç¨‹ä¸èƒ½ä½¿ç”¨ã€‚
    2ã€ä¸å¯æŠ¢å ï¼Œèµ„æºè¯·æ±‚è€…ä¸èƒ½å¼ºåˆ¶ä»èµ„æºå æœ‰è€…æ‰‹ä¸­å¤ºå–èµ„æºï¼Œèµ„æºåªèƒ½ç”±èµ„æºå æœ‰è€…ä¸»åŠ¨é‡Šæ”¾ã€‚
    3ã€è¯·æ±‚å’Œä¿æŒï¼Œå³å½“èµ„æºè¯·æ±‚è€…åœ¨è¯·æ±‚å…¶ä»–çš„èµ„æºçš„åŒæ—¶ä¿æŒå¯¹åŸæœ‰èµ„æºçš„å æœ‰ã€‚
    4ã€å¾ªç¯ç­‰å¾…ï¼Œå³å­˜åœ¨ä¸€ä¸ªç­‰å¾…å¾ªç¯é˜Ÿåˆ—ï¼šp1è¦p2çš„èµ„æºï¼Œp2è¦p1çš„èµ„æºã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªç­‰å¾…ç¯è·¯

å››ä¸ªæ¡ä»¶éƒ½æˆç«‹çš„æ—¶å€™ï¼Œä¾¿å½¢æˆæ­»é”ã€‚æ­»é”æƒ…å†µä¸‹æ‰“ç ´ä¸Šè¿°ä»»ä½•ä¸€ä¸ªæ¡ä»¶ï¼Œä¾¿å¯è®©æ­»é”æ¶ˆå¤±ã€‚

```java
public class ThreadDead {
    public static Object resources1 = new Object();
    public static Object resources2 = new Object();
    public static void main(String[] args) {
        new Thread(new Runnable {
             @Override
            public void run() {
            	 // çº¿ç¨‹1ï¼šå ç”¨èµ„æº1 ï¼Œè¯·æ±‚èµ„æº2
                synchronized(resources1){
                    System.out.println("çº¿ç¨‹1å·²ç»å ç”¨äº†èµ„æº1ï¼Œå¼€å§‹è¯·æ±‚èµ„æº2");
                    try {
                        Thread.sleep(2000);//ä¼‘æ¯ä¸¤ç§’ï¼Œé˜²æ­¢çº¿ç¨‹1ç›´æ¥è¿è¡Œå®Œæˆã€‚
                        //2ç§’å†…çº¿ç¨‹2è‚¯å®šå¯ä»¥é”ä½èµ„æº2
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                    synchronized (resources2){
                        System.out.println("çº¿ç¨‹1å·²ç»å ç”¨äº†èµ„æº2");
                    }
                }
            }
        }).start();
        new Thread(new Runnable {
             @Override
            public void run() {
            	 // çº¿ç¨‹2ï¼šå ç”¨èµ„æº2 ï¼Œè¯·æ±‚èµ„æº1
                synchronized(resources2){
                    System.out.println("çº¿ç¨‹2å·²ç»å ç”¨äº†èµ„æº2ï¼Œå¼€å§‹è¯·æ±‚èµ„æº1");
                    try {
                        Thread.sleep(2000);
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                    synchronized (resources1){
                        System.out.println("çº¿ç¨‹2å·²ç»å ç”¨äº†èµ„æº1");
                    }
                }
            }
        }).start();
    }
}
```



***



### volatile

é—®é¢˜ï¼šçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªæˆå‘˜å˜é‡çš„å€¼ï¼Œä½†æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è¯»å–åˆ°çš„è¿˜æ˜¯ä¹‹å‰çš„å€¼ä¿®æ”¹åçš„å€¼æ— æ³•è¯»å–åˆ°ã€‚
åŸå› ï¼šæŒ‰ç…§JMMæ¨¡å‹ï¼Œæ‰€æœ‰çš„æˆå‘˜å˜é‡å’Œé™æ€å˜é‡éƒ½å­˜åœ¨äºä¸»å†…å­˜ä¸­ï¼Œä¸»å†…å­˜ä¸­çš„å˜é‡å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ã€‚
 		  æ¯ä¸ªçº¿ç¨‹éƒ½å­˜åœ¨ä¸€ä¸ªä¸“å±äºè‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜ä¸€å¼€å§‹å­˜å‚¨çš„æ˜¯æˆå‘˜å˜é‡çš„å‰¯æœ¬ã€‚
	   	çº¿ç¨‹éƒ½æ˜¯ç›´æ¥è®¿é—®è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„è¯¥å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹å¯¹ä¸»å†…å­˜å˜é‡å€¼çš„ä¿®æ”¹å°†ä¸å¯è§

è§£å†³æ­¤é—®é¢˜ï¼šå¸Œæœ›æ‰€æœ‰çº¿ç¨‹å¯¹äºä¸»å†…å­˜çš„æˆå‘˜å˜é‡ä¿®æ”¹ï¼Œå…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ã€‚

* åŠ é”ï¼šå¯ä»¥å®ç°å…¶ä»–çº¿ç¨‹å¯¹å˜é‡ä¿®æ”¹çš„å¯è§æ€§ã€‚
  åŸç†ï¼šæŸä¸€ä¸ªçº¿ç¨‹è¿›å…¥synchronizedä»£ç å—å‰åï¼Œæ‰§è¡Œè¿‡ç¨‹å…¥å¦‚ä¸‹ï¼š
  			1.çº¿ç¨‹è·å¾—é”
  			2.æ¸…ç©ºå·¥ä½œå†…å­˜
  			3.ä»ä¸»å†…å­˜æ‹·è´å…±äº«å˜é‡æœ€æ–°çš„å€¼åˆ°å·¥ä½œå†…å­˜æˆä¸ºå‰¯æœ¬

* volatileï¼šç»™æˆå‘˜å˜é‡åŠ volatileå…³é”®å­—ï¼Œç«‹å³å°±å®ç°äº†æˆå‘˜å˜é‡å¤šçº¿ç¨‹ä¿®æ”¹çš„å¯è§æ€§ã€‚
  åŸç†ï¼šå¼ºåˆ¶çº¿ç¨‹æ¯æ¬¡åœ¨ä½¿ç”¨å˜é‡æ—¶ï¼Œéƒ½ä¼šçœ‹ä¸€ä¸‹å…±äº«åŒºåŸŸæœ€æ–°çš„å€¼ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªæˆå‘˜å˜é‡çš„å€¼ï¼Œå¤±æ•ˆå…¶ä»–çº¿ç¨‹å¯¹æ­¤å˜é‡çš„å‰¯æœ¬

volatileä¸synchronizedçš„åŒºåˆ«ï¼š

* volatileåªèƒ½ä¿®é¥°å®ä¾‹å˜é‡å’Œé™æ€å˜é‡ï¼Œè€Œsynchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œä»¥åŠä»£ç å—ã€‚
* volatileä¿è¯æ•°æ®çš„**å¯è§æ€§**ï¼Œä½†æ˜¯ä¸ä¿è¯åŸå­æ€§(**å¤šçº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œä¸ä¿è¯çº¿ç¨‹å®‰å…¨**)ï¼Œè€Œsynchronizedæ˜¯ä¸€ç§æ’ä»–ï¼ˆäº’æ–¥ï¼‰çš„æœºåˆ¶ï¼Œ 

```java
public class VolatileDemo{
    public  static void main(String[] args) {
        Thread t = new VolatileThread();
        t.start();
        while(true){
            // è¿™é‡Œè¯»å–åˆ°äº†flagå€¼ä¸€ç›´æ˜¯false,è™½ç„¶çº¿ç¨‹å·²ç»æŠŠå®ƒçš„å€¼æ”¹æˆäº†trueã€‚
            //æ·»åŠ volatileä¿®é¥°åå°±å¯ä»¥è¿è¡Œäº†
			if(t.isFlag()){
                System.out.println("æ‰§è¡Œäº†å¾ªç¯ä¸€æ¬¡~~~~~~~");
            }
        }
    }
}
class VolatileThread extends Thread {
	private volatile boolean flag = false;
    public boolean isFlag() {
        return flag;
    }
    @OverrideMoney
    public void run() {
        this.flag = true;
        System.out.println("çº¿ç¨‹ä¿®æ”¹äº†flag=" + flag);
    }
}
```

```java
public class Money {
    public static volatile int money = 100000;
    
    public static void main(String[] args) {
        MyThread1 t1 = new MyThread1();
        t1.setName("å°è·¯åŒå­¦");
        t1.start();

        MyThread2 t2 = new MyThread2();
        t2.setName("å°çš®åŒå­¦");
        t2.start();
    }
}

public class MyThread1 extends  Thread {
    @Override
    public void run() {
        while(Money.money == 100000){
			//ä¸€ç›´å¾ªç¯ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å€¼
        }
        System.out.println("å·²ç»ä¸æ˜¯åä¸‡äº†");
    }
}

public class MyThread2 extends Thread {
    @Override
    public void run() {
        Thread.sleep(100);//å…ˆè®©å¦ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°cpu
        Money.money = 90000;
    }
}
```



***



### åŸå­æ€§

#### æ¦‚è¿°

åŸå­æ€§ï¼šæŒ‡åœ¨ä¸€æ¬¡æ“ä½œæˆ–è€…å¤šæ¬¡æ“ä½œä¸­ï¼Œæ‰€æœ‰çš„æ“ä½œå…¨éƒ¨éƒ½å¾—åˆ°äº†æ‰§è¡Œå¹¶ä¸”ä¸ä¼šå—åˆ°ä»»ä½•å› ç´ çš„å¹²æ‰°ï¼Œæœ€ç»ˆç»“æœè¦ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚

åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œvolatileå…³é”®å­—å¯ä»¥**ä¿è¯å…±äº«æ•°æ®çš„å¯è§æ€§**ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¯¹æ•°æ®æ“ä½œçš„åŸå­æ€§ï¼ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹volatileä¿®é¥°çš„å˜é‡ä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼‰

volatileçš„ä½¿ç”¨åœºæ™¯ï¼š
		å¼€å…³æ§åˆ¶ï¼Œåˆ©ç”¨å¯è§æ€§çš„ç‰¹ç‚¹ï¼Œæ§åˆ¶æŸä¸€æ®µä»£ç æ‰§è¡Œæˆ–è€…å…³é—­ã€‚
		å¤šä¸ªçº¿ç¨‹æ“ä½œå…±äº«å˜é‡ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶è¿›è¡Œå†™æ“ä½œï¼Œå…¶ä»–çš„çº¿ç¨‹éƒ½æ˜¯è¯»ã€‚

```java
public class VolatileAtomicThreadDemo{
    public static void main(String[] args) {
        Runnable target = new VolatileAtomicThread();
        // å¼€å¯100ä¸ªçº¿ç¨‹å¯¹æ‰§è¡Œè¿™ä¸€ä¸ªä»»åŠ¡ã€‚
        for(int x = 0 ; x < 100 ; x++) {
            new Thread(target).start();
        }
    }
}
//å¹¶æ²¡æœ‰åˆ°10000
public class VolatileAtomicThread implements Runnable{
    private volatile int count = 0;
    @Override// å¯¹è¯¥å˜é‡è¿›è¡Œ++æ“ä½œï¼Œ100æ¬¡
    public void run(){
        for(int i = 0; i < 100; i++){
            count++;
            System.out.println("count ===>>>> " + count);
        }
    }
}
```



***



#### AtomicInteger

å¦‚ä½•ä¿è¯å˜é‡è®¿é—®çš„åŸå­æ€§å‘¢?

1. åŠ é”å®ç°çº¿ç¨‹å®‰å…¨ã€‚å®‰å…¨æ€§å¾—åˆ°äº†ä¿è¯ï¼Œä½†æ˜¯æ€§èƒ½ä¸å¥½ï¼ï¼

   ```java
   public class VolatileAtomicThread implements Runnable{
       private volatile int count = 0;
       @Override// å¯¹è¯¥å˜é‡è¿›è¡Œ++æ“ä½œï¼Œ100æ¬¡
       public void run(){
           for(int i = 0; i < 100; i++){
               synchronized (this){
                   count++;
               	System.out.println("count ===>>>> " + count);
               }
           }
       }
   }
   ```

2. **åŸºäºCASæ–¹å¼çš„åŸå­ç±»**
   Javaå·²ç»æä¾›äº†ä¸€äº›æœ¬èº«å³å¯å®ç°åŸå­æ€§ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰çš„ç±»ã€‚
   æ¦‚è¿°ï¼šjavaä»JDK1.5å¼€å§‹æä¾›äº†java.util.concurrent.atomicåŒ…(ç®€ç§°AtomicåŒ…)ï¼Œ
        		  è¿™ä¸ªåŒ…ä¸­çš„åŸå­æ“ä½œç±»æä¾›äº†ä¸€ç§ç”¨æ³•ç®€å•æ€§èƒ½é«˜æ•ˆï¼Œçº¿ç¨‹å®‰å…¨åœ°æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ–¹å¼ã€‚

   æ“ä½œæ•´å‹çš„åŸå­ç±»ï¼š

   | æ–¹æ³•                                   | ä½œç”¨                                                         |
   | -------------------------------------- | ------------------------------------------------------------ |
   | public AtomicInteger()                 | åˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤å€¼ä¸º0çš„åŸå­å‹Integer                           |
   | public AtomicInteger(int initialValue) | åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å®šå€¼çš„åŸå­å‹Integer                              |
   | public final int get()                 | è·å–å€¼                                                       |
   | public final int getAndIncrement()     | ä»¥åŸå­æ–¹å¼å°†å½“å‰å€¼åŠ 1ï¼Œè¿”å›çš„æ˜¯è‡ªå¢'å‰'çš„å€¼                  |
   | public final int incrementAndGet()     | ä»¥åŸå­æ–¹å¼å°†å½“å‰å€¼åŠ 1ï¼Œè¿”å›çš„æ˜¯è‡ªå¢'å'çš„å€¼                  |
   | public final int getAndSet(int value)  | ä»¥åŸå­æ–¹å¼è®¾ç½®ä¸ºnewValueçš„å€¼ï¼Œè¿”å›æ—§å€¼                       |
   | public final int addAndGet(int data)   | ä»¥åŸå­æ–¹å¼å°†è¾“å…¥çš„æ•°å€¼ä¸å®ä¾‹ä¸­çš„å€¼ç›¸åŠ å¹¶è¿”å›<br />å®ä¾‹ï¼šAtomicIntegeré‡Œçš„value |

   ```java
   class VolatileAtomicThreadDemo {
       public static void main(String[] args) {
           Runnable target = new VolatileAtomicThread() ;
           for(int x = 0 ; x < 100 ; x++) {
               new Thread(target).start();
           }
           //count ===>>>> 10000   100*100
       }
   }
   public class VolatileAtomicThread implements Runnable{
       // åŸå­ç±»ä¸­å°è£…å¥½äº†æ•´å‹å˜é‡ï¼Œé»˜è®¤å€¼æ˜¯0
       private AtomicInteger atomicInteger = new AtomicInteger();
       @Override// å¯¹è¯¥å˜é‡è¿›è¡Œ++æ“ä½œï¼Œ100æ¬¡
       public void run(){
           for(int i = 0; i < 100; i++){
               int count = atomicInteger.incrementAndGet();//åº•å±‚å˜é‡+1
               System.out.println("count ===>>>> " + count);
           }
       }
   }
   ```

   

***



#### CAS+è‡ªæ—‹

**AtomicIntegeråŸç† :** è‡ªæ—‹é”  + CAS ç®—æ³•

**CASç®—æ³•ï¼š**
	æœ‰3ä¸ªæ“ä½œæ•°ï¼ˆå†…å­˜å€¼Vï¼Œ æ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„å€¼Bï¼‰
	å½“æ—§çš„é¢„æœŸå€¼A == å†…å­˜å€¼V   æ­¤æ—¶å¯ä»¥ä¿®æ”¹ï¼Œå°†Væ”¹ä¸ºB
	å½“æ—§çš„é¢„æœŸå€¼A !=  å†…å­˜å€¼V   æ­¤æ—¶ä¸èƒ½ä¿®æ”¹ï¼Œå¹¶é‡æ–°è·å–ç°åœ¨çš„æœ€æ–°å€¼ï¼Œé‡æ–°è·å–çš„åŠ¨ä½œå°±æ˜¯è‡ªæ—‹ã€‚

**AtomicInteger-æºç è§£æ**

```java
//å…ˆè‡ªå¢ï¼Œç„¶åè·å–è‡ªå¢åçš„ç»“æœ
public final int incrementAndGet() {
        //+ 1  è‡ªå¢åçš„ç»“æœ
        //this å°±è¡¨ç¤ºå½“å‰çš„atomicIntegerï¼ˆå€¼ï¼‰
        //1    è‡ªå¢ä¸€æ¬¡
        return U.getAndAddInt(this, VALUE, 1) + 1;
}

public final int getAndAddInt(Object o, long offset, int delta) {
        //v æ—§å€¼
        int v;
        //è‡ªæ—‹çš„è¿‡ç¨‹
        do {
            //ä¸æ–­çš„è·å–æ—§å€¼
            v = getIntVolatile(o, offset);
            //å¦‚æœè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ä¸ºfalseï¼Œé‚£ä¹ˆç»§ç»­è‡ªæ—‹
            //å¦‚æœè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ä¸ºtrueï¼Œé‚£ä¹ˆè‡ªæ—‹ç»“æŸ
            //o è¡¨ç¤ºçš„å°±æ˜¯å†…å­˜å€¼
            //v æ—§å€¼
            //v + delta ä¿®æ”¹åçš„å€¼
        } while (!weakCompareAndSetInt(o, offset, v, v+delta));
//ä½œç”¨ï¼šæ¯”è¾ƒå†…å­˜ä¸­çš„å€¼ï¼Œæ—§å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰å°±æŠŠä¿®æ”¹åçš„å€¼å†™åˆ°å†…å­˜ä¸­ï¼Œè¿”å›trueã€‚è¡¨ç¤ºä¿®æ”¹æˆåŠŸã€‚
//å¦‚æœä¸ç›¸ç­‰ï¼Œæ— æ³•æŠŠä¿®æ”¹åçš„å€¼å†™åˆ°å†…å­˜ä¸­ï¼Œè¿”å›falseã€‚è¡¨ç¤ºä¿®æ”¹å¤±è´¥ã€‚é‚£ä¹ˆç»§ç»­è‡ªæ—‹ã€‚
        return v;
}
```



***



#### æ‚²è§‚é”ä¹è§‚é”

CASä¸Synchronizedæ€»ç»“ï¼š
CASå’ŒSynchronizedéƒ½å¯ä»¥ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«æ•°æ®çš„å®‰å…¨æ€§ã€‚é‚£ä¹ˆä»–ä»¬ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

* Synchronizedæ˜¯ä»æ‚²è§‚çš„è§’åº¦å‡ºå‘ï¼š
  æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ï¼ˆ**å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹**ï¼‰ã€‚å› æ­¤Synchronizedæˆ‘ä»¬ä¹Ÿå°†å…¶ç§°ä¹‹ä¸ºæ‚²è§‚é”ã€‚jdkä¸­çš„ReentrantLockä¹Ÿæ˜¯ä¸€ç§æ‚²è§‚é”ã€‚**æ€§èƒ½è¾ƒå·®**ï¼ï¼
* CASæ˜¯ä»ä¹è§‚çš„è§’åº¦å‡ºå‘:
   æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ã€‚**å¦‚æœåˆ«äººä¿®æ”¹è¿‡ï¼Œåˆ™è·å–ç°åœ¨æœ€æ–°çš„å€¼ã€‚å¦‚æœåˆ«äººæ²¡ä¿®æ”¹è¿‡ï¼Œç›´æ¥ä¿®æ”¹å…±äº«æ•°æ®çš„å€¼**ã€‚CASè¿™ç§æœºåˆ¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶ç§°ä¹‹ä¸ºä¹è§‚é”ã€‚**ç»¼åˆæ€§èƒ½è¾ƒå¥½**ï¼



***



### å¹¶å‘åŒ…

> å¹¶å‘åŒ…çš„æ¥å†ï¼š
>     åœ¨å®é™…å¼€å‘ä¸­å¦‚æœä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¤§å®¶ä¸éœ€è¦åšçº¿ç¨‹å®‰å…¨ï¼Œåšäº†åè€Œæ€§èƒ½ä¸å¥½ï¼
>     ä½†æ˜¯å¼€å‘ä¸­æœ‰å¾ˆå¤šä¸šåŠ¡æ˜¯éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ï¼Œæ­¤æ—¶å°±å¿…é¡»è€ƒè™‘äº†ã€‚å¦åˆ™ä¸šåŠ¡å‡ºç°é—®é¢˜ã€‚
>     Javaä¸ºå¾ˆå¤šä¸šåŠ¡åœºæ™¯æä¾›äº†æ€§èƒ½ä¼˜å¼‚ï¼Œä¸”çº¿ç¨‹å®‰å…¨çš„å¹¶å‘åŒ…ï¼Œç¨‹åºå‘˜å¯ä»¥é€‰æ‹©ä½¿ç”¨ï¼

#### ConcurrentHashMap

* Mapé›†åˆä¸­çš„ç»å…¸é›†åˆï¼šHashMapå®ƒæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ€§èƒ½å¥½ï¼Œå¦‚æœåœ¨è¦æ±‚çº¿ç¨‹å®‰å…¨çš„ä¸šåŠ¡æƒ…å†µä¸‹å°±ä¸èƒ½ç”¨è¿™ä¸ªé›†åˆåšMapé›†åˆï¼Œå¦åˆ™ä¸šåŠ¡ä¼šå´©æºƒã€‚
* Hashtableçº¿ç¨‹å®‰å…¨åŸºäºsynchronizedï¼Œç»¼åˆæ€§èƒ½å·®,è¢«æ·˜æ±°äº†
* ConcurrentHashMapä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œç»¼åˆæ€§èƒ½è¾ƒå¥½ï¼ä¸æ­¢çº¿ç¨‹å®‰å…¨ï¼Œè€Œä¸”æ•ˆç‡é«˜ï¼Œæ€§èƒ½å¥½ã€‚

![ConcurrentHashMapæ•°æ®ç»“æ„](https://gitee.com/seazean/images/raw/master/JavaSE/ConcurrentHashMapæ•°æ®ç»“æ„.png)

å­˜å‚¨æ•°æ®æ­¥éª¤

1. å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ åˆ›å»ºConcurrentHashMapå¯¹è±¡ï¼Œåˆ™ä»€ä¹ˆäº‹æƒ…éƒ½ä¸åšã€‚åœ¨ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™åˆ›å»ºå“ˆå¸Œè¡¨
2. è®¡ç®—å½“å‰å…ƒç´ åº”å­˜å…¥çš„ç´¢å¼•ã€‚
3. å¦‚æœè¯¥ç´¢å¼•ä½ç½®ä¸ºnullï¼Œåˆ™åˆ©ç”¨casç®—æ³•ï¼Œå°†æœ¬ç»“ç‚¹æ·»åŠ åˆ°æ•°ç»„ä¸­ã€‚
4. å¦‚æœè¯¥ç´¢å¼•ä½ç½®ä¸ä¸ºnullï¼Œåˆ™åˆ©ç”¨volatileå…³é”®å­—è·å¾—å½“å‰ä½ç½®æœ€æ–°çš„ç»“ç‚¹åœ°å€ï¼ŒæŒ‚åœ¨ä»–ä¸‹é¢ï¼Œå˜æˆé“¾è¡¨ã€‚
5. å½“é“¾è¡¨çš„é•¿åº¦å¤§äºç­‰äº8æ—¶ï¼Œè‡ªåŠ¨è½¬æ¢æˆçº¢é»‘æ ‘6ï¼Œä»¥é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘å¤´ç»“ç‚¹ä¸ºé”å¯¹è±¡ï¼Œé…åˆæ‚²è§‚é”ä¿è¯å¤šçº¿ç¨‹æ“ä½œé›†åˆæ—¶æ•°æ®çš„å®‰å…¨æ€§

```java
//éœ€æ±‚ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶å¾€HashMapå®¹å™¨ä¸­å­˜å…¥æ•°æ®ä¼šå‡ºç°å®‰å…¨é—®é¢˜ã€‚
public class ConcurrentHashMapDemo{
    public static Map<String,String> map = new ConcurrentHashMap();
    public static void main(String[] args){
        new AddMapDataThread().start();
        new AddMapDataThread().start();
        
        Thread.sleep(1000 * 4);//ä¼‘æ¯10ç§’ï¼Œç¡®ä¿ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•
        System.out.println("Mapå¤§å°ï¼š" + map.size());//20ä¸‡
    }
}

public class AddMapDataThread extends Thread{
    @Override
    public void run() {
        for(int i = 0 ; i < 1000000 ; i++ ){
            ConcurrentHashMapDemo.map.put("é”®ï¼š"+i , "å€¼"+i);
        }
    }
}
```





#### CountDownLatch

CountDownLatchå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œï¼Œå†æ‰§è¡Œè‡ªå·±ã€‚

æ„é€ å™¨ï¼š
    `public CountDownLatch(int count)`  count :åˆå§‹åŒ–å”¤é†’éœ€è¦çš„downå‡ æ­¥ã€‚

æ–¹æ³•ï¼š
	`public void await() ` : è®©å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œå¿…é¡»downå®Œåˆå§‹åŒ–çš„æ•°å­—æ‰å¯ä»¥è¢«å”¤é†’ï¼Œå¦åˆ™è¿›å…¥æ— é™ç­‰å¾…
	`public void countDown()` : è®¡æ•°å™¨è¿›è¡Œå‡1ï¼ˆdown 1ï¼‰

```java
/*çº¿ç¨‹1è¦æ‰§è¡Œæ‰“å°ï¼šAå’ŒCï¼Œçº¿ç¨‹2è¦æ‰§è¡Œæ‰“å°ï¼šBï¼Œä½†çº¿ç¨‹1åœ¨æ‰“å°Aåï¼Œè¦çº¿ç¨‹2æ‰“å°Bä¹‹åæ‰èƒ½æ‰“å°Cï¼Œæ‰€ä»¥ï¼šçº¿ç¨‹1åœ¨æ‰“å°Aåï¼Œå¿…é¡»ç­‰å¾…çº¿ç¨‹2æ‰“å°å®ŒBä¹‹åæ‰èƒ½ç»§ç»­æ‰§è¡Œ*/
public class CountDownLatchDemo {
    public static void main(String[] args) {
        //åˆ›å»º1ä¸ªè®¡æ•°å™¨ï¼šç”¨æ¥æ§åˆ¶ A , Bçº¿ç¨‹çš„æ‰§è¡Œæµç¨‹çš„ã€‚
        CountDownLatch down = new CountDownLatch(1);
        new ThreadA(down).start();
        new ThreadB(down).start();
    }
}
class ThreadA extends Thread{
    private CountDownLatch down;
    public ThreadA(CountDownLatch down){this.down = down;}
	@Override
    public void run() {
        System.out.println("A");
        try {
            down.await(); // Açº¿ç¨‹ä½ è¿›å…¥ç­‰å¾…ï¼Œè®©Bçº¿ç¨‹æ‰§è¡Œè‡ªå·±ï¼
        } catch (Exception e) {
            e.printStackTrace();
        }
        System.out.println("C");
    }
}
class ThreadB extends Thread{
    private CountDownLatch down;
    public ThreadA(CountDownLatch down){this.down = down;}
	@Override
    public void run() {
        System.out.println("B");
        down.countDown();// è¿™é‡Œç›¸å½“äºæ˜¯-1ï¼Œä»£è¡¨è‡ªå·±æ‰§è¡Œå®Œæ¯•ã€‚Açº¿ç¨‹è¢«å”¤é†’
    }
}
```



#### CyclicBarrier

CyclicBarrier(å¾ªç¯å±éšœ)ä½œç”¨ï¼šæŸä¸ªçº¿ç¨‹ä»»åŠ¡å¿…é¡»ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä»¥åæ‰èƒ½æœ€ç»ˆè§¦å‘è‡ªå·±æ‰§è¡Œã€‚

æ„é€ å™¨ï¼š
	`public CyclicBarrier(int parties, Runnable barrierAction)` : ç”¨äºåœ¨çº¿ç¨‹åˆ°è¾¾å±éšœpartiesæ—¶ï¼Œ
																							ä¼˜å…ˆæ‰§è¡ŒbarrierActionï¼Œæ–¹ä¾¿å¤„ç†æ›´å¤æ‚çš„ä¸šåŠ¡åœºæ™¯
å‚æ•°ï¼š
		parties : ä»£è¡¨å¤šå°‘ä¸ªçº¿ç¨‹çš„æ‰§è¡Œ
		barrierAction : åˆ°è¾¾æ‰§è¡Œå±éšœå°±å¼€å§‹è§¦å‘çš„çº¿ç¨‹ä»»åŠ¡

æ–¹æ³•ï¼š
	`public int await()` : çº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•å‘Šè¯‰CyclicBarrierå·²ç»åˆ°è¾¾å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡ï¼ˆä¼‘çœ ï¼‰

å°ç»“ï¼š
    å¯ä»¥å®ç°å¤šçº¿ç¨‹ä¸­ï¼ŒæŸä¸ªä»»åŠ¡åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä»¥åè§¦å‘ã€‚
    å¾ªç¯å±éšœå¯ä»¥å®ç°è¾¾åˆ°ä¸€ç»„å±éšœå°±è§¦å‘ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼

```java
/*å…¬å¸å¬é›†5åå‘˜å·¥å¼€ä¼šï¼Œç­‰5åå‘˜å·¥éƒ½åˆ°äº†ï¼Œä¼šè®®å¼€å§‹ã€‚æˆ‘ä»¬åˆ›å»º5ä¸ªå‘˜å·¥çº¿ç¨‹ï¼Œ1ä¸ªå¼€ä¼šä»»åŠ¡ï¼Œ
å‡ ä¹åŒæ—¶å¯åŠ¨ä½¿ç”¨CyclicBarrierä¿è¯5åå‘˜å·¥çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œåï¼Œå†æ‰§è¡Œå¼€ä¼šçº¿ç¨‹ã€‚*/
public class CyclicBarrierDemo{
    public static void main(String[] args) {
		CyclicBarrier cb = new CyclicBarrier(3,new MeetingRunnable());
        new PeopleThread(cb).start();//å‘˜å·¥ï¼šThread-0è¿›å…¥ä¼šè®®å®¤
        new PeopleThread(cb).start();//å‘˜å·¥ï¼šThread-2è¿›å…¥ä¼šè®®å®¤
        new PeopleThread(cb).start();//å‘˜å·¥ï¼šThread-1è¿›å…¥ä¼šè®®å®¤
								  //äººå‘˜åˆ°é½äº†å¼€å§‹ç”±Thread-0ä¸»æŒä¼šè®®ï¼
    }
}
public class MeetingRunnable implements Runnable{
    @Override
    public void run() {
        sout("äººå‘˜åˆ°é½,ç”±"+Thread.currentThread().getName()+"ä¸»æŒä¼šè®®");
    }
}
public class PeopleThread extends Thread{
	private CyclicBarrier cb;
	public PeopleThread(CyclicBarrier cb) {this.cb = cb;}
	 @Override
    public void run() {
        try{
            Thread.sleep(2000);
            sout("å‘˜å·¥ï¼š"+Thread.currentThread().getName()+"è¿›å…¥ä¼šè®®å®¤");
            cb.await();// è‡ªå·±åšå®Œäº†ï¼Œå‘Šè¯‰å¾ªç¯å±éšœæˆ‘ç»“æŸäº†ï¼
        }catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```



#### Semaphore

synchronizedå¯ä»¥èµ·åˆ°"é”"çš„ä½œç”¨ï¼Œä½†æŸä¸ªæ—¶é—´æ®µå†…ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å…è®¸æ‰§è¡Œã€‚
Semaphoreï¼ˆå‘ä¿¡å·ï¼‰çš„ä½œç”¨æ˜¯æ§åˆ¶çº¿ç¨‹çš„å¹¶å‘æ•°é‡ï¼ŒSemaphoreå¯ä»¥è®¾ç½®åŒæ—¶å…è®¸å‡ ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚

Semaphoreçš„æ„é€ å™¨ï¼š
     `public Semaphore(int permits)`ï¼špermits è¡¨ç¤ºè®¸å¯çº¿ç¨‹çš„æ•°é‡
     `public Semaphore(int permits, boolean fair)`ï¼šfair è¡¨ç¤ºå…¬å¹³æ€§ï¼Œ
															å¦‚æœè¿™ä¸ªè®¾ä¸º true çš„è¯ï¼Œä¸‹æ¬¡æ‰§è¡Œçš„çº¿ç¨‹ä¼šæ˜¯ç­‰å¾…æœ€ä¹…çš„çº¿ç¨‹
Semaphoreçš„æ–¹æ³•ï¼š
     `public void acquire() throws InterruptedException` : è¡¨ç¤ºè·å–è®¸å¯
     `public void release()` : è¡¨ç¤ºé‡Šæ”¾è®¸å¯
	 acquire()å’Œrelease()æ–¹æ³•ä¹‹é—´çš„ä»£ç ä¸º"åŒæ­¥ä»£ç "

```java
//é¢å‘å¯¹è±¡
public class SemaphoreDemo {
    public static void main(String[] args) {
        Service service = new Service();
        for(int i = 0; i < 5; i++){
            new Thread(service, "çº¿ç¨‹ï¼š"+i).start();
        }
    }
}
//æ‰§è¡Œçš„ä»»åŠ¡
class Service{
    // å¯ä»¥åŒæ—¶æ”¯æŒå¤šä¸ªçº¿ç¨‹è¿›å…¥å…±äº«èµ„æºåŒºæ‰§è¡Œã€‚
    private Semaphore semaphore = new Semaphore(2);
    public void showMethod(){
        try{
            semaphore.acquire();
            long startTime = System.currentTimeMillis();
            sout("è¿›å…¥æ—¶é—´ï¼š"+startTime);
            sout(Thread.currentThread().getName()+"è¿›å…¥èµ„æºæ‰§è¡Œ");
            Thread.sleep(1000);
        }catch (Exception e) {
            e.printStackTrace();
        }
        long endTime = System.currentTimeMillis();
        sout("ç»“æŸæ—¶é—´ï¼š"+startTime);
        semaphore.release();
    }
}
// çº¿ç¨‹ç±»
class MyThread extends Thread{
    private Service service;
    public MyThread(Service service , String name){
        super(name);
        this.service = service;
    }
    @Override
    public void run() {
        service.showMethod();
    }
}
```



#### Exchanger

Exchangerï¼ˆäº¤æ¢è€…ï¼‰æ˜¯ä¸€ä¸ªç”¨äºçº¿ç¨‹é—´åä½œçš„å·¥å…·ç±»ï¼Œç”¨äºè¿›è¡Œçº¿ç¨‹é—´çš„æ•°æ®äº¤æ¢ã€‚
è¿‡ç¨‹ï¼šä¸¤ä¸ªçº¿ç¨‹é€šè¿‡exchangeæ–¹æ³•äº¤æ¢æ•°æ®ï¼Œå¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œexchange()æ–¹æ³•ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿæ‰§è¡Œexchangeæ–¹æ³•ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾åŒæ­¥ç‚¹æ—¶ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹å°±å¯ä»¥äº¤æ¢æ•°æ®ï¼Œå°†æœ¬çº¿ç¨‹ç”Ÿäº§å‡ºæ¥çš„æ•°æ®ä¼ é€’ç»™å¯¹æ–¹ã€‚

Exchangeræ„é€ æ–¹æ³•ï¼š `public Exchanger()`æˆ–è€…`public Exchanger<>()`
Exchangeré‡è¦æ–¹æ³•ï¼š`public V exchange(V x)`

```java
public class ExchangerDemo {
    public static void main(String[] args) {
        // åˆ›å»ºäº¤æ¢å¯¹è±¡ï¼ˆä¿¡ä½¿ï¼‰
        Exchanger<String> exchanger = new Exchanger<>();
        new ThreadA(exchanger).start();
        new ThreadA(exchanger).start();
    } 
}
class ThreadA extends Thread{
    private Exchanger<String> exchanger();
    public ThreadA(Exchanger<String> exchanger){this.exchanger = exchanger;}
     @Override
    public void run() {
        try{
            sout("çº¿ç¨‹Aï¼Œåšå¥½äº†ç¤¼ç‰©Aï¼Œç­‰å¾…çº¿ç¨‹Bé€æ¥çš„ç¤¼ç‰©B");
            //å¦‚æœç­‰å¾…äº†5sè¿˜æ²¡æœ‰äº¤æ¢å®ƒå°±å»æ­»ï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼
            String s = exchanger.exchange("ç¤¼ç‰©A",5,TimeUnit.SECONDS);
            sout("çº¿ç¨‹Aæ”¶åˆ°çº¿ç¨‹Bçš„ç¤¼ç‰©ï¼š" + s);
        } catch (Exception e) {
            System.out.println("çº¿ç¨‹Aç­‰å¾…äº†5sï¼Œæ²¡æœ‰æ”¶åˆ°ç¤¼ç‰©,æœ€ç»ˆå°±æ‰§è¡Œç»“æŸäº†!");
        }
    }
}
class ThreadB extends Thread{
    private Exchanger<String> exchanger;
    public ThreadB(Exchanger<String> exchanger) {
        this.exchanger = exchanger;
    }
    @Override
    public void run() {
        try {
            System.out.println("çº¿ç¨‹B,åšå¥½äº†ç¤¼ç‰©B,ç­‰å¾…çº¿ç¨‹Aé€æ¥çš„ç¤¼ç‰©A.....");
            // å¼€å§‹äº¤æ¢ç¤¼ç‰©ã€‚å‚æ•°æ˜¯é€ç»™å…¶ä»–çº¿ç¨‹çš„ç¤¼ç‰©!
            sout("çº¿ç¨‹Bæ”¶åˆ°çº¿ç¨‹Açš„ç¤¼ç‰©ï¼š" + exchanger.exchange("ç¤¼ç‰©B"));
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```



***



## Î»

### lambda

#### æ¦‚è¿°

Lambdaè¡¨è¾¾å¼æ˜¯JDK1.8å¼€å§‹ä¹‹åçš„æ–°æŠ€æœ¯ï¼Œæ˜¯ä¸€ç§ä»£ç çš„æ–°è¯­æ³•ï¼Œä¸€ç§ç‰¹æ®Šå†™æ³•ï¼Œ
ä½œç”¨ï¼šä¸ºäº†ç®€åŒ–åŒ¿åå†…éƒ¨ç±»çš„ä»£ç å†™æ³•ã€‚

Lambdaè¡¨è¾¾å¼çš„æ ¼å¼:

```java
(åŒ¿åå†…éƒ¨ç±»è¢«é‡å†™æ–¹æ³•çš„å½¢å‚åˆ—è¡¨) -> {
	//è¢«é‡å†™æ–¹æ³•çš„æ–¹æ³•ä½“ä»£ç ã€‚
}
```

Lambdaè¡¨è¾¾å¼å¹¶ä¸èƒ½ç®€åŒ–æ‰€æœ‰åŒ¿åå†…éƒ¨ç±»çš„å†™æ³•ï¼Œåªèƒ½ç®€åŒ–**å‡½æ•°å¼æ¥å£çš„åŒ¿åå†…éƒ¨ç±»**

æ¡ä»¶ï¼šé¦–å…ˆå¿…é¡»æ˜¯æ¥å£ï¼Œæ¥å£ä¸­åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•

@FunctionalInterfaceå‡½æ•°å¼æ¥å£æ³¨è§£ï¼šä¸€æ—¦æŸä¸ªæ¥å£åŠ ä¸Šäº†è¿™ä¸ªæ³¨è§£ï¼Œè¿™ä¸ªæ¥å£åªèƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•



#### ç®€åŒ–Runnable

```java
//1.
Thread t = new Thread(new Runnable() {
    @Override
    public void run() {
        sout(Thread.currentThread().getName()+":æ‰§è¡Œ~~~");
    }
});
t.start();

//2.
Thread t1 = new Thread(() -> {
    sout(Thread.currentThread().getName()+":æ‰§è¡Œ~~~");
});
t1.start();
//3.
new Thread(() -> {
    sout(Thread.currentThread().getName()+":æ‰§è¡Œ~~~");
}).start();

//4.ä¸€è¡Œä»£ç 
new Thread(() -> sout(Thread.currentThread().getName()+":æ‰§è¡Œ~~~")).start();
```



#### ç®€åŒ–Comparator

```java
public class CollectionsDemo {
    public static void main(String[] args) {
        List<Student> lists = new ArrayList<>();//...s1 s2 s3
        Collections.addAll(lists , s1 , s2 , s3);
        Collections.sort(lists, new Comparator<Student>() {
            @Override
            public int compare(Student s1, Student s2) {
                return s1.getAge() - s2.getAge();
            }
        });
        
        // ç®€åŒ–å†™æ³•
        Collections.sort(lists ,(Student t1, Student t2) -> {
                return t1.getAge() - t2.getAge();
        });
        // å‚æ•°ç±»å‹å¯ä»¥çœç•¥,æœ€ç®€å•çš„
        Collections.sort(lists ,(t1,t2) -> t1.getAge()-t2.getAge());
    }
}
```



#### ç®€åŒ–æ–¹æ³•

Lambdaè¡¨è¾¾å¼çš„çœç•¥å†™æ³•ï¼ˆè¿›ä¸€æ­¥åœ¨Lambdaè¡¨è¾¾å¼çš„åŸºç¡€ä¸Šç»§ç»­ç®€åŒ–ï¼‰
   ï¼ˆ1ï¼‰å¦‚æœLambdaè¡¨è¾¾å¼çš„æ–¹æ³•ä½“ä»£ç åªæœ‰ä¸€è¡Œä»£ç ã€‚å¯ä»¥çœç•¥å¤§æ‹¬å·ä¸å†™,åŒæ—¶è¦çœç•¥åˆ†å·ï¼
   ï¼ˆ2ï¼‰å¦‚æœLambdaè¡¨è¾¾å¼çš„æ–¹æ³•ä½“ä»£ç åªæœ‰ä¸€è¡Œä»£ç ã€‚å¯ä»¥çœç•¥å¤§æ‹¬å·ä¸å†™ã€‚
       	  æ­¤æ—¶ï¼Œå¦‚æœè¿™è¡Œä»£ç æ˜¯returnè¯­å¥ï¼Œå¿…é¡»çœç•¥returnä¸å†™ï¼ŒåŒæ—¶ä¹Ÿå¿…é¡»çœç•¥";"ä¸å†™
   ï¼ˆ3ï¼‰å‚æ•°ç±»å‹å¯ä»¥çœç•¥ä¸å†™ã€‚
   ï¼ˆ4ï¼‰å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°ç±»å‹å¯ä»¥çœç•¥ï¼ŒåŒæ—¶()ä¹Ÿå¯ä»¥çœç•¥ã€‚

```java
List<String> names = new ArrayList<>();
names.add("èƒ¡");
names.add("ç”˜");
names.add("æ´ª");

names.forEach(new Consumer<String>() {
    @Override
    public void accept(String s) {
        System.out.println(s);
    }
});

names.forEach((String s) -> {
        System.out.println(s);
});

names.forEach((s) -> {
    System.out.println(s);
});

names.forEach(s -> {
    System.out.println(s);
});

names.forEach(s -> System.out.println(s) );
```



***



### æ–¹æ³•å¼•ç”¨

#### æ¦‚è¿°

æ–¹æ³•å¼•ç”¨ï¼šæ–¹æ³•å¼•ç”¨æ˜¯ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–Lambdaè¡¨è¾¾å¼çš„å†™æ³•ã€‚
æ–¹æ³•å¼•ç”¨çš„æ ¼å¼ï¼šç±»å‹æˆ–è€…å¯¹è±¡::å¼•ç”¨çš„æ–¹æ³•ã€‚
å…³é”®è¯­æ³•æ˜¯ï¼šâ€œ::â€

```java
lists.forEach( s -> System.out.println(s));
// æ–¹æ³•å¼•ç”¨ï¼
lists.forEach(System.out::println);
```



#### é™æ€æ–¹æ³•çš„å¼•ç”¨

å¼•ç”¨æ ¼å¼ï¼šç±»å::é™æ€æ–¹æ³•

ç®€åŒ–æ­¥éª¤ï¼šå®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼ŒæŠŠéœ€è¦ç®€åŒ–çš„ä»£ç æ”¾åˆ°ä¸€ä¸ªé™æ€æ–¹æ³•ä¸­å»

é™æ€æ–¹æ³•å¼•ç”¨çš„æ³¨æ„äº‹é¡¹ï¼šè¢«å¼•ç”¨çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨è¦å’Œå‡½æ•°å¼æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸€è‡´,æ‰èƒ½å¼•ç”¨ç®€åŒ–

```java
//å®šä¹‰é›†åˆåŠ å…¥å‡ ä¸ªStudentå…ƒç´ 
	// ä½¿ç”¨é™æ€æ–¹æ³•è¿›è¡Œç®€åŒ–ï¼
    Collections.sort(lists, (o1, o2) -> Student.compareByAge(o1 , o2));
    // å¦‚æœå‰åå‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”æ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼Œæ—¢å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³•å¼•ç”¨
    Collections.sort(lists, Student::compareByAge);

public class Student {
    private String name ;
    private int age ;

    public static int compareByAge(Student o1 , Student o2){
        return  o1.getAge() - o2.getAge();
    }
}
```



#### å®ä¾‹æ–¹æ³•çš„å¼•ç”¨

å¼•ç”¨æ ¼å¼ï¼šå¯¹è±¡::å®ä¾‹æ–¹æ³•

ç®€åŒ–æ­¥éª¤ï¼šå®šä¹‰ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼ŒæŠŠéœ€è¦çš„ä»£ç æ”¾åˆ°å®ä¾‹æ–¹æ³•ä¸­å»

å®ä¾‹æ–¹æ³•å¼•ç”¨çš„æ³¨æ„äº‹é¡¹ï¼šè¢«å¼•ç”¨çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨è¦å’Œå‡½æ•°å¼æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸€è‡´ã€‚

```java
public class MethodDemo {
    public static void main(String[] args) {
        List<String> lists = new ArrayList<>();
        lists.add("java1");
        lists.add("java2");
        lists.add("java3");
        // å¯¹è±¡æ˜¯ System.out = new PrintStream();
        // å®ä¾‹æ–¹æ³•ï¼šprintln()
        // å‰åå‚æ•°æ­£å¥½éƒ½æ˜¯ä¸€ä¸ª
        lists.forEach(s -> System.out.println(s));
        lists.forEach(System.out::println);
    }
}
```



#### ç‰¹å®šç±»å‹æ–¹æ³•çš„å¼•ç”¨

ç‰¹å®šç±»å‹ï¼šString ,ä»»ä½•ç±»å‹

å¼•ç”¨æ ¼å¼ï¼šç‰¹å®šç±»å‹::æ–¹æ³•

æ³¨æ„äº‹é¡¹ï¼šå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°åˆ—è¡¨ä¸­çš„å½¢å‚ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºäº†åé¢çš„æ–¹æ³•çš„è°ƒç”¨è€…ï¼Œå¹¶ä¸”å…¶ä½™å‚æ•°ä½œä¸ºåé¢æ–¹æ³•çš„å½¢å‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ç‰¹å®šç±»å‹æ–¹æ³•å¼•ç”¨äº†ã€‚

```java
public class MethodDemo{
    public static void main(String[] args) {
        String[] strs = new String[]{"James", "AA", "John",
                "Patricia","Dlei" , "Robert","Boom", "Cao" ,"black" ,
                "Michael", "Linda","cao","after","sBBB"};

        // public static <T> void sort(T[] a, Comparator<? super T> c)
        // éœ€æ±‚ï¼šæŒ‰ç…§å…ƒç´ çš„é¦–å­—ç¬¦(å¿½ç•¥å¤§å°å†™)å‡åºæ’åºï¼ï¼ï¼
        Arrays.sort(strs, new Comparator<String>() {
            @Override
            public int compare(String s1, String s2) {
                return s1.compareToIgnoreCase(s2);//æŒ‰ç…§å…ƒç´ çš„é¦–å­—ç¬¦(å¿½ç•¥å¤§å°å†™)
            }
        });

        Arrays.sort(strs, ( s1,  s2 ) ->  s1.compareToIgnoreCase(s2));

        // ç‰¹å®šç±»å‹çš„æ–¹æ³•å¼•ç”¨ï¼š
        Arrays.sort(strs,  String::compareToIgnoreCase);
        System.out.println(Arrays.toString(strs));
    }
}
```



#### æ„é€ å™¨å¼•ç”¨

æ ¼å¼ï¼šç±»å::newã€‚
æ³¨æ„äº‹é¡¹ï¼šå‰åå‚æ•°ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œåˆåœ¨åˆ›å»ºå¯¹è±¡å°±å¯ä»¥ä½¿ç”¨æ„é€ å™¨å¼•ç”¨
  				 s -> new Student(s) => Student::new

```java
public class ConstructorDemo {
    public static void main(String[] args) {
        List<String> lists = new ArrayList<>();
        lists.add("java1");
        lists.add("java2");
        lists.add("java3");

        // é›†åˆé»˜è®¤åªèƒ½è½¬æˆObjectç±»å‹çš„æ•°ç»„ã€‚
        Object[] objs = lists.toArray();

        // æˆ‘ä»¬æƒ³æŒ‡å®šè½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹çš„æ•°ç»„ï¼æœ€æ–°çš„å†™æ³•å¯ä»¥ç»“åˆæ„é€ å™¨å¼•ç”¨å®ç° 
        // default <T> T[] toArray(IntFunction<T[]> generator)
        String[] strs = lists.toArray(new IntFunction<String[]>() {
            @Override
            public String[] apply(int value) {
                return new String[value];
            }
        });
        String[] strs1 = lists.toArray(s -> new String[s] );
        String[] strs2 = lists.toArray(String[]::new);

        System.out.println("Stringç±»å‹çš„æ•°ç»„ï¼š"+ Arrays.toString(strs2));
    }
}
```





***



## IO

### Stream

#### æ¦‚è¿°

Streamæµèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜?
    å¯ä»¥è§£å†³å·²æœ‰é›†åˆç±»åº“æˆ–è€…æ•°ç»„APIçš„å¼Šç«¯ã€‚
    Streamè®¤ä¸ºé›†åˆå’Œæ•°ç»„æ“ä½œçš„APIå¾ˆä¸å¥½ç”¨ï¼Œæ‰€ä»¥é‡‡ç”¨äº†Streamæµç®€åŒ–é›†åˆå’Œæ•°ç»„çš„æ“ä½œã€‚
	Streamæµå…¶å®å°±æ˜¯ä¸€æ ¹ä¼ é€å¸¦ï¼Œå…ƒç´ åœ¨ä¸Šé¢å¯ä»¥è¢«Streamæµæ“ä½œã€‚

```java
list.stream().filter(new Predicate<String>() {
            @Override
            public boolean test(String s) {
                return s.startsWith("å¼ ");
            }
        });

list.stream().filter(s -> s.startsWith("å¼ "));
```



#### è·å–æµ

é›†åˆè·å–Streamæµç”¨: default Stream<E> stream();
æ•°ç»„ï¼šArrays.stream(æ•°ç»„)   /  Stream.of(æ•°ç»„);

```java
// Collectioné›†åˆè·å–Streamæµã€‚
Collection<String> c = new ArrayList<>();
Stream<String> listStream = c.stream();

//Mapé›†åˆè·å–æµ
// å…ˆè·å–é”®çš„Streamæµã€‚
Stream<String> keysStream = map.keySet().stream();
// åœ¨è·å–å€¼çš„Streamæµ
Stream<Integer> valuesStream = map.values().stream();
// è·å–é”®å€¼å¯¹çš„Streamæµï¼ˆkey=valueï¼š Map.Entry<String,Integer>ï¼‰
Stream<Map.Entry<String,Integer>> keyAndValues = map.entrySet().stream();

//æ•°ç»„è·å–æµ
String[] arr = new String[]{"Java", "JavaEE" ,"Spring Boot"};
Stream<String> arrStream1 = Arrays.stream(arr);
Stream<String> arrStream2 = Stream.of(arr);
```



#### å¸¸ç”¨API

| æ–¹æ³•å                                                    | è¯´æ˜                                                     |
| --------------------------------------------------------- | -------------------------------------------------------- |
| void forEach(Consumer<? super T> action)                  | é€ä¸€å¤„ç†(éå†)                                           |
| long count                                                | è¿”å›æµä¸­çš„å…ƒç´ æ•°                                         |
| Stream<T> filterPredicate<? super T> predicate)           | ç”¨äºå¯¹æµä¸­çš„æ•°æ®è¿›è¡Œè¿‡æ»¤                                 |
| Stream<T> limit(long maxSize)                             | è¿”å›æ­¤æµä¸­çš„å…ƒç´ ç»„æˆçš„æµï¼Œæˆªå–å‰æŒ‡å®šå‚æ•°ä¸ªæ•°çš„æ•°æ®       |
| Stream<T> skip(long n)                                    | è·³è¿‡æŒ‡å®šå‚æ•°ä¸ªæ•°çš„æ•°æ®ï¼Œè¿”å›ç”±è¯¥æµçš„å‰©ä½™å…ƒç´ ç»„æˆçš„æµ     |
| <R> Stream<R> map(Function<? super T,? extends R> mapper) | åŠ å·¥æ–¹æ³•ï¼Œå°†å½“å‰æµä¸­çš„Tç±»å‹æ•°æ®è½¬æ¢ä¸ºå¦ä¸€ç§Rç±»å‹çš„æµ     |
| static <T> Stream<T> concat(Stream a, Stream b)           | åˆå¹¶aå’Œbä¸¤ä¸ªæµä¸ºä¸€ä¸ª.  è°ƒç”¨: `Stream.concat(s1,s2);`     |
| Stream<T> distinct()                                      | è¿”å›ç”±è¯¥æµçš„ä¸åŒå…ƒç´ (æ ¹æ®Object.equals(Object) )ç»„æˆçš„æµ |



```java
public class StreamDemo {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        list.add("å¼ æ— å¿Œ"); list.add("å‘¨èŠ·è‹¥"); list.add("èµµæ•");
        list.add("å¼ å¼º"); list.add("å¼ ä¸‰ä¸°"); list.add("å¼ ä¸‰ä¸°");
        //å–ä»¥å¼ å¼€å¤´å¹¶ä¸”åå­—æ˜¯ä¸‰ä½æ•°çš„
        list.stream().filter(s -> s.startsWith("å¼ ")
                .filter(s -> s.length == 3).forEach(System.out::println);
        //ç»Ÿè®¡æ•°é‡
		long count = list.stream().filter(s -> s.startsWith("å¼ ")
                .filter(s -> s.length == 3).count();
		//å–å‰ä¸¤ä¸ª
		list.stream().filter(s -> s.length == 3).limit(2).forEach(...);
		//è·³è¿‡å‰ä¸¤ä¸ª
		list.stream().filter(s -> s.length == 3).skip(2).forEach(...);

		// éœ€æ±‚ï¼šæŠŠåç§°éƒ½åŠ ä¸Šâ€œé»‘é©¬çš„:+xxxâ€
		list.stream().map(s -> "é»‘é©¬çš„"+s).forEach(System.out::println);
		// éœ€æ±‚ï¼šæŠŠåç§°éƒ½åŠ å·¥å‚å­¦ç”Ÿå¯¹è±¡æ”¾ä¸Šå»!!
		// list.stream().map(name -> new Student(name));
		list.stream.map(Student::new).forEach(System.out::println);
                                          	
		//æ•°ç»„æµ
		Stream<Integer> s1 = Stream.of(10,20,30,40,50);
		//é›†åˆæµ
		Stream<String> s2 = list.stream();
		//åˆå¹¶æµ
		Stream<Object> s3 = Stream.concat(s1,s2);
		s3.forEach(System.out::println);
    }
}
class Student{
    private String name;
    //......
}                                          
```



#### ç»ˆç»“æ–¹æ³•

ç»ˆç»“æ–¹æ³•ï¼šStreamè°ƒç”¨äº†ç»ˆç»“æ–¹æ³•ï¼Œæµçš„æ“ä½œå°±å…¨éƒ¨ç»ˆç»“ï¼Œä¸èƒ½ç»§ç»­ä½¿ç”¨ã€‚foreach , countã€‚

éç»ˆç»“æ–¹æ³•ï¼šæ¯æ¬¡è°ƒç”¨å®Œæˆä»¥åè¿”å›ä¸€ä¸ªæ–°çš„æµå¯¹è±¡ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œæ”¯æŒ**é“¾å¼ç¼–ç¨‹**ï¼

```java
// foreachç»ˆç»“æ–¹æ³•
	list.stream().filter(s -> s.startsWith("å¼ "))
		.filter(s -> s.length() == 3).forEach(System.out::println);
```



#### æ”¶é›†Streamæµ

æ”¶é›†Streamæµçš„å«ä¹‰ï¼šå°±æ˜¯æŠŠStreamæµçš„æ•°æ®è½¬å›åˆ°é›†åˆä¸­å»ã€‚

Streamæµï¼šæ‰‹æ®µ
é›†åˆï¼šç›®çš„

| æ–¹æ³•å                                                       | è¯´æ˜                   |
| ------------------------------------------------------------ | ---------------------- |
| R collect(Collector collector)                               | æŠŠç»“æœæ”¶é›†åˆ°é›†åˆä¸­     |
| public static <T> Collector toList()                         | æŠŠå…ƒç´ æ”¶é›†åˆ°Listé›†åˆä¸­ |
| public static <T> Collector toSet()                          | æŠŠå…ƒç´ æ”¶é›†åˆ°Seté›†åˆä¸­  |
| public static  Collector toMap(Function keyMapper,Function valueMapper) | æŠŠå…ƒç´ æ”¶é›†åˆ°Mapé›†åˆä¸­  |
| Object[] toArray()                                           | æŠŠå…ƒç´ æ”¶é›†æ•°ç»„ä¸­       |

```java
public static void main(String[] args) {
	List<String> list = new ArrayList<>();
	Stream<String> stream=list.stream().filter(s -> s.startsWith("å¼ "));    
    //æŠŠstreamæµè½¬æ¢æˆSeté›†åˆã€‚
    Set<String> set = stream.collect(Collectors.toSet());
    
    //æŠŠstreamæµè½¬æ¢æˆListé›†åˆã€‚
    //é‡æ–°å®šä¹‰ï¼Œå› ä¸ºèµ„æºå·²ç»è¢«å…³é—­äº†
    Stream<String> stream1=list.stream().filter(s -> s.startsWith("å¼ "));
    List<String> list = stream.collect(Collectors.toList());
    
    //æŠŠstreamæµè½¬æ¢æˆæ•°ç»„ã€‚
    Stream<String> stream2 =list.stream().filter(s -> s.startsWith("å¼ "));
    Object[] arr = stream2.toArray();
    // å¯ä»¥å€Ÿç”¨æ„é€ å™¨å¼•ç”¨ç”³æ˜è½¬æ¢æˆçš„æ•°ç»„ç±»å‹ï¼ï¼ï¼
    String[] arr1 = stream2.toArray(String[]::new);
}
```



***



### File

#### æ¦‚è¿°

Fileç±»ï¼šä»£è¡¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶å¯¹è±¡ã€‚
Fileç±»ï¼šæ˜¯ç”¨æ¥æ“ä½œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶å¯¹è±¡çš„ï¼Œåˆ é™¤æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶ä¿¡æ¯ï¼Œåˆ›å»ºæ–‡ä»¶ï¼ˆæ–‡ä»¶å¤¹ï¼‰...
			  å¹¿ä¹‰æ¥è¯´æ“ä½œç³»ç»Ÿè®¤ä¸ºæ–‡ä»¶åŒ…å«ï¼ˆæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰

Fileç±»çš„åˆ›å»ºæ–‡ä»¶å¯¹è±¡çš„API:
     åŒ…ï¼šjava.io.File
     æ„é€ å™¨ï¼š
         	public File(String pathname):æ ¹æ®è·¯å¾„è·å–æ–‡ä»¶å¯¹è±¡
       	  public File(String parent , String child):æ ¹æ®çˆ¶è·¯å¾„å’Œæ–‡ä»¶åç§°è·å–æ–‡ä»¶å¯¹è±¡ï¼
       	  public File(File parent , String child)

Fileç±»åˆ›å»ºæ–‡ä»¶å¯¹è±¡çš„æ ¼å¼:
    a.File f = new File("ç»å¯¹è·¯å¾„/ç›¸å¯¹è·¯å¾„");
        ç»å¯¹è·¯å¾„ï¼šä»ç£ç›˜çš„çš„ç›˜ç¬¦ä¸€è·¯èµ°åˆ°ç›®çš„ä½ç½®çš„è·¯å¾„ã€‚
            -- ç»å¯¹è·¯å¾„ä¾èµ–å…·ä½“çš„ç¯å¢ƒï¼Œä¸€æ—¦è„±ç¦»ç¯å¢ƒï¼Œä»£ç å¯èƒ½å‡ºé”™ï¼ï¼
            -- ä¸€èˆ¬æ˜¯å®šä½æŸä¸ªæ“ä½œç³»ç»Ÿä¸­çš„æŸä¸ªæ–‡ä»¶å¯¹è±¡ã€‚
        **ç›¸å¯¹è·¯å¾„**ï¼šä¸å¸¦ç›˜ç¬¦çš„ã€‚ï¼ˆé‡ç‚¹ï¼‰
            -- é»˜è®¤æ˜¯ç›´æ¥ç›¸å¯¹åˆ°å·¥ç¨‹ç›®å½•ä¸‹å¯»æ‰¾æ–‡ä»¶çš„ã€‚
            -- ç›¸å¯¹è·¯å¾„åªèƒ½ç”¨äºå¯»æ‰¾å·¥ç¨‹ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥è·¨å¹³å°ï¼

â€‹    b.File f = new File("æ–‡ä»¶å¯¹è±¡/æ–‡ä»¶å¤¹å¯¹è±¡");
â€‹        å¹¿ä¹‰æ¥è¯´ï¼šæ–‡ä»¶æ˜¯åŒ…å«æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„ã€‚

```java
public class FileDemo{
    public static void main(String[] args) {
        // 1.åˆ›å»ºæ–‡ä»¶å¯¹è±¡ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„
        // æ–‡ä»¶è·¯å¾„åˆ†éš”ç¬¦ï¼š
        //      -- a.ä½¿ç”¨æ­£æ–œæ ï¼š /
        //      -- b.ä½¿ç”¨åæ–œæ ï¼š \\
        //      -- c.ä½¿ç”¨åˆ†éš”ç¬¦API:File.separator
        //File f1 = new File("D:"+File.separator+"itcast"+File.separator
		//+"å›¾ç‰‡èµ„æº"+File.separator+"beautiful.jpg");
        File f1 = new File("D:\\itcast\\å›¾ç‰‡èµ„æº\\beautiful.jpg");
        System.out.println(f1.length()); // è·å–æ–‡ä»¶çš„å¤§å°ï¼Œå­—èŠ‚å¤§å°

        // 2.åˆ›å»ºæ–‡ä»¶å¯¹è±¡ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„
        File f2 = new File("Day09Demo/src/dlei.txt");
        System.out.println(f2.length());

        // 3.åˆ›å»ºæ–‡ä»¶å¯¹è±¡ï¼šä»£è¡¨æ–‡ä»¶å¤¹ã€‚
        File f3 = new File("D:\\itcast\\å›¾ç‰‡èµ„æº");
        System.out.println(f3.exists());// åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼ï¼
    }
}
```



#### API

##### å¸¸ç”¨æ–¹æ³•

`public String getAbsolutePath()` : è¿”å›æ­¤Fileçš„ç»å¯¹è·¯å¾„åå­—ç¬¦ä¸²ã€‚
`public String getPath()` : è·å–åˆ›å»ºæ–‡ä»¶å¯¹è±¡çš„æ—¶å€™ç”¨çš„è·¯å¾„
`public String getName()` : è¿”å›ç”±æ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•çš„åç§°ã€‚
`public long length()` : è¿”å›ç”±æ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶çš„é•¿åº¦ï¼ˆå¤§å°ï¼‰ã€‚
`public long length(FileFilter filter)` : æ–‡ä»¶è¿‡æ»¤å™¨ã€‚

```java
public class FileDemo {
    public static void main(String[] args) {
        // 1.ç»å¯¹è·¯å¾„åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡
        File f1 = new File("E:/å›¾ç‰‡/meinv.jpg");
        // a.è·å–å®ƒçš„ç»å¯¹è·¯å¾„ã€‚
        System.out.println(f1.getAbsolutePath());
        // b.è·å–æ–‡ä»¶å®šä¹‰çš„æ—¶å€™ä½¿ç”¨çš„è·¯å¾„ã€‚
        System.out.println(f1.getPath());
        // c.è·å–æ–‡ä»¶çš„åç§°ï¼šå¸¦åç¼€ã€‚
        System.out.println(f1.getName());
        // d.è·å–æ–‡ä»¶çš„å¤§å°ï¼šå­—èŠ‚ä¸ªæ•°ã€‚
        System.out.println(f1.length());
        System.out.println("------------------------");

        // 2.ç›¸å¯¹è·¯å¾„
        File f2 = new File("Day09Demo/src/dlei01.txt");
        // a.è·å–å®ƒçš„ç»å¯¹è·¯å¾„ã€‚
        System.out.println(f2.getAbsolutePath());
        // b.è·å–æ–‡ä»¶å®šä¹‰çš„æ—¶å€™ä½¿ç”¨çš„è·¯å¾„ã€‚
        System.out.println(f2.getPath());
        // c.è·å–æ–‡ä»¶çš„åç§°ï¼šå¸¦åç¼€ã€‚
        System.out.println(f2.getName());
        // d.è·å–æ–‡ä»¶çš„å¤§å°ï¼šå­—èŠ‚ä¸ªæ•°ã€‚
        System.out.println(f2.length());
    }
}

```



##### åˆ¤æ–­æ–¹æ³•

`public boolean exists()` : æ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å®é™…å­˜åœ¨ã€‚
`public boolean isDirectory()` : æ­¤Fileè¡¨ç¤ºçš„æ˜¯å¦ä¸ºç›®å½•ã€‚
`public boolean isFile()` : æ­¤Fileè¡¨ç¤ºçš„æ˜¯å¦ä¸ºæ–‡ä»¶

```java
File f = new File("Day09Demo/src/dlei01.txt");
// a.åˆ¤æ–­æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨
System.out.println(f.exists()); // true
// b.åˆ¤æ–­æ–‡ä»¶å¯¹è±¡æ˜¯å¦æ˜¯æ–‡ä»¶,æ˜¯æ–‡ä»¶è¿”å›true ,åä¹‹
System.out.println(f.isFile()); // true
// c.åˆ¤æ–­æ–‡ä»¶å¯¹è±¡æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹,æ˜¯æ–‡ä»¶å¤¹è¿”å›true ,åä¹‹
System.out.println(f.isDirectory()); // false
```



##### åˆ›å»ºå’Œåˆ é™¤æ–¹æ³•

`public boolean createNewFile()` : å½“ä¸”ä»…å½“å…·æœ‰è¯¥åç§°çš„æ–‡ä»¶å°šä¸å­˜åœ¨æ—¶ï¼Œ åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶ã€‚
															ï¼ˆå‡ ä¹ä¸ç”¨çš„ï¼Œå› ä¸ºä»¥åæ–‡ä»¶éƒ½æ˜¯è‡ªåŠ¨åˆ›å»ºçš„ï¼ï¼‰
`public boolean delete()` : åˆ é™¤ç”±æ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ ï¼ˆåªèƒ½åˆ é™¤ç©ºç›®å½•ï¼‰
`public boolean mkdir()` : åˆ›å»ºç”±æ­¤Fileè¡¨ç¤ºçš„ç›®å½•ã€‚ï¼ˆåªèƒ½åˆ›å»ºä¸€çº§ç›®å½•ï¼‰
`public boolean mkdirs()` : å¯ä»¥åˆ›å»ºå¤šçº§ç›®å½•ï¼ˆå»ºè®®ä½¿ç”¨çš„ï¼‰

```java
public class FileDemo {
    public static void main(String[] args) throws IOException {
        File f = new File("Day09Demo/src/dlei02.txt");
        // a.åˆ›å»ºæ–°æ–‡ä»¶ï¼Œåˆ›å»ºæˆåŠŸè¿”å›true ,åä¹‹
        System.out.println(f.createNewFile());

        // b.åˆ é™¤æ–‡ä»¶æˆ–è€…ç©ºæ–‡ä»¶å¤¹
        System.out.println(f.delete());
        // ä¸èƒ½åˆ é™¤éç©ºæ–‡ä»¶å¤¹ï¼Œåªèƒ½åˆ é™¤ç©ºæ–‡ä»¶å¤¹
        File f1 = new File("E:/itcast/aaaaa");
        System.out.println(f1.delete());

        // c.åˆ›å»ºä¸€çº§ç›®å½•
        File f2 = new File("E:/bbbb");
        System.out.println(f2.mkdir());

        // d.åˆ›å»ºå¤šçº§ç›®å½•
        File f3 = new File("D:/itcast/e/a/d/ds/fas/fas/fas/fas/fas/fas");
        System.out.println(f3.mkdirs());
    }
}
```



#### éå†ç›®å½•

- `public String[] list()`ï¼š
        è·å–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„"ä¸€çº§æ–‡ä»¶åç§°"åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ä¸­å»è¿”å›ã€‚
- `public File[] listFiles()(å¸¸ç”¨)`ï¼š
        è·å–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„"ä¸€çº§æ–‡ä»¶å¯¹è±¡"åˆ°ä¸€ä¸ª**æ–‡ä»¶å¯¹è±¡æ•°ç»„**ä¸­å»è¿”å›ï¼ˆ**é‡ç‚¹**ï¼‰
- `public long lastModified` :
       è¿”å›æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶ä¸Šæ¬¡ä¿®æ”¹çš„æ—¶é—´ã€‚ 

```java
public class FileDemo {
    public static void main(String[] args) {
        File dir = new File("D:\\itcast");
        // a.è·å–å½“å‰ç›®å½•å¯¹è±¡ä¸‹çš„å…¨éƒ¨ä¸€çº§æ–‡ä»¶åç§°åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„è¿”å›ã€‚
        String[] names = dir.list();
        for (String name : names) {
            System.out.println(name);
        }
        // b.è·å–å½“å‰ç›®å½•å¯¹è±¡ä¸‹çš„å…¨éƒ¨ä¸€çº§æ–‡ä»¶å¯¹è±¡åˆ°ä¸€ä¸ªFileç±»å‹çš„æ•°ç»„è¿”å›ã€‚
        File[] files = dir.listFiles();
        for (File file : files) {
            System.out.println(file.getAbsolutePath());
        }

        // c
        File f1 = new File("D:\\itcast\\å›¾ç‰‡èµ„æº\\beautiful.jpg");
        long time = f1.lastModified(); // æœ€åä¿®æ”¹æ—¶é—´ï¼
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        System.out.println(sdf.format(time));
    }
}
```



#### æ–‡ä»¶æœç´¢

é€’å½’å®ç°æ–‡ä»¶æœç´¢(éè§„å¾‹é€’å½’)
	ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªæ–¹æ³•ç”¨äºåšæœç´¢ã€‚
	ï¼ˆ2ï¼‰è¿›å…¥æ–¹æ³•ä¸­è¿›è¡Œä¸šåŠ¡æœç´¢åˆ†æã€‚

```java
/**
 * å»æŸä¸ªç›®å½•ä¸‹æœç´¢æŸä¸ªæ–‡ä»¶
 * @param dir æœç´¢æ–‡ä»¶çš„ç›®å½•ã€‚
 * @param fileName æœç´¢æ–‡ä»¶çš„åç§°ã€‚
 */
public static void searchFiles(File dir , String fileName){
    // 1.åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥è·¯å¾„ï¼Œæ˜¯å¦æ˜¯æ–‡ä»¶å¤¹
    if(dir.exists() && dir.isDirectory()){
        // 2.æå–å½“å‰ç›®å½•ä¸‹çš„å…¨éƒ¨ä¸€çº§æ–‡ä»¶å¯¹è±¡
        File files = dir.listFiles();// å¯èƒ½æ˜¯null/ä¹Ÿå¯èƒ½æ˜¯ç©ºé›†åˆ[]
        // 3.åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸€çº§æ–‡ä»¶å¯¹è±¡,åˆ¤æ–­æ˜¯å¦ä¸ä¸ºç©ºç›®å½•
        if(files != null && files.length > 0){
            // 4.åˆ¤æ–­ä¸€çº§æ–‡ä»¶å¯¹è±¡
            for(File file : files){
                // 5.åˆ¤æ–­fileæ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹
                if(file.isFile()){
                    // 6.åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦ä¸ºæˆ‘è¦æ‰¾çš„æ–‡ä»¶å¯¹è±¡
                    if(f.getName().contains(fileName)){//æ¨¡ç³ŠæŸ¥æ‰¾
                        sout(f.getAbsolutePath());
                        try {
                            // å¯åŠ¨å®ƒï¼ˆæ‹“å±•ï¼‰
                            Runtime r = Runtime.getRuntime();
                            r.exec(f.getAbsolutePath());
                        } catch (IOException e) {
                            e.printStackTrace();
                        }
                    }
                } else {
                    // 7.è¯¥æ–‡ä»¶æ˜¯æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹è¦é€’å½’è¿›å…¥ç»§ç»­å¯»æ‰¾
                    searchFiles(file,fileName)
                }
            }
        }
    }
}
```



***



### å­—ç¬¦é›†

å­—ç¬¦é›†ï¼šå„ä¸ªå›½å®¶ä¸ºè‡ªå·±å›½å®¶çš„å­—ç¬¦å–çš„ä¸€å¥—ç¼–å·è§„åˆ™ã€‚
	è®¡ç®—æœºçš„åº•å±‚æ˜¯ä¸èƒ½ç›´æ¥å­˜å‚¨å­—ç¬¦çš„ï¼Œåªèƒ½å­˜å‚¨äºŒè¿›åˆ¶ï¼Œ010101ã€‚

ç¾å›½äººï¼š
    8ä¸ªå¼€å…³ä¸€ç»„å°±å¯ä»¥ç¼–ç å­—ç¬¦ã€‚ 1ä¸ªå­—èŠ‚ã€‚
    2^8 = 256
    ä¸€ä¸ªå­—èŠ‚å­˜å‚¨ä¸€ä¸ªå­—ç¬¦å®Œå…¨å¤Ÿç”¨äº†ã€‚

â€‹    a  97
â€‹    b  98

â€‹    A  65
â€‹    B  66

â€‹    0  48
â€‹    1  49
â€‹    è¿™å¥—ç¼–ç æ˜¯ASCIIç¼–ç ã€‚
â€‹	è‹±æ–‡å’Œæ•°å­—åœ¨åº•å±‚å­˜å‚¨çš„æ—¶å€™éƒ½æ˜¯é‡‡ç”¨1ä¸ªå­—èŠ‚å­˜å‚¨çš„ã€‚

ä¸­å›½äººï¼š
    ä¸­å›½äººçš„å­—ç¬¦å¾ˆå¤šï¼š9ä¸‡å·¦å³å­—ç¬¦ã€‚
    2ä¸ªå­—èŠ‚ç¼–ç ä¸€ä¸ªä¸­æ–‡å­—ç¬¦ï¼Œ1ä¸ªå­—èŠ‚ç¼–ç ä¸€ä¸ªè‹±æ–‡å­—ç¬¦ã€‚
    è¿™å¥—ç¼–ç å«ï¼šGBKç¼–ç ã€‚
    å®ƒä¹Ÿå¿…é¡»å…¼å®¹ASCIIç¼–ç è¡¨ã€‚

ç¾å›½äººï¼š
    æˆ‘æ¥æ”¶é›†å…¨çƒæ‰€æœ‰çš„å­—ç¬¦ï¼Œç»Ÿä¸€ç¼–å·ã€‚è¿™å¥—ç¼–ç å« Unicodeç¼–ç ï¼ˆä¸‡å›½ç ï¼‰
	ä¸€ä¸ªè‹±æ–‡ç­‰äºä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªä¸­æ–‡ï¼ˆå«ç¹ä½“ï¼‰ç­‰äºä¸¤ä¸ªå­—èŠ‚ã€‚ä¸­æ–‡æ ‡ç‚¹å ä¸¤ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡æ ‡ç‚¹å ä¸¤ä¸ªå­—èŠ‚

â€‹    UTF-8å°±æ˜¯å˜ç§å½¢å¼ï¼Œå®ƒä¹Ÿå¿…é¡»å…¼å®¹ASCIIç¼–ç è¡¨ã€‚
â€‹    UTF-8ä¸€ä¸ªä¸­æ–‡ä¸€èˆ¬å 3ä¸ªå­—èŠ‚ï¼Œä¸­æ–‡æ ‡ç‚¹å 3ä¸ªã€‚è‹±æ–‡å­—æ¯å’Œæ•°å­—1ä¸ªå­—èŠ‚
â€‹    

ç¼–ç å‰ä¸ç¼–ç åçš„ç¼–ç é›†å¿…é¡»ä¸€è‡´æ‰ä¸ä¼šä¹±ç !!



***



### IOæµ

#### æ¦‚è¿°

IOè¾“å…¥è¾“å‡ºæµï¼šè¾“å…¥/è¾“å‡ºæµ
    Inputï¼šè¾“å…¥
    Outputï¼šè¾“å‡º

å¼•å…¥ï¼šFileç±»åªèƒ½æ“ä½œæ–‡ä»¶å¯¹è±¡æœ¬èº«ï¼Œä¸èƒ½è¯»å†™æ–‡ä»¶å¯¹è±¡çš„å†…å®¹ï¼Œè¯»å†™æ•°æ®å†…å®¹ï¼Œåº”è¯¥ä½¿ç”¨IOæµ

IOæµæ˜¯ä¸€ä¸ªæ°´æµæ¨¡å‹ï¼šIOç†è§£æˆæ°´ç®¡ï¼ŒæŠŠæ•°æ®ç†è§£æˆæ°´æµã€‚

IOæµçš„åˆ†ç±»ï¼š

* æŒ‰ç…§æµçš„æ–¹å‘åˆ†ä¸ºï¼šè¾“å…¥æµï¼Œè¾“å‡ºæµã€‚
  * è¾“å‡ºæµï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠå†…å­˜ä¸­çš„æ•°æ®å†™å‡ºåˆ°ç£ç›˜æ–‡ä»¶æˆ–è€…ç½‘ç»œä»‹è´¨ä¸­å»çš„æµç§°ä¸ºè¾“å‡ºæµ
    è¾“å‡ºæµçš„ä½œç”¨ï¼šå†™æ•°æ®åˆ°æ–‡ä»¶ï¼Œæˆ–è€…å†™æ•°æ®å‘é€ç»™åˆ«äºº
  * è¾“å…¥æµï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠç£ç›˜æ–‡ä»¶ä¸­çš„æ•°æ®æˆ–è€…ç½‘ç»œä¸­çš„æ•°æ®è¯»å…¥åˆ°å†…å­˜ä¸­çš„æµç§°ä¸ºè¾“å…¥æµ
    è¾“å…¥æµçš„ä½œç”¨ï¼šè¯»å–æ•°æ®åˆ°å†…å­˜
* æŒ‰ç…§æµçš„å†…å®¹åˆ†ä¸ºï¼šå­—èŠ‚æµï¼Œå­—ç¬¦æµ
  * å­—èŠ‚æµï¼šæµä¸­çš„æ•°æ®çš„æœ€å°å•ä½æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„å­—èŠ‚ï¼Œè¿™ä¸ªæµå°±æ˜¯å­—èŠ‚æµ
  * å­—ç¬¦æµï¼šæµä¸­çš„æ•°æ®çš„æœ€å°å•ä½æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„å­—ç¬¦ï¼Œè¿™ä¸ªæµå°±æ˜¯å­—ç¬¦æµï¼ˆ**é’ˆå¯¹äºæ–‡æœ¬å†…å®¹**ï¼‰

æµå¤§ä½“åˆ†ä¸ºå››å¤§ç±»ï¼š

* å­—èŠ‚è¾“å…¥æµï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠç£ç›˜æ–‡ä»¶ä¸­çš„æ•°æ®æˆ–è€…ç½‘ç»œä¸­çš„æ•°æ®ä»¥ä¸€ä¸ªä¸€ä¸ªçš„å­—èŠ‚çš„å½¢å¼è¯»å…¥åˆ°å†…å­˜ä¸­å»çš„æµç§°ä¸ºå­—èŠ‚è¾“å…¥æµ
* å­—èŠ‚è¾“å‡ºæµï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠå†…å­˜ä¸­çš„æ•°æ®ä»¥ä¸€ä¸ªä¸€ä¸ªçš„å­—èŠ‚å†™å‡ºåˆ°ç£ç›˜æ–‡ä»¶æˆ–è€…ç½‘ç»œä»‹è´¨ä¸­å»çš„æµç§°ä¸ºå­—èŠ‚è¾“å‡ºæµ
* å­—ç¬¦è¾“å…¥æµï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠç£ç›˜æ–‡ä»¶ä¸­çš„æ•°æ®æˆ–è€…ç½‘ç»œä¸­çš„æ•°æ®ä»¥ä¸€ä¸ªä¸€ä¸ªçš„å­—ç¬¦çš„å½¢å¼è¯»å…¥åˆ°å†…å­˜ä¸­å»çš„æµç§°ä¸ºå­—ç¬¦è¾“å…¥æµ
* å­—ç¬¦è¾“å‡ºæµï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠå†…å­˜ä¸­çš„æ•°æ®ä»¥ä¸€ä¸ªä¸€ä¸ªçš„å­—ç¬¦å†™å‡ºåˆ°ç£ç›˜æ–‡ä»¶æˆ–è€…ç½‘ç»œä»‹è´¨ä¸­å»çš„æµç§°ä¸ºå­—ç¬¦è¾“å‡ºæµ

```java
IOæµçš„ä½“ç³»ï¼š
        å­—èŠ‚æµ                                   å­—ç¬¦æµ
  å­—èŠ‚è¾“å…¥æµ              å­—èŠ‚è¾“å‡ºæµ            å­—ç¬¦è¾“å…¥æµ         å­—ç¬¦è¾“å‡ºæµ
InputStream           OutputStream          Reader            Writer   (æŠ½è±¡ç±»)
FileInputStream       FileOutputStream      FileReader        FileWriter(å®ç°ç±»)
BufferedInputStream  BufferedOutputStream  BufferedReader   BufferedWriter(å®ç°ç±»ç¼“å†²æµ)
                                           InputStreamReader OutputStreamWriter
ObjectInputStream     ObjectOutputStream
```



****



#### å­—èŠ‚æµ

##### å­—èŠ‚è¾“å…¥æµ

FileInputStreamæ–‡ä»¶å­—èŠ‚è¾“å…¥æµï¼š

* ä½œç”¨ï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠç£ç›˜æ–‡ä»¶ä¸­çš„æ•°æ®æŒ‰ç…§å­—èŠ‚çš„å½¢å¼è¯»å…¥åˆ°å†…å­˜ä¸­çš„æµï¼Œå°±æ˜¯æŒ‰ç…§å­—èŠ‚è¯»å–æ–‡ä»¶æ•°æ®åˆ°å†…å­˜

* æ„é€ å™¨ï¼š
  `public FileInputStream(File path)` : åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å…¥æµç®¡é“ä¸æºæ–‡ä»¶å¯¹è±¡æ¥é€š
  `public FileInputStream(String pathName)` : åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å…¥æµç®¡é“ä¸æ–‡ä»¶è·¯å¾„å¯¹æ¥ï¼Œ
  																					  åº•å±‚å®è´¨ä¸Šåˆ›å»ºäº†Fileå¯¹è±¡ 

* æ–¹æ³•ï¼š
  `public int read()` : æ¯æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚è¿”å›ï¼è¯»å–å®Œæ¯•ä¼šè¿”å›-1
  `public int read(byte[] buffer)`:ä»å­—èŠ‚è¾“å…¥æµä¸­è¯»å–å­—èŠ‚åˆ°å­—èŠ‚æ•°ç»„ä¸­å»ï¼Œ
                 							 è¿”å›è¯»å–çš„å­—èŠ‚æ•°é‡ï¼Œæ²¡æœ‰å­—èŠ‚å¯è¯»è¿”å›-1ã€‚
  											**byteä¸­æ–°è¯»å–çš„æ•°æ®é»˜è®¤æ˜¯è¦†ç›–åŸæ•°æ®**ï¼Œæ„é€ Stringéœ€è¦è®¾å®šé•¿åº¦
  `public String(byte[] bytes,int offset,int length)` : æ„é€ æ–°çš„String
  `public long transferTo(OutputStream out) `: ä»è¾“å…¥æµä¸­è¯»å–æ‰€æœ‰å­—èŠ‚ï¼Œå¹¶æŒ‰è¯»å–çš„é¡ºåº
  											å°†å­—èŠ‚å†™å…¥ç»™å®šçš„è¾“å‡ºæµ(jdk9ä»¥åçš„æ–°æ–¹æ³•)`is.transferTo(os)`

```java
public class FileInputStreamDemo01 {
    public static void main(String[] args) throws Exception {
        // 1.åˆ›å»ºæ–‡ä»¶å¯¹è±¡å®šä½dlei01.txt
        File file = new File("Day09Demo/src/dlei01.txt");
        // 2.åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å…¥æµç®¡é“ä¸æºæ–‡ä»¶æ¥é€š
        InputStream is = new FileInputStream(file);
        // 3.è¯»å–ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·è¿”å›ï¼Œè¯»å–å®Œæ¯•è¿”å›-1
		//int code1 = is.read(); // è¯»å–ä¸€æ»´æ°´ï¼Œä¸€ä¸ªå­—èŠ‚
		//System.out.println((char)code1);

        // 4.ä½¿ç”¨whileè¯»å–å­—èŠ‚æ•°
        // å®šä¹‰ä¸€ä¸ªæ•´æ•°å˜é‡å­˜å‚¨å­—èŠ‚
        int ch = 0 ;
        while((ch = is.read())!= -1){
            System.out.print((char) ch);
        }
    }
}
```

ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚è¯»å–è‹±æ–‡å’Œæ•°å­—æ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯ä¸€æ—¦è¯»å–ä¸­æ–‡è¾“å‡ºæ— æ³•é¿å…ä¹±ç ï¼Œå› ä¸ºä¼šæˆªæ–­ä¸­æ–‡çš„å­—èŠ‚ã€‚ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚çš„è¯»å–æ•°æ®ï¼Œæ€§èƒ½ä¹Ÿè¾ƒå·®ï¼Œæ‰€ä»¥**ç¦æ­¢ä½¿ç”¨ä¸Šé¢çš„æ–¹æ¡ˆ**ï¼

é‡‡å–ä¸‹é¢çš„æ–¹æ¡ˆï¼š

```java
public static void main(String[] args) throws Exception {
    //ç®€åŒ–å†™æ³•ï¼Œåº•å±‚å®è´¨ä¸Šåˆ›å»ºäº†Fileå¯¹è±¡
    InputStream is = new FileInputStream("Day09Demo/src/dlei01.txt");
    byte[] buffer = new byte[3];//å¼€å‘ä¸­ä½¿ç”¨byte[1024]
    int len;
    while((len = is.read(buffer))!=-1){
        // è¯»å–äº†å¤šå°‘å°±å€’å‡ºå¤šå°‘ï¼
        String rs = new String(buffer,0,len);!!!!!!!!!!!
        System.out.print(rs);
    }
}
```

```java
//å®šä¹‰ä¸€ä¸ªå­—èŠ‚æ•°ç»„ä¸æ–‡ä»¶çš„å¤§å°åˆšåˆšä¸€æ ·å¤§ï¼Œç„¶åä¸€æ¡¶æ°´è¯»å–å…¨éƒ¨å­—èŠ‚æ•°æ®å†è¾“å‡ºï¼
//å¯ä»¥é¿å…ä¸­æ–‡è¯»å–è¾“å‡ºä¹±ç ï¼Œä½†æ˜¯å¦‚æœè¯»å–çš„æ–‡ä»¶è¿‡å¤§ï¼Œä¼šå‡ºç°å†…å­˜æº¢å‡ºï¼ï¼
//å­—èŠ‚æµå¹¶ä¸é€‚åˆè¯»å–æ–‡æœ¬æ–‡ä»¶å†…å®¹è¾“å‡ºï¼Œè¯»å†™æ–‡ä»¶å†…å®¹å»ºè®®ä½¿ç”¨å­—ç¬¦æµã€‚
/*
	byte[] buffer = new byte[(int) f.length()];
	int len = is.read(buffer);
	String rs = new String(buffer);
*/

File f = new File("Day09Demo/src/dlei03.txt");
InputStream is = new FileInputStream(f);
byte[] buffer = is.readAllBytes();
String rs = new String(buffer);
System.out.println(rs);
```



##### å­—èŠ‚è¾“å‡ºæµ

FileOutputStreamæ–‡ä»¶å­—èŠ‚è¾“å‡ºæµï¼š

* ä½œç”¨ï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠå†…å­˜ä¸­çš„æ•°æ®ï¼ŒæŒ‰ç…§å­—èŠ‚çš„å½¢å¼å†™å‡ºåˆ°ç£ç›˜æ–‡ä»¶ä¸­å»ï¼Œå°±æ˜¯æŠŠå†…å­˜æ•°æ®æŒ‰ç…§å­—èŠ‚å†™å‡ºåˆ°ç£ç›˜æ–‡ä»¶ä¸­å»

* æ„é€ å™¨ï¼š
  `public FileOutputStream(File file)` : åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµç®¡é“é€šå‘ç›®æ ‡æ–‡ä»¶å¯¹è±¡
  `public FileOutputStream(String file) ` : åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµç®¡é“é€šå‘ç›®æ ‡æ–‡ä»¶è·¯å¾„
  `public FileOutputStream(File file , boolean append)` :
  										                  åˆ›å»ºä¸€ä¸ªè¿½åŠ æ•°æ®çš„å­—èŠ‚è¾“å‡ºæµç®¡é“é€šå‘ç›®æ ‡æ–‡ä»¶å¯¹è±¡
  `public FileOutputStream(String file , boolean append)  `:
  										                  åˆ›å»ºä¸€ä¸ªè¿½åŠ æ•°æ®çš„å­—èŠ‚è¾“å‡ºæµç®¡é“é€šå‘ç›®æ ‡æ–‡ä»¶è·¯å¾„
* APIï¼š
  `public void write(int a)` : å†™ä¸€ä¸ªå­—èŠ‚å‡ºå» 
  `public void write(byte[] buffer)` :å†™ä¸€ä¸ªå­—èŠ‚æ•°ç»„å‡ºå»
  `public void write(byte[] buffer , int pos , int len)` : å†™ä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„ä¸€éƒ¨åˆ†å‡ºå»
                      å‚æ•°ä¸€ï¼Œå­—èŠ‚æ•°ç»„ï¼›å‚æ•°äºŒï¼šèµ·å§‹å­—èŠ‚ç´¢å¼•ä½ç½®ï¼Œå‚æ•°ä¸‰ï¼šå†™å¤šå°‘ä¸ªå­—èŠ‚æ•°å‡ºå»ã€‚



* FileOutputStreamå­—èŠ‚è¾“å‡ºæµæ¯æ¬¡å¯åŠ¨å†™æ•°æ®çš„æ—¶å€™éƒ½ä¼šå…ˆæ¸…ç©ºä¹‹å‰çš„å…¨éƒ¨æ•°æ®ï¼Œé‡æ–°å†™å…¥ï¼š
  `OutputStream os = new FileOutputStream("Day09Demo/out05")` : è¦†ç›–æ•°æ®ç®¡é“
  `OutputStream os = new FileOutputStream("Day09Demo/out05" , true)` : è¿½åŠ æ•°æ®çš„ç®¡é“ 

å°ç»“ï¼š
		å­—èŠ‚è¾“å‡ºæµåªèƒ½å†™å­—èŠ‚å‡ºå»ã€‚
		å­—èŠ‚è¾“å‡ºæµé»˜è®¤æ˜¯**è¦†ç›–**æ•°æ®ç®¡é“ã€‚
		æ¢è¡Œç”¨ï¼š **os.write("\r\n".getBytes());**
		å…³é—­å’Œåˆ·æ–°ï¼šåˆ·æ–°æµå¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œå…³é—­åŒ…å«åˆ·æ–°æ•°æ®ä½†æ˜¯æµå°±ä¸èƒ½ä½¿ç”¨äº†ï¼

```java
OutputStream os = new FileOutputStream("Day09Demo/out05");
os.write(97);//a
os.write('b');
os.write("\r\n".getBytes());
os.write("æˆ‘çˆ±Java".getBytes());
os.close();
```



##### æ–‡ä»¶å¤åˆ¶

æ€æƒ³ï¼š
	å­—èŠ‚æ˜¯è®¡ç®—æœºä¸­ä¸€åˆ‡æ–‡ä»¶çš„ç»„æˆï¼Œæ‰€ä»¥å­—èŠ‚æµé€‚åˆåšä¸€åˆ‡æ–‡ä»¶çš„å¤åˆ¶ã€‚

åˆ†ææ­¥éª¤ï¼š
    ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å…¥æµç®¡é“ä¸æºæ–‡ä»¶æ¥é€šã€‚
    ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµä¸ç›®æ ‡æ–‡ä»¶æ¥é€šã€‚
    ï¼ˆ3ï¼‰åˆ›å»ºä¸€ä¸ªå­—èŠ‚æ•°ç»„ä½œä¸ºæ¡¶
    ï¼ˆ4ï¼‰ä»å­—èŠ‚è¾“å…¥æµç®¡é“ä¸­è¯»å–æ•°æ®ï¼Œå†™å‡ºåˆ°å­—èŠ‚è¾“å‡ºæµç®¡é“å³å¯ã€‚
    ï¼ˆ5ï¼‰å…³é—­èµ„æºï¼

```java
public class CopyDemo01 {
    public static void main(String[] args) {
        InputStream is = null ;
        OutputStream os = null ;
        try{
            //ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å…¥æµç®¡é“ä¸æºæ–‡ä»¶æ¥é€šã€‚
            is = new FileInputStream("D:\\itcast\\å›¾ç‰‡èµ„æº\\meinv.jpg");
            //ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµä¸ç›®æ ‡æ–‡ä»¶æ¥é€šã€‚
            os = new FileOutputStream("D:\\itcast\\meimei.jpg");
            //ï¼ˆ3ï¼‰åˆ›å»ºä¸€ä¸ªå­—èŠ‚æ•°ç»„ä½œä¸ºæ¡¶
            byte buffer = new byte[1024];
            //ï¼ˆ4ï¼‰ä»å­—èŠ‚è¾“å…¥æµç®¡é“ä¸­è¯»å–æ•°æ®ï¼Œå†™å‡ºåˆ°å­—èŠ‚è¾“å‡ºæµç®¡é“å³å¯
            int len = 0;
            while((len = is.read(buffer)) != -1){
                os.write(buffer,0,len);
            }
            System.out.println("å¤åˆ¶å®Œæˆï¼");
        }catch (Exception e){
            e.printStackTrace();
        } finally {
            /**ï¼ˆ5ï¼‰å…³é—­èµ„æºï¼ */
            try{
                if(os!=null)os.close();
                if(is!=null)is.close();
            }catch (Exception e){
                e.printStackTrace();
            }
        }
    }
}
```



***



#### å­—ç¬¦æµ

##### å­—ç¬¦è¾“å…¥æµ

FileReader:æ–‡ä»¶å­—ç¬¦è¾“å…¥æµã€‚

   * ä½œç”¨ï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠç£ç›˜æ–‡ä»¶çš„æ•°æ®ä»¥å­—ç¬¦çš„å½¢å¼è¯»å…¥åˆ°å†…å­˜ï¼Œè¯»å–æ–‡æœ¬æ–‡ä»¶å†…å®¹åˆ°å†…å­˜ä¸­å»ã€‚
   * æ„é€ å™¨ï¼š
            `public FileReader(File file)` : åˆ›å»ºä¸€ä¸ªå­—ç¬¦è¾“å…¥æµä¸æºæ–‡ä»¶å¯¹è±¡æ¥é€šã€‚
            `public FileReader(String filePath)` : åˆ›å»ºä¸€ä¸ªå­—ç¬¦è¾“å…¥æµä¸æºæ–‡ä»¶è·¯å¾„æ¥é€šã€‚
   * æ–¹æ³•ï¼š
            `public int read()` : è¯»å–ä¸€ä¸ªå­—ç¬¦çš„ç¼–å·è¿”å›ï¼ è¯»å–å®Œæ¯•è¿”å›-1
            `public int read(char[] buffer)` : è¯»å–ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œè¯»å–å¤šå°‘ä¸ªå°±è¿”å›å¤šå°‘ä¸ªï¼Œè¯»å–å®Œæ¯•è¿”å›-1
   * ç»“è®ºï¼š
     å­—ç¬¦æµä¸€ä¸ªä¸€ä¸ªå­—ç¬¦çš„è¯»å–æ–‡æœ¬å†…å®¹è¾“å‡ºï¼Œå¯ä»¥è§£å†³ä¸­æ–‡è¯»å–è¾“å‡ºä¹±ç çš„é—®é¢˜ï¼Œé€‚åˆæ“ä½œæ–‡æœ¬æ–‡ä»¶ã€‚
     ä½†æ˜¯ï¼šä¸€ä¸ªä¸€ä¸ªå­—ç¬¦çš„è¯»å–æ–‡æœ¬å†…å®¹æ€§èƒ½è¾ƒå·®ï¼ï¼
     å­—ç¬¦æµæŒ‰ç…§**å­—ç¬¦æ•°ç»„å¾ªç¯è¯»å–æ•°æ®**ï¼Œå¯ä»¥è§£å†³ä¸­æ–‡è¯»å–è¾“å‡ºä¹±ç çš„é—®é¢˜ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿè¾ƒå¥½ï¼ï¼
   * **å­—ç¬¦æµä¸èƒ½å¤åˆ¶å›¾ç‰‡ï¼Œè§†é¢‘ç­‰ç±»å‹çš„æ–‡ä»¶**ã€‚å­—ç¬¦æµåœ¨è¯»å–å®Œäº†å­—èŠ‚æ•°æ®åå¹¶æ²¡æœ‰ç›´æ¥å¾€ç›®çš„åœ°å†™ï¼Œè€Œæ˜¯å…ˆæŸ¥ç¼–ç è¡¨ï¼ŒæŸ¥åˆ°å¯¹åº”çš„æ•°æ®å°±å°†è¯¥æ•°æ®å†™å…¥ç›®çš„åœ°ã€‚å¦‚æœæŸ¥ä¸åˆ°ï¼Œåˆ™ç è¡¨ä¼šå°†ä¸€äº›æœªçŸ¥åŒºåŸŸä¸­çš„æ•°æ®å»mapè¿™äº›å­—èŠ‚æ•°æ®ï¼Œç„¶åå†™åˆ°ç›®çš„åœ°ï¼Œè¿™æ ·çš„è¯å°±é€ æˆäº†æºæ•°æ®å’Œç›®çš„æ•°æ®çš„ä¸ä¸€è‡´ã€‚

```java
public class FileReaderDemo01{//å­—ç¬¦
    public static void main(String[] args) throws Exception {
        // 1.åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡å®šä½æºæ–‡ä»¶
        // File f = new File("Day10Demo/src/dlei01.txt");
        // 2.åˆ›å»ºä¸€ä¸ªå­—ç¬¦è¾“å…¥æµç®¡é“ä¸æºæ–‡ä»¶æ¥é€š
        // Reader fr = new FileReader(f);
        // 3.ç®€åŒ–å†™æ³•ï¼šåˆ›å»ºä¸€ä¸ªå­—ç¬¦è¾“å…¥æµç®¡é“ä¸æºæ–‡ä»¶è·¯å¾„æ¥é€š
        Reader fr = new FileReader("Day10Demo/src/dlei01.txt");
        //int code1 = fr.read();
		//System.out.print((char)code1);
        int ch;
        while((ch = fr.read()) != -1){
            System.out.print((char)ch);
        }
    }
}
public class FileReaderDemo02 {//å­—ç¬¦æ•°ç»„
    public static void main(String[] args) throws Exception {
        Reader fr = new FileReader("Day10Demo/src/dlei01.txt");
        
        //char[] buffer = new char[3];
		//int len = fr.read(buffer);
		//System.out.println("å­—ç¬¦æ•°ï¼š"+len);
		//String rs = new String(buffer,0,len);
		//System.out.println(rs);
        char[] buffer = new char[1024];
        int len;
        while((len = fr.read(buffer)) != -1) {
            System.out.print(new String(buffer, 0 , len));
        }
    }
}
```



##### å­—ç¬¦è¾“å‡ºæµ

FileWriteræ–‡ä»¶å­—ç¬¦è¾“å‡ºæµçš„ä½¿ç”¨ã€‚

* ä½œç”¨ï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠå†…å­˜ä¸­çš„æ•°æ®æŒ‰ç…§å­—ç¬¦çš„å½¢å¼å†™å‡ºåˆ°ç£ç›˜æ–‡ä»¶ä¸­å»ã€‚
         ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠå†…å­˜çš„æ•°æ®ä»¥å­—ç¬¦å†™å‡ºåˆ°æ–‡ä»¶ä¸­å»ã€‚
* æ„é€ å™¨ï¼š
     `public FileWriter(File file)` : åˆ›å»ºä¸€ä¸ªå­—ç¬¦è¾“å‡ºæµç®¡é“é€šå‘ç›®æ ‡æ–‡ä»¶å¯¹è±¡ã€‚
    `public FileWriter(String filePath)` : åˆ›å»ºä¸€ä¸ªå­—ç¬¦è¾“å‡ºæµç®¡é“é€šå‘ç›®æ ‡æ–‡ä»¶è·¯å¾„ã€‚
    `public FileWriter(File file,boolean append)` : åˆ›å»ºä¸€ä¸ªè¿½åŠ æ•°æ®çš„å­—ç¬¦è¾“å‡ºæµç®¡é“é€šå‘æ–‡ä»¶å¯¹è±¡
    `public FileWriter(String filePath,boolean append)` : åˆ›å»ºä¸€ä¸ªè¿½åŠ æ•°æ®çš„å­—ç¬¦è¾“å‡ºæµç®¡é“é€šå‘ç›®æ ‡æ–‡ä»¶è·¯å¾„ã€‚
* æ–¹æ³•ï¼š
      `public void write(int c)` : å†™ä¸€ä¸ªå­—ç¬¦å‡ºå»
      `public void write(String c)` : å†™ä¸€ä¸ªå­—ç¬¦ä¸²å‡ºå»
      `public void write(char[] buffer)` : å†™ä¸€ä¸ªå­—ç¬¦æ•°ç»„å‡ºå»
      `public void write(String c ,int pos ,int len)` : å†™å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‡ºå»
      `public void write(char[] buffer ,int pos ,int len)` : å†™å­—ç¬¦æ•°ç»„çš„ä¸€éƒ¨åˆ†å‡ºå»
* ç»“è®ºï¼š
          è¦†ç›–æ•°æ®ç®¡é“ï¼š`Writer fw = new FileWriter("Day10Demo/src/dlei03.txt"); `
          è¿½åŠ æ•°æ®ç®¡é“ï¼š`Writer fw = new FileWriter("Day10Demo/src/dlei03.txt",true);`
          æ¢è¡Œï¼šfw.write("\r\n"); // æ¢è¡Œ
          è¯»å†™å­—ç¬¦æ–‡ä»¶æ•°æ®å»ºè®®ä½¿ç”¨å­—ç¬¦æµã€‚

```java
Writer fw = new FileWriter("Day10Demo/src/dlei03.txt");
fw.write(97);   // å­—ç¬¦a
fw.write('b');  // å­—ç¬¦b
fw.write("Javaæ˜¯æœ€ä¼˜ç¾çš„è¯­è¨€ï¼");
fw.write("\r\n");
fw.close;
```



****



#### ç¼“å†²æµ

##### æ¦‚è¿°

ä½œç”¨ï¼šç¼“å†²æµå¯ä»¥æé«˜å­—èŠ‚æµå’Œå­—ç¬¦æµçš„è¯»å†™æ•°æ®çš„æ€§èƒ½ã€‚

ç¼“å†²æµåˆ†ä¸ºå››ç±»ï¼š
    ï¼ˆ1ï¼‰BufferedInputStreamï¼šå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼Œå¯ä»¥æé«˜å­—èŠ‚è¾“å…¥æµè¯»æ•°æ®çš„æ€§èƒ½ã€‚
    ï¼ˆ2ï¼‰BufferedOutStreamï¼š  å­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼Œå¯ä»¥æé«˜å­—èŠ‚è¾“å‡ºæµå†™æ•°æ®çš„æ€§èƒ½ã€‚
    ï¼ˆ3ï¼‰BufferedReaderï¼š  å­—ç¬¦ç¼“å†²è¾“å…¥æµï¼Œå¯ä»¥æé«˜å­—ç¬¦è¾“å…¥æµè¯»æ•°æ®çš„æ€§èƒ½ã€‚
    ï¼ˆ4ï¼‰BufferedWriterï¼š  å­—ç¬¦ç¼“å†²è¾“å‡ºæµï¼Œå¯ä»¥æé«˜å­—ç¬¦è¾“å‡ºæµå†™æ•°æ®çš„æ€§èƒ½ã€‚



##### å­—èŠ‚ç¼“å†²è¾“å…¥æµ

å­—èŠ‚ç¼“å†²è¾“å…¥æµï¼šBufferedInputStream
	ä½œç”¨ï¼šå¯ä»¥æŠŠä½çº§çš„å­—èŠ‚è¾“å…¥æµåŒ…è£…æˆä¸€ä¸ªé«˜çº§çš„ç¼“å†²å­—èŠ‚è¾“å…¥æµç®¡é“, æé«˜å­—èŠ‚è¾“å…¥æµè¯»æ•°æ®çš„æ€§èƒ½ã€‚
	æ„é€ å™¨: `public BufferedInputStream(InputStream in)`
	åŸç†ï¼šç¼“å†²å­—èŠ‚è¾“å…¥æµç®¡é“è‡ªå¸¦äº†ä¸€ä¸ª8KBçš„ç¼“å†²æ± ï¼Œæ¯æ¬¡å¯ä»¥ç›´æ¥å€Ÿç”¨æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½æœ€å¤šæå–8KB
           	çš„æ•°æ®åˆ°ç¼“å†²æ± ä¸­å»ï¼Œä»¥åæˆ‘ä»¬ç›´æ¥ä»ç¼“å†²æ± è¯»å–æ•°æ®ï¼Œæ‰€ä»¥æ€§èƒ½è¾ƒå¥½

```java
public class BufferedInputStreamDemo01 {
    public static void main(String[] args) throws Exception {
        // 1.å®šä¹‰ä¸€ä¸ªä½çº§çš„å­—èŠ‚è¾“å…¥æµä¸æºæ–‡ä»¶æ¥é€š
        InputStream is = new FileInputStream("Day10Demo/src/dlei04.txt");
        // 2.æŠŠä½çº§çš„å­—èŠ‚è¾“å…¥æµåŒ…è£…æˆä¸€ä¸ªé«˜çº§çš„ç¼“å†²å­—èŠ‚è¾“å…¥æµã€‚
        BufferInputStream bis = new BufferInputStream(is);
        // 3.å®šä¹‰ä¸€ä¸ªå­—èŠ‚æ•°ç»„æŒ‰ç…§å¾ªç¯è¯»å–ã€‚
        byte[] buffer = new byte[1024];
        int len;
        while((len = bis.read(buffer)) != -1){
            String rs = new String(buffer, 0 , len);
            System.out.print(rs);
        }
    }
}
```



##### å­—èŠ‚ç¼“å†²è¾“å‡ºæµ

å­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼šBufferedOutputStream
	ä½œç”¨ï¼šå¯ä»¥æŠŠä½çº§çš„å­—èŠ‚è¾“å‡ºæµåŒ…è£…æˆä¸€ä¸ªé«˜çº§çš„ç¼“å†²å­—èŠ‚è¾“å‡ºæµï¼Œä»è€Œæé«˜å†™æ•°æ®çš„æ€§èƒ½ã€‚
	æ„é€ å™¨ï¼š`public BufferedOutputStream(OutputStream os)`
	åŸç†ï¼šç¼“å†²å­—èŠ‚è¾“å‡ºæµè‡ªå¸¦äº†8KBç¼“å†²æ± ,æ•°æ®å°±ç›´æ¥å†™å…¥åˆ°ç¼“å†²æ± ä¸­å»ï¼Œæ€§èƒ½æé«˜äº†ï¼

```java
public class BufferedOutputStreamDemo02 {
    public static void main(String[] args) throws Exception {
        // 1.å†™ä¸€ä¸ªåŸå§‹çš„å­—èŠ‚è¾“å‡ºæµ
        OutputStream os = new FileOutputStream("Day10Demo/src/dlei05.txt");
        // 2.æŠŠä½çº§çš„å­—èŠ‚è¾“å‡ºæµåŒ…è£…æˆä¸€ä¸ªé«˜çº§çš„ç¼“å†²å­—èŠ‚è¾“å‡ºæµ
        BufferedOutputStream bos =  new BufferedOutputStream(os);
        // 3.å†™æ•°æ®å‡ºå»
        bos.write('a');
        bos.write(100);
        bos.write("æˆ‘çˆ±ä¸­å›½".getBytes());
        bos.close();
    }
}

```



##### å­—èŠ‚æµçš„æ€§èƒ½åˆ†æ

åˆ©ç”¨å­—èŠ‚æµçš„å¤åˆ¶ç»Ÿè®¡å„ç§å†™æ³•å½¢å¼ä¸‹ç¼“å†²æµçš„æ€§èƒ½æ‰§è¡Œæƒ…å†µã€‚

å¤åˆ¶æµï¼š
    ï¼ˆ1ï¼‰ä½¿ç”¨ä½çº§çš„å­—èŠ‚æµæŒ‰ç…§ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚çš„å½¢å¼å¤åˆ¶æ–‡ä»¶ã€‚
    ï¼ˆ2ï¼‰ä½¿ç”¨ä½çº§çš„å­—èŠ‚æµæŒ‰ç…§ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„å½¢å¼å¤åˆ¶æ–‡ä»¶ã€‚
    ï¼ˆ3ï¼‰ä½¿ç”¨é«˜çº§çš„ç¼“å†²å­—èŠ‚æµæŒ‰ç…§ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚çš„å½¢å¼å¤åˆ¶æ–‡ä»¶ã€‚
    ï¼ˆ4ï¼‰ä½¿ç”¨é«˜çº§çš„ç¼“å†²å­—èŠ‚æµæŒ‰ç…§ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„å½¢å¼å¤åˆ¶æ–‡ä»¶ã€‚

ç»“æœï¼š
		é«˜çº§çš„ç¼“å†²å­—èŠ‚æµæŒ‰ç…§ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„å½¢å¼å¤åˆ¶æ–‡ä»¶ï¼Œæ€§èƒ½æœ€é«˜ï¼Œå»ºè®®ä½¿ç”¨



##### å­—ç¬¦ç¼“å†²è¾“å…¥æµ

å­—ç¬¦ç¼“å†²è¾“å…¥æµï¼šBufferedReader
	ä½œç”¨ï¼šå­—ç¬¦ç¼“å†²è¾“å…¥æµæŠŠå­—ç¬¦è¾“å…¥æµåŒ…è£…æˆé«˜çº§çš„ç¼“å†²å­—ç¬¦è¾“å…¥æµï¼Œå¯ä»¥æé«˜å­—ç¬¦è¾“å…¥æµè¯»æ•°æ®çš„æ€§èƒ½ã€‚
	æ„é€ å™¨ï¼š`public BufferedReader(Reader reader):`
    åŸç†ï¼šç¼“å†²å­—ç¬¦è¾“å…¥æµé»˜è®¤ä¼šæœ‰ä¸€ä¸ª8Kçš„å­—ç¬¦ç¼“å†²æ± ,å¯ä»¥æé«˜è¯»å­—ç¬¦çš„æ€§èƒ½ã€‚

ç¼“å†²å­—ç¬¦è¾“å…¥æµè¿˜å¤šäº†ä¸€ä¸ªæŒ‰ç…§è¡Œè¯»å–æ•°æ®çš„åŠŸèƒ½ï¼ˆ**é‡ç‚¹**ï¼‰:
           `public String readLine()` : è¯»å–ä¸€è¡Œæ•°æ®è¿”å›ï¼Œè¯»å–å®Œæ¯•è¿”å›null;

```java
public static void main(String[] args) throws Exception {
    // 1.å®šä¹‰ä¸€ä¸ªåŸå§‹çš„å­—ç¬¦è¾“å…¥æµè¯»å–æºæ–‡ä»¶
    Reader fr = new FileReader("Day10Demo/src/dlei06.txt");
    // 2.æŠŠä½çº§çš„å­—ç¬¦è¾“å…¥æµç®¡é“åŒ…è£…æˆä¸€ä¸ªé«˜çº§çš„ç¼“å†²å­—ç¬¦è¾“å…¥æµç®¡é“
    BufferedReader br = new BufferedReader(fr);
    // å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡å­˜å‚¨æ¯è¡Œæ•°æ®
    String line;
    while((line = br.readLine()) != null){
        System.out.println(line);
    }
    br.close();
    //æ·˜æ±°æ•°ç»„å¾ªç¯è¯»å–
    //char[] buffer = new char[1024];
    //int len;
    //while((len = br.read(buffer)) != -1){
    //System.out.println(new String(buffer , 0 , len));
}
```



##### å­—ç¬¦ç¼“å†²è¾“å‡ºæµ

ç¬¦ç¼“å†²è¾“å‡ºæµï¼šBufferedWriter
       ä½œç”¨ï¼šæŠŠä½çº§çš„å­—ç¬¦è¾“å‡ºæµåŒ…è£…æˆä¸€ä¸ªé«˜çº§çš„ç¼“å†²å­—ç¬¦è¾“å‡ºæµï¼Œæé«˜å†™å­—ç¬¦æ•°æ®çš„æ€§èƒ½ã€‚
       æ„é€ å™¨ï¼š`public BufferedWriter(Writer writer)`
       åŸç†ï¼šé«˜çº§çš„å­—ç¬¦ç¼“å†²è¾“å‡ºæµå¤šäº†ä¸€ä¸ª8kçš„å­—ç¬¦ç¼“å†²æ± ï¼Œå†™æ•°æ®æ€§èƒ½æå¤§æé«˜äº†!

å­—ç¬¦ç¼“å†²è¾“å‡ºæµå¤šäº†ä¸€ä¸ªæ¢è¡Œçš„ç‰¹æœ‰åŠŸèƒ½ï¼š`public void newLine()`ï¼š**æ–°å»ºä¸€è¡Œ**ã€‚

```java
public static void main(String[] args) throws Exception {
    Writer fw = new FileWriter("Day10Demo/src/dlei07.txt",true);//è¿½åŠ 
    BufferedWriter bw = new BufferedWriter(fw);
    
    bw.write("æˆ‘çˆ±å­¦ä¹ Java");
    bw.newLine();//æ¢è¡Œ
    bw.close();
}
```



***



##### ç¼“å†²æµé«˜æ•ˆçš„åŸå› 

å­—ç¬¦å‹ç¼“å†²æµé«˜æ•ˆçš„åŸå› ï¼š

* BufferedReaderï¼šæ¯æ¬¡è°ƒç”¨readæ–¹æ³•ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä»ç£ç›˜ä¸­è¯»å–äº†8192ï¼ˆ8kï¼‰ä¸ªå­—ç¬¦ï¼Œå­˜å‚¨åˆ°è¯¥ç±»å‹å¯¹è±¡çš„ç¼“å†²åŒºæ•°ç»„ä¸­ï¼Œå°†å…¶ä¸­ä¸€ä¸ªè¿”å›ç»™è°ƒç”¨è€…ï¼Œå†æ¬¡è°ƒç”¨readæ–¹æ³•æ—¶ï¼Œå°±ä¸éœ€è¦è®¿é—®ç£ç›˜ï¼Œç›´æ¥ä»ç¼“å†²åŒºä¸­æ‹¿å‡ºä¸€ä¸ªæ•°æ®å³å¯ï¼Œæå‡äº†æ•ˆç‡
* BufferedWriterï¼šæ¯æ¬¡è°ƒç”¨writeæ–¹æ³•ï¼Œä¸ä¼šç›´æ¥å°†å­—ç¬¦åˆ·æ–°åˆ°æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åˆ°å­—ç¬¦æ•°ç»„ä¸­ï¼Œç­‰å­—ç¬¦æ•°ç»„å†™æ»¡äº†ï¼Œæ‰ä¸€æ¬¡æ€§åˆ·æ–°åˆ°æ–‡ä»¶ä¸­ï¼Œå‡å°‘äº†å’Œç£ç›˜äº¤äº’çš„æ¬¡æ•°ï¼Œæå‡äº†æ•ˆç‡

å­—èŠ‚å‹ç¼“å†²æµé«˜æ•ˆçš„åŸå› ï¼š

* BufferedInputStreamï¼šåœ¨è¯¥ç±»å‹ä¸­å‡†å¤‡äº†ä¸€ä¸ªæ•°ç»„ï¼Œå­˜å‚¨å­—èŠ‚ä¿¡æ¯ï¼Œå½“å¤–ç•Œè°ƒç”¨read()æ–¹æ³•æƒ³è·å–ä¸€ä¸ªå­—èŠ‚çš„æ—¶å€™ï¼Œè¯¥å¯¹è±¡ä»æ–‡ä»¶ä¸­ä¸€æ¬¡æ€§è¯»å–äº†8192ä¸ªå­—èŠ‚åˆ°æ•°ç»„ä¸­ï¼Œåªè¿”å›äº†ç¬¬ä¸€ä¸ªå­—èŠ‚ç»™è°ƒç”¨è€…ã€‚å°†æ¥è°ƒç”¨è€…å†æ¬¡è°ƒç”¨readæ–¹æ³•æ—¶ï¼Œå½“å‰å¯¹è±¡å°±ä¸éœ€è¦å†æ¬¡è®¿é—®ç£ç›˜ï¼Œåªéœ€è¦ä»æ•°ç»„ä¸­å–å‡ºä¸€ä¸ªå­—èŠ‚è¿”å›ç»™è°ƒç”¨è€…å³å¯ï¼Œç”±äºè¯»å–çš„æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥é€Ÿåº¦éå¸¸å¿«ã€‚å½“8192ä¸ªå­—èŠ‚å…¨éƒ½è¯»å–å®Œæˆä¹‹åï¼Œå†éœ€è¦è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œå°±å¾—è®©è¯¥å¯¹è±¡åˆ°æ–‡ä»¶ä¸­è¯»å–ä¸‹ä¸€ä¸ª8192ä¸ªå­—èŠ‚
* BufferedOutputStreamï¼šåœ¨è¯¥ç±»å‹ä¸­å‡†å¤‡äº†ä¸€ä¸ªæ•°ç»„ï¼Œå­˜å‚¨å­—èŠ‚ä¿¡æ¯ï¼Œå½“å¤–ç•Œè°ƒç”¨writeæ–¹æ³•æƒ³å†™å‡ºä¸€ä¸ªå­—èŠ‚çš„æ—¶å€™ï¼Œè¯¥å¯¹è±¡ç›´æ¥å°†è¿™ä¸ªå­—èŠ‚å­˜å‚¨åˆ°äº†è‡ªå·±çš„æ•°ç»„ä¸­ï¼Œè€Œä¸åˆ·æ–°åˆ°æ–‡ä»¶ä¸­ã€‚ä¸€ç›´åˆ°è¯¥æ•°ç»„æ‰€æœ‰8192ä¸ªä½ç½®å…¨éƒ½å æ»¡ï¼Œè¯¥å¯¹è±¡æ‰æŠŠè¿™ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰æ•°æ®ä¸€æ¬¡æ€§å†™å‡ºåˆ°ç›®æ ‡æ–‡ä»¶ä¸­ã€‚å¦‚æœæœ€åä¸€æ¬¡å¾ªç¯è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å°†æ•°ç»„å†™æ»¡ï¼Œæœ€ç»ˆåœ¨å…³é—­æµå¯¹è±¡çš„æ—¶å€™ï¼Œä¹Ÿä¼šå°†è¯¥æ•°ç»„ä¸­çš„æ•°æ®åˆ·æ–°åˆ°æ–‡ä»¶ä¸­ã€‚ 



æ³¨æ„ï¼š**å­—èŠ‚æµå’Œå­—ç¬¦æµï¼Œéƒ½æ˜¯è£…æ»¡æ—¶è‡ªåŠ¨å†™å‡ºï¼Œæˆ–è€…æ²¡æ»¡æ—¶æ‰‹åŠ¨flushå†™å‡ºï¼Œæˆ–closeæ—¶åˆ·æ–°å†™å‡º**



***



#### è½¬æ¢æµ

##### ä¹±ç é—®é¢˜

```
å­—ç¬¦æµè¯»å–ï¼š
    ä»£ç ç¼–ç             æ–‡ä»¶ç¼–ç          ä¸­æ–‡æƒ…å†µã€‚
    UTF-8              UTF-8           ä¸ä¹±ç !
    GBK                GBK             ä¸ä¹±ç !
    UTF-8              GBK             ä¹±ç !
```

å¦‚æœä»£ç ç¼–ç å’Œè¯»å–çš„æ–‡ä»¶ç¼–ç ä¸€è‡´ã€‚å­—ç¬¦æµè¯»å–çš„æ—¶å€™ä¸ä¼šä¹±ç ã€‚
å¦‚æœä»£ç ç¼–ç å’Œè¯»å–çš„æ–‡ä»¶ç¼–ç ä¸ä¸€è‡´ã€‚å­—ç¬¦æµè¯»å–çš„æ—¶å€™ä¼šä¹±ç ã€‚



##### å­—ç¬¦è¾“å…¥è½¬æ¢æµ

 å­—ç¬¦è¾“å…¥è½¬æ¢æµInputStreamReader:
	ä½œç”¨ï¼šå¯ä»¥è§£å†³å­—ç¬¦æµè¯»å–ä¸åŒç¼–ç ä¹±ç çš„é—®é¢˜ã€‚
				å¯ä»¥æŠŠåŸå§‹çš„**å­—èŠ‚æµ**æŒ‰ç…§å½“å‰é»˜è®¤çš„ä»£ç ç¼–ç æˆ–æŒ‡å®šçš„ç¼–ç **è½¬æ¢æˆå­—ç¬¦è¾“å…¥æµ**ã€‚
	æ„é€ å™¨ï¼š
           `public InputStreamReader(InputStream is)`ï¼šä½¿ç”¨å½“å‰ä»£ç é»˜è®¤ç¼–ç (UTF-8)è½¬æ¢æˆå­—ç¬¦æµ
           `public InputStreamReader(InputStream is,String charset)` : æŒ‡å®šç¼–ç æŠŠå­—èŠ‚æµè½¬æ¢æˆå­—ç¬¦æµ

```java
public class InputStreamReaderDemo{
    public static void main(String[] args) throws Exception {
        // 1.æå–GBKæ–‡ä»¶çš„åŸå§‹å­—èŠ‚æµ
        InputStream is = new FileInputStream("D:\\itcast\\Netty.txt");
        // 2.æŠŠåŸå§‹å­—èŠ‚è¾“å…¥æµé€šè¿‡è½¬æ¢æµï¼Œè½¬æ¢æˆ å­—ç¬¦è¾“å…¥è½¬æ¢æµInputStreamReader
        InputStreamReader isr = new InputStreamReader(is,"GBK"); 
        // 3.åŒ…è£…æˆç¼“å†²æµ
        BufferedReader br = new BufferedReader(isr);
        //å¾ªç¯è¯»å–
        String line;
        while((line = br.readLine()) != null){
            System.out.println(line);
        }
    }
}
```



##### å­—ç¬¦è¾“å‡ºè½¬æ¢æµ

å­—ç¬¦è¾“å‡ºè½¬æ¢æµï¼šOutputStreamWriter
	ä½œç”¨ï¼šå¯ä»¥æŒ‡å®šç¼–ç **æŠŠå­—èŠ‚è¾“å‡ºæµè½¬æ¢æˆå­—ç¬¦è¾“å‡ºæµ**ã€‚
				å¯ä»¥æŒ‡å®šå†™å‡ºå»çš„å­—ç¬¦çš„ç¼–ç ã€‚
	æ„é€ å™¨ï¼š
		`public OutputStreamWriter(OutputStream os)` : ç”¨é»˜è®¤ç¼–ç UTF-8æŠŠå­—èŠ‚è¾“å‡ºæµè½¬æ¢æˆå­—ç¬¦è¾“å‡ºæµ
		`public OutputStreamWriter(OutputStream os ,String charset)` : æŒ‡å®šç¼–ç æŠŠå­—èŠ‚è¾“å‡ºæµè½¬æ¢æˆ

```Java
OutputStream os = new FileOutputStream("Day10Demo/src/dlei07.txt");
OutputStreamWriter osw = new OutputStreamWriter(os,"GBK");
osw.write("æˆ‘åœ¨å­¦ä¹ Java");   
osw.close();
```



****



#### åºåˆ—åŒ–

##### æ¦‚è¿°

å¯¹è±¡åºåˆ—åŒ–ï¼šæŠŠJavaå¯¹è±¡è½¬æ¢æˆå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ï¼Œå°†å¯¹è±¡å†™å…¥åˆ°IOæµä¸­ã€‚     å¯¹è±¡ => æ–‡ä»¶ä¸­
å¯¹è±¡ååºåˆ—åŒ–ï¼šæŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ï¼Œä»IOæµä¸­æ¢å¤å¯¹è±¡ã€‚     æ–‡ä»¶ä¸­ => å¯¹è±¡

##### transient

transientä¿®é¥°çš„æˆå‘˜å˜é‡ï¼Œå°†ä¸å‚ä¸åºåˆ—åŒ–ï¼



##### å¯¹è±¡åºåˆ—åŒ–æµ

å¯¹è±¡åºåˆ—åŒ–æµï¼ˆå¯¹è±¡å­—èŠ‚è¾“å‡ºæµï¼‰ï¼šObjectOutputStream
	ä½œç”¨ï¼šæŠŠå†…å­˜ä¸­çš„Javaå¯¹è±¡æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶ä¸­å»ã€‚
	æ„é€ å™¨ï¼š`public ObjectOutputStream(OutputStream out)`
	åºåˆ—åŒ–æ–¹æ³•ï¼š`public final void writeObject(Object obj)`

æ³¨æ„ï¼šå¯¹è±¡å¦‚æœæƒ³å‚ä¸åºåˆ—åŒ–ï¼Œå¯¹è±¡å¿…é¡»å®ç°åºåˆ—åŒ–æ¥å£ **implements Serializable** ï¼Œå¦åˆ™åºåˆ—åŒ–å¤±è´¥ï¼

```java
public class SerializeDemo01 {
    public static void main(String[] args) throws Exception {
        // 1.åˆ›å»ºUserç”¨æˆ·å¯¹è±¡
        User user = new User("seazean","980823","ä¸ƒåä¸€");
        // 2.åˆ›å»ºä½çº§çš„å­—èŠ‚è¾“å‡ºæµé€šå‘ç›®æ ‡æ–‡ä»¶
        OutputStream os = new FileOutputStream("Day10Demo/src/obj.dat");
        // 3.æŠŠä½çº§çš„å­—èŠ‚è¾“å‡ºæµåŒ…è£…æˆé«˜çº§çš„å¯¹è±¡å­—èŠ‚è¾“å‡ºæµObjectOutputStream
        ObjectOutputStream oos = new ObjectOutputStream(os);
        // 4.é€šè¿‡å¯¹è±¡å­—èŠ‚è¾“å‡ºæµåºåˆ—åŒ–å¯¹è±¡ï¼š
        oos.writeObject(user);
        // 5.é‡Šæ”¾èµ„æº
        oos.close();
        System.out.println("åºåˆ—åŒ–å¯¹è±¡æˆåŠŸ~~~~");
    }
}

class User implements Serializable {
    // åŠ å…¥åºåˆ—ç‰ˆæœ¬å·
    private static final long serialVersionUID = 1L;

    private String loginName;
    private transient String passWord;
    private String userName;
    ///get+set
}
```



##### å¯¹è±¡åºååˆ—åŒ–

å¯¹è±¡ååºåˆ—åŒ–ï¼ˆå¯¹è±¡å­—èŠ‚è¾“å…¥æµï¼‰ï¼šObjectInputStream
	ä½œç”¨ï¼šè¯»å–åºåˆ—åŒ–çš„å¯¹è±¡æ–‡ä»¶æ¢å¤åˆ°Javaå¯¹è±¡ä¸­ã€‚
	æ„é€ å™¨ï¼š`public ObjectInputStream(InputStream is)`
	æ–¹æ³•ï¼š`public final Object readObject()`

åºåˆ—åŒ–ç‰ˆæœ¬å·ï¼š`private static final long serialVersionUID = 2L`;
    å¿…é¡»åºåˆ—åŒ–ä½¿ç”¨çš„ç‰ˆæœ¬å·å’Œååºåˆ—åŒ–ä½¿ç”¨çš„ç‰ˆæœ¬å·ä¸€è‡´æ‰å¯ä»¥æ­£å¸¸ååºåˆ—åŒ–ï¼å¦åˆ™æŠ¥é”™ï¼

```java
public class SerializeDemo02 {
    public static void main(String[] args) throws Exception {
        InputStream is = new FileInputStream("Day10Demo/src/obj.dat");
        ObjectInputStream ois = new ObjectInputStream(is);
        User user = (User)ois.readObject();//ååºåˆ—åŒ–
        System.out.println(user);
        System.out.println("ååºåˆ—åŒ–å®Œæˆï¼");
    }
}
class User implements Serializable {
    // åŠ å…¥åºåˆ—ç‰ˆæœ¬å·
    private static final long serialVersionUID = 1L;
    //........
}
```



****



#### æ‰“å°æµ

æ‰“å°æµPrintStream / PrintWriter.

æ‰“å°æµçš„ä½œç”¨ï¼š
    1.å¯ä»¥æ–¹ä¾¿ï¼Œå¿«é€Ÿçš„å†™æ•°æ®å‡ºå»ã€‚
    2.å¯ä»¥å®ç°æ‰“å°ä»€ä¹ˆç±»å‹ï¼Œå°±æ˜¯ä»€ä¹ˆç±»å‹ã€‚
	**3.System.out.print() åº•å±‚åŸºäºæ‰“å°æµå®ç°çš„** 

æ‰“å°æµçš„æ„é€ å™¨ï¼š
    `public PrintStream(OutputStream os)`:
    `public PrintStream(String filepath)`:

System:
        public static void setOut(PrintStream out) :è®©ç³»ç»Ÿçš„è¾“å‡ºæµå‘æ‰“å°æµã€‚

ç»“è®ºï¼š
		æ‰“å°æµå¯ä»¥æ–¹ä¾¿ï¼Œä¸”é«˜æ•ˆçš„æ‰“å°å„ç§æ•°æ®ã€‚
        PrintStreamä¸å…‰å¯ä»¥æ‰“å°æ•°æ®ï¼Œè¿˜å¯ä»¥å†™"å­—èŠ‚æ•°æ®"å‡ºå»ã€‚
        PrintWriterä¸å…‰å¯ä»¥æ‰“å°æ•°æ®ï¼Œè¿˜å¯ä»¥å†™"å­—ç¬¦æ•°æ®"å‡ºå»ã€‚

```java
public class PrintStreamDemo01 {
    public static void main(String[] args) throws Exception {
        PrintStream ps = new  PrintStream("Day10Demo/src/dlei.txt");
        //PrintWriter pw = new  PrintWriter("Day10Demo/src/dlei08.txt");
        ps.println(ä»»ä½•ç±»å‹çš„æ•°æ®);
        ps.print(ä¸æ¢è¡Œ);
        ps.write("æˆ‘çˆ±ä½ ".getBytes());
        ps.close();
    }
}
public class PrintStreamDemo02 {
    public static void main(String[] args) throws Exception {
        System.out.println("==itheima0==");
        PrintStream ps = new PrintStream("Day10Demo/src/log.txt");
        System.setOut(ps); // è®©ç³»ç»Ÿçš„è¾“å‡ºæµå‘æ‰“å°æµã€‚
		//ä¸è¾“å‡ºåœ¨æ§åˆ¶å°ï¼Œè¾“å‡ºåˆ°æ–‡ä»¶é‡Œ
        System.out.println("==itheima1==");
        System.out.println("==itheima2==");
    }
}
```



***



### Close

try-with-resources:
     try(
            // è¿™é‡Œåªèƒ½æ”¾ç½®èµ„æºå¯¹è±¡ï¼Œç”¨å®Œä¼šè‡ªåŠ¨è°ƒç”¨close()å…³é—­
     ){

â€‹     }catch(Exception e){
â€‹          e.printStackTrace();
â€‹     }
ä»€ä¹ˆæ˜¯èµ„æºï¼Ÿ
â€‹     èµ„æºç±»ä¸€å®šæ˜¯å®ç°äº†Closeableæ¥å£ï¼Œå®ç°è¿™ä¸ªæ¥å£çš„ç±»å°±æ˜¯èµ„æº
â€‹     æœ‰close()æ–¹æ³•ï¼Œtry-with-resourcesä¼šè‡ªåŠ¨è°ƒç”¨å®ƒçš„close()å…³é—­èµ„æºã€‚

```java
try(
	/** ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å…¥æµç®¡é“ä¸æºæ–‡ä»¶æ¥é€šã€‚ */
	InputStream is  = new FileInputStream("D:\\itcast\\å›¾ç‰‡èµ„æº\\meinv.jpg");
	/** ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµä¸ç›®æ ‡æ–‡ä»¶æ¥é€šã€‚*/
	OutputStream os = new FileOutputStream("D:\\itcast\\meimei.jpg");
	/** ï¼ˆ5ï¼‰å…³é—­èµ„æºï¼æ˜¯è‡ªåŠ¨è¿›è¡Œçš„ */
){
	byte[] buffer = new byte[1024];
	int len = 0;
	while((len = is.read(buffer)) != -1){
		os.write(buffer, 0 , len);
	}
	System.out.println("å¤åˆ¶å®Œæˆï¼");
}catch (Exception e){
	e.printStackTrace();
}
```



***



### Properties

Propertiesï¼šå±æ€§é›†å¯¹è±¡ã€‚å°±æ˜¯ä¸€ä¸ªMapé›†åˆï¼Œä¸€ä¸ªé”®å€¼å¯¹é›†åˆ
Propertiesæ ¸å¿ƒä½œç”¨ï¼šPropertiesä»£è¡¨çš„æ˜¯ä¸€ä¸ªå±æ€§æ–‡ä»¶ï¼Œå¯ä»¥æŠŠé”®å€¼å¯¹æ•°æ®å­˜å…¥åˆ°ä¸€ä¸ªå±æ€§æ–‡ä»¶
å±æ€§æ–‡ä»¶ï¼šåç¼€æ˜¯.propertiesç»“å°¾çš„æ–‡ä»¶,é‡Œé¢çš„å†…å®¹éƒ½æ˜¯ key=value

> å¤§å‹æ¡†æ¶æŠ€æœ¯ä¸­ï¼Œå±æ€§æ–‡ä»¶éƒ½æ˜¯å¾ˆé‡è¦çš„ç³»ç»Ÿé…ç½®æ–‡ä»¶ã€‚
> users.properties
>           admin=123456

Propertiesæ–¹æ³•ï¼š

| æ–¹æ³•å                                              | è¯´æ˜                                        |
| --------------------------------------------------- | ------------------------------------------- |
| public Object setProperty(String key, String value) | è®¾ç½®é›†åˆçš„é”®å’Œå€¼ï¼Œåº•å±‚è°ƒç”¨Hashtableæ–¹æ³• put |
| public String getProperty(String key)               | ä½¿ç”¨æ­¤å±æ€§åˆ—è¡¨ä¸­æŒ‡å®šçš„é”®æœç´¢å±æ€§            |
| public Set<String>   stringPropertyNames()          | æ‰€æœ‰é”®çš„åç§°çš„é›†åˆ                          |
| public synchronized void load(Reader r)             | ä»è¾“å…¥å­—ç¬¦æµè¯»å–å±æ€§åˆ—è¡¨ï¼ˆé”®å’Œå…ƒç´ å¯¹ï¼‰      |
| public synchronized void load(InputStream inStream) | åŠ è½½å±æ€§æ–‡ä»¶çš„æ•°æ®åˆ°å±æ€§é›†å¯¹è±¡ä¸­å»          |
| public void store(Writer w, String comments)        | å°†æ­¤å±æ€§åˆ—è¡¨(é”®å’Œå…ƒç´ å¯¹)å†™å…¥ Propertiesè¡¨   |
| public void store(OutputStream os, String comments) | ä¿å­˜æ•°æ®åˆ°å±æ€§æ–‡ä»¶ä¸­å»                      |

````java
public class PropertiesDemo01 {
    public static void main(String[] args) throws Exception {
        // a.åˆ›å»ºä¸€ä¸ªå±æ€§é›†å¯¹è±¡ï¼šPropertiesçš„å¯¹è±¡ã€‚
        Properties properties = new Properties();//{}
        properties.setProperty("admin" , "123456");
        // b.æŠŠå±æ€§é›†å¯¹è±¡çš„æ•°æ®å­˜å…¥åˆ°å±æ€§æ–‡ä»¶ä¸­å»ï¼ˆé‡ç‚¹ï¼‰
        OutputStream os = new FileOutputStream("Day10Demo/src/users.properties");
        properties.store(os,"i am very happy!!æˆ‘ä¿å­˜äº†ç”¨æˆ·æ•°æ®!");
        //å‚æ•°ä¸€ï¼šè¢«ä¿å­˜æ•°æ®çš„è¾“å‡ºç®¡é“
        //å‚æ•°äºŒï¼šä¿å­˜å¿ƒå¾—ã€‚å°±æ˜¯å¯¹è±¡ä¿å­˜çš„æ•°æ®è¿›è¡Œè§£é‡Šè¯´æ˜ï¼
    }
}
````

````java
public class PropertiesDemo02 {
    public static void main(String[] args) throws Exception {
        Properties properties = new Properties();//åº•å±‚åŸºäºmapé›†åˆ
        properties.load(new FileInputStream("Day10Demo/src/users.properties"));
        System.out.println(properties);
        System.out.println(properties.getProperty("admin"));
        
		Set<String> set = properties.stringPropertyNames();
        for (String s : set) {
            String value = properties.getProperty(s);
            System.out.println(s + value);
        }
    }
}
````



***



### RandomIO

RandomAccessFileç±»ï¼šè¯¥ç±»çš„å®ä¾‹æ”¯æŒè¯»å–å’Œå†™å…¥éšæœºè®¿é—®æ–‡ä»¶

æ„é€ å™¨ï¼š
RandomAccessFile(File file, String mode) ï¼šåˆ›å»ºéšæœºè®¿é—®æ–‡ä»¶æµï¼Œä»Fileå‚æ•°æŒ‡å®šçš„æ–‡ä»¶è¯»å–ï¼Œå¯é€‰æ‹©å†™å…¥ã€‚ 
RandomAccessFile(String name, String mode) ï¼šåˆ›å»ºéšæœºè®¿é—®æ–‡ä»¶æµï¼Œä»æŒ‡å®šåç§°çš„æ–‡ä»¶è¯»å–ï¼Œå¯é€‰æ‹©å†™å…¥æ–‡ä»¶ã€‚ 

å¸¸ç”¨æ–¹æ³•ï¼š
`public void seek(long pos)` : è®¾ç½®æ–‡ä»¶æŒ‡é’ˆåç§»ï¼Œä»è¯¥æ–‡ä»¶å¼€å¤´æµ‹é‡ï¼Œå‘ç”Ÿä¸‹ä¸€æ¬¡è¯»å–æˆ–å†™å…¥(æ’å…¥+è¦†ç›–)
`public void write(byte[] b)` : ä»æŒ‡å®šçš„å­—èŠ‚æ•°ç»„å†™å…¥ b.lengthä¸ªå­—èŠ‚åˆ°è¯¥æ–‡ä»¶
`public int read(byte[] b)` : ä»è¯¥æ–‡ä»¶è¯»å–æœ€å¤šb.lengthä¸ªå­—èŠ‚çš„æ•°æ®åˆ°å­—èŠ‚æ•°ç»„

```java
public static void main(String[] args) throws Exception {
    RandomAccessFile rf = new RandomAccessFile(new File(),"rw");
    rf.write("hello world".getBytes());
    rf.seek(5);//helloxxxxld
    rf.write("xxxx".getBytes());
    rf.close();
}
```



***



### Commons-io

commons-ioæ˜¯apacheå¼€æºåŸºé‡‘ç»„ç»‡æä¾›çš„ä¸€ç»„æœ‰å…³IOæ“ä½œçš„ç±»åº“ï¼Œå¯ä»¥æŒºæé«˜IOåŠŸèƒ½å¼€å‘çš„æ•ˆç‡ã€‚
commons-ioå·¥å…·åŒ…æä¾›äº†å¾ˆå¤šæœ‰å…³ioæ“ä½œçš„ç±»ï¼š

| åŒ…                                  | åŠŸèƒ½æè¿°                                     |
| ----------------------------------- | :------------------------------------------- |
| org.apache.commons.io               | æœ‰å…³Streamsã€Readersã€Writersã€Filesçš„å·¥å…·ç±» |
| org.apache.commons.io.input         | è¾“å…¥æµç›¸å…³çš„å®ç°ç±»ï¼ŒåŒ…å«Readerå’ŒInputStream  |
| org.apache.commons.io.output        | è¾“å‡ºæµç›¸å…³çš„å®ç°ç±»ï¼ŒåŒ…å«Writerå’ŒOutputStream |
| org.apache.commons.io.serialization | åºåˆ—åŒ–ç›¸å…³çš„ç±»                               |



IOUtilså’ŒFileUtilså¯ä»¥æ–¹ä¾¿çš„å¤åˆ¶æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼ï¼

```java
public class CommonsIODemo01 {
    public static void main(String[] args) throws Exception {
        // 1.å®Œæˆæ–‡ä»¶å¤åˆ¶ï¼
        IOUtils.copy(new FileInputStream("Day13Demo/src/books.xml"), 
                     new FileOutputStream("Day13Demo/new.xml"));
        // 2.å®Œæˆæ–‡ä»¶å¤åˆ¶åˆ°æŸä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼
        FileUtils.copyFileToDirectory(new File("Day13Demo/src/books.xml"),
                                      new File("D:/itcast"));
        // 3.å®Œæˆæ–‡ä»¶å¤¹å¤åˆ¶åˆ°æŸä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼
        FileUtils.copyDirectoryToDirectory(new File("D:\\itcast\\çº¦å§å›¾ç‰‡æœåŠ¡å™¨") ,
                                           new File("D:\\"));

        //  Javaä»1.7å¼€å§‹æä¾›äº†ä¸€äº›nio, è‡ªå·±ä¹Ÿæœ‰ä¸€è¡Œä»£ç å®Œæˆå¤åˆ¶çš„æŠ€æœ¯ã€‚
        Files.copy(Paths.get("Day13Demo/src/books.xml")
                , new FileOutputStream("Day13Demo/new11.txt"));
    }
}
```





****



## ç½‘ç»œ

### ç½‘ç»œæ¦‚è¿°

#### è½¯ä»¶ç»“æ„

é€šä¿¡ä¸€å®šæ˜¯åŸºäºè½¯ä»¶ç»“æ„å®ç°çš„:

* C/Sç»“æ„ ï¼šå…¨ç§°ä¸ºClient/Serverç»“æ„ï¼Œæ˜¯æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»“æ„ã€‚
          å¸¸è§ç¨‹åºæœ‰ï¼±ï¼±ã€è¿…é›·ï¼ŒIDEAç­‰è½¯ä»¶ã€‚
* B/Sç»“æ„ ï¼šå…¨ç§°ä¸ºBrowser/Serverç»“æ„ï¼Œæ˜¯æŒ‡æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç»“æ„ã€‚
          å¸¸è§æµè§ˆå™¨æœ‰è°·æ­Œã€ç«ç‹ç­‰ã€è½¯ä»¶ï¼šåšå­¦è°·ã€äº¬ä¸œã€æ·˜å®ã€‚
          ï¼ˆå¼€å‘ä¸­çš„é‡ç‚¹ï¼ŒåŸºäºç½‘é¡µè®¾è®¡ç•Œé¢ï¼Œç•Œé¢æ•ˆæœå¯ä»¥æ›´ä¸°å¯Œ: Java Webå¼€å‘ï¼‰

ä¸¤ç§æ¶æ„å„æœ‰ä¼˜åŠ¿ï¼Œä½†æ˜¯æ— è®ºå“ªç§æ¶æ„ï¼Œéƒ½ç¦»ä¸å¼€ç½‘ç»œçš„æ”¯æŒã€‚
ç½‘ç»œç¼–ç¨‹ï¼Œå°±æ˜¯åœ¨ä¸€å®šçš„åè®®ä¸‹ï¼Œå®ç°ä¸¤å°è®¡ç®—æœºçš„é€šä¿¡çš„æŠ€æœ¯ã€‚



#### ä¸‰è¦ç´ 

ç½‘ç»œé€šä¿¡çš„ä¸‰è¦ç´ ï¼š

1. åè®®ï¼šè®¡ç®—æœºç½‘ç»œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡å¿…é¡»äº‹å…ˆçº¦å®šå’Œå½¼æ­¤éµå®ˆçš„é€šä¿¡è§„åˆ™ã€‚
      		 HTTP , FTP , TCP , UDP , SSH , SMTPã€‚

2. IPåœ°å€ï¼šäº’è”ç½‘åè®®åœ°å€(Internet Protocol Address)ã€‚ç”¨æ¥ç»™ä¸€ä¸ªç½‘ç»œä¸­çš„è®¡ç®—æœºè®¾å¤‡åšå”¯ä¸€çš„ç¼–å·ã€‚

   * IPv4 ï¼š4ä¸ªå­—èŠ‚ï¼Œ32ä½ç»„æˆã€‚  192.168.1.1
   * Pv6ï¼šå¯ä»¥å®ç°ä¸ºæ‰€æœ‰è®¾å¤‡åˆ†é…IP  128ä½

   * ipconfigï¼šæŸ¥çœ‹æœ¬æœºçš„IP
     â€‹      ping æ£€æŸ¥æœ¬æœºä¸æŸä¸ªIPæŒ‡å®šçš„æœºå™¨æ˜¯å¦è”é€šï¼Œæˆ–è€…è¯´æ˜¯æ£€æµ‹å¯¹æ–¹æ˜¯å¦åœ¨çº¿ã€‚
     â€‹      ping ç©ºæ ¼ IPåœ°å€ ï¼šping 220.181.57.216ï¼Œping www.baidu.com

   æ³¨æ„ï¼šç‰¹æ®Šçš„IPåœ°å€ï¼š æœ¬æœºIPåœ°å€.(ä¸å—ç¯å¢ƒçš„å½±å“ï¼Œä»»ä½•æ—¶å€™éƒ½å­˜åœ¨è¿™ä¸¤ä¸ªip,å¯ä»¥ç›´æ¥æ‰¾æœ¬æœºï¼)
   â€‹       	**127.0.0.1 == localhost**ã€‚

3. ç«¯å£ï¼šç«¯å£å·å°±å¯ä»¥å”¯ä¸€æ ‡è¯†è®¾å¤‡ä¸­çš„è¿›ç¨‹ï¼ˆåº”ç”¨ç¨‹åºï¼‰
   ç«¯å£å·ï¼š
      	 ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ•´æ•°ï¼Œå®ƒçš„å–å€¼èŒƒå›´æ˜¯0~65535ã€‚
      	 0~1023ä¹‹é—´çš„ç«¯å£å·ç”¨äºä¸€äº›çŸ¥åçš„ç½‘ç»œæœåŠ¡å’Œåº”ç”¨ã€‚æ™®é€šçš„åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨1024ä»¥ä¸Šçš„ç«¯å£å·ã€‚
       	å¦‚æœç«¯å£å·è¢«å¦å¤–ä¸€ä¸ªæœåŠ¡æˆ–åº”ç”¨æ‰€å ç”¨ï¼Œä¼šå¯¼è‡´å½“å‰ç¨‹åºå¯åŠ¨å¤±è´¥ã€‚æŠ¥å‡ºç«¯å£è¢«å ç”¨å¼‚å¸¸ï¼ï¼

åˆ©ç”¨**åè®®+IPåœ°å€+ç«¯å£å·** ä¸‰å…ƒç»„åˆï¼Œå°±å¯ä»¥æ ‡è¯†ç½‘ç»œä¸­çš„è¿›ç¨‹äº†ï¼Œé‚£ä¹ˆè¿›ç¨‹é—´çš„é€šä¿¡å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ ‡è¯†ä¸å…¶å®ƒè¿›ç¨‹è¿›è¡Œäº¤äº’ã€‚



#### åˆ†å±‚å’Œåè®®

ç½‘ç»œé€šä¿¡åè®®ï¼š
	é€šä¿¡åè®®æ˜¯å¯¹è®¡ç®—æœºå¿…é¡»éµå®ˆçš„è§„åˆ™ï¼Œåªæœ‰éµå®ˆè¿™äº›è§„åˆ™ï¼Œè®¡ç®—æœºä¹‹é—´æ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚

> åº”ç”¨å±‚ï¼šåº”ç”¨ç¨‹åºï¼ˆQQ,å¾®ä¿¡,æµè§ˆå™¨ï¼‰,å¯èƒ½ç”¨åˆ°çš„åè®®ï¼ˆHTTP,FTP,SMTPï¼‰ï¼Œé€šå¸¸ç¨‹åºå‘˜åªéœ€è¦è¿™ä¸€å±‚
>
> ä¼ è¾“å±‚ï¼šTCP/IPåè®® - UDPåè®®ï¼Œè®¡ç®—æœºç½‘ç»œå·¥ç¨‹å¸ˆéœ€è¦ç²¾é€šçš„åè®®ï¼Œæœ‰äº›æŠ€æœ¯æˆ‘ä»¬ä¹Ÿéœ€è¦ç²¾é€š
>
> ç½‘ç»œå±‚  ï¼šIPåè®®  å°è£…è‡ªå·±çš„IPå’Œå¯¹æ–¹çš„IPå’Œç«¯å£
>
> æ•°æ®é“¾è·¯å±‚ ï¼š è¿›å…¥åˆ°ç¡¬ä»¶ï¼ˆç½‘ï¼‰
>

TCP/IPåè®®ï¼šä¼ è¾“æ§åˆ¶åè®® (Transmission Control Protocol)ã€‚
    TCPåè®®æ˜¯é¢å‘è¿æ¥çš„å®‰å…¨çš„å¯é çš„ä¼ è¾“é€šä¿¡åè®®ã€‚
    1.åœ¨é€šä¿¡ä¹‹å‰å¿…é¡»ç¡®å®šå¯¹æ–¹åœ¨çº¿å¹¶ä¸”è¿æ¥æˆåŠŸæ‰å¯ä»¥é€šä¿¡ã€‚
    2.ä¾‹å¦‚ä¸‹è½½æ–‡ä»¶ã€æµè§ˆç½‘é¡µç­‰(è¦æ±‚å¯é ä¼ è¾“)

UDPï¼šç”¨æˆ·æ•°æ®æŠ¥åè®®(User Datagram Protocol)ã€‚
    UDPåè®®æ˜¯ä¸€ä¸ªé¢å‘æ— è¿æ¥çš„ä¸å¯é ä¼ è¾“çš„åè®®ã€‚
    1.ç›´æ¥å‘æ¶ˆæ¯ç»™å¯¹æ–¹ï¼Œä¸ç®¡å¯¹æ–¹æ˜¯å¦åœ¨çº¿ï¼Œå‘æ¶ˆæ¯åä¹Ÿä¸éœ€è¦ç¡®è®¤ã€‚
    2.æ— çº¿ï¼ˆè§†é¢‘ä¼šè®®ï¼Œé€šè¯ï¼‰ï¼Œæ€§èƒ½å¥½ï¼Œå¯èƒ½ä¸¢å¤±ä¸€äº›æ•°æ®ï¼ï¼



****



### é€šä¿¡æ¨¡å‹

ç›¸å…³æ¦‚å¿µï¼š

* åŒæ­¥ï¼šå½“å‰çº¿ç¨‹è¦è‡ªå·±è¿›è¡Œæ•°æ®çš„è¯»å†™æ“ä½œã€‚ï¼ˆè‡ªå·±å»é“¶è¡Œå–é’±ï¼‰
* å¼‚æ­¥ï¼šå½“å‰çº¿ç¨‹å¯ä»¥å»åšå…¶ä»–äº‹æƒ…ï¼Œï¼ˆå§”æ‰˜ä¸€å°å¼Ÿæ‹¿é“¶è¡Œå¡åˆ°é“¶è¡Œå–é’±ï¼Œç„¶åç»™ä½ ï¼‰
* é˜»å¡ï¼šåœ¨æ•°æ®æ²¡æœ‰çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯è¦ç»§ç»­ç­‰å¾…ç€è¯»ã€‚ï¼ˆæ’é˜Ÿç­‰å¾…ï¼‰
* éé˜»å¡ï¼šåœ¨æ•°æ®æ²¡æœ‰çš„æƒ…å†µä¸‹ï¼Œä¼šå»åšå…¶ä»–äº‹æƒ…ï¼Œä¸€æ—¦æœ‰äº†æ•°æ®å†æ¥è·å–ã€‚ï¼ˆæŸœå°å–æ¬¾ï¼Œå–ä¸ªå·ï¼Œç„¶åååœ¨æ¤…å­ä¸Šåšå…¶å®ƒäº‹ï¼Œç­‰å·å¹¿æ’­ä¼šé€šçŸ¥ä½ åŠç†ï¼‰ 

åŸºæœ¬é€šä¿¡æ¨¡å‹:

1. BIOé€šä¿¡æ¨¡å¼ï¼šåŒæ­¥é˜»å¡å¼é€šä¿¡ã€‚ï¼ˆSocketç½‘ç»œç¼–ç¨‹ä¹Ÿå°±æ˜¯ä¸Šé¢çš„é€šä¿¡æ¶æ„ï¼‰
       BIOè¡¨ç¤ºåŒæ­¥é˜»å¡å¼IOï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œ
       å³å®¢æˆ·ç«¯æœ‰è¿æ¥è¯·æ±‚æ—¶æœåŠ¡å™¨ç«¯å°±éœ€è¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œ
       å¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡çº¿ç¨‹æ± æœºåˆ¶æ”¹å–„ã€‚
       åŒæ­¥é˜»å¡å¼æ€§èƒ½æå·®ï¼šå¤§é‡çº¿ç¨‹ï¼Œå¤§é‡é˜»å¡ã€‚

2. ä¼ªå¼‚æ­¥é€šä¿¡ï¼šå¼•å…¥äº†çº¿ç¨‹æ± ã€‚
       ä¸éœ€è¦ä¸€ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥å®ç°1ä¸ªçº¿ç¨‹å¤ç”¨æ¥å¤„ç†å¾ˆå¤šä¸ªå®¢æˆ·ç«¯ï¼
       è¿™ç§æ¶æ„ï¼Œå¯ä»¥é¿å…ç³»ç»Ÿçš„æ­»æœºï¼Œå› ä¸ºä¸ä¼šå‡ºç°å¾ˆå¤šçº¿ç¨‹ï¼Œçº¿ç¨‹å¯æ§ã€‚
       ä½†æ˜¯é«˜å¹¶å‘ä¸‹æ€§èƒ½è¿˜æ˜¯å¾ˆå·®ï¼ša.çº¿ç¨‹æ•°é‡å°‘ï¼Œæ•°æ®ä¾ç„¶æ˜¯é˜»å¡çš„ã€‚æ•°æ®æ²¡æœ‰æ¥çº¿ç¨‹è¿˜æ˜¯è¦ç­‰å¾…ï¼

3. NIOè¡¨ç¤º**åŒæ­¥éé˜»å¡IO**ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºè¯·æ±‚å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œ
         å®¢æˆ·ç«¯å‘é€çš„è¿æ¥ä¼šæ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œå¤šè·¯å¤ç”¨å™¨è½®è¯¢åˆ°è¿æ¥æœ‰I/Oè¯·æ±‚æ—¶æ‰å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†

â€‹      1ä¸ªä¸»çº¿ç¨‹ä¸“é—¨è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯ï¼š
   â€‹      1ä¸ªçº¿ç¨‹[c1 ,s2 ,c3,c4, ,s2 ,c3,c4,,c3,c4, ]è½®è¯¢æ‰€æœ‰çš„å®¢æˆ·ç«¯ï¼Œå‘æ¥äº†æ•°æ®æ‰ä¼šå¼€å¯çº¿ç¨‹å¤„ç†
   â€‹      åŒæ­¥ï¼šçº¿ç¨‹è¿˜è¦ä¸æ–­çš„æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œä»¥åŠå¤„ç†æ•°æ®ã€‚
   â€‹      éé˜»å¡ï¼šå¦‚æœä¸€ä¸ªç®¡é“æ²¡æœ‰æ•°æ®ï¼Œä¸éœ€è¦ç­‰å¾…ï¼Œå¯ä»¥è½®è¯¢ä¸‹ä¸€ä¸ªç®¡é“æ˜¯å¦æœ‰æ•°æ®ï¼

4. AIOè¡¨ç¤ºå¼‚æ­¥éé˜»å¡IOï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªæœ‰æ•ˆè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹ï¼Œ
       å®¢æˆ·ç«¯çš„I/Oè¯·æ±‚éƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿå…ˆå®ŒæˆIOæ“ä½œåå†é€šçŸ¥æœåŠ¡å™¨åº”ç”¨æ¥å¯åŠ¨çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚
       å¼‚æ­¥ï¼šæœåŠ¡ç«¯çº¿ç¨‹æ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯ç®¡é“ä»¥åå°±äº¤ç»™åº•å±‚å¤„ç†å®ƒçš„ioé€šä¿¡ã€‚è‡ªå·±å¯ä»¥åšå…¶ä»–äº‹æƒ…ã€‚
       éé˜»å¡ï¼šåº•å±‚ä¹Ÿæ˜¯å®¢æˆ·ç«¯æœ‰æ•°æ®æ‰ä¼šå¤„ç†ï¼Œæœ‰äº†æ•°æ®ä»¥åå¤„ç†å¥½é€šçŸ¥æœåŠ¡å™¨åº”ç”¨æ¥å¯åŠ¨çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚

å„ç§æ¨¡å‹åº”ç”¨åœºæ™¯ï¼š

* BIOé€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¯¥æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¨‹åºç®€å•ã€‚
* NIOé€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œå¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¼–ç¨‹å¤æ‚ï¼ŒJDK 1.4å¼€å§‹æ”¯æŒã€‚
* AIOé€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œå¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨æ“ä½œç³»ç»Ÿå‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹å¤æ‚ï¼ŒJDK 1.7å¼€å§‹æ”¯æŒã€‚





****



### InetAddress

ä¸€ä¸ªè¯¥InetAddressç±»çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªIPåœ°å€å¯¹è±¡ã€‚

æˆå‘˜æ–¹æ³•ï¼š
	`static InetAddress getLocalHost()` : è·å¾—æœ¬åœ°ä¸»æœºIPåœ°å€å¯¹è±¡
	`static InetAddress getByName(String host)` : æ ¹æ®IPåœ°å€å­—ç¬¦ä¸²æˆ–ä¸»æœºåè·å¾—å¯¹åº”çš„IPåœ°å€å¯¹è±¡
	`String getHostName()` : è·å–ä¸»æœºå
	`String getHostAddress()` : è·å¾—IPåœ°å€å­—ç¬¦ä¸²

```java
public class InetAddressDemo {
    public static void main(String[] args) throws Exception {
        // 1.è·å–æœ¬æœºåœ°å€å¯¹è±¡
        InetAddress ip = InetAddress.getLocalHost();
        System.out.println(ip.getHostName());//DESKTOP-NNMBHQR
        System.out.println(ip.getHostAddress());//192.168.11.1
        // 2.è·å–åŸŸåipå¯¹è±¡
        InetAddress ip2 = InetAddress.getByName("www.baidu.com");
        System.out.println(ip2.getHostName());//www.baidu.com
        System.out.println(ip2.getHostAddress());//14.215.177.38
        // 3.è·å–å…¬ç½‘IPå¯¹è±¡ã€‚
        InetAddress ip3 = InetAddress.getByName("182.61.200.6");
        System.out.println(ip3.getHostName());//182.61.200.6
        System.out.println(ip3.getHostAddress());//182.61.200.6
        
        // 4.åˆ¤æ–­æ˜¯å¦èƒ½é€šï¼š ping  5sä¹‹å‰æµ‹è¯•æ˜¯å¦å¯é€š
        System.out.println(ip2.isReachable(5000)); // pingç™¾åº¦
    }
}
```



***



### UDP

#### æ¦‚è¿°

UDPï¼ˆUser Datagram Protocolï¼‰åè®®çš„ç‰¹ç‚¹ï¼š
		é¢å‘æ— è¿æ¥çš„åè®®
		å‘é€ç«¯åªç®¡å‘é€ï¼Œä¸ç¡®è®¤å¯¹æ–¹æ˜¯å¦èƒ½æ”¶åˆ°ã€‚
		åŸºäºæ•°æ®åŒ…è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚
		å‘é€æ•°æ®çš„åŒ…çš„å¤§å°é™åˆ¶**64KB**ä»¥å†…
		å› ä¸ºé¢å‘æ— è¿æ¥ï¼Œé€Ÿåº¦å¿«ï¼Œä½†æ˜¯ä¸å¯é ã€‚ä¼šä¸¢å¤±æ•°æ®ï¼

UDPåè®®çš„ä½¿ç”¨åœºæ™¯ï¼šåœ¨çº¿è§†é¢‘ï¼Œç½‘ç»œè¯­éŸ³ï¼Œç”µè¯ã€‚



#### UDPå®ç°

UDPåè®®ç›¸å…³çš„ä¸¤ä¸ªç±»
    DatagramPacketï¼ˆæ•°æ®åŒ…å¯¹è±¡ï¼‰ï¼šç”¨æ¥å°è£…è¦å‘é€æˆ–è¦æ¥æ”¶çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼šé›†è£…ç®±
    DatagramSocketï¼ˆå‘é€å¯¹è±¡ï¼‰ï¼šç”¨æ¥å‘é€æˆ–æ¥æ”¶æ•°æ®åŒ…ï¼Œæ¯”å¦‚ï¼šç å¤´

**DatagramPacket**ï¼š

* DatagramPacketç±»æ„é€ å™¨
  * `public new DatagramPacket(byte[] buf, int length, InetAddress address, int port)` : åˆ›å»ºå‘é€ç«¯æ•°æ®åŒ…å¯¹è±¡
    å‚æ•°ï¼š bufï¼šè¦å‘é€çš„å†…å®¹ï¼Œå­—èŠ‚æ•°ç»„		lengthï¼šè¦å‘é€å†…å®¹çš„é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚
    			addressï¼šæ¥æ”¶ç«¯çš„IPåœ°å€å¯¹è±¡		portï¼šæ¥æ”¶ç«¯çš„ç«¯å£å·
  * `public new DatagramPacket(byte[] buf, int length)` : åˆ›å»ºæ¥æ”¶ç«¯çš„æ•°æ®åŒ…å¯¹è±¡
    å‚æ•°ï¼šbufï¼šç”¨æ¥å­˜å‚¨æ¥æ”¶åˆ°å†…å®¹		lengthï¼šèƒ½å¤Ÿæ¥æ”¶å†…å®¹çš„é•¿åº¦
* DatagramPacketç±»å¸¸ç”¨æ–¹æ³•
     `public int getLength()` : è·å¾—å®é™…æ¥æ”¶åˆ°çš„å­—èŠ‚ä¸ªæ•°
      `public byte[] getData()` : è¿”å›æ•°æ®ç¼“å†²åŒº

**DatagramSocket**ï¼š

* DatagramSocketç±»æ„é€ æ–¹æ³•
      `protected DatagramSocket()` : åˆ›å»ºå‘é€ç«¯çš„Socketå¯¹è±¡ï¼Œç³»ç»Ÿä¼šéšæœºåˆ†é…ä¸€ä¸ªç«¯å£å·ã€‚
      `protected DatagramSocket(int port)` : åˆ›å»ºæ¥æ”¶ç«¯çš„Socketå¯¹è±¡å¹¶æŒ‡å®šç«¯å£å·
* DatagramSocketç±»æˆå‘˜æ–¹æ³•
      `public void send(DatagramPacket dp)` : å‘é€æ•°æ®åŒ…
      `public void receive(DatagramPacket p)` : æ¥æ”¶æ•°æ®åŒ…
  	`public void close()` : å…³é—­æ•°æ®æŠ¥å¥—æ¥å­—

```java
public class UDPClientDemo {
    public static void main(String[] args) throws Exception {
        System.out.println("===å¯åŠ¨å®¢æˆ·ç«¯===");
        // 1.åˆ›å»ºä¸€ä¸ªé›†è£…ç®±å¯¹è±¡ï¼Œç”¨äºå°è£…éœ€è¦å‘é€çš„æ•°æ®åŒ…!
        byte[] buffer = "æˆ‘å­¦Java".getBytes();
        DatagramPacket packet = new DatagramPacket(buffer,bubffer.length
											,InetAddress.getLoclHost,8000);
        // 2.åˆ›å»ºä¸€ä¸ªç å¤´å¯¹è±¡
        DatagramSocket socket = new DatagramSocket();
        // 3.å¼€å§‹å‘é€æ•°æ®åŒ…å¯¹è±¡
        socket.send(packet);
        socket.close();
    }
}
public class UDPServerDemo{
    public static void main(String[] args) throws Exception {
        System.out.println("==å¯åŠ¨æœåŠ¡ç«¯ç¨‹åº==");
        // 1.åˆ›å»ºä¸€ä¸ªæ¥æ”¶å®¢æˆ·éƒ½ç«¯çš„æ•°æ®åŒ…å¯¹è±¡ï¼ˆé›†è£…ç®±ï¼‰
        byte[] buffer = new byte[1024*64];
        DatagramPacket packet = new DatagramPacket(buffer,bubffer.length);
        // 2.åˆ›å»ºä¸€ä¸ªæ¥æ”¶ç«¯çš„ç å¤´å¯¹è±¡
        DatagramSocket socket = new DatagramSocket(8000);
        // 3.å¼€å§‹æ¥æ”¶
        socket.receive(packet);
        // 4.ä»é›†è£…ç®±ä¸­è·å–æœ¬æ¬¡è¯»å–çš„æ•°æ®é‡
        int len = packet.getLength();
        // 5.è¾“å‡ºæ•°æ®
        //String rs = new String(socket.getData(), 0, len)
        String rs = new String(buffer , 0 , len);
        System.out.println(rs);
        // 6.æœåŠ¡ç«¯è¿˜å¯ä»¥è·å–å‘æ¥ä¿¡æ¯çš„å®¢æˆ·ç«¯çš„IPå’Œç«¯å£ã€‚
        String ip = packet.getAddress().getHostAdress();
        int port = packet.getPort();
        socket.close();
    }
}
```



#### é€šè®¯æ–¹å¼

UDPé€šä¿¡æ–¹å¼ï¼š

+ å•æ’­

  å•æ’­ç”¨äºä¸¤ä¸ªä¸»æœºä¹‹é—´çš„ç«¯å¯¹ç«¯é€šä¿¡

+ ç»„æ’­

  ç»„æ’­ç”¨äºå¯¹ä¸€ç»„ç‰¹å®šçš„ä¸»æœºè¿›è¡Œé€šä¿¡
  IP : 224.0.1.0
  Socketå¯¹è±¡ : MulticastSocket

+ å¹¿æ’­

  å¹¿æ’­ç”¨äºä¸€ä¸ªä¸»æœºå¯¹æ•´ä¸ªå±€åŸŸç½‘ä¸Šæ‰€æœ‰ä¸»æœºä¸Šçš„æ•°æ®é€šä¿¡
  IP : 255.255.255.255
  Socketå¯¹è±¡ : DatagramSocket

  

***



### TCP

#### æ¦‚å¿µ

TCP/IPåè®® ==> Transfer Control Protocol ==> ä¼ è¾“æ§åˆ¶åè®®
TCP/IPåè®®çš„ç‰¹ç‚¹
	é¢å‘è¿æ¥çš„åè®®
	åªèƒ½ç”±å®¢æˆ·ç«¯ä¸»åŠ¨å‘é€æ•°æ®ç»™æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°æ•°æ®ä¹‹åï¼Œå¯ä»¥ç»™å®¢æˆ·ç«¯å“åº”æ•°æ®ã€‚
	é€šè¿‡**ä¸‰æ¬¡æ¡æ‰‹**å»ºç«‹è¿æ¥ï¼Œè¿æ¥æˆåŠŸå½¢æˆæ•°æ®ä¼ è¾“é€šé“ã€‚
	é€šè¿‡**å››æ¬¡æŒ¥æ‰‹**æ–­å¼€è¿æ¥
	åŸºäºIOæµè¿›è¡Œæ•°æ®ä¼ è¾“
	ä¼ è¾“æ•°æ®å¤§å°æ²¡æœ‰é™åˆ¶
	å› ä¸ºé¢å‘è¿æ¥çš„åè®®ï¼Œé€Ÿåº¦æ…¢ï¼Œä½†æ˜¯æ˜¯å¯é çš„åè®®ã€‚

TCPåè®®çš„ä½¿ç”¨åœºæ™¯ï¼šæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ï¼›é‚®ä»¶å‘é€å’Œæ¥æ”¶ï¼›è¿œç¨‹ç™»å½•ã€‚

æ³¨æ„ï¼š**TCPä¸ä¼šä¸ºæ²¡æœ‰æ•°æ®çš„ACKè¶…æ—¶é‡ä¼ **

<img src="https://gitee.com/seazean/images/raw/master/JavaSE/ä¸‰æ¬¡æ¡æ‰‹.png" alt="ä¸‰æ¬¡æ¡æ‰‹" style="zoom: 50%;" />

<img src="https://gitee.com/seazean/images/raw/master/JavaSE/å››æ¬¡æŒ¥æ‰‹.png" alt="å››æ¬¡æŒ¥æ‰‹" style="zoom: 67%;" />



***



#### Socket

TCPé€šä¿¡ä¹Ÿå«**Socketç½‘ç»œç¼–ç¨‹**ï¼Œåªè¦ä»£ç åŸºäºSocketå¼€å‘ï¼Œåº•å±‚å°±æ˜¯åŸºäºäº†å¯é ä¼ è¾“çš„TCPé€šä¿¡ã€‚

TCPåè®®ç›¸å…³çš„ç±»
    Socketï¼šä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºã€‚
    ServerSocketï¼šä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªæœåŠ¡å™¨ç«¯ç¨‹åºã€‚

* Socketç±»

  * æ„é€ æ–¹æ³•ï¼š
        `Socket(InetAddress address,int port)` : åˆ›å»ºæµå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šIPæŒ‡å®šç«¯å£å·
    	`Socket(String host, int port)` : æ ¹æ®ipåœ°å€å­—ç¬¦ä¸²å’Œç«¯å£å·åˆ›å»ºå®¢æˆ·ç«¯Socketå¯¹è±¡
    æ³¨æ„äº‹é¡¹ï¼šæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå°±ä¼šç«‹å³è¿æ¥æŒ‡å®šçš„æœåŠ¡å™¨ï¼Œè¿æ¥æˆåŠŸï¼Œåˆ™è¡¨ç¤ºä¸‰æ¬¡æ¡æ‰‹é€šè¿‡ï¼Œåä¹‹æŠ›å‡ºå¼‚å¸¸ã€‚
  * å¸¸ç”¨APIï¼š
    	`OutputStream getOutputStream()` : è·å¾—å­—èŠ‚è¾“å‡ºæµå¯¹è±¡
    	`InputStream getInputStream()` : è·å¾—å­—èŠ‚è¾“å…¥æµå¯¹è±¡
    	`void shutdownInput()` : åœæ­¢æ¥å—
    	`void shutdownOutput()` : åœæ­¢å‘é€æ•°æ®ï¼Œç»ˆæ­¢é€šä¿¡
    	`SocketAddress getRemoteSocketAddress() `: è¿”å›å¥—æ¥å­—è¿æ¥åˆ°çš„ç«¯ç‚¹çš„åœ°å€ï¼Œæœªè¿æ¥è¿”å›null

* ServerSocketç±»ï¼š
  
  * æ„é€ æ–¹æ³•ï¼š`public ServerSocket(int port)`
  * å¸¸ç”¨APIï¼š`public Socket accept()`ï¼šç­‰å¾…æ¥æ”¶ä¸€ä¸ªå®¢æˆ·ç«¯çš„Socketç®¡é“è¿æ¥è¯·æ±‚ï¼Œè¿æ¥æˆåŠŸè¿”å›ä¸€ä¸ªSocketå¯¹è±¡

  ç›¸å½“äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªæ•°æ®ç®¡é“ï¼Œç®¡é“ä¸€èˆ¬ä¸ç”¨closeã€‚
  
  

***



#### TCPå®ç°

å®¢æˆ·ç«¯çš„å¼€å‘æµç¨‹ï¼š
    1.å®¢æˆ·ç«¯è¦è¯·æ±‚äºæœåŠ¡ç«¯çš„socketç®¡é“è¿æ¥ã€‚
    2.ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµ
    3.é€šè¿‡å­—èŠ‚è¾“å‡ºæµç»™æœåŠ¡ç«¯å†™å‡ºæ•°æ®ã€‚
æœåŠ¡ç«¯çš„å¼€å‘æµç¨‹ï¼š
    1.ç”¨ServerSocketæ³¨å†Œç«¯å£ã€‚
    2.æ¥æ”¶å®¢æˆ·ç«¯çš„Socketç®¡é“è¿æ¥ã€‚
    3.ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµã€‚
    4.ä»å­—èŠ‚è¾“å…¥æµä¸­è¯»å–å®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®ã€‚

![](https://gitee.com/seazean/images/raw/master/JavaSE/BIOå·¥ä½œæœºåˆ¶.png)



##### BIO_1

å®¢æˆ·ç«¯å‘é€ä¸€è¡Œæ•°æ®ï¼ŒæœåŠ¡ç«¯æ¥æ”¶ä¸€è¡Œæ•°æ®

````java
public class ClientDemo {
    public static void main(String[] args) throws Exception {
        // 1.å®¢æˆ·ç«¯è¦è¯·æ±‚äºæœåŠ¡ç«¯çš„socketç®¡é“è¿æ¥ã€‚
        Socket socket = new Socket("127.0.0.1",8080);
        // 2.ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµ
        OutputStream os = new socket.getOutputStream();
        // 3.æŠŠä½çº§çš„å­—èŠ‚è¾“å‡ºæµåŒ…è£…æˆé«˜çº§çš„æ‰“å°æµã€‚
        PrintStream ps = new PrintStream(os);
        // 4.å¼€å§‹å‘æ¶ˆæ¯å‡ºå»
        ps.println("æˆ‘æ˜¯å®¢æˆ·ç«¯");
        ps.flush();//ä¸€èˆ¬ä¸å…³é—­IOæµ
        System.out.println("å®¢æˆ·ç«¯å‘é€å®Œæ¯•~~~~");
    }
}
public class ServerDemo{
    public static void main(String[] args) throws Exception {
        System.out.println("----æœåŠ¡ç«¯å¯åŠ¨----");
        // 1.æ³¨å†Œç«¯å£: public ServerSocket(int port)
        ServerSocket serverSocket = new ServerSocket(8080);
        // 2.å¼€å§‹ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„Socketç®¡é“è¿æ¥ã€‚
        Socket socket = serverSocket.accept();
        // 3.ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµã€‚
        InputStream is = socket.getInputStream();
        // 4.æŠŠå­—èŠ‚è¾“å…¥æµè½¬æ¢æˆå­—ç¬¦è¾“å…¥æµ
        BufferedReader br = new BufferedReader(new InputStreamReader(is));
        // 6.æŒ‰ç…§è¡Œè¯»å–æ¶ˆæ¯ ã€‚
        String line;
        if((line = br.readLine()) != null){
            System.out.println(line);
        }
    }
}
````



##### BIO_2

å®¢æˆ·2ç«¯å¯ä»¥åå¤å‘é€æ•°æ®ï¼ŒæœåŠ¡ç«¯å¯ä»¥åå¤æ•°æ®2

```java
public class ClientDemo {
    public static void main(String[] args) throws Exception {
        // 1.å®¢æˆ·ç«¯è¦è¯·æ±‚äºæœåŠ¡ç«¯çš„socketç®¡é“è¿æ¥ã€‚
        Socket socket = new Socket("127.0.0.1",8080);
        // 2.ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµ
        OutputStream os = new socket.getOutputStream();
        // 3.æŠŠä½çº§çš„å­—èŠ‚è¾“å‡ºæµåŒ…è£…æˆé«˜çº§çš„æ‰“å°æµã€‚
        PrintStream ps = new PrintStream(os);
        // 4.å¼€å§‹å‘æ¶ˆæ¯å‡ºå»
         while(true){
            Scanner sc = new Scanner(System.in);
            System.out.print("è¯·è¯´ï¼š");
            ps.println(sc.nextLine());
            ps.flush();
        }
    }
}
public class ServerDemo{
    public static void main(String[] args) throws Exception {
        System.out.println("----æœåŠ¡ç«¯å¯åŠ¨----");
        // 1.æ³¨å†Œç«¯å£: public ServerSocket(int port)
        ServerSocket serverSocket = new ServerSocket(8080);
        // 2.å¼€å§‹ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„Socketç®¡é“è¿æ¥ã€‚
        Socket socket = serverSocket.accept();
        // 3.ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµã€‚
        InputStream is = socket.getInputStream();
        // 4.æŠŠå­—èŠ‚è¾“å…¥æµè½¬æ¢æˆå­—ç¬¦è¾“å…¥æµ
        BufferedReader br = new BufferedReader(new InputStreamReader(is));
        // 6.æŒ‰ç…§è¡Œè¯»å–æ¶ˆæ¯ ã€‚
        String line;
        while((line = br.readLine()) != null){
            System.out.println(line);
        }
    }
}
```



##### BIO_3

å®ç°ä¸€ä¸ªæœåŠ¡ç«¯å¯ä»¥åŒæ—¶æ¥æ”¶å¤šä¸ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€‚

```java
public class ClientDemo {
    public static void main(String[] args) throws Exception {
        Socket socket = new Socket("127.0.0.1",8080);
        OutputStream os = new socket.getOutputStream();
        PrintStream ps = new PrintStream(os);
		while(true){
            Scanner sc = new Scanner(System.in);
            System.out.print("è¯·è¯´ï¼š");
            ps.println(sc.nextLine());
            ps.flush();
        }
    }
}
public class ServerDemo{
    public static void main(String[] args) throws Exception {
        System.out.println("----æœåŠ¡ç«¯å¯åŠ¨----");
        ServerSocket serverSocket = new ServerSocket(8080);
        while(true){
            // 3.å¼€å§‹ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„Socketç®¡é“è¿æ¥ã€‚
             Socket socket = serverSocket.accept();
            // 4.æ¯æ¥æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯å¿…é¡»ä¸ºè¿™ä¸ªå®¢æˆ·ç«¯ç®¡é“åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†ä¸ä¹‹é€šä¿¡ã€‚
            new ServerReaderThread(socket).start();
        }
    }
}
class ServerReaderThread extends Thread{
    privat Socket socket;
    public ServerReaderThread(Socket socket){this.socket = socket;}
    @Override
    public void run() {
        try(InputStream is = socket.getInputStream();
           	BufferedReader br = new BufferedReader(new InputStreamReader(is))
           ){
            String line;
            while((line = br.readLine()) != null){
                sout(socket.getRemoteSocketAddress() + "ï¼š" + line);
            }
        }catch(Exception e){
            sout(socket.getRemoteSocketAddress()+"ä¸‹çº¿äº†~~~~~~");
        }
    }
}
```



##### ä¼ªå¼‚æ­¥é€šä¿¡

ä¸€ä¸ªå®¢æˆ·ç«¯è¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ç§æ¨¡å‹æ˜¯ä¸è¡Œçš„ï¼Œå¹¶å‘è¶Šé«˜ï¼Œç³»ç»Ÿç˜«ç—ªçš„è¶Šå¿«ï¼ï¼
æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡ç«¯å¼•å…¥çº¿ç¨‹æ± ï¼Œä½¿ç”¨çº¿ç¨‹æ± æ¥å¤„ç†ä¸å®¢æˆ·ç«¯çš„æ¶ˆæ¯é€šä¿¡ï¼

ä¼˜åŠ¿ï¼šä¸ä¼šå¼•èµ·ç³»ç»Ÿçš„æ­»æœºï¼Œå¯ä»¥æ§åˆ¶å¹¶å‘çº¿ç¨‹çš„æ•°é‡ã€‚
åŠ£åŠ¿ï¼šåŒæ—¶å¯ä»¥å¹¶å‘çš„çº¿ç¨‹å°†å—åˆ°é™åˆ¶ã€‚

```java
public class Client {
    public static void main(String[] args) throws Exception{
		Socket socket = new Socket("127.0.0.1",8080);
        OutputStream os = new socket.getOutputStream();
        PrintStream ps = new PrintStream(os);
        BufferedReader br = new BufferedReader(new InputStreamReader(System.in));
		String msg;
        while ((msg = br.readLine()) != null) {
            ps.println(msg);
            ps.flush();
        }
    }
}


public class Server {
	public static void main(String[] args) {
		try {
			System.out.println("----------æœåŠ¡ç«¯å¯åŠ¨æˆåŠŸ------------");
			ServrSocket ss = new ServerSocket(8080);
			// ä¸€ä¸ªæœåŠ¡ç«¯åªéœ€è¦å¯¹åº”ä¸€ä¸ªçº¿ç¨‹æ± 
			HandlerSocketThreadPool handlerSocketThreadPool =
					new HandlerSocketThreadPool(3, 100);
			// å®¢æˆ·ç«¯å¯èƒ½æœ‰å¾ˆå¤šä¸ª
			while(true){
				Socket socket = ss.accept() ;
				System.out.println("æœ‰äººä¸Šçº¿äº†ï¼ï¼");
				// æ¯æ¬¡æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯çš„socketè¯·æ±‚ï¼Œéƒ½éœ€è¦ä¸ºè¿™ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ª
				// ç‹¬ç«‹çš„çº¿ç¨‹ ä¸“é—¨è´Ÿè´£å¯¹è¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡ï¼ï¼
				handlerSocketThreadPool.execute(new ReaderClientRunnable(socket));
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
}
// çº¿ç¨‹æ± å¤„ç†ç±»
public class HandlerSocketThreadPool {
	
	// çº¿ç¨‹æ±  
	private ExecutorService executor;
	// çº¿ç¨‹æ± ï¼š3ä¸ªçº¿ç¨‹  100ä¸ª
	public HandlerSocketThreadPool(int maxPoolSize, int queueSize){
		executor = new ThreadPoolExecutor(
				maxPoolSize,
				maxPoolSize,
				120L, 
				TimeUnit.SECONDS,
				new ArrayBlockingQueue<Runnable>(queueSize) );
	}
	public void execute(Runnable task){
		this.executor.execute(task);
	}
}
class ReaderClientRunnable implements Runnable {
	private Socket socket ;
	public ReaderClientRunnable(Socket socket) {this.socket = socket;}
	@Override
	public void run() {
		try {
			InputStream is = socket.getInputStream() ;
			// è½¬æˆä¸€ä¸ªç¼“å†²å­—ç¬¦æµ
			Reader fr = new InputStreamReader(is);
			BufferedReader br = new BufferedReader(fr);
			// ä¸€è¡Œä¸€è¡Œçš„è¯»å–æ•°æ®
			String line = null ;
			while((line = br.readLine())!=null){ // é˜»å¡å¼çš„ï¼ï¼
				System.out.println(socket.getRemoteSocketAddress() + line);
			}
		} catch (Exception e) {
			System.out.println(socket.getRemoteSocketAddress()+"ä¸‹çº¿äº†");
		}
	}
}
```



****



#### æ–‡ä»¶ä¼ è¾“

##### å­—èŠ‚æµä¼ è¾“

å®¢æˆ·ç«¯ï¼šæœ¬åœ°å›¾ç‰‡:  â€ªE:\itcast\å›¾ç‰‡èµ„æº\beautiful.jpg
æœåŠ¡ç«¯ï¼šæœåŠ¡å™¨è·¯å¾„ï¼šE:\itcast\å›¾ç‰‡æœåŠ¡å™¨

UUID. randomUUID() : æ–¹æ³•ç”Ÿæˆéšæœºçš„æ–‡ä»¶å

**socket.shutdownOutput()**ï¼šè¿™ä¸ªå¿…é¡»æ‰§è¡Œï¼Œä¸ç„¶æœåŠ¡å™¨ä¼šä¸€ç›´å¾ªç¯ç­‰å¾…æ•°æ®ï¼Œæœ€åæ–‡ä»¶æŸåï¼Œç¨‹åºæŠ¥é”™ã€‚

```java
//å¸¸é‡åŒ…
public class Constants {
    public static final String SRC_IMAGE = "D:\\itcast\\å›¾ç‰‡èµ„æº\\beautiful.jpg";
    public static final String SERVER_DIR = "D:\\itcast\\å›¾ç‰‡æœåŠ¡å™¨\\";
    public static final String SERVER_IP = "127.0.0.1";
    public static final int SERVER_PORT = 8888;

}
public class ClientDemo {
    public static void main(String[] args) throws Exception {
        Socket socket = new Socket(Constants.ERVER_IP,Constants.SERVER_PORT);
        BufferedOutputStream bos=new BufferedOutputStream(socket.getOutputStream());
        //æå–æœ¬æœºçš„å›¾ç‰‡ä¸Šä¼ ç»™æœåŠ¡ç«¯ã€‚Constants.SRC_IMAGE
        BufferedInputStream bis = new BufferedInputStream(new FileInputStream());
        byte[] buffer = new byte[1024];
        int len ;
        while((len = bis.read(buffer)) != -1) {
            bos.write(buffer, 0 ,len);
        }
        bos.flush();// åˆ·æ–°å›¾ç‰‡æ•°æ®åˆ°æœåŠ¡ç«¯ï¼ï¼
        socket.shutdownOutput();// å‘Šè¯‰æœåŠ¡ç«¯æˆ‘çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œä¸è¦åœ¨ç­‰æˆ‘äº†ï¼
        bis.close();
        
        //ç­‰å¾…ç€æœåŠ¡ç«¯çš„å“åº”æ•°æ®ï¼ï¼
        BufferedReader br = new BufferedReader(
           				 new InputStreamReader(socket.getInputStream()));
        System.out.println("æ”¶åˆ°æœåŠ¡ç«¯å“åº”ï¼š"+br.readLine());
    }
}
```

```java
public class ServerDemo {
    public static void main(String[] args) throws Exception {
        System.out.println("----æœåŠ¡ç«¯å¯åŠ¨----");
        // 1.æ³¨å†Œç«¯å£: 
        ServerSocket serverSocket = new ServerSocket(Constants.SERVER_PORT);
        // 2.å®šä¹‰ä¸€ä¸ªå¾ªç¯ä¸æ–­çš„æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚
        while(true){
            // 3.å¼€å§‹ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„Socketç®¡é“è¿æ¥ã€‚
            Socket socket = serverSocket.accept();
            // 4.æ¯æ¥æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯å¿…é¡»ä¸ºè¿™ä¸ªå®¢æˆ·ç«¯ç®¡é“åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†ä¸ä¹‹é€šä¿¡ã€‚
            new ServerReaderThread(socket).start();
        }
    }
}
class ServerReaderThread extends Thread{
    private Socket socket ;
    public ServerReaderThread(Socket socket){this.socket = socket;}
    @Override
    public void run() {
        try{
            InputStream is = socket.getInputStream();
           	BufferedInputStream bis = new BufferedInputStream(is);
            BufferedOutputStream bos = new BufferedOutputStream(
                new FileOutputStream
                (Constants.SERVER_DIR+UUID.randomUUID().toString()+".jpg"));
            byte[] buffer = new byte[1024];
            int len;
            while((len = bis.read(buffer))!=-1){
                bos.write(buffer,0,len);
            }
            bos.close();
            System.out.println("æœåŠ¡ç«¯æ¥æ”¶å®Œæ¯•äº†ï¼");
            
            // 4.å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯
            PrintStream ps = new PrintStream(socket.getOutputStream());
            ps.println("æ‚¨å¥½ï¼Œå·²æˆåŠŸæ¥æ”¶æ‚¨ä¸Šä¼ çš„å›¾ç‰‡ï¼");
            ps.flush();
            Thread.sleep(10000);
        }catch (Exception e){
            sout(socket.getRemoteSocketAddress() + "ä¸‹çº¿äº†");
        }
    }
}
```





##### æ•°æ®æµä¼ è¾“

æ„é€ æ–¹æ³•ï¼š
`DataOutputStream(OutputStream out)`:åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®è¾“å‡ºæµï¼Œä»¥å°†æ•°æ®å†™å…¥æŒ‡å®šçš„åº•å±‚è¾“å‡ºæµã€‚
`DataInputStream(InputStream in) `: åˆ›å»ºä½¿ç”¨æŒ‡å®šçš„åº•å±‚InputStreamçš„DataInputStreamã€‚

å¸¸ç”¨APIï¼š
`final void writeUTF(String str)`:ä½¿ç”¨æœºå™¨æ— å…³çš„æ–¹å¼ä½¿ç”¨UTF-8ç¼–ç å°†å­—ç¬¦ä¸²å†™å…¥åº•å±‚è¾“å‡ºæµã€‚ 
`final String readUTF()`:è¯»å–ä»¥modified UTF-8æ ¼å¼ç¼–ç çš„Unicodeå­—ç¬¦ä¸²ï¼Œè¿”å›Stringç±»å‹



```java
public class Client {
    public static void main(String[] args) {
		InputStream is = new FileInputStream("path");
            //  1ã€è¯·æ±‚ä¸æœåŠ¡ç«¯çš„Socketé“¾æ¥
            Socket socket = new Socket("127.0.0.1" , 8888);
            //  2ã€æŠŠå­—èŠ‚è¾“å‡ºæµåŒ…è£…æˆä¸€ä¸ªæ•°æ®è¾“å‡ºæµ
            DataOutputStream dos = new DataOutputStream(socket.getOutputStream());
            //  3ã€å…ˆå‘é€ä¸Šä¼ æ–‡ä»¶çš„åç¼€ç»™æœåŠ¡ç«¯
            dos.writeUTF(".png");
            //  4ã€æŠŠæ–‡ä»¶æ•°æ®å‘é€ç»™æœåŠ¡ç«¯è¿›è¡Œæ¥æ”¶
            byte[] buffer = new byte[1024];
            int len;
            while((len = is.read(buffer)) > 0 ){
                dos.write(buffer , 0 , len);
            }
            dos.flush();
            Thread.sleep(10000);
    }
}

public class Server {
    public static void main(String[] args) {
        ServerSocket ss = new ServerSocket(8888);
        Socket socket = ss.accept();
 		// 1ã€å¾—åˆ°ä¸€ä¸ªæ•°æ®è¾“å…¥æµè¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®
		DataInputStream dis = new DataInputStream(socket.getInputStream());
		// 2ã€è¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ–‡ä»¶ç±»å‹
		String suffix = dis.readUTF();
		// 3ã€å®šä¹‰ä¸€ä¸ªå­—èŠ‚è¾“å‡ºç®¡é“è´Ÿè´£æŠŠå®¢æˆ·ç«¯å‘æ¥çš„æ–‡ä»¶æ•°æ®å†™å‡ºå»
		OutputStream os = new FileOutputStream("path"+
                    UUID.randomUUID().toString()+suffix);
		// 4ã€ä»æ•°æ®è¾“å…¥æµä¸­è¯»å–æ–‡ä»¶æ•°æ®ï¼Œå†™å‡ºåˆ°å­—èŠ‚è¾“å‡ºæµä¸­å»
		byte[] buffer = new byte[1024];
		int len;
		while((len = dis.read(buffer)) > 0){
 			os.write(buffer,0, len);
		}
		os.close();
		System.out.println("æœåŠ¡ç«¯æ¥æ”¶æ–‡ä»¶ä¿å­˜æˆåŠŸï¼");
    }
}
```





***



### BS

å®¢æˆ·ç«¯ï¼šæµè§ˆå™¨ã€‚ï¼ˆæ— éœ€å¼€å‘ï¼‰
æœåŠ¡ç«¯ï¼šè‡ªå·±å¼€å‘ã€‚
éœ€æ±‚ï¼šåœ¨æµè§ˆå™¨ä¸­è¯·æ±‚æœ¬ç¨‹åºï¼Œå“åº”ä¸€ä¸ªç½‘é¡µæ–‡å­—ç»™æµè§ˆå™¨æ˜¾ç¤º

```java
public class BSServerDemo {
    public static void main(String[] args) {
        try{
            ServerSocket ss = new ServerSocket(8080);
            //å»ºä¸€ä¸ªå¾ªç¯æ¥æ”¶å¤šä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚
            while(true){
                Socket socket = ss.accept();
                new ServerReaderThread(socket).start();
            }
        }catch(Exception e){
            e.printStackTrace();
        }
    }
}
class ServerReaderThread extends Thread{
	private Socket socket;
    public ServerReaderThread(Socket socket) {this.socket = socket;}
    @Override
    public void run() {
        try{
            // å“åº”æ¶ˆæ¯æ•°æ®ç»™æµè§ˆå™¨æ˜¾ç¤ºã€‚æµè§ˆå™¨æ˜¯åŸºäºHTTPåè®®é€šä¿¡ï¼
            // å“åº”æ ¼å¼å¿…é¡»æ»¡è¶³HTTPåè®®æ•°æ®æ ¼å¼çš„è¦æ±‚ï¼Œæµè§ˆå™¨æ‰èƒ½å¤Ÿè¯†åˆ«ï¼Œå¦åˆ™å“åº”æ¶ˆæ¯æµè§ˆå™¨ä¸è®¤è¯†
            PrintStream ps = new PrintStream(socket.getOutputStream());
            ps.println("HTTP/1.1 200 OK"); // å“åº”æ•°æ®çš„å“åº”å¤´æ•°æ®ï¼
            ps.println("Content-Type:text/html;charset=UTF-8");//å“åº”æ•°æ®çš„ç±»å‹ç½‘é¡µæˆ–è€…æ–‡æœ¬å†…å®¹ï¼
            ps.println(); // å¿…é¡»æ¢ä¸€è¡Œ
            // ä»¥ä¸‹å¼€å§‹å“åº”çœŸå®çš„æ•°æ®ï¼ï¼
            ps.println("<span style='color:green;font-size:100px;'>ç‰›é€¼çš„128æœŸ<span>");
            Thread.sleep(4000);//é˜²æ­¢æ•°æ®æ²¡æ”¶åˆ°
			ps.close();
        }catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```



***



### NIO

#### æ¦‚è¿°

**NIOçš„ä»‹ç»**ï¼š

* Java NIOï¼ˆNew IOï¼‰ä¹Ÿæœ‰äººç§°ä¹‹ä¸º java non-blocking IOæ˜¯ä»Java 1.4ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªæ–°çš„IO APIï¼Œå¯ä»¥æ›¿ä»£æ ‡å‡†çš„Java IO APIã€‚NIOä¸åŸæ¥çš„IOæœ‰åŒæ ·çš„ä½œç”¨å’Œç›®çš„ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ–¹å¼å®Œå…¨ä¸åŒï¼ŒNIOæ”¯æŒé¢**å‘ç¼“å†²åŒº**çš„ã€åŸºäº**é€šé“**çš„IOæ“ä½œã€‚NIOå°†ä»¥æ›´åŠ é«˜æ•ˆçš„æ–¹å¼è¿›è¡Œæ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚NIOå¯ä»¥ç†è§£ä¸ºéé˜»å¡IO,ä¼ ç»Ÿçš„IOçš„readå’Œwriteåªèƒ½é˜»å¡æ‰§è¡Œï¼Œçº¿ç¨‹åœ¨è¯»å†™IOæœŸé—´ä¸èƒ½å¹²å…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚è°ƒç”¨socket.read()æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ä¸€ç›´æ²¡æœ‰æ•°æ®ä¼ è¾“è¿‡æ¥ï¼Œçº¿ç¨‹å°±ä¸€ç›´é˜»å¡ï¼Œè€ŒNIOä¸­å¯ä»¥é…ç½®socketä¸ºéé˜»å¡æ¨¡å¼ã€‚
* NIO ç›¸å…³ç±»éƒ½è¢«æ”¾åœ¨ java.nio åŒ…åŠå­åŒ…ä¸‹ï¼Œå¹¶ä¸”å¯¹åŸ java.io åŒ…ä¸­çš„å¾ˆå¤šç±»è¿›è¡Œæ”¹å†™ã€‚
* NIO æœ‰ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼š**Channel( é€šé“) ï¼ŒBuffer( ç¼“å†²åŒº), Selector( é€‰æ‹©å™¨)**
* Java NIO çš„éé˜»å¡æ¨¡å¼ï¼Œä½¿ä¸€ä¸ªçº¿ç¨‹ä»æŸé€šé“å‘é€è¯·æ±‚æˆ–è€…è¯»å–æ•°æ®ï¼Œä½†æ˜¯å®ƒä»…èƒ½å¾—åˆ°ç›®å‰å¯ç”¨çš„æ•°æ®ï¼Œå¦‚æœç›®å‰æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œå°±ä»€ä¹ˆéƒ½ä¸ä¼šè·å–ï¼Œè€Œä¸æ˜¯ä¿æŒçº¿ç¨‹é˜»å¡ï¼Œæ‰€ä»¥ç›´è‡³æ•°æ®å˜çš„å¯ä»¥è¯»å–ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–çš„äº‹æƒ…ã€‚ éé˜»å¡å†™ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚
* é€šä¿—ç†è§£ï¼šNIO æ˜¯å¯ä»¥åšåˆ°ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªæ“ä½œçš„ã€‚å‡è®¾æœ‰ 1000 ä¸ªè¯·æ±‚è¿‡æ¥,æ ¹æ®å®é™…æƒ…å†µï¼Œå¯ä»¥åˆ†é…20 æˆ–è€… 80ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚ä¸åƒä¹‹å‰çš„é˜»å¡ IO é‚£æ ·ï¼Œéå¾—åˆ†é… 1000 ä¸ªã€‚



**NIO å’Œ BIO çš„æ¯”è¾ƒ**ï¼š

* BIO ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®,è€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®,å— I/O çš„æ•ˆç‡æ¯”æµ I/O é«˜å¾ˆå¤š

* BIO æ˜¯é˜»å¡çš„ï¼ŒNIO åˆ™æ˜¯éé˜»å¡çš„

* BIO åŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œï¼Œè€Œ NIO åŸºäº Channel(é€šé“)å’Œ Buffer(ç¼“å†²åŒº)è¿›è¡Œæ“ä½œï¼Œæ•°æ®æ€»æ˜¯ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»ç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­ã€‚Selector(é€‰æ‹©å™¨)ç”¨äºç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šè¿æ¥è¯·æ±‚ï¼Œæ•°æ®åˆ°è¾¾ç­‰ï¼‰ï¼Œå› æ­¤ä½¿ç”¨å•ä¸ªçº¿ç¨‹å°±å¯ä»¥ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯é€šé“

  | NIO                       | BIO                 |
  | ------------------------- | ------------------- |
  | é¢å‘ç¼“å†²åŒºï¼ˆBufferï¼‰      | é¢å‘æµï¼ˆStreamï¼‰    |
  | éé˜»å¡ï¼ˆNon Blocking IOï¼‰ | é˜»å¡IO(Blocking IO) |
  | é€‰æ‹©å™¨ï¼ˆSelectorsï¼‰       |                     |



***



#### åŸç†

NIOä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼š**Channel( é€šé“) ï¼ŒBuffer( ç¼“å†²åŒº), Selector( é€‰æ‹©å™¨)**

* Bufferç¼“å†²åŒº

  ç¼“å†²åŒºæœ¬è´¨æ˜¯ä¸€å—å¯ä»¥å†™å…¥æ•°æ®ã€è¯»å–æ•°æ®çš„å†…å­˜ã€‚è¿™å—å†…å­˜è¢«åŒ…è£…æˆNIO Bufferå¯¹è±¡ï¼Œå¹¶ä¸”æä¾›äº†ç›¸åº”çš„æ–¹æ³•ï¼Œç”¨æ¥æ“ä½œè¿™å—å†…å­˜ï¼Œç›¸æ¯”è¾ƒç›´æ¥å¯¹æ•°ç»„çš„æ“ä½œï¼ŒBufferçš„APIæ›´åŠ å®¹æ˜“æ“ä½œå’Œç®¡ç†ã€‚

* Channelé€šé“

  Java NIOçš„é€šé“ç±»ä¼¼æµï¼Œä¸åŒçš„æ˜¯æ—¢å¯ä»¥ä»é€šé“ä¸­è¯»å–æ•°æ®ï¼Œåˆå¯ä»¥å†™æ•°æ®åˆ°é€šé“ï¼Œæµçš„ï¼ˆinputæˆ–output)è¯»å†™é€šå¸¸æ˜¯å•å‘çš„ã€‚é€šé“å¯ä»¥éé˜»å¡è¯»å–å’Œå†™å…¥é€šé“ï¼Œæ”¯æŒè¯»å–æˆ–å†™å…¥ç¼“å†²åŒºï¼Œä¹Ÿæ”¯æŒå¼‚æ­¥åœ°è¯»å†™ã€‚

* Selectoré€‰æ‹©å™¨

  Selectoræ˜¯ä¸€ä¸ªJava NIOç»„ä»¶ï¼Œèƒ½å¤Ÿæ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ª NIO é€šé“ï¼Œå¹¶ç¡®å®šå“ªäº›é€šé“å·²ç»å‡†å¤‡å¥½è¿›è¡Œè¯»å–æˆ–å†™å…¥ã€‚è¿™æ ·ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªchannelï¼Œä»è€Œç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œæé«˜æ•ˆç‡

  

NIOçš„å®ç°æ¡†æ¶ï¼š

![](https://gitee.com/seazean/images/raw/master/JavaSE/NIOæ¡†æ¶.png)

* æ¯ä¸ª channel éƒ½ä¼šå¯¹åº”ä¸€ä¸ª Buffer
* ä¸€ä¸ªçº¿ç¨‹å¯¹åº”Selector ï¼Œ ä¸€ä¸ªSelectorå¯¹åº”å¤šä¸ª channel(è¿æ¥)
* ç¨‹åºåˆ‡æ¢åˆ°å“ªä¸ªchannelæ˜¯ç”±äº‹ä»¶å†³å®šçš„
* Selector ä¼šæ ¹æ®ä¸åŒçš„äº‹ä»¶ï¼Œåœ¨å„ä¸ªé€šé“ä¸Šåˆ‡æ¢
* Buffer å°±æ˜¯ä¸€ä¸ªå†…å­˜å— ï¼Œ **åº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„**
* æ•°æ®çš„è¯»å–å†™å…¥æ˜¯é€šè¿‡ Bufferå®Œæˆçš„ , BIO ä¸­è¦ä¹ˆæ˜¯è¾“å…¥æµï¼Œæˆ–è€…æ˜¯è¾“å‡ºæµ, ä¸èƒ½åŒå‘ï¼Œä½†æ˜¯ NIO çš„ Buffer æ˜¯å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ã€‚
* Java NIOç³»ç»Ÿçš„æ ¸å¿ƒåœ¨äºï¼šé€šé“(Channel)å’Œç¼“å†²åŒº (Buffer)ã€‚é€šé“è¡¨ç¤ºæ‰“å¼€åˆ° IO è®¾å¤‡(ä¾‹å¦‚ï¼šæ–‡ä»¶ã€ å¥—æ¥å­—)çš„è¿æ¥ã€‚è‹¥éœ€è¦ä½¿ç”¨ NIO ç³»ç»Ÿï¼Œè·å–ç”¨äºè¿æ¥ IO è®¾å¤‡çš„é€šé“ä»¥åŠç”¨äºå®¹çº³æ•°æ®çš„ç¼“å†²åŒºï¼Œç„¶åæ“ä½œç¼“å†²åŒºï¼Œå¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒChannel è´Ÿè´£ä¼ è¾“ï¼Œ Buffer è´Ÿè´£å­˜å–æ•°æ®



***



#### ç¼“å†²åŒº

##### æ¦‚è¿°

ç”¨äºç‰¹å®šåŸºæœ¬æ•°æ®ç±»å‹çš„å®¹å™¨ã€‚ç”± java.nio åŒ…å®šä¹‰çš„ï¼Œæ‰€æœ‰ç¼“å†²åŒºéƒ½æ˜¯ BufferæŠ½è±¡ç±»çš„å­ç±»ã€‚Java NIO ä¸­çš„ Buffer ä¸»è¦ç”¨äºä¸ NIO é€šé“è¿›è¡Œ äº¤äº’ï¼Œæ•°æ®æ˜¯ä»é€šé“è¯»å…¥ç¼“å†²åŒºï¼Œä»ç¼“å†²åŒºå†™å…¥é€šé“ä¸­çš„

![](https://gitee.com/seazean/images/raw/master/JavaSE/NIO-Buffer.png)

**Buffer** å°±åƒä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥ä¿å­˜å¤šä¸ªç›¸åŒç±»å‹çš„æ•°æ®ï¼Œæ ¹æ®æ•°æ®ç±»å‹ä¸åŒ ï¼Œæœ‰ä»¥ä¸‹ Buffer å¸¸ç”¨å­ç±»ï¼š
	ByteBuffer, CharBuffer, ShortBuffer, IntBuffer, LongBuffer, FloatBuffer, DoubleBuffer 



##### å±æ€§

* å®¹é‡ (capacity) ï¼šä½œä¸ºä¸€ä¸ªå†…å­˜å—ï¼ŒBufferå…·æœ‰ä¸€å®šçš„å›ºå®šå¤§å°ï¼Œä¹Ÿç§°ä¸º"å®¹é‡"ï¼Œç¼“å†²åŒºå®¹é‡ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”åˆ›å»ºåä¸èƒ½æ›´æ”¹ã€‚ 

* é™åˆ¶ (limit)ï¼šè¡¨ç¤ºç¼“å†²åŒºä¸­**å¯ä»¥æ“ä½œæ•°æ®**çš„å¤§å°ï¼ˆlimit åæ•°æ®ä¸èƒ½è¿›è¡Œè¯»å†™ï¼‰ã€‚ç¼“å†²åŒºçš„é™åˆ¶ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶å®¹é‡ã€‚ **å†™å…¥æ¨¡å¼ï¼Œé™åˆ¶ç­‰äºbufferçš„å®¹é‡ã€‚è¯»å–æ¨¡å¼ä¸‹ï¼Œlimitç­‰äºå†™å…¥çš„æ•°æ®é‡**ã€‚

* ä½ç½® (position)ï¼šä¸‹ä¸€ä¸ªè¦è¯»å–æˆ–å†™å…¥çš„æ•°æ®çš„ç´¢å¼•ã€‚ç¼“å†²åŒºçš„ä½ç½®ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶é™åˆ¶ 

* **æ ‡è®° (mark)ä¸é‡ç½® (reset)**ï¼šæ ‡è®°æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œé€šè¿‡Bufferä¸­çš„mark() æ–¹æ³•æŒ‡å®š Buffer ä¸­ä¸€ä¸ªç‰¹å®šçš„positionï¼Œä¹‹åå¯ä»¥é€šè¿‡è°ƒç”¨ reset() æ–¹æ³•æ¢å¤åˆ°è¿™ ä¸ª position.

* æ ‡è®°ã€ä½ç½®ã€é™åˆ¶ã€å®¹é‡éµå®ˆä»¥ä¸‹ä¸å˜å¼ï¼š **0 <= mark <= position <= limit <= capacity**

  ![](https://gitee.com/seazean/images/raw/master/JavaSE/NIO-Bufferæ“ä½œ.png)





##### å¸¸ç”¨API

**è·å–Bufferå¯¹è±¡**ï¼š
`static XxxBuffer allocate(int capacity)` : åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸ºcapacity çš„XxxBuffer å¯¹è±¡

**BufferåŸºæœ¬æ“ä½œ**ï¼š

| æ–¹æ³•                                        | è¯´æ˜                                                    |
| ------------------------------------------- | ------------------------------------------------------- |
| public Buffer clear()                       | æ¸…ç©ºç¼“å†²åŒºï¼Œä¸æ¸…ç©ºå†…å®¹ï¼Œå°†ä½ç½®è®¾ç½®ä¸ºé›¶ï¼Œé™åˆ¶è®¾ç½®ä¸ºå®¹é‡  |
| public Buffer flip()                        | ç¿»è½¬ç¼“å†²åŒºï¼Œå°†ç¼“å†²åŒºçš„ç•Œé™è®¾ç½®ä¸ºå½“å‰ä½ç½®ï¼Œpositionç½®0   |
| public int capacity()                       | è¿”å› Bufferçš„capacity å¤§å°                              |
| public final boolean hasRemaining()         | åˆ¤æ–­ç¼“å†²åŒºä¸­æ˜¯å¦è¿˜æœ‰å…ƒç´                                 |
| public final int limit()                    | è¿”å›Bufferçš„ç•Œé™(limit)çš„ä½ç½®                           |
| public Buffer limit(int newLimit)           | å°†è®¾ç½®ç¼“å†²åŒºç•Œé™ä¸º n, è¿”å›ä¸€ä¸ªå…·æœ‰æ–° limit çš„ç¼“å†²åŒºå¯¹è±¡ |
| public Buffer mark()                        | åœ¨æ­¤ä½ç½®å¯¹ç¼“å†²åŒºè®¾ç½®æ ‡è®°                                |
| public final int position()                 | è¿”å›ç¼“å†²åŒºçš„å½“å‰ä½ç½®position                            |
| public Buffer position(int n)               | å°†è®¾ç½®ç¼“å†²åŒºçš„å½“å‰ä½ç½®ä¸ºn,å¹¶è¿”å›ä¿®æ”¹åçš„ Buffer å¯¹è±¡    |
| public final int remaining()                | è¿”å›å½“å‰ä½ç½®positionå’Œlimitä¹‹é—´çš„å…ƒç´ ä¸ªæ•°               |
| public Buffer reset()                       | å°†ä½ç½® position é‡ç½®ä¸ºå…ˆå‰markæ ‡è®°çš„ä½ç½®ã€‚              |
| public Buffer rewind()                      | å°†ä½ç½®è®¾ä¸ºä¸º0ï¼Œå–æ¶ˆè®¾ç½®çš„ mark                          |
| public static ByteBuffer wrap(byte[] array) | å°†ä¸€ä¸ªå­—èŠ‚æ•°ç»„åŒ…è£…åˆ°ç¼“å†²åŒºä¸­                            |

**Bufferæ•°æ®æ“ä½œ**ï¼š

| æ–¹æ³•                                              | è¯´æ˜                                              |
| ------------------------------------------------- | ------------------------------------------------- |
| public abstract byte get()                        | è¯»å–è¯¥ç¼“å†²åŒºå½“å‰ä½ç½®çš„å•ä¸ªå­—èŠ‚ï¼Œç„¶åå¢åŠ ä½ç½®      |
| public ByteBuffer get(byte[] dst)                 | è¯»å–å¤šä¸ªå­—èŠ‚åˆ°å­—èŠ‚æ•°ç»„dstä¸­                       |
| public abstract byte get(int index)               | è¯»å–æŒ‡å®šç´¢å¼•ä½ç½®çš„å­—èŠ‚(ä¸ä¼šç§»åŠ¨ position)         |
| public abstract ByteBuffer put(byte b)            | å°†ç»™å®šå•ä¸ªå­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„å½“å‰ä½ç½®ï¼Œç„¶åå¢åŠ ä½ç½®  |
| public final ByteBuffer put(byte[] src)           | å°†src å­—èŠ‚æ•°ç»„å†™å…¥ç¼“å†²åŒºçš„å½“å‰ä½ç½®                |
| public abstract ByteBuffer put(int index, byte b) | å°†æŒ‡å®šå­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„ç´¢å¼•ä½ç½®(ä¸ä¼šç§»åŠ¨ position) |

æç¤ºï¼š"\n"ï¼Œå ç”¨ä¸¤ä¸ªå­—èŠ‚



##### è¯»å†™æ•°æ®

ä½¿ç”¨Bufferè¯»å†™æ•°æ®ä¸€èˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š

* 1.å†™å…¥æ•°æ®åˆ°Buffer
* 2.è°ƒç”¨flip()æ–¹æ³•ï¼Œè½¬æ¢ä¸ºè¯»å–æ¨¡å¼
* 3.ä»Bufferä¸­è¯»å–æ•°æ®
* 4.è°ƒç”¨buffer.clear()æ–¹æ³•æˆ–è€…buffer.compact()æ–¹æ³•æ¸…é™¤ç¼“å†²åŒº

```java
public class TestBuffer {
	@Test
    public void test(){
		String str = "itheima";
		//1. åˆ†é…ä¸€ä¸ªæŒ‡å®šå¤§å°çš„ç¼“å†²åŒº
		ByteBuffer buffer = ByteBuffer.allocate(1024);
		System.out.println("-----------------allocate()----------------");
		System.out.println(bufferf.position());//0
		System.out.println(buffer.limit());//1024
		System.out.println(buffer.capacity());//1024
        
        //2. åˆ©ç”¨ put() å­˜å…¥æ•°æ®åˆ°ç¼“å†²åŒºä¸­
      	buffer.put(str.getBytes());
     	System.out.println("-----------------put()----------------");
		System.out.println(bufferf.position());//7
		System.out.println(buffer.limit());//1024
		System.out.println(buffer.capacity());//1024
        
        //3. åˆ‡æ¢è¯»å–æ•°æ®æ¨¡å¼
        buffer.flip();
        System.out.println("-----------------flip()----------------");
        System.out.println(buffer.position());//0
        System.out.println(buffer.limit());//7
        System.out.println(buffer.capacity());//1024
        
        //4. åˆ©ç”¨ get() è¯»å–ç¼“å†²åŒºä¸­çš„æ•°æ®
        byte[] dst = new byte[buffer.limit()];
        buffer.get(dst);
        System.out.println(dst.length);
        System.out.println(new String(dst, 0, dst.length));
        System.out.println("-----------------get()----------------");
        System.out.println(buffer.position());//7
        System.out.println(buffer.limit());//7
        System.out.println(buffer.capacity());//1024
        
        //5. rewind() : å¯é‡å¤è¯»
        buffer.rewind();
        System.out.println("-----------------rewind()----------------");
        System.out.println(buffer.position());//0
        System.out.println(buffer.limit());//7
        System.out.println(buffer.capacity());//1024
        
        //6. clear() : æ¸…ç©ºç¼“å†²åŒº. ä½†æ˜¯ç¼“å†²åŒºä¸­çš„æ•°æ®ä¾ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å¤„äºâ€œè¢«é—å¿˜â€çŠ¶æ€
        System.out.println(buffer.hasRemaining());//true
        buffer.clear();
        System.out.println(buffer.hasRemaining());//true
      	System.out.println("-----------------clear()----------------");
      	System.out.println(buffer.position());//0
      	System.out.println(buffer.limit());//1024
      	System.out.println(buffer.capacity());//1024
    }
}
```





##### ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº

æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼š
`byte byffer`å¯ä»¥æ˜¯ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯åŸºäºç›´æ¥å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯éå †å†…å­˜ï¼‰ï¼›å¦ä¸€ç§æ˜¯éç›´æ¥å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯å †å†…å­˜ï¼‰ã€‚å¯¹äºç›´æ¥å†…å­˜æ¥è¯´ï¼ŒJVMå°†ä¼šåœ¨IOæ“ä½œä¸Šå…·æœ‰æ›´é«˜çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒç›´æ¥ä½œç”¨äºæœ¬åœ°ç³»ç»Ÿçš„IOæ“ä½œã€‚è€Œéç›´æ¥å†…å­˜ï¼Œä¹Ÿå°±æ˜¯å †å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¦‚æœè¦ä½œIOæ“ä½œï¼Œä¼šå…ˆä»æœ¬è¿›ç¨‹å†…å­˜å¤åˆ¶åˆ°ç›´æ¥å†…å­˜ï¼Œå†åˆ©ç”¨æœ¬åœ°IOå¤„ç†ã€‚

ç›´æ¥å†…å­˜åˆ›å»ºBufferå¯¹è±¡ï¼š`static XxxBuffer allocateDirect(int capacity)`

æ•°æ®æµçš„è§’åº¦ï¼š
éç›´æ¥å†…å­˜çš„ä½œç”¨é“¾ï¼š**æœ¬åœ°IO-->ç›´æ¥å†…å­˜-->éç›´æ¥å†…å­˜-->ç›´æ¥å†…å­˜-->æœ¬åœ°IO**
ç›´æ¥å†…å­˜æ˜¯ï¼š**æœ¬åœ°IO-->ç›´æ¥å†…å­˜-->æœ¬åœ°IO**

**ä¼˜ç¼ºç‚¹**ï¼šç›´æ¥å†…å­˜ä½¿ç”¨allocateDirectåˆ›å»ºï¼Œè¿™éƒ¨åˆ†çš„æ•°æ®æ˜¯åœ¨JVMä¹‹å¤–çš„ï¼Œå› æ­¤å®ƒä¸ä¼šå ç”¨åº”ç”¨çš„å†…å­˜ï¼Œä½†æ˜¯å®ƒæ¯”ç”³è¯·æ™®é€šçš„å †å†…å­˜éœ€è¦è€—è´¹æ›´é«˜çš„æ€§èƒ½ã€‚å­—èŠ‚ç¼“å†²åŒºæ˜¯å¦æ˜¯ç›´æ¥ç¼“å†²åŒºå¯é€šè¿‡è°ƒç”¨isDirect() æ–¹æ³•æ¥ç¡®å®šã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š

- æœ‰å¾ˆå¤§çš„æ•°æ®éœ€è¦å­˜å‚¨ï¼Œæ•°æ®çš„ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿
- é€‚åˆé¢‘ç¹çš„IOæ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œå¹¶å‘åœºæ™¯



***



#### é€šé“

##### æ¦‚è¿°

é€šé“ï¼ˆChannelï¼‰ï¼šç”± java.nio.channels åŒ…å®šä¹‰ çš„ã€‚Channel è¡¨ç¤º IO æºä¸ç›®æ ‡æ‰“å¼€çš„è¿æ¥ã€‚ Channel ç±»ä¼¼äºä¼ ç»Ÿçš„â€œæµâ€ã€‚åªä¸è¿‡ Channel æœ¬èº«ä¸èƒ½ç›´æ¥è®¿é—®æ•°æ®ï¼ŒChannel åªèƒ½ä¸ Buffer è¿›è¡Œ**äº¤äº’**ã€‚

1ã€ NIO çš„é€šé“ç±»ä¼¼äºæµï¼Œä½†æœ‰äº›åŒºåˆ«å¦‚ä¸‹ï¼š

* é€šé“å¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™ï¼Œè€Œæµåªèƒ½è¯»æˆ–è€…åªèƒ½å†™

* é€šé“å¯ä»¥å®ç°å¼‚æ­¥è¯»å†™æ•°æ®

* é€šé“å¯ä»¥ä»ç¼“å†²è¯»æ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™æ•°æ®åˆ°ç¼“å†²:

2ã€BIO ä¸­çš„ stream æ˜¯å•å‘çš„ï¼ŒNIOä¸­çš„é€šé“(Channel)æ˜¯åŒå‘çš„ï¼Œå¯ä»¥è¯»æ“ä½œï¼Œä¹Ÿå¯ä»¥å†™æ“ä½œã€‚

3ã€Channel åœ¨ NIO ä¸­æ˜¯ä¸€ä¸ªæ¥å£: `public interface Channel extends Closeable{}`



**Channelå®ç°ç±»**ï¼š

* FileChannelï¼šç”¨äºè¯»å–ã€å†™å…¥ã€æ˜ å°„å’Œæ“ä½œæ–‡ä»¶çš„é€šé“ã€‚
* DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®é€šé“ã€‚
* SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®ã€‚
* ServerSocketChannelï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªSocketChannelã€‚ 
  æç¤ºï¼šServerSocketChanne ç±»ä¼¼ ServerSocket , SocketChannel ç±»ä¼¼ Socket

**FileChannelç±»ï¼š**

* FileInputStream
* FileOutputStream
* RandomAccessFile
* DatagramSocket
* Socket
* ServerSocket



##### å¸¸ç”¨API

è·å–é€šé“æ–¹å¼ï¼š

* å¯¹æ”¯æŒé€šé“çš„å¯¹è±¡è°ƒç”¨getChannel()æ–¹æ³•
* é€šè¿‡é€šé“çš„é™æ€æ–¹æ³• open() æ‰“å¼€å¹¶è¿”å›æŒ‡å®šé€šé“
* ä½¿ç”¨ Files ç±»çš„é™æ€æ–¹æ³• newByteChannel() è·å–å­—èŠ‚é€šé“ã€‚

| æ–¹æ³•                                       | è¯´æ˜                                                    |
| ------------------------------------------ | ------------------------------------------------------- |
| public abstract int read(ByteBuffer dst)   | ä»Channelä¸­è¯»å–æ•°æ®åˆ°ByteBufferï¼Œä»positionä½ç½®å¼€å§‹å‚¨å­˜ |
| public final long read(ByteBuffer[] dsts)  | å°†Channelä¸­çš„æ•°æ®â€œåˆ†æ•£â€åˆ°ByteBuffer[]                   |
| public abstract int write(ByteBuffer src)  | å°†ByteBufferä¸­çš„æ•°æ®å†™å…¥Channelï¼Œä»positionä½ç½®å¼€å§‹å†™å‡º |
| public final long write(ByteBuffer[] srcs) | å°†ByteBuffer[]åˆ°ä¸­çš„æ•°æ®â€œèšé›†â€åˆ°Channel                 |
| public abstract long position()            | è¿”å›æ­¤é€šé“çš„æ–‡ä»¶ä½ç½®                                    |
| FileChannel position(long newPosition)     | è®¾ç½®æ­¤é€šé“çš„æ–‡ä»¶ä½ç½®                                    |
| public abstract long size()                | è¿”å›æ­¤é€šé“çš„æ–‡ä»¶çš„å½“å‰å¤§å°                              |
| FileChannel truncate(long size)            | å°†æ­¤é€šé“çš„æ–‡ä»¶æˆªå–ä¸ºç»™å®šå¤§å°                            |
| void force(boolean metaData)               | å¼ºåˆ¶å°†æ‰€æœ‰å¯¹æ­¤é€šé“çš„æ–‡ä»¶æ›´æ–°å†™å…¥åˆ°å­˜å‚¨è®¾å¤‡ä¸­            |



##### æ–‡ä»¶è¯»å†™

```java
public class ChannelTest {
    @Test
	public void write() throws Exception{
 		// 1ã€å­—èŠ‚è¾“å‡ºæµé€šå‘ç›®æ ‡æ–‡ä»¶
        FileOutputStream fos = new FileOutputStream("data01.txt");
        // 2ã€å¾—åˆ°å­—èŠ‚è¾“å‡ºæµå¯¹åº”çš„é€šé“Channel
        FileChannel channel = fos.getChannel();
        // 3ã€åˆ†é…ç¼“å†²åŒº
        ByteBuffer buffer = ByteBuffer.allocate(1024);
        buffer.put("hello,é»‘é©¬Javaç¨‹åºå‘˜ï¼".getBytes());
        // 4ã€æŠŠç¼“å†²åŒºåˆ‡æ¢æˆå†™å‡ºæ¨¡å¼
        buffer.flip();
        channel.write(buffer);
        channel.close();
        System.out.println("å†™æ•°æ®åˆ°æ–‡ä»¶ä¸­ï¼");
    }
    @Test
    public void read() throws Exception {
        // 1ã€å®šä¹‰ä¸€ä¸ªæ–‡ä»¶å­—èŠ‚è¾“å…¥æµä¸æºæ–‡ä»¶æ¥é€š
        FileInputStream fis = new FileInputStream("data01.txt");
        // 2ã€éœ€è¦å¾—åˆ°æ–‡ä»¶å­—èŠ‚è¾“å…¥æµçš„æ–‡ä»¶é€šé“
        FileChannel channel = fis.getChannel();
        // 3ã€å®šä¹‰ä¸€ä¸ªç¼“å†²åŒº
        ByteBuffer buffer = ByteBuffer.allocate(1024);
        // 4ã€è¯»å–æ•°æ®åˆ°ç¼“å†²åŒº
        channel.read(buffer);
        buffer.flip();
        // 5ã€è¯»å–å‡ºç¼“å†²åŒºä¸­çš„æ•°æ®å¹¶è¾“å‡ºå³å¯
        String rs = new String(buffer.array(),0,buffer.remaining());
        System.out.println(rs);
    }
}
```



##### æ–‡ä»¶å¤åˆ¶

æ–¹å¼ä¸€ï¼šBuffer

æ–¹å¼äºŒï¼štransferFrom    transferTo

* public abstract long transferFrom(ReadableByteChannel src, long position, long count)ï¼šä»ç»™å®šçš„å¯è¯»å­—èŠ‚é€šé“å°†å­—èŠ‚ä¼ è¾“åˆ°è¯¥é€šé“çš„æ–‡ä»¶ä¸­

  * src - æºé€šé“
  * position - æ–‡ä»¶ä¸­è¦è¿›è¡Œä¼ è¾“çš„ä½ç½®; å¿…é¡»æ˜¯éè´Ÿçš„ 
  * count - è¦ä¼ è¾“çš„æœ€å¤§å­—èŠ‚æ•°; å¿…é¡»æ˜¯éè´Ÿçš„ 

* public abstract long transferTo(long position, long count, WritableByteChannel target)ï¼šå°†è¯¥é€šé“æ–‡ä»¶çš„å­—èŠ‚ä¼ è¾“åˆ°ç»™å®šçš„å¯å†™å­—èŠ‚é€šé“ã€‚ 

  * position - ä¼ è¾“å¼€å§‹çš„æ–‡ä»¶ä¸­çš„ä½ç½®; å¿…é¡»æ˜¯éè´Ÿçš„ 
  * count - è¦ä¼ è¾“çš„æœ€å¤§å­—èŠ‚æ•°; å¿…é¡»æ˜¯éè´Ÿçš„ 

  * target - ç›®æ ‡é€šé“ 

```java
public class ChannelTest {
    @Test
    public void copy1() throws Exception {
        File srcFile = new File("C:\\å£çº¸.jpg");
        File destFile = new File("C:\\Users\\å£çº¸new.jpg");
        // å¾—åˆ°ä¸€ä¸ªå­—èŠ‚å­—èŠ‚è¾“å…¥æµ
        FileInputStream fis = new FileInputStream(srcFile);
        // å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµ
        FileOutputStream fos = new FileOutputStream(destFile);
        // å¾—åˆ°çš„æ˜¯æ–‡ä»¶é€šé“
        FileChannel isChannel = fis.getChannel();
        FileChannel osChannel = fos.getChannel();
        // åˆ†é…ç¼“å†²åŒº
        ByteBuffer buffer = ByteBuffer.allocate(1024);
        while(true){
            // å¿…é¡»å…ˆæ¸…ç©ºç¼“å†²ç„¶åå†å†™å…¥æ•°æ®åˆ°ç¼“å†²åŒº
            buffer.clear();
            // å¼€å§‹è¯»å–ä¸€æ¬¡æ•°æ®
            int flag = isChannel.read(buffer);
            if(flag == -1){
                break;
            }
            // å·²ç»è¯»å–äº†æ•°æ® ï¼ŒæŠŠç¼“å†²åŒºçš„æ¨¡å¼åˆ‡æ¢æˆå¯è¯»æ¨¡å¼
            buffer.flip();
            // æŠŠæ•°æ®å†™å‡ºåˆ°
            osChannel.write(buffer);
        }
        isChannel.close();
        osChannel.close();
        System.out.println("å¤åˆ¶å®Œæˆï¼");
    }
    
	@Test
	public void test02() throws Exception {
    	// 1ã€å­—èŠ‚è¾“å…¥ç®¡é“
   	 	FileInputStream fis = new FileInputStream("data01.txt");
   	 	FileChannel isChannel = fis.getChannel();
    	// 2ã€å­—èŠ‚è¾“å‡ºæµç®¡é“
    	FileOutputStream fos = new FileOutputStream("data03.txt");
    	FileChannel osChannel = fos.getChannel();
    	// 3ã€å¤åˆ¶
    	osChannel.transferFrom(isChannel,isChannel.position(),isChannel.size());
    	isChannel.close();
    	osChannel.close();
	}
    
	@Test
	public void test02() throws Exception {
    	// 1ã€å­—èŠ‚è¾“å…¥ç®¡é“
    	FileInputStream fis = new FileInputStream("data01.txt");
    	FileChannel isChannel = fis.getChannel();
    	// 2ã€å­—èŠ‚è¾“å‡ºæµç®¡é“
    	FileOutputStream fos = new FileOutputStream("data04.txt");
    	FileChannel osChannel = fos.getChannel();
    	// 3ã€å¤åˆ¶
    	isChannel.transferTo(isChannel.position() , isChannel.size() , osChannel);
    	isChannel.close();
    	osChannel.close();
	}
}
```



##### åˆ†æ•£èšé›†

åˆ†æ•£è¯»å–ï¼ˆScatter ï¼‰ï¼šæ˜¯æŒ‡æŠŠChannelé€šé“çš„æ•°æ®è¯»å…¥åˆ°å¤šä¸ªç¼“å†²åŒºä¸­å»

èšé›†å†™å…¥ï¼ˆGathering ï¼‰ï¼šæ˜¯æŒ‡å°†å¤šä¸ª Buffer ä¸­çš„æ•°æ®â€œèšé›†â€åˆ° Channelã€‚

```java
public class ChannelTest {
    @Test
    public void test() throws IOException{
    	// 1ã€å­—èŠ‚è¾“å…¥ç®¡é“
        FileInputStream is = new FileInputStream("data01.txt");
        FileChannel isChannel = is.getChannel();
        // 2ã€å­—èŠ‚è¾“å‡ºæµç®¡é“
        FileOutputStream fos = new FileOutputStream("data02.txt");
        FileChannel osChannel = fos.getChannel();
        // 3ã€å®šä¹‰å¤šä¸ªç¼“å†²åŒºåšæ•°æ®åˆ†æ•£
        ByteBuffer buffer1 = ByteBuffer.allocate(4);
        ByteBuffer buffer2 = ByteBuffer.allocate(1024);
        ByteBuffer[] buffers = {buffer1 , buffer2};
        // 4ã€ä»é€šé“ä¸­è¯»å–æ•°æ®åˆ†æ•£åˆ°å„ä¸ªç¼“å†²åŒº
        isChannel.read(buffers);
        // 5ã€ä»æ¯ä¸ªç¼“å†²åŒºä¸­æŸ¥è¯¢æ˜¯å¦æœ‰æ•°æ®è¯»å–åˆ°äº†
        for(ByteBuffer buffer : buffers){
            buffer.flip();// åˆ‡æ¢åˆ°è¯»æ•°æ®æ¨¡å¼
            System.out.println(new String(buffer.array() , 0 , buffer.remaining()));
        }
        // 6ã€èšé›†å†™å…¥åˆ°é€šé“
        osChannel.write(buffers);
        isChannel.close();
        osChannel.close();
        System.out.println("æ–‡ä»¶å¤åˆ¶~~");
    }
}
```



***



#### é€‰æ‹©å™¨

##### é€‰æ‹©å™¨æ¦‚è¿°

é€‰æ‹©å™¨ï¼ˆSelectorï¼‰ æ˜¯ SelectableChannle å¯¹è±¡çš„**å¤šè·¯å¤ç”¨å™¨**ï¼ŒSelector å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ª SelectableChannel çš„ IO çŠ¶å†µï¼Œåˆ©ç”¨ Selectorå¯ä½¿ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ç®¡ç†å¤šä¸ª Channelã€‚**Selector æ˜¯éé˜»å¡ IO çš„æ ¸å¿ƒ**ã€‚

![](https://gitee.com/seazean/images/raw/master/JavaSE/NIO-Selector.png)



* Java çš„ NIOï¼Œç”¨éé˜»å¡çš„ IO æ–¹å¼ã€‚å¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†å¤šä¸ªçš„å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±ä¼šä½¿ç”¨åˆ° Selector(é€‰æ‹©å™¨)
* Selector èƒ½å¤Ÿæ£€æµ‹å¤šä¸ªæ³¨å†Œçš„é€šé“ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿ(æ³¨æ„:å¤šä¸ª Channel ä»¥äº‹ä»¶çš„æ–¹å¼å¯ä»¥æ³¨å†Œåˆ°åŒä¸€ä¸ªSelector)ï¼Œå¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¾¿è·å–äº‹ä»¶ç„¶åé’ˆå¯¹æ¯ä¸ªäº‹ä»¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚è¿™æ ·å°±å¯ä»¥åªç”¨ä¸€ä¸ªå•çº¿ç¨‹å»ç®¡ç†å¤šä¸ªé€šé“ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å¤šä¸ªè¿æ¥å’Œè¯·æ±‚
* åªæœ‰åœ¨è¿æ¥/é€šé“çœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰ä¼šè¿›è¡Œè¯»å†™ï¼Œå°±å¤§å¤§åœ°å‡å°‘äº†ç³»ç»Ÿå¼€é”€ï¼Œå¹¶ä¸”ä¸å¿…ä¸ºæ¯ä¸ªè¿æ¥éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ç”¨å»ç»´æŠ¤å¤šä¸ªçº¿ç¨‹
* é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´çš„å¼€é”€



##### é€‰æ‹©å™¨ç”¨æ³•

åˆ›å»º Selector(è°ƒç”¨é™æ€æ–¹æ³•) ï¼š`Selector selector = Selector.open();`

å‘é€‰æ‹©å™¨æ³¨å†Œé€šé“ï¼š`SelectableChannel.register(Selector sel, int ops)`

å°†é€šé“æ³¨å†Œé€‰æ‹©å™¨æ—¶ï¼Œé€‰æ‹©å™¨å¯¹é€šé“çš„ç›‘å¬äº‹ä»¶ï¼Œéœ€è¦é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° ops æŒ‡å®šã€‚ç›‘å¬çš„äº‹ä»¶ç±»å‹ç”¨SelectionKeyçš„å››ä¸ªå¸¸é‡è¡¨ç¤ºï¼š

* è¯» : SelectionKey.OP_READ ï¼ˆ1ï¼‰
* å†™ : SelectionKey.OP_WRITE ï¼ˆ4ï¼‰
* è¿æ¥ : SelectionKey.OP_CONNECT ï¼ˆ8ï¼‰
* æ¥æ”¶ : SelectionKey.OP_ACCEPT ï¼ˆ16ï¼‰
* è‹¥æ³¨å†Œæ—¶ä¸æ­¢ç›‘å¬ä¸€ä¸ªäº‹ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨â€œä½æˆ–â€æ“ä½œç¬¦è¿æ¥ï¼š
  `int interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE `



**Selector API**ï¼š

| æ–¹æ³•                                             | è¯´æ˜                                      |
| ------------------------------------------------ | ----------------------------------------- |
| public static Selector open()                    | æ‰“å¼€é€‰æ‹©å™¨                                |
| public abstract void close()                     | å…³é—­æ­¤é€‰æ‹©å™¨                              |
| public abstract int select()                     | é€‰æ‹©ä¸€ç»„å…¶ç›¸åº”é€šé“å‡†å¤‡å¥½è¿›è¡ŒI / Oæ“ä½œçš„é”® |
| public abstract Set<SelectionKey> selectedKeys() | è¿”å›æ­¤é€‰æ‹©å™¨çš„é€‰æ‹©é”®é›†                    |

**SelectionKey API**:

| æ–¹æ³•                                        | è¯´æ˜                                               |
| ------------------------------------------- | -------------------------------------------------- |
| public abstract void cancel()               | å–æ¶ˆè¯¥é”®çš„é€šé“ä¸å…¶é€‰æ‹©å™¨çš„æ³¨å†Œ                     |
| public abstract SelectableChannel channel() | è¿”å›åˆ›å»ºæ­¤é”®çš„é€šé“ï¼Œè¯¥æ–¹æ³•åœ¨å–æ¶ˆé”®ä¹‹åä»å°†è¿”å›é€šé“ |
| public final boolean isAcceptable()         | æ£€æµ‹æ­¤å¯†é’¥çš„é€šé“æ˜¯å¦å·²å‡†å¤‡å¥½æ¥å—æ–°çš„å¥—æ¥å­—è¿æ¥     |
| public final boolean isConnectable()        | æ£€æµ‹æ­¤å¯†é’¥çš„é€šé“æ˜¯å¦å·²å®Œæˆæˆ–æœªå®Œæˆå…¶å¥—æ¥å­—è¿æ¥æ“ä½œ |
| public final boolean isReadable()           | æ£€æµ‹æ­¤å¯†é’¥çš„é¢‘é“æ˜¯å¦å¯ä»¥é˜…è¯»                       |
| public final boolean isWritable()           | æ£€æµ‹æ­¤å¯†é’¥çš„é€šé“æ˜¯å¦å‡†å¤‡å¥½è¿›è¡Œå†™å…¥                 |



åŸºæœ¬æ­¥éª¤ï¼š

```java
//1.è·å–é€šé“
ServerSocketChannel ssChannel = ServerSocketChannel.open();
//2.åˆ‡æ¢éé˜»å¡æ¨¡å¼
ssChannel.configureBlocking(false);
//3.ç»‘å®šè¿æ¥
ssChannel.bin(new InetSocketAddress(9999));
//4.è·å–é€‰æ‹©å™¨
Selector selector = Selector.open();
//5.å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š,å¹¶ä¸”æŒ‡å®šâ€œç›‘å¬æ¥æ”¶äº‹ä»¶â€
ssChannel.register(selector, SelectionKey.OP_ACCEPT);
```



***



#### NIOå®ç°

##### å®ç°æµç¨‹

* **SelectableChannel_API**

  | æ–¹æ³•                                                         | è¯´æ˜                     |
  | ------------------------------------------------------------ | ------------------------ |
  | public final SelectableChannel configureBlocking(boolean block) | è®¾ç½®æ­¤é€šé“çš„é˜»å¡æ¨¡å¼     |
  | public final SelectionKey register(Selector sel, int ops)    | å‘ç»™å®šçš„é€‰æ‹©å™¨æ³¨å†Œæ­¤é€šé“ |

* **SocketChannel_API**ï¼š

  | æ–¹æ³•                                                        | è¯´æ˜                           |
  | :---------------------------------------------------------- | ------------------------------ |
  | public static SocketChannel open()                          | æ‰“å¼€å¥—æ¥å­—é€šé“                 |
  | public static SocketChannel open(SocketAddress remote)      | æ‰“å¼€å¥—æ¥å­—é€šé“å¹¶è¿æ¥åˆ°è¿œç¨‹åœ°å€ |
  | public abstract boolean connect(SocketAddress remote)       | è¿æ¥æ­¤é€šé“çš„åˆ°è¿œç¨‹åœ°å€         |
  | public abstract SocketChannel bind(SocketAddress local)     | å°†é€šé“çš„å¥—æ¥å­—ç»‘å®šåˆ°æœ¬åœ°åœ°å€   |
  | public abstract SocketAddress getLocalAddress()             | è¿”å›å¥—æ¥å­—ç»‘å®šçš„æœ¬åœ°å¥—æ¥å­—åœ°å€ |
  | public abstract SocketAddress getRemoteAddress()            | è¿”å›å¥—æ¥å­—è¿æ¥çš„è¿œç¨‹å¥—æ¥å­—åœ°å€ |
  | abstract SelectableChannel configureBlocking(boolean block) | è°ƒæ•´æ­¤é€šé“çš„é˜»å¡æ¨¡å¼           |

* **ServerSocketChannel_API**ï¼š

  | æ–¹æ³•                                                       | è¯´æ˜                                                         |
  | ---------------------------------------------------------- | ------------------------------------------------------------ |
  | public static ServerSocketChannel open()                   | æ‰“å¼€æœåŠ¡å™¨å¥—æ¥å­—é€šé“                                         |
  | public final ServerSocketChannel bind(SocketAddress local) | å°†é€šé“çš„å¥—æ¥å­—ç»‘å®šåˆ°æœ¬åœ°åœ°å€ï¼Œå¹¶é…ç½®å¥—æ¥å­—ä»¥ç›‘å¬è¿æ¥         |
  | public abstract SocketChannel accept()                     | æ¥å—ä¸æ­¤é€šé“å¥—æ¥å­—çš„è¿æ¥ï¼Œé€šè¿‡æ­¤æ–¹æ³•è¿”å›çš„å¥—æ¥å­—é€šé“å°†å¤„äºé˜»å¡æ¨¡å¼ |



æœåŠ¡ç«¯ 

1. è·å–é€šé“ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šé€šè¿‡**`ServerSocketChannel.accept`**å¾—åˆ° SocketChannel 

2. åˆ‡æ¢éé˜»å¡æ¨¡å¼

3. ç»‘å®šè¿æ¥

4. è·å–é€‰æ‹©å™¨

5. å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š, å¹¶ä¸”æŒ‡å®šâ€œç›‘å¬æ¥æ”¶äº‹ä»¶â€

6. è½®è¯¢å¼çš„è·å–é€‰æ‹©å™¨ä¸Šå·²ç»â€œå‡†å¤‡å°±ç»ªâ€çš„äº‹ä»¶

   

å®¢æˆ·ç«¯

1. è·å–é€šé“: `SocketChannel sc = SocketChannel.open(new InetSocketAddress("127.0.0.1", 9999));`
2. åˆ‡æ¢éé˜»å¡æ¨¡å¼
3. åˆ†é…æŒ‡å®šå¤§å°çš„ç¼“å†²åŒº: `ByteBuffer buffer = ByteBuffer.allocate(1024);`
4. å‘é€æ•°æ®ç»™æœåŠ¡ç«¯



##### ä»£ç å®ç°

37è¡Œä»£ç ï¼Œå¦‚æœåˆ¤æ–­æ¡ä»¶æ”¹ä¸º !=-1ï¼Œéœ€è¦å®¢æˆ·ç«¯shutdownä¸€ä¸‹

```java
public class Server {
    public static void main(String[] args){
        // 1ã€è·å–é€šé“
        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();
        // 2ã€åˆ‡æ¢ä¸ºéé˜»å¡æ¨¡å¼
        serverSocketChannel.configureBlocking(false);
        // 3ã€ç»‘å®šè¿æ¥çš„ç«¯å£
        serverSocketChannel.bind(new InetSocketAddress(9999));
        // 4ã€è·å–é€‰æ‹©å™¨Selector
        Selector selector = Selector.open();
        // 5ã€å°†é€šé“éƒ½æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šå»ï¼Œå¹¶ä¸”å¼€å§‹æŒ‡å®šç›‘å¬æ¥æ”¶äº‹ä»¶
        serverSocketChannel. register(selector, SelectionKey.OP_ACCEPT);
		// 6ã€ä½¿ç”¨Selectoré€‰æ‹©å™¨è½®è¯¢å·²ç»å°±ç»ªå¥½çš„äº‹ä»¶
        while (selector.select() > 0) {
            System.out.println("----å¼€å§‹æ–°ä¸€è½®çš„æ—¶é—´å¤„ç†----");
            // 7ã€è·å–é€‰æ‹©å™¨ä¸­çš„æ‰€æœ‰æ³¨å†Œçš„é€šé“ä¸­å·²ç»å°±ç»ªå¥½çš„äº‹ä»¶
            Set<SelectionKey> selectionKeys = selector.selectedKeys();
            Iterator<SelectionKey> it = selectionKeys.iterator();
            // 8ã€å¼€å§‹éå†è¿™äº›å‡†å¤‡å¥½çš„äº‹ä»¶
            while (it.hasNext()) {
                SelectionKey key = it.next();// æå–å½“å‰è¿™ä¸ªäº‹ä»¶
                // 9ã€åˆ¤æ–­è¿™ä¸ªäº‹ä»¶å…·ä½“æ˜¯ä»€ä¹ˆ
                if (key.isAcceptable()) {
                    // 10ã€ç›´æ¥è·å–å½“å‰æ¥å…¥çš„å®¢æˆ·ç«¯é€šé“
                    SocketChannel socketChannel = serverSocketChannel.accept();
                    // 11 ã€åˆ‡æ¢æˆéé˜»å¡æ¨¡å¼
                    socketChannel.configureBlocking(false);
                    // 12ã€å°†æœ¬å®¢æˆ·ç«¯é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨
                    socketChannel.register(selector, SelectionKey.OP_READ);
                } else if (key.isReadable()) {
                    // 13ã€è·å–å½“å‰é€‰æ‹©å™¨ä¸Šçš„è¯»å°±ç»ªäº‹ä»¶
                    SelectableChannel channel = key.channel();
                    SocketChannel socketChannel = (SocketChannel) channel;
                    // 14ã€è¯»å–æ•°æ®
                    ByteBuffer buffer = ByteBuffer.allocate(1024);
                    int len;
                    while ((len = socketChannel.read(buffer)) > 0) {
                        System.out.println(len);
                        buffer.flip();
                        System.out.println(socketChannel.getRemoteAddress() + ":" + new String(buffer.array(), 0, len));
                        buffer.clear();// æ¸…é™¤ä¹‹å‰çš„æ•°æ®
                    }
                }
                it.remove();
            }
        }
    }
}
```

```java
public class Client {
    public static void main(String[] args) throws Exception {
        // 1ã€è·å–é€šé“
        SocketChannel socketChannel = SocketChannel.open(new 			
                                            InetSocketAddress("127.0.0.1", 9999));
        // 2ã€åˆ‡æ¢æˆéé˜»å¡æ¨¡å¼
        socketChannel.configureBlocking(false);
        // 3ã€åˆ†é…æŒ‡å®šç¼“å†²åŒºå¤§å°
        ByteBuffer buffer = ByteBuffer.allocate(1024);
        // 4ã€å‘é€æ•°æ®ç»™æœåŠ¡ç«¯
        Scanner sc = new Scanner(System.in);
        while (true){
            System.out.print("è¯·è¯´ï¼š");
            String msg = sc.nextLine();
            buffer.put(("æ³¢å¦ï¼š"+msg).getBytes());
            buffer.flip();
            socketChannel.write(buffer);
            buffer.clear();
        }
    }
}
```



***



#### NIOç¾¤èŠ

éœ€æ±‚ï¼šè¿›ä¸€æ­¥ç†è§£ NIOéé˜»å¡ç½‘ç»œç¼–ç¨‹æœºåˆ¶ï¼Œå®ç°å¤šäººç¾¤èŠ

* ç¼–å†™ä¸€ä¸ª NIO ç¾¤èŠç³»ç»Ÿï¼Œå®ç°å®¢æˆ·ç«¯ä¸å®¢æˆ·ç«¯çš„é€šä¿¡éœ€æ±‚ï¼ˆéé˜»å¡ï¼‰
* æœåŠ¡å™¨ç«¯ï¼šå¯ä»¥ç›‘æµ‹ç”¨æˆ·ä¸Šçº¿ï¼Œç¦»çº¿ï¼Œå¹¶å®ç°æ¶ˆæ¯è½¬å‘åŠŸèƒ½
* å®¢æˆ·ç«¯ï¼šé€šè¿‡channelå¯ä»¥æ— é˜»å¡å‘é€æ¶ˆæ¯ç»™å…¶å®ƒæ‰€æœ‰å®¢æˆ·ç«¯ç”¨æˆ·ï¼ŒåŒæ—¶å¯ä»¥æ¥å—å…¶å®ƒå®¢æˆ·ç«¯ç”¨æˆ·é€šè¿‡æœåŠ¡ç«¯è½¬å‘æ¥çš„æ¶ˆæ¯

```java
public class ChatServer {
    //å®šä¹‰å±æ€§
    private Selector selector;
    private ServerSocketChannel listenChannel;
    private static final int PORT = 6667;
    //æ„é€ å™¨
    //åˆå§‹åŒ–å·¥ä½œ
    public ChatServer() {
        try {
            //å¾—åˆ°é€‰æ‹©å™¨
            selector = Selector.open();
            //ServerSocketChannel
            listenChannel =  ServerSocketChannel.open();
            //ç»‘å®šç«¯å£
            listenChannel.socket().bind(new InetSocketAddress(PORT));
            //è®¾ç½®éé˜»å¡æ¨¡å¼
            listenChannel.configureBlocking(false);
            //å°†è¯¥listenChannel æ³¨å†Œåˆ°selector
            listenChannel.register(selector, SelectionKey.OP_ACCEPT);
        }catch (IOException e) {
            e.printStackTrace();
        }

    }

    //ç›‘å¬
    public void listen() {
        System.out.println("Listening thread:" + Thread.currentThread().getName());
        try {
            //å¾ªç¯å¤„ç†
            while (true) {
                int count = selector.select();
                if(count > 0) {//æœ‰äº‹ä»¶å¤„ç†
                    //éå†å¾—åˆ°selectionKey é›†åˆ
                    Iterator<SelectionKey> keyIterator = selector.selectedKeys().iterator();
                    while (keyIterator.hasNext()) {
                        //å–å‡ºselectionKey
                        SelectionKey selectionKey = keyIterator.next();

                        //ç›‘å¬åˆ°accept
                        if(selectionKey.isAcceptable()) {
                            SocketChannel socketChannel = listenChannel.accept();
                            socketChannel.configureBlocking(false);
                            //å°†è¯¥ sc æ³¨å†Œåˆ°selector
                            socketChannel.register(selector, SelectionKey.OP_READ);
                            //æç¤º
                            System.out.println(socketChannel.getRemoteAddress() + "is online...");
                        }
                        //é€šé“å‘é€readäº‹ä»¶ï¼Œå³é€šé“æ˜¯å¯è¯»çš„çŠ¶æ€
                        if(selectionKey.isReadable()) { 
                            //å¤„ç†è¯» (ä¸“é—¨å†™æ–¹æ³•..)
                            readData(selectionKey);
                        }
                        //å½“å‰çš„key åˆ é™¤ï¼Œé˜²æ­¢é‡å¤å¤„ç†
                        keyIterator.remove();
                    }
                } else {
                    System.out.println("waiting....");
                }
            }

        }catch (Exception e) {
            e.printStackTrace();

        }finally {
            //å‘ç”Ÿå¼‚å¸¸å¤„ç†....
        }
    }

    //è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯
    private void readData(SelectionKey selectionKey) {
        //å–åˆ°å…³è”çš„channel
        SocketChannel channel = null;
        try {
           //å¾—åˆ°channel
            channel = (SocketChannel) selectionKey.channel();
            //åˆ›å»ºbuffer
            ByteBuffer buffer = ByteBuffer.allocate(1024);

            int len = channel.read(buffer);
            //æ ¹æ®countçš„å€¼åšå¤„ç†
            if(len > 0) {
                //æŠŠç¼“å­˜åŒºçš„æ•°æ®è½¬æˆå­—ç¬¦ä¸²
                String msg = new String(buffer.array(), 0, len);
                //è¾“å‡ºè¯¥æ¶ˆæ¯
                System.out.println("form Client:" + msg);
                //å‘å…¶å®ƒçš„å®¢æˆ·ç«¯è½¬å‘æ¶ˆæ¯(å»æ‰è‡ªå·±), ä¸“é—¨å†™ä¸€ä¸ªæ–¹æ³•æ¥å¤„ç†
                sendInfoToOtherClients(msg, channel);
            }

        }catch (IOException e) {
            try {
                System.out.println(channel.getRemoteAddress() + "is offline...");
                //å–æ¶ˆæ³¨å†Œ
                selectionKey.cancel();
                //å…³é—­é€šé“
                channel.close();
            }catch (IOException e2) {
                e2.printStackTrace();;
            }
        }
    }

    //è½¬å‘æ¶ˆæ¯ç»™å…¶å®ƒå®¢æˆ·(é€šé“)
    private void sendInfoToOtherClients(String msg, SocketChannel selfChannel ) throws  IOException{

        System.out.println("Server forwarding message...");
        System.out.println("Server forwarding data thread:" + Thread.currentThread().getName());
        //éå† æ‰€æœ‰æ³¨å†Œåˆ°selector ä¸Šçš„ SocketChannel,å¹¶æ’é™¤ self
        for(SelectionKey selectionKey: selector.keys()) {

            //é€šè¿‡ key  å–å‡ºå¯¹åº”çš„ SocketChannel
            Channel targetChannel = selectionKey.channel();

            //æ’é™¤è‡ªå·±
            if(targetChannel instanceof  SocketChannel && targetChannel != selfChannel) {

                //è½¬å‹
                SocketChannel socketChannel = (SocketChannel)targetChannel;
                //å°†msg å­˜å‚¨åˆ°buffer
                //ByteBuffer buffer = ByteBuffer.wrap(msg.getBytes());
                ByteBuffer buffer = ByteBuffer.allocate(1024);
                buffer.put(msg.getBytes());
                buffer.flip();
                //å°†buffer çš„æ•°æ®å†™å…¥ é€šé“
                socketChannel.write(buffer);
            }
        }

    }

    public static void main(String[] args) {
        //åˆ›å»ºæœåŠ¡å™¨å¯¹è±¡
        ChatServer groupChatServer = new ChatServer();
        groupChatServer.listen();
    }
}
```



```java
public class ChatClient {

    //å®šä¹‰ç›¸å…³çš„å±æ€§
    private final String HOST = "127.0.0.1"; // æœåŠ¡å™¨çš„ip
    private final int PORT = 6667; //æœåŠ¡å™¨ç«¯å£
    private Selector selector;
    private SocketChannel socketChannel;
    private String username;

    //æ„é€ å™¨, å®Œæˆåˆå§‹åŒ–å·¥ä½œ
    public ChatClient() throws IOException {

        selector = Selector.open();
        //è¿æ¥æœåŠ¡å™¨
        socketChannel = socketChannel.open(new InetSocketAddress("127.0.0.1", PORT));
        //è®¾ç½®éé˜»å¡
        socketChannel.configureBlocking(false);
        //å°†channel æ³¨å†Œåˆ°selector
        socketChannel.register(selector, SelectionKey.OP_READ);
        //å¾—åˆ°username
        //socketChannel.getLocalAddress().toString();   /127.0.0.1:8182
        username = socketChannel.getLocalAddress().toString().substring(1);
        System.out.println(username + " is ok...");

    }

    //å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯
    public void sendInfo(String info) {
        info = username + ":" + info;
        try {
            socketChannel.write(ByteBuffer.wrap(info.getBytes()));
        }catch (IOException e) {
            e.printStackTrace();
        }
    }

    //è¯»å–ä»æœåŠ¡å™¨ç«¯å›å¤çš„æ¶ˆæ¯
    public void readInfo() {
        try {
            int readChannels = selector.select();
            if(readChannels > 0) {//æœ‰å¯ä»¥ç”¨çš„é€šé“

                Iterator<SelectionKey> iterator = selector.selectedKeys().iterator();
                while (iterator.hasNext()) {

                    SelectionKey key = iterator.next();
                    if(key.isReadable()) {
                        //å¾—åˆ°ç›¸å…³çš„é€šé“
                       SocketChannel sc = (SocketChannel) key.channel();
                       //å¾—åˆ°ä¸€ä¸ªBuffer
                        ByteBuffer buffer = ByteBuffer.allocate(1024);
                        //è¯»å–
                        sc.read(buffer);
                        buffer.flip();
                        //æŠŠè¯»åˆ°çš„ç¼“å†²åŒºçš„æ•°æ®è½¬æˆå­—ç¬¦ä¸²
                        String msg = new String(buffer.array(),0,buffer.remaining());
                        System.out.println(msg.trim());
                    }
                    iterator.remove(); //åˆ é™¤å½“å‰çš„selectionKey, é˜²æ­¢é‡å¤æ“ä½œ
                }
            } else {
                //System.out.println("æ²¡æœ‰å¯ä»¥ç”¨çš„é€šé“...");
            }
        }catch (Exception e) {
            e.printStackTrace();
        }
    }

    public static void main(String[] args) throws Exception {
        //å¯åŠ¨æˆ‘ä»¬å®¢æˆ·ç«¯
        ChatClient chatClient = new ChatClient();
        //å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹, æ¯2ç§’ï¼Œè¯»å–ä»æœåŠ¡å™¨å‘é€æ•°æ®
        new Thread() {
            @Override
            public void run() {
                while (true) {
                    chatClient.readInfo();
                    try {
                        Thread.currentThread().sleep(2000);
                    }catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
            }
        }.start();

        //å‘é€æ•°æ®ç»™æœåŠ¡å™¨ç«¯
        Scanner scanner = new Scanner(System.in);
        while (scanner.hasNextLine()) {
            String s = scanner.nextLine();
            chatClient.sendInfo(s);
        }
    }
}

```



***



### AIO

Java AIO(NIO.2) ï¼š å¼‚æ­¥éé˜»å¡ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªæœ‰æ•ˆè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹ï¼Œå®¢æˆ·ç«¯çš„I/Oè¯·æ±‚éƒ½æ˜¯ç”±OSå…ˆå®Œæˆäº†å†é€šçŸ¥æœåŠ¡å™¨åº”ç”¨å»å¯åŠ¨çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚

```java
AIOå¼‚æ­¥éé˜»å¡ï¼ŒåŸºäºNIOçš„ï¼Œå¯ä»¥ç§°ä¹‹ä¸ºNIO2.0
  BIO                     NIO                                AIO        
Socket                SocketChannel                    AsynchronousSocketChannel
ServerSocket          ServerSocketChannel	       AsynchronousServerSocketChannel
```

ä¸NIOä¸åŒï¼Œå½“è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œåªé¡»ç›´æ¥è°ƒç”¨APIçš„readæˆ–writeæ–¹æ³•å³å¯, è¿™ä¸¤ç§æ–¹æ³•å‡ä¸ºå¼‚æ­¥çš„ã€‚å¯¹äºè¯»æ“ä½œï¼Œå½“æœ‰æµå¯è¯»å–æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å¯è¯»çš„æµä¼ å…¥readæ–¹æ³•çš„ç¼“å†²åŒºï¼›å¯¹äºå†™æ“ä½œï¼Œå½“æ“ä½œç³»ç»Ÿå°†writeæ–¹æ³•ä¼ é€’çš„æµå†™å…¥å®Œæ¯•æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸»åŠ¨é€šçŸ¥åº”ç”¨ç¨‹åºã€‚å¯ä»¥ç†è§£ä¸ºï¼Œread/writeæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå®Œæˆåä¼šä¸»åŠ¨è°ƒç”¨å›è°ƒå‡½æ•°ã€‚

åœ¨JDK1.7ä¸­ï¼Œè¿™éƒ¨åˆ†å†…å®¹è¢«ç§°ä½œNIO.2ï¼Œä¸»è¦åœ¨Java.nio.channelsåŒ…ä¸‹å¢åŠ äº†ä¸‹é¢å››ä¸ªå¼‚æ­¥é€šé“ï¼š
AsynchronousSocketChannel, AsynchronousServerSocketChannel, AsynchronousFileChannel, AsynchronousDatagramChannel





***



## åå°„

### ç±»åŠ è½½å™¨

* ä½œç”¨ï¼šè´Ÿè´£å°†.classæ–‡ä»¶ï¼ˆå­˜å‚¨çš„ç‰©ç†æ–‡ä»¶ï¼‰åŠ è½½åœ¨åˆ°å†…å­˜ä¸­
* åŠ è½½è¿‡ç¨‹
  å½“ä¸€ä¸ªç±»è¢«ä½¿ç”¨æ—¶æ‰ä¼šä»ç¡¬ç›˜åŠ è½½åˆ°å†…å­˜ã€‚
  * åŠ è½½ ï¼šé€šè¿‡åŒ…å + ç±»åï¼Œè·å–è¿™ä¸ªç±»ï¼Œå‡†å¤‡ç”¨æµè¿›è¡Œä¼ è¾“ã€‚æŠŠè¿™ä¸ªç±»åŠ è½½åˆ°å†…å­˜ä¸­ï¼ŒåŠ è½½å®Œæ¯•åˆ›å»ºä¸€ä¸ªclasså¯¹è±¡
  * é“¾æ¥(éªŒè¯)ï¼šç¡®ä¿Classæ–‡ä»¶å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«å®‰å…¨
                          (æ–‡ä»¶ä¸­çš„ä¿¡æ¯æ˜¯å¦ç¬¦åˆè™šæ‹Ÿæœºè§„èŒƒæœ‰æ²¡æœ‰å®‰å…¨éšæ‚£)
  * é“¾æ¥(å‡†å¤‡)ï¼šè´Ÿè´£ä¸ºç±»çš„ç±»å˜é‡ï¼ˆè¢«staticä¿®é¥°çš„å˜é‡ï¼‰åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹åŒ–å€¼(åˆå§‹åŒ–é™æ€å˜é‡)
  * é“¾æ¥(è§£æ)ï¼šå°†ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨
                         (æœ¬ç±»ä¸­å¦‚æœç”¨åˆ°äº†å…¶ä»–ç±»ï¼Œæ­¤æ—¶å°±éœ€è¦æ‰¾åˆ°å¯¹åº”çš„ç±»)
  * åˆå§‹åŒ–ï¼šæ ¹æ®ç¨‹åºå‘˜é€šè¿‡ç¨‹åºåˆ¶å®šçš„ä¸»è§‚è®¡åˆ’å»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶ä»–èµ„æº
                   (é™æ€å˜é‡èµ‹å€¼ä»¥åŠåˆå§‹åŒ–å…¶ä»–èµ„æº)

+ åˆ†ç±»

  + Bootstrap class loaderï¼šè™šæ‹Ÿæœºçš„å†…ç½®ç±»åŠ è½½å™¨ï¼Œé€šå¸¸è¡¨ç¤ºä¸ºnull ï¼Œå¹¶ä¸”æ²¡æœ‰çˆ¶null
  + Platform class loaderï¼šå¹³å°ç±»åŠ è½½å™¨,è´Ÿè´£åŠ è½½JDKä¸­ä¸€äº›ç‰¹æ®Šçš„æ¨¡å—
  + System class loaderï¼šç³»ç»Ÿç±»åŠ è½½å™¨,è´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“

+ ç±»åŠ è½½å™¨çš„ç»§æ‰¿å…³ç³»

  + Systemçš„çˆ¶åŠ è½½å™¨ä¸ºPlatform
  + Platformçš„çˆ¶åŠ è½½å™¨ä¸ºBootstrap

+ åŒäº²å§”æ´¾æ¨¡å‹
  å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼

+ ClassLoader 
  public static ClassLoader getSystemClassLoader() : è·å–ç³»ç»Ÿç±»åŠ è½½å™¨
  public InputStream getResourceAsStream(String name) : åŠ è½½æŸä¸€ä¸ªèµ„æºæ–‡ä»¶

  ```java
  public class ClassLoaderDemo2 {
      public static void main(String[] args) throws IOException {
          //è·å–ç³»ç»Ÿç±»åŠ è½½å™¨
          ClassLoader systemClassLoader = ClassLoader.getSystemClassLoader();
  
          //åˆ©ç”¨åŠ è½½å™¨å»åŠ è½½ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶
          //å‚æ•°ï¼šæ–‡ä»¶çš„è·¯å¾„ï¼ˆæ”¾åœ¨srcçš„æ ¹ç›®å½•ä¸‹ï¼Œé»˜è®¤å»é‚£é‡ŒåŠ è½½ï¼‰
          //è¿”å›å€¼ï¼šå­—èŠ‚æµã€‚
          InputStream is = systemClassLoader.getResourceAsStream("prop.properties");
          Properties prop = new Properties();
          prop.load(is);
  
          System.out.println(prop);
          is.close();
      }
  }
  ```

  



***



### Junit

> å•å…ƒæµ‹è¯•æ˜¯æŒ‡ç¨‹åºå‘˜å†™çš„æµ‹è¯•ä»£ç ç»™è‡ªå·±çš„ç±»ä¸­çš„æ–¹æ³•è¿›è¡Œé¢„æœŸæ­£ç¡®æ€§çš„éªŒè¯ã€‚
> å•å…ƒæµ‹è¯•ä¸€æ—¦å†™å¥½äº†è¿™äº›æµ‹è¯•ä»£ç ï¼Œå°±å¯ä»¥ä¸€ç›´ä½¿ç”¨ï¼Œå¯ä»¥å®ç°ä¸€å®šç¨‹åº¦ä¸Šçš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚

å•å…ƒæµ‹è¯•çš„ç»å…¸æ¡†æ¶ï¼šJunit

* Junit : æ˜¯Javaè¯­è¨€ç¼–å†™çš„ç¬¬ä¸‰æ–¹å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ–¹ä¾¿å¿«é€Ÿçš„æµ‹è¯•æˆ‘ä»¬ä»£ç çš„æ­£ç¡®æ€§ã€‚
* å•å…ƒæµ‹è¯•ï¼š
  * å•å…ƒï¼šåœ¨Javaä¸­ï¼Œä¸€ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå•å…ƒ
  *  å•å…ƒæµ‹è¯•ï¼šJunitç¼–å†™çš„ä¸€å°æ®µä»£ç ï¼Œç”¨æ¥å¯¹æŸä¸ªç±»ä¸­çš„æŸä¸ªæ–¹æ³•è¿›è¡ŒåŠŸèƒ½æµ‹è¯•æˆ–ä¸šåŠ¡é€»è¾‘æµ‹è¯•	

Junitå•å…ƒæµ‹è¯•æ¡†æ¶çš„ä½œç”¨ï¼š
    ç”¨æ¥å¯¹ç±»ä¸­çš„æ–¹æ³•åŠŸèƒ½è¿›è¡Œæœ‰ç›®çš„çš„æµ‹è¯•ï¼Œä»¥ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚
    èƒ½å¤Ÿ**ç‹¬ç«‹çš„**æµ‹è¯•æŸä¸ªæ–¹æ³•æˆ–è€…æ‰€æœ‰æ–¹æ³•çš„é¢„æœŸæ­£ç¡®æ€§ã€‚

Junitæ¡†æ¶çš„ä½¿ç”¨æ­¥éª¤ï¼š

```java
ï¼ˆ1ï¼‰ä¸‹è½½è¿™ä¸ªæ¡†æ¶ã€‚
	æ¡†æ¶ä¸€èˆ¬æ˜¯jaråŒ…çš„å½¢å¼ï¼ŒjaråŒ…é‡Œé¢éƒ½æ˜¯classæ–‡ä»¶ã€‚ï¼ˆJavaå·¥ç¨‹çš„æœ€ç»ˆå½¢å¼ï¼‰
	classæ–‡ä»¶å°±æ˜¯æˆ‘ä»¬è°ƒç”¨çš„æ ¸å¿ƒä»£ç ã€‚Junitå·²ç»è¢«IDEAä¸‹è½½å¥½äº†ï¼Œå¯ä»¥ç›´æ¥å¯¼å…¥åˆ°é¡¹ç›®ä½¿ç”¨çš„ã€‚

ï¼ˆ2ï¼‰ç›´æ¥ç”¨Junitæµ‹è¯•ä»£ç å³å¯
	a.å…ˆæ¨¡æ‹Ÿä¸šåŠ¡ä»£ç 
	b.å†™æµ‹è¯•ç±»
		æµ‹è¯•ç±»çš„å‘½åè§„èŒƒï¼šä»¥Testå¼€å¤´ï¼Œä»¥ä¸šåŠ¡ç±»ç±»åç»“å°¾ï¼Œä½¿ç”¨é©¼å³°å‘½åæ³•
		ä¸šåŠ¡åç§°æ˜¯ï¼šUserService
		æµ‹è¯•è¿™ä¸ªä¸šåŠ¡ç±»çš„æµ‹è¯•ç±»ï¼šTestUserService/UserServiceTest
	c.åœ¨æµ‹è¯•ç±»ä¸­å†™æµ‹è¯•æ–¹æ³•
		æµ‹è¯•æ–¹æ³•çš„å‘½åè§„åˆ™ï¼šä»¥testå¼€å¤´ï¼Œä»¥ä¸šåŠ¡æ–¹æ³•åç»“å°¾
		æ¯”å¦‚è¢«æµ‹è¯•ä¸šåŠ¡æ–¹æ³•åä¸ºï¼šloginï¼Œé‚£ä¹ˆæµ‹è¯•æ–¹æ³•åå°±åº”è¯¥å«ï¼štestLogin

ï¼ˆ3ï¼‰å¦‚ä½•è¿è¡Œæµ‹è¯•æ–¹æ³•
	é€‰ä¸­æ–¹æ³•å --> å³é”® --> Run 'æµ‹è¯•æ–¹æ³•å'  è¿è¡Œé€‰ä¸­çš„æµ‹è¯•æ–¹æ³•
	é€‰ä¸­æµ‹è¯•ç±»ç±»å --> å³é”® --> Run 'æµ‹è¯•ç±»ç±»å'  è¿è¡Œæµ‹è¯•ç±»ä¸­æ‰€æœ‰æµ‹è¯•æ–¹æ³•
	é€‰ä¸­æ¨¡å—å --> å³é”® --> Run 'All Tests'  è¿è¡Œæ¨¡å—ä¸­çš„æ‰€æœ‰æµ‹è¯•ç±»çš„æ‰€æœ‰æµ‹è¯•æ–¹æ³•
```

æµ‹è¯•æ–¹æ³•æ³¨æ„äº‹é¡¹ï¼š**å¿…é¡»æ˜¯publicä¿®é¥°çš„ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œæ²¡æœ‰å‚æ•°ï¼Œä½¿ç”¨æ³¨è§£@Testä¿®é¥°**

Junitå¸¸ç”¨æ³¨è§£(Junit 4.xxxxç‰ˆæœ¬)
    @Test æµ‹è¯•æ–¹æ³•ï¼
    	@Beforeï¼šç”¨æ¥ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚
    	@Afterï¼šç”¨æ¥ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚
    	@BeforeClassï¼šç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹å‰**åª**æ‰§è¡Œä¸€æ¬¡ã€‚
   	 @AfterClassï¼šç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹å**åª**æ‰§è¡Œä¸€æ¬¡ã€‚

Junitå¸¸ç”¨æ³¨è§£(Junit5.xxxxç‰ˆæœ¬)
    @Test æµ‹è¯•æ–¹æ³•ï¼
   	 @BeforeEachï¼šç”¨æ¥ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚
    	@AfterEachï¼šç”¨æ¥ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚
    	@BeforeAllï¼šç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹å‰åªæ‰§è¡Œä¸€æ¬¡ã€‚
    	@AfterAllï¼šç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹ååªæ‰§è¡Œä¸€æ¬¡ã€‚

ä½œç”¨ï¼š
	å¼€å§‹æ‰§è¡Œçš„æ–¹æ³•ï¼šåˆå§‹åŒ–èµ„æºã€‚
	æ‰§è¡Œå®Œä¹‹åçš„æ–¹æ³•ï¼šé‡Šæ”¾èµ„æºã€‚

```java
public class UserService {
    public String login(String loginName , String passWord){
        if("admin".equals(loginName)&&"123456".equals(passWord)){
            return "success";
        }
        return "ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ï¼";
    }
    public void chu(int a , int b){
        System.out.println(a / b);
    }
}
```

```java
//æµ‹è¯•æ–¹æ³•çš„è¦æ±‚ï¼š1.å¿…é¡»publicä¿®é¥° 2.æ²¡æœ‰è¿”å›å€¼æ²¡æœ‰å‚æ•° 3. å¿…é¡»ä½¿æ³¨è§£@Testä¿®é¥°
public class UserServiceTest {
     // @Beforeï¼šç”¨æ¥ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚
    @Before
    public void before(){
        System.out.println("===before===");
    }
    // @Afterï¼šç”¨æ¥ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚
    @After
    public void after(){
        System.out.println("===after===");
    }
    // @BeforeClassï¼šç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹å‰åªæ‰§è¡Œä¸€æ¬¡ã€‚
    @BeforeClass
    public static void beforeClass(){
        System.out.println("===beforeClass===");
    }
    // @AfterClassï¼šç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹ååªæ‰§è¡Œä¸€æ¬¡ã€‚
    @AfterClass
    public static void afterClass(){
        System.out.println("===afterClass===");
    }
    @Test
    public void testLogin(){
        UserService userService = new UserService();
        String rs = userService.login("admin","123456");
        /**æ–­è¨€é¢„æœŸç»“æœçš„æ­£ç¡®æ€§ã€‚
         * å‚æ•°ä¸€ï¼šæµ‹è¯•å¤±è´¥çš„æç¤ºä¿¡æ¯ã€‚
         * å‚æ•°äºŒï¼šæœŸæœ›å€¼ã€‚
         * å‚æ•°ä¸‰ï¼šå®é™…å€¼
         */
        Assert.assertEquals("ç™»å½•ä¸šåŠ¡åŠŸèƒ½æ–¹æ³•æœ‰é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼","success",rs);
    }
    @Test
    public void testChu(){
        UserService userService = new UserService();
        userService.chu(10 , 0);
    }
}
```





****



### åå°„

åå°„æ˜¯æŒ‡å¯¹äºä»»ä½•ä¸€ä¸ªç±»ï¼Œåœ¨"è¿è¡Œçš„æ—¶å€™"éƒ½å¯ä»¥ç›´æ¥å¾—åˆ°è¿™ä¸ªç±»å…¨éƒ¨æˆåˆ†ã€‚
    åœ¨è¿è¡Œæ—¶,å¯ä»¥ç›´æ¥å¾—åˆ°è¿™ä¸ªç±»çš„æ„é€ å™¨å¯¹è±¡ã€‚ï¼ˆConstructorï¼‰
    åœ¨è¿è¡Œæ—¶,å¯ä»¥ç›´æ¥å¾—åˆ°è¿™ä¸ªç±»çš„æˆå‘˜å˜é‡å¯¹è±¡ã€‚ï¼ˆFieldï¼‰
    åœ¨è¿è¡Œæ—¶,å¯ä»¥ç›´æ¥å¾—åˆ°è¿™ä¸ªç±»çš„æˆå‘˜æ–¹æ³•å¯¹è±¡ã€‚ï¼ˆMethodï¼‰

æ ¸å¿ƒæ€æƒ³ï¼šå¾—åˆ°ç¼–è¯‘ä»¥åçš„classæ–‡ä»¶å¯¹è±¡ã€‚åœ¨è¿è¡Œæ—¶è·å–ç±»çš„å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡ï¼Œç„¶åè§£æç±»ä¸­çš„å…¨éƒ¨æˆåˆ†ã€‚

åå°„æä¾›äº†ä¸€ä¸ªClassç±»å‹ï¼Œå°±æ˜¯å¯ä»¥å¾—åˆ°ç¼–è¯‘ä»¥åçš„classç±»å¯¹è±¡ã€‚
    HelloWorld.java -> javac -> HelloWorld.class
	`Class c = HelloWorld.class;`

æ³¨æ„ï¼šåå°„æ˜¯å·¥ä½œåœ¨è¿è¡Œæ—¶çš„æŠ€æœ¯ï¼Œå› ä¸ºåªæœ‰è¿è¡Œä¹‹åæ‰ä¼šæœ‰classç±»å¯¹è±¡ã€‚



***



### è·å–

>åå°„æ˜¯é€šè¿‡å…ˆå¾—åˆ°ç¼–è¯‘ä»¥åçš„Classç±»å¯¹è±¡ï¼šå­—èŠ‚ç æ–‡ä»¶ã€‚
>ç„¶åæ‰å¯ä»¥å¾—åˆ°ç±»ä¸­çš„å…¨éƒ¨æˆåˆ†ï¼Œè¿›è¡Œä¸€äº›åŠŸèƒ½è®¾è®¡ã€‚

åå°„ä¸ºä¸€ä¸ªç±»çš„å…¨éƒ¨æˆåˆ†éƒ½è®¾è®¡äº†ä¸€ä¸ªç±»å‹æ¥ä»£è¡¨è¿™ä¸ªå¯¹è±¡ï¼š
    Class : å­—èŠ‚ç æ–‡ä»¶çš„ç±»å‹
    Constructor : æ„é€ å™¨çš„ç±»å‹
    Field : æˆå‘˜å˜é‡çš„ç±»å‹
    Method : æ–¹æ³•çš„ç±»å‹

#### è·å–ç±»å¯¹è±¡

åå°„æŠ€æœ¯çš„ç¬¬ä¸€æ­¥æ°¸è¿œæ˜¯å…ˆå¾—åˆ°Classç±»å¯¹è±¡:æœ‰ä¸‰ç§æ–¹å¼è·å–
    ï¼ˆ1ï¼‰ ç±»å.class
    ï¼ˆ2ï¼‰ é€šè¿‡ç±»çš„å¯¹è±¡.getClass()æ–¹æ³•
    ï¼ˆ3ï¼‰ Class.forName("ç±»çš„å…¨é™å")   -->`public static Class<?> forName(String className)`

Classç±»ä¸‹çš„æ–¹æ³•ï¼š
     `String getSimpleName()` : è·å¾—ç±»åå­—ç¬¦ä¸²ï¼šç±»å
     `String getName()` : è·å¾—ç±»å…¨åï¼šåŒ…å+ç±»å
     `T newInstance()` : åˆ›å»ºClasså¯¹è±¡å…³è”ç±»çš„å¯¹è±¡,å…¶å®åº•å±‚ä¹Ÿæ˜¯è°ƒç”¨æ— å‚æ•°æ„é€ å™¨ï¼Œå·²ç»è¢«æ·˜æ±°ã€‚

```java
public class ReflectDemo{
    public static void main(String[] args) throws Exception {
        // åå°„çš„ç¬¬ä¸€æ­¥æ°¸è¿œæ˜¯å…ˆå¾—åˆ°ç±»çš„Classæ–‡ä»¶å¯¹è±¡: å­—èŠ‚ç æ–‡ä»¶ã€‚
        // 1.ç±»å.class
        Class c1 = Student.class;
        System.out.println(c1);//class _03åå°„_è·å–Classç±»å¯¹è±¡.Student

        // 2.å¯¹è±¡.getClass()
        Student swk = new Student();
        Class c2 = swk.getClass();
        System.out.println(c2);

        // 3.Class.forName("ç±»çš„å…¨é™å")
        // ç›´æ¥å»åŠ è½½è¯¥ç±»çš„classæ–‡ä»¶ã€‚
        Class c3 = Class.forName("_03åå°„_è·å–Classç±»å¯¹è±¡.Student");
        System.out.println(c3);

        System.out.println(c1.getSimpleName()); // è·å–ç±»åæœ¬èº«ï¼ˆç®€åï¼‰Student
        System.out.println(c1.getName()); //è·å–ç±»çš„å…¨é™å_03åå°„_è·å–Classç±»å¯¹è±¡.Student
    }
}
class Student{}
```



#### è·å–æ„é€ å™¨

è·å–æ„é€ å™¨çš„APIï¼š
	1.Constructor getConstructor(Class... parameterTypes)
		æ ¹æ®å‚æ•°åŒ¹é…è·å–æŸä¸ªæ„é€ å™¨ï¼Œåªèƒ½æ‹¿publicä¿®é¥°çš„æ„é€ å™¨ï¼Œå‡ ä¹ä¸ç”¨ï¼
	2.**Constructor getDeclaredConstructor(Class... parameterTypes)**
		æ ¹æ®å‚æ•°åŒ¹é…è·å–æŸä¸ªæ„é€ å™¨ï¼Œåªè¦ç”³æ˜å°±å¯ä»¥å®šä½ï¼Œä¸å…³å¿ƒæƒé™ä¿®é¥°ç¬¦ï¼Œå»ºè®®ä½¿ç”¨ï¼
	3.Constructor[] getConstructors()
		è·å–æ‰€æœ‰çš„æ„é€ å™¨ï¼Œåªèƒ½æ‹¿publicä¿®é¥°çš„æ„é€ å™¨ã€‚å‡ ä¹ä¸ç”¨ï¼
	4.**Constructor[] getDeclaredConstructors()**
		è·å–æ‰€æœ‰ç”³æ˜çš„æ„é€ å™¨ï¼Œåªè¦ç”³æ˜å°±å¯ä»¥å®šä½ï¼Œä¸å…³å¿ƒæƒé™ä¿®é¥°ç¬¦ã€‚å»ºè®®ä½¿ç”¨ï¼

Constructorçš„å¸¸ç”¨APIï¼š
	`T newInstance(Object... initargs)` : åˆ›å»ºå¯¹è±¡ï¼Œæ³¨å…¥æ„é€ å™¨éœ€è¦çš„æ•°æ®ã€‚
	`void setAccessible(true)` : ä¿®æ”¹è®¿é—®æƒé™ï¼Œtrueä»£è¡¨æš´åŠ›æ”»ç ´æƒé™ï¼Œfalseä¿ç•™ä¸å¯è®¿é—®æƒé™(æš´åŠ›åå°„)
	` String getName()` : ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›æ­¤æ„é€ å‡½æ•°çš„åç§°
	`int getParameterCount()` : è¿”å›å‚æ•°æ•°é‡
	`Class<?>[] getParameterTypes` : è¿”å›å‚æ•°ç±»å‹æ•°ç»„

```java
public class TestStudent01 {
    @Test
    public void getDeclaredConstructors(){
        // a.åå°„ç¬¬ä¸€æ­¥å…ˆå¾—åˆ°Classç±»å¯¹è±¡
        Class c = Student.class ;
        // b.å®šä½å…¨éƒ¨æ„é€ å™¨ï¼Œåªè¦ç”³æ˜äº†å°±å¯ä»¥æ‹¿åˆ°
        Constructor[] cons = c.getDeclaredConstructors();
        // c.éå†è¿™äº›æ„é€ å™¨
        for (Constructor con : cons) {
            System.out.println(con.getName()+"->"+con.getParameterCount());
        }
    }
    @Test
    public void getDeclaredConstructor() throws Exception {
        // a.åå°„ç¬¬ä¸€æ­¥å…ˆå¾—åˆ°Classç±»å¯¹è±¡
        Class c = Student.class ;
        // b.å®šä½æŸä¸ªæ„é€ å™¨ï¼Œæ ¹æ®å‚æ•°åŒ¹é…ï¼Œåªè¦ç”³æ˜äº†å°±å¯ä»¥è·å–
        //Constructor con = c.getDeclaredConstructor(); // å¯ä»¥æ‹¿åˆ°ï¼å®šä½æ— å‚æ•°æ„é€ å™¨ï¼
        Constructor con = c.getDeclaredConstructor(String.class, int.class); //æœ‰å‚æ•°çš„ï¼!
        // c.æ„é€ å™¨åç§°å’Œå‚æ•°
        System.out.println(con.getName()+"->"+con.getParameterCount());
    }
}
```

```java
public class Student {
    private String name ;
    private int age ;
    private Student(){
        System.out.println("æ— å‚æ•°æ„é€ å™¨è¢«æ‰§è¡Œ~~~~");
    }
    public Student(String name, int age) {
        System.out.println("æœ‰å‚æ•°æ„é€ å™¨è¢«æ‰§è¡Œ~~~~");
        this.name = name;
        this.age = age;
    }
}
```

```java
//æµ‹è¯•æ–¹æ³•
public class TestStudent02 {
    // 1.è°ƒç”¨æ— å‚æ•°æ„é€ å™¨å¾—åˆ°ä¸€ä¸ªç±»çš„å¯¹è±¡è¿”å›ã€‚
    @Test
    public void createObj01() throws Exception {
        // a.åå°„ç¬¬ä¸€æ­¥æ˜¯å…ˆå¾—åˆ°Classç±»å¯¹è±¡
        Class c = Student.class ;
        // b.å®šä½æ— å‚æ•°æ„é€ å™¨å¯¹è±¡
        Constructor constructor = c.getDeclaredConstructor();
        // c.æš´åŠ›æ‰“å¼€ç§æœ‰æ„é€ å™¨çš„è®¿é—®æƒé™
        constructor.setAccessible(true);
        // d.é€šè¿‡æ— å‚æ•°æ„é€ å™¨åˆå§‹åŒ–å¯¹è±¡è¿”å›
        Student swk = (Student) constructor.newInstance(); // æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨æ— å‚æ•°æ„é€ å™¨çš„ï¼
        System.out.println(swk);//Student{name='null', age=0}
    }

    // 2.è°ƒç”¨æœ‰å‚æ•°æ„é€ å™¨å¾—åˆ°ä¸€ä¸ªç±»çš„å¯¹è±¡è¿”å›ã€‚
    @Test
    public void createObj02() throws Exception {
        // a.åå°„ç¬¬ä¸€æ­¥æ˜¯å…ˆå¾—åˆ°Classç±»å¯¹è±¡
        Class c = Student.class ;
        // b.å®šä½æœ‰å‚æ•°æ„é€ å™¨å¯¹è±¡
        Constructor constructor = c.getDeclaredConstructor(String.class , int.class);
        // c.é€šè¿‡æ— å‚æ•°æ„é€ å™¨åˆå§‹åŒ–å¯¹è±¡è¿”å›
        Student swk = (Student) constructor.newInstance("å­™æ‚Ÿç©º",500); // æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨æœ‰å‚æ•°æ„é€ å™¨çš„ï¼
        System.out.println(swk);//Student{name='å­™æ‚Ÿç©º', age=500}
    }
}


```



#### è·å–æˆå‘˜å˜é‡

è·å–Fieldæˆå‘˜å˜é‡APIï¼š
	 1.Field getField(String name) : æ ¹æ®æˆå‘˜å˜é‡åè·å¾—å¯¹åº”Fieldå¯¹è±¡ï¼Œåªèƒ½è·å¾—publicä¿®é¥°
     2.Field getDeclaredField(String name) : æ ¹æ®æˆå‘˜å˜é‡åè·å¾—å¯¹åº”Fieldå¯¹è±¡ï¼Œæ‰€æœ‰ç”³æ˜çš„å˜é‡
     3.Field[] getFields() : è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ï¼Œåªèƒ½è·å¾—publicçš„
     4.Field[] getDeclaredFields() : è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ï¼Œåªè¦ç”³æ˜äº†å°±å¯ä»¥å¾—åˆ°

Fieldçš„æ–¹æ³•ï¼šç»™æˆå‘˜å˜é‡èµ‹å€¼å’Œå–å€¼
	`void set(Object obj, Object value)` : ç»™å¯¹è±¡æ³¨å…¥æŸä¸ªæˆå‘˜å˜é‡æ•°æ®ã€‚**objæ˜¯å¯¹è±¡**ï¼Œvalueæ˜¯å€¼
	`Object get(Object obj)` : è·å–å¯¹è±¡çš„æˆå‘˜å˜é‡çš„å€¼ã€‚**objæ˜¯å¯¹è±¡**
	`void setAccessible(true) `: æš´åŠ›åå°„ï¼Œè®¾ç½®ä¸ºå¯ä»¥ç›´æ¥è®¿é—®ç§æœ‰ç±»å‹çš„å±æ€§ã€‚
	`Class getType() `: è·å–å±æ€§çš„ç±»å‹ï¼Œè¿”å›Classå¯¹è±¡ã€‚
	`String getName()` : è·å–å±æ€§çš„åç§°ã€‚

```Java
public class FieldDemo {
    //è·å–å…¨éƒ¨æˆå‘˜å˜é‡
    @Test
    public void getDeclaredFields(){
        // a.å…ˆè·å–classç±»å¯¹è±¡
        Class c = Dog.class;
        // b.è·å–å…¨éƒ¨ç”³æ˜çš„æˆå‘˜å˜é‡å¯¹è±¡
        Field[] fields = c.getDeclaredFields();
        for (Field field : fields) {
            System.out.println(field.getName()+"->"+field.getType());
        }
    }
    //è·å–æŸä¸ªæˆå‘˜å˜é‡
    @Test
    public void getDeclaredField() throws Exception {
        // a.å…ˆè·å–classç±»å¯¹è±¡
        Class c = Dog.class;
        // b.å®šä½æŸä¸ªæˆå‘˜å˜é‡å¯¹è±¡ :æ ¹æ®åç§°å®šä½ï¼ï¼
        Field ageF = c.getDeclaredField("age");
        System.out.println(ageF.getName()+"->"+ageF.getType());
    }
}
```

```java
public class Dog {
    private String name;
    private int age ;
    private String color ;
    public static String school;
    public static final String SCHOOL_1 = "å® ç‰©å­¦æ ¡";

    public Dog() {
    }

    public Dog(String name, int age, String color) {
        this.name = name;
        this.age = age;
        this.color = color;
    }
}
```

```java
//æµ‹è¯•æ–¹æ³•
public class FieldDemo02 {
    @Test
    public void setField() throws Exception {
        // a.åå°„çš„ç¬¬ä¸€æ­¥è·å–Classç±»å¯¹è±¡
        Class c = Dog.class ;
        // b.å®šä½nameæˆå‘˜å˜é‡
        Field name = c.getDeclaredField("name");
        // c.ä¸ºè¿™ä¸ªæˆå‘˜å˜é‡èµ‹å€¼ï¼
        Dog d = new Dog();
        name.setAccessible(true);
        name.set(d,"æ³°è¿ª");
        System.out.println(d);//Dog{name='æ³°è¿ª', age=0, color='null'}
        // d.è·å–æˆå‘˜å˜é‡çš„å€¼
        String value = name.get(d)+"";
        System.out.println(value);//æ³°è¿ª
    }
}
```



#### è·å–æ–¹æ³•

è·å–Methodæ–¹æ³•APIï¼š
	1ã€Method getMethod(String name,Class...args);
				æ ¹æ®æ–¹æ³•åå’Œå‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„æ–¹æ³•å¯¹è±¡ï¼Œåªèƒ½è·å¾—publicçš„
	2ã€Method getDeclaredMethod(String name,Class...args);
   			 æ ¹æ®æ–¹æ³•åå’Œå‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„æ–¹æ³•å¯¹è±¡ï¼ŒåŒ…æ‹¬privateçš„
	3ã€Method[] getMethods();
    			è·å¾—ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡ï¼Œè¿”å›æ•°ç»„ï¼Œåªèƒ½è·å¾—publicä¿®é¥°çš„ä¸”åŒ…å«çˆ¶ç±»çš„
	4ã€Method[] getDeclaredMethods();
 			   è·å¾—ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡ï¼Œè¿”å›æ•°ç»„,åªè·å¾—æœ¬ç±»ç”³æ˜çš„æ–¹æ³•ã€‚

Methodå¸¸ç”¨APIï¼š
	public Object invoke(Object objï¼Œ Object... args) : ä½¿ç”¨æŒ‡å®šçš„å‚æ•°è°ƒç”¨ç”±æ­¤æ–¹æ³•å¯¹è±¡ã€‚objå¯¹è±¡åï¼Œnewçš„

```java
public class MethodDemo{
    //è·å¾—ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡
    @Test
    public void getDeclaredMethods(){
        // a.å…ˆè·å–classç±»å¯¹è±¡
        Class c = Dog.class ;
        // b.è·å–å…¨éƒ¨ç”³æ˜çš„æ–¹æ³•!
        Method[] methods = c.getDeclaredMethods();
        // c.éå†è¿™äº›æ–¹æ³•
        for (Method method : methods) {
            System.out.println(method.getName()+"->"
                    + method.getParameterCount()+"->" + method.getReturnType());
        }
    }
    @Test
    public void getDeclardMethod() throws Exception {
        Class c = Dog.class;
        Method run = c.getDeclaredMethod("run");
        // c.è§¦å‘æ–¹æ³•æ‰§è¡Œ!
        Dog d = new Dog();
        Object o = run.invoke(d);
        System.out.println(o);// å¦‚æœæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œç»“æœæ˜¯null
        
		//å‚æ•°ä¸€ï¼šæ–¹æ³•åç§°   å‚æ•°äºŒï¼šæ–¹æ³•çš„å‚æ•°ä¸ªæ•°å’Œç±»å‹(å¯å˜å‚æ•°ï¼)
        Method eat = c.getDeclaredMethod("eat",String.class);
        eat.setAccessible(true); // æš´åŠ›åå°„ï¼
        
       	//å‚æ•°ä¸€ï¼šè¢«è§¦å‘æ–¹æ³•æ‰€åœ¨çš„å¯¹è±¡  å‚æ•°äºŒï¼šæ–¹æ³•éœ€è¦çš„å…¥å‚å€¼
        Object o1 = eat.invoke(d,"è‚‰");
        System.out.println(o1);// å¦‚æœæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œç»“æœæ˜¯null
    }
}

public class Dog {
    private String name ;
    public Dog(){
    }
    public void run(){System.out.println("ç‹—è·‘çš„è´¼å¿«~~");}
	private void eat(){System.out.println("ç‹—åƒéª¨å¤´");}
	private void eat(String name){System.out.println("ç‹—åƒ"+name);}
	public static void inAddr(){System.out.println("åœ¨å‰å±±åŒºæœ‰ä¸€åªå•èº«ç‹—ï¼");}
}
```



***



### æš´åŠ›æ”»å‡»

1. åå°„å¯ä»¥ç ´åé¢å‘å¯¹è±¡çš„å°è£…æ€§ï¼ˆæš´åŠ›åå°„ï¼‰
2. åŒæ—¶å¯ä»¥ç ´åæ³›å‹çš„çº¦æŸæ€§

 æ³›å‹åªèƒ½å·¥ä½œåœ¨ç¼–è¯‘é˜¶æ®µï¼Œè¿è¡Œé˜¶æ®µæ³›å‹å°±æ¶ˆå¤±äº†ã€‚åå°„å·¥ä½œåœ¨è¿è¡Œæ—¶é˜¶æ®µã€‚

```java
public class ReflectDemo {
    public static void main(String[] args) throws Exception {
        List<Double> scores = new ArrayList<>();
        scores.add(99.3);
        scores.add(199.3);
        scores.add(89.5);
        // æ‹“å±•ï¼šé€šè¿‡åå°„æš´åŠ›çš„æ³¨å…¥ä¸€ä¸ªå…¶ä»–ç±»å‹çš„æ•°æ®è¿›å»ã€‚
        // a.å…ˆå¾—åˆ°é›†åˆå¯¹è±¡çš„Classæ–‡ä»¶å¯¹è±¡
        Class c = scores.getClass();
        // b.ä»ArrayListçš„Classå¯¹è±¡ä¸­å®šä½addæ–¹æ³•
        Method add = c.getDeclaredMethod("add", Object.class);
        // c.è§¦å‘scoresé›†åˆå¯¹è±¡ä¸­çš„addæ‰§è¡Œï¼ˆè¿è¡Œé˜¶æ®µï¼Œæ³›å‹ä¸èƒ½çº¦æŸäº†ï¼‰
        add.invoke(scores,"æ³¢ä»”");
        System.out.println(scores);
    }
}
```



***



### ä½œç”¨

å¯ä»¥åœ¨è¿è¡Œæ—¶å¾—åˆ°ä¸€ä¸ªç±»çš„å…¨éƒ¨æˆåˆ†ç„¶åæ“ä½œã€‚
å¯ä»¥ç ´åå°è£…æ€§ï¼Œä¹Ÿå¯ä»¥ç ´åæ³›å‹çš„çº¦æŸæ€§ã€‚

æ›´é‡è¦çš„ç”¨é€”æ˜¯é€‚åˆï¼šåšJavaé«˜çº§æ¡†æ¶ï¼ŒåŸºæœ¬ä¸Šä¸»æµæ¡†æ¶éƒ½ä¼šåŸºäºåå°„è®¾è®¡ä¸€äº›é€šç”¨æŠ€æœ¯åŠŸèƒ½ã€‚

Mybatisæ¡†æ¶ï¼š
    ä½ ç»™ä»»ä½•ä¸€ä¸ªå¯¹è±¡æ•°æ®æˆ‘éƒ½å¯ä»¥ç›´æ¥å¸®ä½ è§£æå­—æ®µå¹¶ä¸”æŠŠå¯¹åº”æ•°æ®ä¿å­˜èµ·æ¥ã€‚
    Student (æ³¨å†Œï¼ŒæŠŠä¿¡æ¯å­—æ®µéƒ½å­˜å‚¨èµ·æ¥)
    Teacher (æ³¨å†Œï¼ŒæŠŠä¿¡æ¯å­—æ®µéƒ½å­˜å‚¨èµ·æ¥)
    Manager (æ³¨å†Œï¼ŒæŠŠä¿¡æ¯å­—æ®µéƒ½å­˜å‚¨èµ·æ¥)

```java
//ä»»ä½•å¯¹è±¡åªè¦ç»™æˆ‘ï¼Œæˆ‘å°±å¯ä»¥æŠŠä¿¡æ¯å’Œå­—æ®µéƒ½è§£æå¹¶å­˜å‚¨èµ·æ¥ã€‚
public class ReflectDemo{
    public static void main(String[] args) throws Exception {
        Student s = new Student(1,"èµµæ•",26,'å¥³' ,"å…‰æ˜é¡¶","110");
        Mybatis.save(s);
        Pig p = new Pig("ä½©å¥‡",500.0 , "ç²‰è‰²","å°çº¢","æ¯çŒª");
        Mybatis.save(p);
    }
}
public class Mybatis {
    // æä¾›ä¸€ä¸ªæ–¹æ³•ï¼šå¯ä»¥ä¿å­˜ä¸€åˆ‡å¯¹è±¡æ•°æ®çš„å­—æ®µå’Œå…·ä½“å€¼
    public static void save(Object obj) {
        try(PrintStream ps =new PrintStream(
            			new FileOutputStream("Day12Demo/src/data.txt",true));
		){// è§£æå¯¹è±¡çš„å­—æ®µå’Œæ¯ä¸ªå­—æ®µçš„å€¼å­˜å‚¨èµ·æ¥ï¼
            Class c = obj.getClass();
            ps.println("===="+c.getSimpleName()+"====");
            // 2.å®šä½å®ƒçš„å…¨éƒ¨æˆå‘˜å˜é‡
            Field[] fields = c.getDeclaredFields();
            // 3.éå†è¿™äº›å­—æ®µå¹¶ä¸”å–å€¼
            for(Field field : fields) {
                String name = field.getName();//å­—æ®µåç§°
                field.setAccessible(true);
                String value = field.get(obj)+"";
                ps.println(name+"="+value);
            }
        }catch (Exception e){
            e.printStackTrace();
        }
    }
}
public class Student {
    private int id ;
    private String name ;
    private int age ;
    private char sex ;
    private String address ;
    private String tel ;
    //æ„é€ æ–¹æ³•
}
public class Pig {
    private String name ;
    private double weight;
    private String color;
    private String owner ;
    private String sex ;
    //æ„é€ æ–¹æ³•
}
```

â€‹    

***





***





## æ³¨è§£

### æ¦‚å¿µ

æ³¨è§£ï¼š
       ç”¨åœ¨ç±»ä¸Šï¼Œæ–¹æ³•ä¸Šï¼Œæˆå‘˜å˜é‡ï¼Œæ„é€ å™¨ï¼Œ...ä¸Šå¯¹æˆåˆ†è¿›è¡Œç¼–è¯‘çº¦æŸï¼Œæ ‡è®°ç­‰æ“ä½œçš„ã€‚
       æ³¨è§£æ˜¯JDK1.5çš„æ–°ç‰¹æ€§ã€‚
       æ³¨è§£ç›¸å½“ä¸€ç§æ ‡è®°ï¼Œæ˜¯ç±»çš„ç»„æˆéƒ¨åˆ†ï¼Œå¯ä»¥ç»™ç±»æºå¸¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯ã€‚
       æ³¨è§£æ˜¯ç»™ç¼–è¯‘å™¨æˆ–JVMçœ‹çš„ï¼Œç¼–è¯‘å™¨æˆ–JVMå¯ä»¥æ ¹æ®æ³¨è§£æ¥å®Œæˆå¯¹åº”çš„åŠŸèƒ½ã€‚

æ³¨è§£ä½œç”¨ï¼š
       1.æ ‡è®°ã€‚
       2.æ–¹æ³•é‡å†™çº¦æŸ @Override
       3.å‡½æ•°å¼æ¥å£çº¦æŸ @FunctionalInterface.
       4.ç°ä»Šæµè¡Œçš„æ¡†æ¶æŠ€æœ¯å¤šåŠéƒ½æ˜¯åœ¨ä½¿ç”¨æ³¨è§£å’Œåå°„ã€‚éƒ½æ˜¯å±äºæ¡†æ¶çš„åº•å±‚åŸºç¡€æŠ€æœ¯ã€‚

```java
public class AnnotationDemo01 {}

@FunctionalInterface
interface A{
    void test();
}
```



***



### è‡ªå®šä¹‰

```java
ä¿®é¥°ç¬¦ @interface æ³¨è§£å{
     // æ³¨è§£å±æ€§
}
```

è‡ªå®šä¹‰æ³¨è§£ç”¨@interfaceå…³é”®å­—ï¼Œæ³¨è§£é»˜è®¤å¯ä»¥æ ‡è®°å¾ˆå¤šåœ°æ–¹ã€‚

ä½¿ç”¨æ³¨è§£çš„æ ¼å¼ï¼š@æ³¨è§£å

```java
@Book
@MyTest
public class MyBook {
    //æ–¹æ³•å˜é‡éƒ½å¯ä»¥æ³¨è§£
}

@interface Book{
}
@interface MyTest{
}
```



***



### æ³¨è§£å±æ€§

#### æ™®é€šå±æ€§

å±æ€§çš„æ ¼å¼
	æ ¼å¼1ï¼šæ•°æ®ç±»å‹ å±æ€§å();
	æ ¼å¼2ï¼šæ•°æ®ç±»å‹ å±æ€§å() default é»˜è®¤å€¼;

å±æ€§é€‚ç”¨çš„æ•°æ®ç±»å‹:
       å…«ç§æ•°æ®æ•°æ®ç±»å‹(intï¼Œshortï¼Œlongï¼Œdoubleï¼Œbyteï¼Œcharï¼Œbooleanï¼Œfloat)
       Stringï¼ŒClass
       ä»¥ä¸Šç±»å‹çš„æ•°ç»„å½¢å¼éƒ½æ”¯æŒ

å°ç»“ï¼š
   æ³¨è§£å¯ä»¥æœ‰å±æ€§ï¼Œ**å±æ€§åå¿…é¡»å¸¦()**
   åœ¨ç”¨æ³¨è§£çš„æ—¶å€™ï¼Œå±æ€§å¿…é¡»èµ‹å€¼ï¼Œé™¤éè¿™ä¸ªå±æ€§æœ‰é»˜è®¤å€¼ï¼

```java
@MyBook(name="ã€Šç²¾é€šJavaåŸºç¡€ã€‹",authors = {"æ’­ä»”","Dlei","æ’­å¦"} , price = 99.9 )
public class AnnotationDemo01 {
    @MyBook(name="ã€Šç²¾é€šMySQLæ•°æ®åº“å…¥é—¨åˆ°åˆ åº“è·‘è·¯ã€‹",authors = {"å°ç™½","å°é»‘"} ,
     					price = 19.9 , address = "åŒ—äº¬")
    public static void main(String[] args) {
    }
}
// è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£
@interface MyBook{
    String name();
    String[] authors(); // æ•°ç»„
    double price();
    String address() default "æ­¦æ±‰";
}

```



#### ç‰¹æ®Šå±æ€§

æ³¨è§£çš„ç‰¹æ®Šå±æ€§åç§°ï¼švalue
    valueå±æ€§ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªvalueå±æ€§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨valueå±æ€§çš„æ—¶å€™å¯ä»¥çœç•¥valueåç§°ä¸å†™!
	ä½†æ˜¯å¦‚æœæœ‰å¤šä¸ªå±æ€§,ä¸”å¤šä¸ªå±æ€§æ²¡æœ‰é»˜è®¤å€¼ï¼Œé‚£ä¹ˆvalueæ˜¯ä¸èƒ½çœç•¥çš„ã€‚

```java
//@Book("/deleteBook.action")
//@Book(value = "/deleteBook.action" , age = 12)
public class AnnotationDemo01{
}

@interface Book{
    String value();
    int age() default 10;
}
```



***



### å…ƒæ³¨è§£

å…ƒæ³¨è§£æ˜¯sunå…¬å¸æä¾›çš„ï¼Œç”¨åœ¨è‡ªå®šä¹‰æ³¨è§£ä¸Šçš„æ³¨è§£ã€‚å…ƒæ³¨è§£æ˜¯ç”¨æ¥æ³¨è§£è‡ªå®šä¹‰æ³¨è§£çš„ã€‚

å…ƒæ³¨è§£æœ‰ä¸¤ä¸ªï¼š
    @Target : çº¦æŸè‡ªå®šä¹‰æ³¨è§£å¯ä»¥æ ‡è®°çš„èŒƒå›´ï¼Œ
       		ä½†æ˜¯é»˜è®¤çš„æ³¨è§£å¯ä»¥åœ¨ç±»ï¼Œæ–¹æ³•ï¼Œæ„é€ å™¨ï¼Œæˆå‘˜å˜é‡ï¼Œ... ä½¿ç”¨ã€‚
    @Retention : æ ‡è¯†æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ
				ç”³æ˜æ³¨è§£çš„ä½œç”¨èŒƒå›´ï¼šç¼–è¯‘æ—¶ï¼Œè¿è¡Œæ—¶ã€‚
	@Inherited : è¡¨ç¤ºä¿®é¥°çš„è‡ªå®šä¹‰æ³¨è§£å¯ä»¥è¢«å­ç±»ç»§æ‰¿
	@Documented : è¡¨ç¤ºè¯¥è‡ªå®šä¹‰æ³¨è§£ï¼Œä¼šå‡ºç°åœ¨APIæ–‡æ¡£é‡Œé¢ã€‚

**æˆå‘˜å˜é‡æ˜¯ç±»ä¸­çš„å˜é‡ï¼Œä¸æ˜¯æ–¹æ³•ä¸­çš„å˜é‡**

```java
@Target
	ä½œç”¨ï¼šç”¨æ¥æ ‡è¯†æ³¨è§£ä½¿ç”¨çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨è¯¥æ³¨è§£æ ‡è¯†ï¼Œåˆ™è‡ªå®šä¹‰çš„æ³¨è§£å¯ä»¥ä½¿ç”¨åœ¨ä»»æ„ä½ç½®ã€‚
	å¯ä½¿ç”¨çš„å€¼å®šä¹‰åœ¨ElementTypeæšä¸¾ç±»ä¸­ï¼Œå¸¸ç”¨å€¼å¦‚ä¸‹
		TYPEï¼Œç±»ï¼Œæ¥å£
        FIELD, æˆå‘˜å˜é‡
        METHOD, æˆå‘˜æ–¹æ³•
        PARAMETER, æ–¹æ³•å‚æ•°
        CONSTRUCTOR, æ„é€ å™¨
        LOCAL_VARIABLE, å±€éƒ¨å˜é‡

@Retention
	ä½œç”¨ï¼šç”¨æ¥æ ‡è¯†æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ(æœ‰æ•ˆå­˜æ´»èŒƒå›´)
	å¯ä½¿ç”¨çš„å€¼å®šä¹‰åœ¨RetentionPolicyæšä¸¾ç±»ä¸­ï¼Œå¸¸ç”¨å€¼å¦‚ä¸‹
    	SOURCEï¼šæ³¨è§£åªä½œç”¨åœ¨æºç é˜¶æ®µï¼Œç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­ä¸å­˜åœ¨
    	CLASSï¼šæ³¨è§£ä½œç”¨åœ¨æºç é˜¶æ®µï¼Œå­—èŠ‚ç æ–‡ä»¶é˜¶æ®µï¼Œè¿è¡Œé˜¶æ®µä¸å­˜åœ¨ï¼Œé»˜è®¤å€¼.
		RUNTIMEï¼šæ³¨è§£ä½œç”¨åœ¨æºç é˜¶æ®µï¼Œå­—èŠ‚ç æ–‡ä»¶é˜¶æ®µï¼Œè¿è¡Œé˜¶æ®µï¼ˆå¼€å‘å¸¸ç”¨ï¼‰
```

```java
public class AnnotationDemo01{
    // @MyTest // åªèƒ½æ³¨è§£æ–¹æ³•
    private String name;

    @MyTest
    public static void main( String[] args) {
    }
}
@Target(ElementType.METHOD) // ç”³æ˜åªèƒ½æ³¨è§£æ–¹æ³•
@Retention(RetentionPolicy.RUNTIME) // ç”³æ˜æ³¨è§£ä»å†™ä»£ç ä¸€ç›´åˆ°è¿è¡Œè¿˜åœ¨ï¼Œæ°¸è¿œå­˜æ´»ï¼ï¼
@interface MyTest{
}
```



***



### æ³¨è§£è§£æ

> æˆ‘ä»¬ä¼šä½¿ç”¨æ³¨è§£æ³¨é‡Šä¸€ä¸ªç±»çš„æˆåˆ†ï¼Œé‚£ä¹ˆå°±è®¾è®¡åˆ°è¦è§£æå‡ºè¿™äº›æ³¨è§£çš„æ•°æ®ã€‚
> å¼€å‘ä¸­ç»å¸¸è¦çŸ¥é“ä¸€ä¸ªç±»çš„æˆåˆ†ä¸Šé¢åˆ°åº•æœ‰å“ªäº›æ³¨è§£ï¼Œæ³¨è§£æœ‰å“ªäº›å±æ€§æ•°æ®ï¼Œè¿™éƒ½éœ€è¦è¿›è¡Œæ³¨è§£çš„è§£æã€‚

æ³¨è§£è§£æç›¸å…³çš„æ¥å£ï¼š

* Annotation : æ³¨è§£ç±»å‹ï¼Œè¯¥ç±»æ˜¯æ‰€æœ‰æ³¨è§£çš„çˆ¶ç±»ï¼Œæ³¨è§£éƒ½æ˜¯ä¸€ä¸ªAnnotationçš„å¯¹è±¡
* AnnotatedElement : è¯¥æ¥å£å®šä¹‰äº†ä¸æ³¨è§£è§£æç›¸å…³çš„æ–¹æ³•
* ç±»æˆåˆ†Class, Method , Field , Constructor : å®ç°äº†AnnotatedElementæ¥å£ï¼Œéƒ½æ‹¥æœ‰è§£ææ³¨è§£çš„èƒ½åŠ›

API ï¼š
`Annotation[] getDeclaredAnnotations()` : è·å¾—å½“å‰å¯¹è±¡ä¸Šä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£ï¼Œè¿”å›æ³¨è§£æ•°ç»„ã€‚
`T getDeclaredAnnotation(Class<T> annotationClass)` : æ ¹æ®æ³¨è§£ç±»å‹è·å¾—å¯¹åº”æ³¨è§£å¯¹è±¡
`T getAnnotation(Class<T> annotationClass)` : æ ¹æ®æ³¨è§£ç±»å‹è·å¾—å¯¹åº”æ³¨è§£å¯¹è±¡
`boolean isAnnotationPresent(Class<Annotation> annotationClass)` : åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä½¿ç”¨äº†æŒ‡å®šçš„æ³¨è§£

è§£ææ³¨è§£æ•°æ®çš„åŸç†ï¼š
    æ³¨è§£åœ¨å“ªä¸ªæˆåˆ†ä¸Šï¼Œæˆ‘ä»¬å°±å…ˆæ‹¿å“ªä¸ªæˆåˆ†å¯¹è±¡ã€‚
    æ¯”å¦‚æ³¨è§£ä½œç”¨æˆå‘˜æ–¹æ³•ï¼Œåˆ™è¦è·å¾—è¯¥æˆå‘˜æ–¹æ³•å¯¹åº”çš„Methodå¯¹è±¡ï¼Œå†æ¥æ‹¿ä¸Šé¢çš„æ³¨è§£
    æ¯”å¦‚æ³¨è§£ä½œç”¨åœ¨ç±»ä¸Šï¼Œåˆ™è¦è¯¥ç±»çš„Classå¯¹è±¡ï¼Œå†æ¥æ‹¿ä¸Šé¢çš„æ³¨è§£
    æ¯”å¦‚æ³¨è§£ä½œç”¨åœ¨æˆå‘˜å˜é‡ä¸Šï¼Œåˆ™è¦è·å¾—è¯¥æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ï¼Œå†æ¥æ‹¿ä¸Šé¢çš„æ³¨è§£

```java
public class AnnotationDemo{
    @Test
    public void parseClass() {
        // 1.å®šä½Classç±»å¯¹è±¡
        Class c = BookStore.class;
        // 2.åˆ¤æ–­è¿™ä¸ªç±»ä¸Šæ˜¯å¦ä½¿ç”¨äº†æŸä¸ªæ³¨è§£
        if(c.isAnnotationPresent(Book.class)){
            // 3.è·å–è¿™ä¸ªæ³¨è§£å¯¹è±¡
            Book b = (Book)c.getDeclarAnnotation(Book.class);
            System.out.println(book.value());
            System.out.println(book.price());
            System.out.println(Arrays.toString(book.authors()));
        }
    }
    @Test
    public void parseMethod() throws Exception {
        Class c = BookStore.class;
        Method run = c.getDeclaredMethod("run");
        if(run.isAnnotationPresent(Book.class)){
            Book b = (Book)run.getDeclaredAnnotation(Book.class);
           	sout(ä¸Šé¢çš„ä¸‰ä¸ª);
        }
    }
}

@Book(value = "ã€ŠJavaåŸºç¡€åˆ°ç²¾é€šã€‹", price = 99.5, authors = {"æ³¢ä»”","æ³¢å¦"})
class BookStore{
    @Book(value = "ã€ŠMybatisæŒä¹…å±‚æ¡†æ¶ã€‹", price = 199.5, authors = {"dlei","æ’­å®¢"})
    public void run(){
    }
}
@Target({ElementType.TYPE,ElementType.METHOD}) // ç±»å’Œæˆå‘˜æ–¹æ³•ä¸Šä½¿ç”¨
@Retention(RetentionPolicy.RUNTIME) // æ³¨è§£æ°¸ä¹…å­˜æ´»
@interface Book{
    String value();
    double price() default 100;
    String[] authors();
}
```



***



### æ³¨è§£æ¨¡æ‹Ÿ

æ³¨è§£æ¨¡æ‹Ÿå†™ä¸€ä¸ªJunitæ¡†æ¶çš„åŸºæœ¬ä½¿ç”¨ã€‚

åˆ†æï¼š
    ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£MyTest.
				åªèƒ½æ³¨è§£æ–¹æ³•ã€‚
				å­˜æ´»èŒƒå›´ä¸€ç›´éƒ½åœ¨ã€‚
    ï¼ˆ2ï¼‰å®šä¹‰è‹¥å¹²ä¸ªæ–¹æ³•ï¼Œåªè¦æœ‰@MyTestæ³¨è§£çš„æ–¹æ³•å°±èƒ½è¢«è§¦å‘æ‰§è¡Œï¼ï¼
				æ²¡æœ‰è¿™ä¸ªæ³¨è§£çš„æ–¹æ³•ä¸èƒ½æ‰§è¡Œï¼ï¼

```java
public class TestDemo{
    @MyTest
    public void test01(){System.out.println("===test01===");}
    public void test02(){System.out.println("===test02===");}
    @MyTest
    public void test03(){System.out.println("===test03===");}
    @MyTest
    public void test04(){System.out.println("===test04===");}
    
    public static void main(String[] args) throws Exception {
        TestDemo t = new TestDemo();
        Class c = TestDemo.class;
        Method[] methods = c.getDeclaredMethods();
        for (Method method : methods) {
            if(method.isAnnotationPresent(MyTest.class)){
                method.invoke(t);
            }
        }
    }
}

@Target(ElementType.METHOD) // åªèƒ½æ³¨è§£æ–¹æ³•ï¼
@Retention(RetentionPolicy.RUNTIME) // ä¸€ç›´éƒ½æ´»ç€
@interface MyTest{
}
```



****



## XML

### æ¦‚è¿°

XMLä»‹ç»ï¼š

- XML æŒ‡å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆ**EXtensibleÂ MarkupÂ Language**ï¼‰
- XML æ˜¯ä¸€ç§**æ ‡è®°è¯­è¨€**ï¼Œå¾ˆç±»ä¼¼ HTMLï¼ŒHTMLæ–‡ä»¶ä¹Ÿæ˜¯XMLæ–‡æ¡£
- XML çš„è®¾è®¡å®—æ—¨æ˜¯**ä¼ è¾“æ•°æ®**ï¼Œè€Œéæ˜¾ç¤ºæ•°æ®
- XML æ ‡ç­¾æ²¡æœ‰è¢«é¢„å®šä¹‰ã€‚æ‚¨éœ€è¦**è‡ªè¡Œå®šä¹‰æ ‡ç­¾**ã€‚
- XML è¢«è®¾è®¡ä¸ºå…·æœ‰**è‡ªæˆ‘æè¿°æ€§(å°±æ˜¯æ˜“äºé˜…è¯»)**ã€‚
- XML æ˜¯Â **W3C çš„æ¨èæ ‡å‡†**

**xmlä¸htmlçš„åŒºåˆ«**ï¼š

â€‹	XML ä¸æ˜¯ HTML çš„æ›¿ä»£ï¼ŒXML å’Œ HTML ä¸ºä¸åŒçš„ç›®çš„è€Œè®¾è®¡ã€‚
â€‹	XML è¢«è®¾è®¡ä¸ºä¼ è¾“å’Œå­˜å‚¨æ•°æ®ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å†…å®¹ï¼›XMlæ ‡ç­¾å¯è‡ªå®šä¹‰ï¼Œä¾¿äºé˜…è¯»ã€‚
â€‹	HTML è¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å¤–è§‚ï¼›HTMLæ ‡ç­¾è¢«é¢„è®¾å¥½ï¼Œä¾¿äºæµè§ˆå™¨è¯†åˆ«ã€‚
â€‹	HTML æ—¨åœ¨æ˜¾ç¤ºä¿¡æ¯ï¼Œè€Œ XML æ—¨åœ¨ä¼ è¾“ä¿¡æ¯ã€‚



****



### åˆ›å»ºæ–‡ä»¶

person.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<person id="110">
	<age>18</age>		<!--å¹´é¾„-->
	<name>å¼ ä¸‰</name>	  <!--å§“å-->
	<sex/>				<!--æ€§åˆ«-->
</person>
```



***



### ç»„æˆéƒ¨åˆ†

XMLæ–‡ä»¶ä¸­å¸¸è§çš„ç»„æˆå…ƒç´ æœ‰:æ–‡æ¡£å£°æ˜ã€å…ƒç´ ã€å±æ€§ã€æ³¨é‡Šã€è½¬ä¹‰å­—ç¬¦ã€å­—ç¬¦åŒºã€‚æ–‡ä»¶åç¼€åä¸ºxml

* **æ–‡æ¡£å£°æ˜** 
  ``<?xml version="1.0" encoding="utf-8" standalone="yes" ?>``
  æ–‡æ¡£å£°æ˜å¿…é¡»åœ¨ç¬¬ä¸€è¡Œï¼Œä»¥<?xmlå¼€å¤´ï¼Œä»¥ï¼Ÿ>ç»“æŸï¼Œ
  	versionï¼šæŒ‡å®šXMLæ–‡æ¡£ç‰ˆæœ¬ã€‚å¿…é¡»å±æ€§ï¼Œè¿™é‡Œä¸€èˆ¬é€‰æ‹©1.0ï¼›
  	encondingï¼šæŒ‡å®šå½“å‰æ–‡æ¡£çš„ç¼–ç ï¼Œå¯é€‰å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯utf-8ï¼›
    standalone: è¯¥å±æ€§ä¸æ˜¯å¿…é¡»çš„ï¼Œæè¿°XMLæ–‡ä»¶æ˜¯å¦ä¾èµ–å…¶ä»–çš„xmlæ–‡ä»¶ï¼Œå–å€¼ä¸ºyes/no
  
* **å…ƒç´ **        
  
  * æ ¼å¼1:`<person></person> ` 
    æ ¼å¼2:`<person/>`
    æ™®é€šå…ƒç´ çš„ç»“æ„ç”±å¼€å§‹æ ‡ç­¾ã€å…ƒç´ ä½“ã€ç»“æŸæ ‡ç­¾ç»„æˆ;
    æ ‡ç­¾ç”±ä¸€å¯¹å°–æ‹¬å·å’Œåˆæ³•æ ‡è¯†ç¬¦ç»„æˆï¼Œæ ‡ç­¾å¿…é¡»æˆå¯¹å‡ºç°ã€‚ç‰¹æ®Šçš„æ ‡ç­¾å¯ä»¥ä¸æˆå¯¹,å¿…é¡»æœ‰ç»“æŸæ ‡è®°</>;
  
* å…ƒç´ ä½“ï¼šå¯ä»¥æ˜¯å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼š``<person><name>å¼ ä¸‰</name></person>``
  * ç©ºå…ƒç´ ï¼šç©ºå…ƒç´ åªæœ‰æ ‡ç­¾ï¼Œè€Œæ²¡æœ‰ç»“æŸæ ‡ç­¾ï¼Œä½†**å…ƒç´ å¿…é¡»è‡ªå·±é—­åˆ**ï¼Œä¾‹å¦‚ï¼š``<sex/>``
  * å…ƒç´ å‘½åï¼šåŒºåˆ†å¤§å°å†™ã€ä¸èƒ½ä½¿ç”¨ç©ºæ ¼å†’å·ã€ä¸å»ºè®®ç”¨XML xml Xmlç­‰å¼€å¤´
  * å¿…é¡»å­˜åœ¨ä¸€ä¸ªæ ¹æ ‡ç­¾ï¼Œæœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ª
  
* **å±æ€§**
  `<name id="1" desc="é«˜å¯Œå¸…">`
  å±æ€§æ˜¯å…ƒç´ çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¿…é¡»å‡ºç°åœ¨å…ƒç´ çš„å¼€å§‹æ ‡ç­¾ä¸­
  å±æ€§çš„å®šä¹‰æ ¼å¼ï¼š`å±æ€§å=â€œå±æ€§å€¼â€`ï¼Œå…¶ä¸­å±æ€§å€¼å¿…é¡»ä½¿ç”¨å•å¼•æˆ–åŒå¼•å·æ‹¬èµ·æ¥
  ä¸€ä¸ªå…ƒç´ å¯ä»¥æœ‰0~Nä¸ªå±æ€§ï¼Œä½†ä¸€ä¸ªå…ƒç´ ä¸­ä¸èƒ½å‡ºç°åŒåå±æ€§
  å±æ€§åä¸èƒ½ä½¿ç”¨ç©ºæ ¼ , ä¸è¦ä½¿ç”¨å†’å·ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œä¸”å¿…é¡»ä»¥å­—æ¯å¼€å¤´

* **æ³¨é‡Š**
  <!--æ³¨é‡Šå†…å®¹-->
  XMLçš„æ³¨é‡Šä¸HTMLç›¸åŒï¼Œæ—¢ä»¥``<!--``å¼€å§‹ï¼Œ``-->``ç»“æŸã€‚

* **è½¬ä¹‰å­—ç¬¦**
  XMLä¸­çš„è½¬ä¹‰å­—ç¬¦ä¸HTMLä¸€æ ·ã€‚å› ä¸ºå¾ˆå¤šç¬¦å·å·²ç»è¢«æ–‡æ¡£ç»“æ„æ‰€ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨å…ƒç´ ä½“æˆ–å±æ€§å€¼ä¸­æƒ³ä½¿ç”¨è¿™äº›ç¬¦å·å°±å¿…é¡»ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ï¼ˆä¹Ÿå«å®ä½“å­—ç¬¦ï¼‰ï¼Œä¾‹å¦‚ï¼š">"ã€"<"ã€"'"ã€"""ã€"&"ã€‚
  XML ä¸­ä»…æœ‰å­—ç¬¦ "<"å’Œ"&" æ˜¯éæ³•çš„ã€‚çœç•¥å·ã€å¼•å·å’Œå¤§äºå·æ˜¯åˆæ³•çš„ï¼ŒæŠŠå®ƒä»¬æ›¿æ¢ä¸ºå®ä½“å¼•ç”¨

  | å­—ç¬¦ | é¢„å®šä¹‰çš„è½¬ä¹‰å­—ç¬¦ |  è¯´æ˜  |
  | :--: | :--------------: | :----: |
  |  <   |     ``&lt;``     |  å°äº  |
  |  >   |    `` &gt;``     |  å¤§äº  |
  |  "   |   `` &quot;``    | åŒå¼•å· |
  |  '   |   `` &apos;``    | å•å¼•å· |
  |  &   |    `` &amp;``    |  å’Œå·  |

* **å­—ç¬¦åŒº**

  ```xml
  <![CDATA[
  	æ–‡æœ¬æ•°æ®
  ]]>
  ```
  
  * CDATA æŒ‡çš„æ˜¯ä¸åº”ç”± XML è§£æå™¨è¿›è¡Œè§£æçš„æ–‡æœ¬æ•°æ®ï¼ˆUnparsed Character Dataï¼‰
* CDATA éƒ¨åˆ†ç”± "<![CDATA[" å¼€å§‹ï¼Œç”± "]]>" ç»“æŸï¼›
  * å¤§é‡çš„è½¬ä¹‰å­—ç¬¦åœ¨xmlæ–‡æ¡£ä¸­æ—¶ï¼Œä¼šä½¿XMLæ–‡æ¡£çš„å¯è¯»æ€§å¤§å¹…åº¦é™ä½ã€‚è¿™æ—¶ä½¿ç”¨CDATAæ®µå°±ä¼šå¥½ä¸€äº›
  
  * è§„åˆ™
         CDATA éƒ¨åˆ†ä¸èƒ½åŒ…å«å­—ç¬¦ä¸² "]]>"ã€‚ä¹Ÿä¸å…è®¸åµŒå¥—çš„ CDATA éƒ¨åˆ†ã€‚
         æ ‡è®° CDATA éƒ¨åˆ†ç»“å°¾çš„ "]]>" ä¸èƒ½åŒ…å«ç©ºæ ¼æˆ–æŠ˜è¡Œã€‚
  
  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
  <?xml-stylesheet type="text/css" href="../css/xml.css" ?>
  <!-- 7.å¤„ç†æŒ‡ä»¤ï¼šå¯¼å…¥å¤–éƒ¨çš„cssæ ·å¼æ§åˆ¶xmlçš„ç•Œé¢æ•ˆæœï¼Œæ²¡æœ‰å•¥ç”¨ï¼Œxmlä¸æ˜¯ä¸ºäº†å±•ç¤ºå¥½çœ‹çš„ï¼-->
  <!-- 1.ç”³æ˜ æŠ¬å¤´ å¿…é¡»åœ¨ç¬¬ä¸€è¡Œ-->
  <!-- 2.æ³¨é‡Šï¼Œæœ¬å¤„å°±æ˜¯æ³¨é‡Šï¼Œå¿…é¡»ç”¨å‰åå°–æ‹¬å·å›´èµ·æ¥ -->
  <!-- 3.æ ‡ç­¾ï¼ˆå…ƒç´ ï¼‰ï¼Œæ³¨æ„ä¸€ä¸ªXMLæ–‡ä»¶åªèƒ½æœ‰ä¸€ä¸ªæ ¹æ ‡ç­¾-->
  <student>
      <!-- 4.å±æ€§ä¿¡æ¯ï¼šid , desc-->
      <name id="1" desc="é«˜å¯Œå¸…">è¥¿é—¨åº†</name>
      <age>32</age>
      <!-- 5.å®ä½“å­—ç¬¦ï¼šåœ¨xmlæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å†™å°äºå·ï¼Œç­‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦
          ä¼šä¸xmlæ–‡ä»¶æœ¬èº«çš„å†…å®¹å†²çªæŠ¥é”™ï¼Œæ­¤æ—¶å¿…é¡»ç”¨è½¬ä¹‰çš„å®ä½“å­—ç¬¦ã€‚
      -->
      <sql>
         <!-- select * from student where age < 18 && age > 10; -->
          select * from student where age &lt; 18 &amp;&amp; age &gt; 10;
      </sql>
      <!-- 6.å­—ç¬¦æ•°æ®åŒºï¼šåœ¨xmlæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å†™å°äºå·ï¼Œç­‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦
          ä¼šä¸xmlæ–‡ä»¶æœ¬èº«çš„å†…å®¹å†²çªæŠ¥é”™ï¼Œæ­¤æ—¶å¿…é¡»ç”¨è½¬ä¹‰çš„å®ä½“å­—ç¬¦
          æˆ–è€…ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨å­—ç¬¦æ•°æ®åŒºï¼Œé‡Œé¢çš„å†…å®¹å¯ä»¥éšä¾¿äº†ï¼
          -->
      <sql2>
          <![CDATA[
               select * from student where age < 18 && age > 10;
          ]]>
      </sql2>
  </student>
  ```
  
  

****



### çº¦æŸ

#### DTDçº¦æŸ

##### DTDå®šä¹‰

DTDæ˜¯æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDocument Type Definitionï¼‰ã€‚DTD å¯ä»¥å®šä¹‰åœ¨ XML æ–‡æ¡£ä¸­å‡ºç°çš„å…ƒç´ ã€è¿™äº›å…ƒç´ å‡ºç°çš„æ¬¡åºã€å®ƒä»¬å¦‚ä½•ç›¸äº’åµŒå¥—ä»¥åŠXMLæ–‡æ¡£ç»“æ„çš„å…¶å®ƒè¯¦ç»†ä¿¡æ¯ã€‚

##### DTDè§„åˆ™

* çº¦æŸå…ƒç´ çš„åµŒå¥—å±‚çº§

  ```dtd
  <!ELEMENT çˆ¶æ ‡ç­¾ ï¼ˆå­æ ‡ç­¾1ï¼Œå­æ ‡ç­¾2ï¼Œâ€¦ï¼‰>
  ```

* çº¦æŸå…ƒç´ ä½“é‡Œé¢çš„æ•°æ®
  
* è¯­æ³•
  
     ```dtd
     <!ELEMENT æ ‡ç­¾åå­— æ ‡ç­¾ç±»å‹>
  ```
  
* åˆ¤æ–­å…ƒç´ 
           ç®€å•å…ƒç´ ï¼šæ²¡æœ‰å­å…ƒç´ ã€‚
           å¤æ‚å…ƒç´ ï¼šæœ‰å­å…ƒç´ çš„å…ƒç´ ï¼›
   
   * æ ‡ç­¾ç±»å‹
   
  | æ ‡ç­¾ç±»å‹ | ä»£ç å†™æ³•  | è¯´æ˜                 |
  | -------- | --------- | -------------------- |
  | PCDATA   | (#PCDATA) | è¢«è§£é‡Šçš„å­—ç¬¦ä¸²æ•°æ®   |
  | EMPTY    | EMPTY     | å³ç©ºå…ƒç´ ï¼Œä¾‹å¦‚\<hr/> |
  | ANY      | ANY       | å³ä»»æ„ç±»å‹           |
  
   * ä»£ç 
  
     ```dtd
  <!ELEMENT persons (person+)>   	<!--çº¦æŸäººä»¬è‡³å°‘ä¸€ä¸ªäºº-->
     <!ELEMENT person (name,age)>	<!--çº¦æŸå…ƒç´ äººçš„å­å…ƒç´ å¿…é¡»ä¸ºå§“åã€å¹´é¾„ï¼Œå¹¶ä¸”æŒ‰é¡ºåº-->
     <!ELEMENT name (#PCDATA)>		<!--"å§“å"å…ƒç´ ä½“ä¸ºå­—ç¬¦ä¸²æ•°æ®-->
     <!ELEMENT age ANY>       		<!--"å¹´é¾„"å…ƒç´ ä½“ä¸ºä»»æ„ç±»å‹-->
     ```
  
   * æ•°é‡è¯
  
     | æ•°é‡è¯ç¬¦å· | å«ä¹‰                         |
     | ---------- | ---------------------------- |
     | ç©º         | è¡¨ç¤ºå…ƒç´ å‡ºç°ä¸€æ¬¡             |
     | *          | è¡¨ç¤ºå…ƒç´ å¯ä»¥å‡ºç°0åˆ°å¤šä¸ª      |
     | +          | è¡¨ç¤ºå…ƒç´ å¯ä»¥å‡ºç°è‡³å°‘1ä¸ª      |
     | ?          | è¡¨ç¤ºå…ƒç´ å¯ä»¥æ˜¯0æˆ–1ä¸ª         |
     | ,          | è¡¨ç¤ºå…ƒç´ éœ€è¦æŒ‰ç…§é¡ºåºæ˜¾ç¤º     |
     | \|         | è¡¨ç¤ºå…ƒç´ éœ€è¦é€‰æ‹©å…¶ä¸­çš„æŸä¸€ä¸ª |
  
     
  
* å±æ€§å£°æ˜

   * è¯­æ³•

     ```dtd
     <!ATTLIST æ ‡ç­¾åç§° 
     		å±æ€§åç§°1 å±æ€§ç±»å‹1 å±æ€§è¯´æ˜1
     		å±æ€§åç§°2 å±æ€§ç±»å‹2 å±æ€§è¯´æ˜2
     		â€¦
     >
     ```

   * å±æ€§ç±»å‹

     | å±æ€§ç±»å‹   | å«ä¹‰                                                         |
     | ---------- | ------------------------------------------------------------ |
     | CDATA      | ä»£è¡¨å±æ€§æ˜¯æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œ eg:<!ATTLIST å±æ€§å CDATA å±æ€§è¯´æ˜>   |
     | ID         | ä»£ç è¯¥å±æ€§å€¼å”¯ä¸€ï¼Œä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼Œ eg:<!ATTLIST å±æ€§å ID å±æ€§è¯´æ˜> |
     | ENUMERATED | ä»£è¡¨å±æ€§å€¼åœ¨æŒ‡å®šèŒƒå›´å†…è¿›è¡Œæšä¸¾ Eg:<!ATTLISTå±æ€§å (ç¤¾ç§‘ç±»\|å·¥ç¨‹ç±»\|æ•™è‚²ç±») "ç¤¾ç§‘ç±»"> "ç¤¾ç§‘ç±»"æ˜¯é»˜è®¤å€¼ï¼Œå±æ€§å¦‚æœä¸è®¾ç½®é»˜è®¤å€¼å°±æ˜¯"ç¤¾ç§‘ç±»" |

   * å±æ€§è¯´æ˜

     | å±æ€§è¯´æ˜  | å«ä¹‰                                                        |
     | --------- | ----------------------------------------------------------- |
     | #REQUIRED | ä»£è¡¨å±æ€§æ˜¯å¿…é¡»æœ‰çš„                                          |
     | #IMPLIED  | ä»£è¡¨å±æ€§å¯æœ‰å¯æ—                                             |
     | #FIXED    | ä»£è¡¨å±æ€§ä¸ºå›ºå®šå€¼ï¼Œå®ç°æ–¹å¼ï¼šbook_info CDATA #FIXED "å›ºå®šå€¼" |

   * ä»£ç 

     ```dtd
     <!ATTLIST ä¹¦									<!--è®¾ç½®"ä¹¦"å…ƒç´ çš„çš„å±æ€§åˆ—è¡¨-->
     	id ID #REQUIRED						 <!--"id"å±æ€§å€¼ä¸ºå¿…é¡»æœ‰-->
     	ç¼–å· CDATA #IMPLIED				    <!--"ç¼–å·"å±æ€§å¯æœ‰å¯æ— -->
     	å‡ºç‰ˆç¤¾ (æ¸…å|åŒ—å¤§|ä¼ æ™ºæ’­å®¢) "ä¼ æ™ºæ’­å®¢" <!--"å‡ºç‰ˆç¤¾"å±æ€§å€¼æ˜¯æšä¸¾å€¼ï¼Œé»˜è®¤ä¸ºâ€œä¼ æ™ºæ’­å®¢â€-->
     	type CDATA #FIXED "IT"            <!--"type"å±æ€§ä¸ºæ–‡æœ¬å­—ç¬¦ä¸²å¹¶ä¸”å›ºå®šå€¼ä¸º"IT"-->
     >
     <!ATTLIST person id CDATA #REQUIRED>  <!--idæ˜¯æ–‡æœ¬å­—ç¬¦ä¸²å¿…é¡»æœ‰-->
     ```
   
     



##### DTDå¼•å…¥

* å¼•å…¥æœ¬åœ°dtd

  ```dtd
  <!DOCTYPE æ ¹å…ƒç´ åç§° SYSTEM â€˜DTDæ–‡ä»¶çš„è·¯å¾„'>
  ```

* åœ¨xmlæ–‡ä»¶å†…éƒ¨å¼•å…¥

  ```dtd
  <!DOCTYPE æ ¹å…ƒç´ åç§° [ dtdæ–‡ä»¶å†…å®¹ ]>
  ```

* å¼•å…¥ç½‘ç»œdtd

  ```dtd
  <!DOCTYPE æ ¹å…ƒç´ çš„åç§° PUBLIC "DTDæ–‡ä»¶åç§°" "DTDæ–‡æ¡£çš„URL">
  ```

```dtd
<!--è¿™æ˜¯persondtd.dtdæ–‡ä»¶ä¸­çš„å†…å®¹,å·²ç»æå‰å†™å¥½-->
<!ELEMENT persons (person)>
<!ELEMENT person (name,age)>
<!ELEMENT name (#PCDATA)>
<!ELEMENT age (#PCDATA)>
```

```xml
<!--å¼•å…¥æœ¬åœ°DTD-->
<!DOCTYPE persons SYSTEM 'persondtd.dtd'>
<persons>
    <person>
        <name>å¼ ä¸‰</name>
        <age>23</age>
    </person>

</persons>
```

```xml-dtd
<!--å†…éƒ¨å¼•å…¥DTD-->
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE persons [
        <!ELEMENT persons (person)>
        <!ELEMENT person (name,age)>
        <!ELEMENT name (#PCDATA)>
        <!ELEMENT age (#PCDATA)>
        ]>

<persons>
    <person>
        <name>å¼ ä¸‰</name>
        <age>23</age>
    </person>
</persons>
```

```dtd
<!--å¼•å…¥ç½‘ç»œDTD--><?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE persons PUBLIC "dtdæ–‡ä»¶çš„åç§°" "dtdæ–‡æ¡£çš„URL">

<persons>
    <person>
        <name>å¼ ä¸‰</name>
        <age>23</age>
    </person>
</persons>
```



##### DTDå®ç°

persondtd.dtdæ–‡ä»¶

```dtd
<!ELEMENT persons (person+)>   	<!--çº¦æŸäººä»¬è‡³å°‘ä¸€ä¸ªäºº-->
<!ELEMENT person (name,age)>	<!--çº¦æŸå…ƒç´ äººçš„å­å…ƒç´ å¿…é¡»ä¸ºå§“åã€å¹´é¾„ï¼Œå¹¶ä¸”æŒ‰é¡ºåº-->
<!ELEMENT name (#PCDATA)>		<!--"å§“å"å…ƒç´ ä½“ä¸ºå­—ç¬¦ä¸²æ•°æ®-->
<!ELEMENT age ANY>       		<!--"å¹´é¾„"å…ƒç´ ä½“ä¸ºä»»æ„ç±»å‹-->
<!ATTLIST person id CDATA #REQUIRED>  <!--idæ˜¯æ–‡æœ¬å­—ç¬¦ä¸²å¿…é¡»æœ‰-->
```

```xml-dtd
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE persons SYSTEM 'persondtd.dtd'>

<persons>
    <person id="001">
        <name>å¼ ä¸‰</name>
        <age>23</age>
    </person>

    <person id = "002">
        <name>å¼ ä¸‰</name>
        <age>23</age>
    </person>
</persons>
```



***



#### Schemaçº¦æŸ

##### Schemaå®šä¹‰

1.Schema è¯­è¨€ä¹Ÿå¯ä½œä¸º XSDï¼ˆXML Schema Definitionï¼‰
2.schemaçº¦æŸæ–‡ä»¶æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªxmlæ–‡ä»¶ï¼Œç¬¦åˆxmlçš„è¯­æ³•ï¼Œè¿™ä¸ªæ–‡ä»¶çš„åç¼€å.xsd
3.ä¸€ä¸ªxmlä¸­å¯ä»¥å¼•ç”¨å¤šä¸ªschemaçº¦æŸæ–‡ä»¶ï¼Œå¤šä¸ªschemaä½¿ç”¨åç§°ç©ºé—´åŒºåˆ†ï¼ˆåç§°ç©ºé—´ç±»ä¼¼äºjavaåŒ…åï¼‰
4.dtdé‡Œé¢å…ƒç´ ç±»å‹çš„å–å€¼æ¯”è¾ƒå•ä¸€å¸¸è§çš„æ˜¯PCDATAç±»å‹ï¼Œä½†æ˜¯åœ¨schemaé‡Œé¢å¯ä»¥æ”¯æŒå¾ˆå¤šä¸ªæ•°æ®ç±»å‹
**5.Schemaæ–‡ä»¶çº¦æŸxmlæ–‡ä»¶çš„åŒæ—¶ä¹Ÿè¢«åˆ«çš„æ–‡ä»¶çº¦æŸç€**



##### Schemaè§„åˆ™

1ã€åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„åç¼€åä¸º.xsdã€‚
2ã€å®šä¹‰æ–‡æ¡£å£°æ˜
3ã€schemaæ–‡ä»¶çš„æ ¹æ ‡ç­¾ä¸ºï¼š <schema>
4ã€åœ¨<schema>ä¸­å®šä¹‰å±æ€§ï¼š
	  xmlns=http://www.w3.org/2001/XMLSchema
	  ä»£è¡¨å½“å‰æ–‡ä»¶æ—¶çº¦æŸåˆ«äººçš„ï¼ŒåŒæ—¶è¿™ä¸ªæ–‡ä»¶ä¹Ÿå¯¹è¯¥Schemaè¿›è¡Œçº¦æŸ
5ã€åœ¨<schema>ä¸­å®šä¹‰å±æ€§ ï¼š
	  targetNamespace = å”¯ä¸€çš„urlåœ°å€ï¼ŒæŒ‡å®šå½“å‰è¿™ä¸ªschemaæ–‡ä»¶çš„åç§°ç©ºé—´ã€‚
	  **åç§°ç©ºé—´**ï¼šå½“å…¶ä»–xmlä½¿ç”¨è¯¥schemaæ–‡ä»¶ï¼Œéœ€è¦å¼•å…¥æ­¤ç©ºé—´
6ã€åœ¨<schema>ä¸­å®šä¹‰å±æ€§ ï¼š
	  elementFormDefault="qualifiedâ€œï¼Œè¡¨ç¤ºå½“å‰schemaæ–‡ä»¶æ˜¯ä¸€ä¸ªè´¨é‡è‰¯å¥½çš„æ–‡ä»¶ã€‚
7ã€é€šè¿‡elementå®šä¹‰å…ƒç´ 
8ã€**åˆ¤æ–­å½“å‰å…ƒç´ æ˜¯ç®€å•å…ƒç´ è¿˜æ˜¯å¤æ‚å…ƒç´ **

person.xsd

```scheme
<?xml version="1.0" encoding="UTF-8" ?>
<schema
    xmlns="http://www.w3.org/2001/XMLSchema"     <!--æœ¬æ–‡ä»¶æ˜¯çº¦æŸåˆ«äººçš„ï¼Œä¹Ÿè¢«çº¦æŸ-->
    targetNamespace="http://www.itheima.cn/javase"<!--è‡ªå·±çš„åç§°ç©ºé—´-->
    elementFormDefault="qualified"				  <!--æœ¬æ–‡ä»¶æ˜¯è´¨é‡å¥½çš„-->
>

    <element name="persons">    		  <!--å®šä¹‰personså¤æ‚å…ƒç´ -->
        <complexType>           		  <!--å¤æ‚çš„å…ƒç´ -->
            <sequence>					  <!--é‡Œé¢çš„å…ƒç´ å¿…é¡»æŒ‰ç…§é¡ºåºå®šä¹‰-->
                <element name = "person"> <!--å®šä¹‰personå¤æ‚å…ƒç´ -->
                    <complexType>
                        <sequence>
                            <!--å®šä¹‰nameå’Œageç®€å•å…ƒç´ -->
                            <element name = "name" type = "string"></element>
                            <element name = "age" type = "string"></element>
                        </sequence>
                    </complexType>
                </element>
            </sequence>
        </complexType>
    </element>
    
</schema>
```



##### Schemaå¼•å…¥

1ã€åœ¨æ ¹æ ‡ç­¾ä¸Šå®šä¹‰å±æ€§xmlns="http://www.w3.org/2001/XMLSchema-instance"
2ã€**é€šè¿‡xmlnså¼•å…¥çº¦æŸæ–‡ä»¶çš„åç§°ç©ºé—´**
3ã€ç»™æŸä¸€ä¸ªxmlnså±æ€§æ·»åŠ ä¸€ä¸ªæ ‡è¯†ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„åç§°ç©ºé—´
	  æ ¼å¼ä¸º: xmlns:æ ‡è¯†=â€œåç§°ç©ºé—´urlâ€ ,æ ‡è¯†å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œä½†æ˜¯ä¸€èˆ¬å–å€¼éƒ½æ˜¯xsi
4ã€é€šè¿‡xsi:schemaLocationæŒ‡å®šåç§°ç©ºé—´æ‰€å¯¹åº”çš„çº¦æŸæ–‡ä»¶è·¯å¾„
	  æ ¼å¼ä¸º: xsi:schemaLocation = "åç§°ç©ºé—´url æ–‡ä»¶è·¯å¾„â€œ

```scheme
<?xml version="1.0" encoding="UTF-8" ?>
<persons
	xmlms:xis="http://www.w3.org/2001/XMLSchema-instance" <!--è¢«åˆ«äººçº¦æŸ-->
    xmlns="http://www.itheima.cn/javase"                  <!--çº¦æŸæ–‡ä»¶çš„åç§°ç©ºé—´-->
    xsi:schemaLocation="http://www.itheima.cn/javase person.xsd"
>

 <person>
        <name>å¼ ä¸‰</name>
        <age>23</age>
    </person>

</persons>
```



##### Schemaå±æ€§

```scheme
<?xml version="1.0" encoding="UTF-8" ?>
<schema
    xmlns="http://www.w3.org/2001/XMLSchema"
    targetNamespace="http://www.itheima.cn/javase"
    elementFormDefault="qualified"
>

    <!--å®šä¹‰personså¤æ‚å…ƒç´ -->
    <element name="persons">
        <complexType>
            <sequence>
                <!--å®šä¹‰personå¤æ‚å…ƒç´ -->
                <element name = "person">
                    <complexType>
                        <sequence>
                            <!--å®šä¹‰nameå’Œageç®€å•å…ƒç´ -->
                            <element name = "name" type = "string"></element>
                            <element name = "age" type = "string"></element>
                        </sequence>
                        <!--å®šä¹‰çš„ä½ç½®æ˜¯sequenceçš„å¤–é¢ï¼ŒcomplexTypeçš„é‡Œé¢-->
                        <!--å®šä¹‰å±æ€§ï¼Œrequired( å¿…é¡»çš„)/optional( å¯é€‰çš„)-->
                        <attribute name="id" type="string" use="required">		
						</attribute>
                    </complexType>
                    
                </element>
            </sequence>
        </complexType>
    </element>
    
</schema>

<?xml version="1.0" encoding="UTF-8" ?>
<persons
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://www.itheima.cn/javase"
    xsi:schemaLocation="http://www.itheima.cn/javase person.xsd"
>
    <person id="001">
        <name>å¼ ä¸‰</name>
        <age>23</age>
    </person>

</persons>
```



***



### Dom4J

#### è§£æ

* æ¦‚è¿°ï¼šxmlè§£æå°±æ˜¯ä»xmlä¸­è·å–åˆ°æ•°æ®ã€‚DOMæ˜¯è§£ææ€æƒ³ã€‚

* DOM(Document Object Model)æ–‡æ¡£å¯¹è±¡æ¨¡å‹:å°±æ˜¯æŠŠæ–‡æ¡£çš„å„ä¸ªç»„æˆéƒ¨åˆ†çœ‹åšæˆå¯¹åº”çš„å¯¹è±¡ã€‚
  ä¼šæŠŠxmlæ–‡ä»¶å…¨éƒ¨åŠ è½½åˆ°å†…å­˜,åœ¨å†…å­˜ä¸­å½¢æˆä¸€ä¸ªæ ‘å½¢ç»“æ„,å†è·å–å¯¹åº”çš„å€¼

* å·¥å…·ï¼šdom4jå±äºç¬¬ä¸‰æ–¹æŠ€æœ¯ï¼Œå¿…é¡»å¯¼å…¥è¯¥æ¡†æ¶
  	https://dom4j.github.io/ å»ä¸‹è½½dom4jï¼Œåœ¨ideaä¸­å½“å‰æ¨¡å—ä¸‹æ–°å»ºä¸€ä¸ªlibæ–‡ä»¶å¤¹,å°†jaråŒ…å¤åˆ¶åˆ°æ–‡ä»¶å¤¹ä¸­
  	é€‰ä¸­jaråŒ… -> å³é”® -> é€‰æ‹©add as libraryå³å¯

* dom4jå®ç°
  * dom4jè§£æå™¨æ„é€ æ–¹æ³•ï¼š`SAXReader saxReader = new SAXReader();`
  * SAXReaderå¸¸ç”¨APIï¼š
    `public Document read(File file)` : Reads a Document from the given File
    `public Document read(InputStream in)` : Reads a Document from the given stream using SAX
  * Java Classç±»API
    `public InputStream getResourceAsStream(String path)`ï¼šåŠ è½½æ–‡ä»¶æˆä¸ºä¸€ä¸ªå­—èŠ‚è¾“å…¥æµè¿”å›



#### è§£ææ ¹å…ƒç´ 

Documentæ–¹æ³•ï¼š
     Element getRootElement()ï¼šè·å–æ ¹å…ƒç´ ã€‚

```java
// éœ€æ±‚ï¼šè§£æbooks.xmlæ–‡ä»¶æˆä¸ºä¸€ä¸ªDocumentæ–‡æ¡£æ ‘å¯¹è±¡ï¼Œå¾—åˆ°æ ¹å…ƒç´ å¯¹è±¡ã€‚
public class Dom4JDemo {
    public static void main(String[] args) throws Exception {
        // 1.åˆ›å»ºä¸€ä¸ªdom4jçš„è§£æå™¨å¯¹è±¡ï¼šä»£è¡¨æ•´ä¸ªdom4jæ¡†æ¶ã€‚
        SAXReader saxReader = new SAXReader();
        // 2.ç¬¬ä¸€ç§æ–¹å¼ï¼ˆç®€å•ï¼‰ï¼šé€šè¿‡è§£æå™¨å¯¹è±¡å»åŠ è½½xmlæ–‡ä»¶æ•°æ®ï¼Œæˆä¸ºä¸€ä¸ªDocumentæ–‡æ¡£æ ‘å¯¹è±¡ã€‚
        //Document document = saxReader.read(new File("Day13Demo/src/books.xml"));
        
        // 3.ç¬¬äºŒç§æ–¹å¼ï¼ˆä»£ç å¤šç‚¹ï¼‰å…ˆæŠŠxmlæ–‡ä»¶è¯»æˆä¸€ä¸ªå­—èŠ‚è¾“å…¥æµ
        // è¿™é‡Œçš„â€œ/â€æ˜¯ç›´æ¥å»srcç±»è·¯å¾„ä¸‹å¯»æ‰¾æ–‡ä»¶ã€‚
        InputStream is = Dom4JDemo01.class.getResourceAsStream("/books.xml");
        Document document = saxReader.read(is);
        System.out.println(document);
		//org.dom4j.tree.DefaultDocument@27a5f880 [Document: name null]
		// 4.ä»documentæ–‡æ¡£æ ‘å¯¹è±¡ä¸­æå–æ ¹å…ƒç´ å¯¹è±¡
        Element root = document.getRootElement();
        System.out.println(root.getName());//books
    }
}
```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<books>
    <book id="0001" desc="ç¬¬ä¸€æœ¬ä¹¦">
        <name>  JavaWebå¼€å‘æ•™ç¨‹</name>
        <author>    å¼ å­ç¥¥</author>
        <sale>100.00å…ƒ   </sale>
    </book>
    <book id="0002">
        <name>ä¸‰å›½æ¼”ä¹‰</name>
        <author>ç½—è´¯ä¸­</author>
        <sale>100.00å…ƒ</sale>
    </book>
    <user>
    </user>
</books>

```



#### è§£æå­å…ƒç´ 

Elementå…ƒç´ çš„API:
    String getName() : å–å…ƒç´ çš„åç§°ã€‚
    List<Element> elements() : è·å–å½“å‰å…ƒç´ ä¸‹çš„å…¨éƒ¨å­å…ƒç´ ï¼ˆä¸€çº§ï¼‰
    List<Element> elements(String name) : è·å–å½“å‰å…ƒç´ ä¸‹çš„æŒ‡å®šåç§°çš„å…¨éƒ¨å­å…ƒç´ ï¼ˆä¸€çº§ï¼‰
    Element element(String name) : è·å–å½“å‰å…ƒç´ ä¸‹çš„æŒ‡å®šåç§°çš„æŸä¸ªå­å…ƒç´ ï¼Œé»˜è®¤å–ç¬¬ä¸€ä¸ªï¼ˆä¸€çº§ï¼‰

```java
public class Dom4JDemo {
    public static void main(String[] args) throws Exception {
        SAXReader saxReader = new SAXReader();
        Document document = saxReader.read(new File("Day13Demo/src/books.xml"));
        // 3.è·å–æ ¹å…ƒç´ å¯¹è±¡
        Element root = document.getRootElement();
        System.out.println(root.getName());

        // 4.è·å–æ ¹å…ƒç´ ä¸‹çš„å…¨éƒ¨å­å…ƒç´ 
        List<Element> sonElements = root.elements();
        for (Element sonElement : sonElements) {
            System.out.println(sonElement.getName());
        }
        // 5.è·å–æ ¹æºä¸‹çš„å…¨éƒ¨bookå­å…ƒç´ 
        List<Element> sonElements1 = root.elements("book");
        for (Element sonElement : sonElements1) {
            System.out.println(sonElement.getName());
        }
        
        // 6.è·å–æ ¹æºä¸‹çš„æŒ‡å®šçš„æŸä¸ªå…ƒç´ 
        Element son = root.element("user");
        System.out.println(son.getName());
        // é»˜è®¤ä¼šæå–ç¬¬ä¸€ä¸ªåç§°ä¸€æ ·çš„å­å…ƒç´ å¯¹è±¡è¿”å›ï¼
        Element son1 = root.element("book");
        System.out.println(son1.attributeValue("id"));
    }
}

```



#### è§£æå±æ€§

Elementå…ƒç´ çš„API:
    List<Attribute> attributes() : è·å–å…ƒç´ çš„å…¨éƒ¨å±æ€§å¯¹è±¡ã€‚
    Attribute attribute(String name) : æ ¹æ®åç§°è·å–æŸä¸ªå…ƒç´ çš„å±æ€§å¯¹è±¡ã€‚
    String attributeValue(String var) : ç›´æ¥è·å–æŸä¸ªå…ƒç´ çš„æŸä¸ªå±æ€§åç§°çš„å€¼ã€‚

Attributeå¯¹è±¡çš„API:
    String getName() :  è·å–å±æ€§åç§°ã€‚
    String getValue() : è·å–å±æ€§å€¼ã€‚

```java
public class Dom4JDemo {
    public static void main(String[] args) throws Exception {
        SAXReader saxReader = new SAXReader();
        Document document = saxReader.read(new File("Day13Demo/src/books.xml"));
        Element root = document.getRootElement();
        // 4.è·å–bookå­å…ƒç´ 
        Element bookEle = root.element("book");

        // 5.è·å–bookå…ƒç´ çš„å…¨éƒ¨å±æ€§å¯¹è±¡
        List<Attribute> attributes = bookEle.attributes();
        for (Attribute attribute : attributes) {
            System.out.println(attribute.getName()+"->"+attribute.getValue());
        }

        // 6.è·å–Bookå…ƒç´ çš„æŸä¸ªå±æ€§å¯¹è±¡
        Attribute descAttr = bookEle.attribute("desc");
        System.out.println(descAttr.getName()+"->"+descAttr.getValue());

        // 7.å¯ä»¥ç›´æ¥è·å–å…ƒç´ çš„å±æ€§å€¼
        System.out.println(bookEle.attributeValue("id"));
        System.out.println(bookEle.attributeValue("desc"));
    }
}
```



#### è§£ææ–‡æœ¬

Element:
    String elementText(String name) : å¯ä»¥ç›´æ¥è·å–å½“å‰å…ƒç´ çš„å­å…ƒç´ çš„æ–‡æœ¬å†…å®¹
    String elementTextTrim(String name) : å»å‰åç©ºæ ¼,ç›´æ¥è·å–å½“å‰å…ƒç´ çš„å­å…ƒç´ çš„æ–‡æœ¬å†…å®¹
    String getText() : ç›´æ¥è·å–å½“å‰å…ƒç´ çš„æ–‡æœ¬å†…å®¹ã€‚
    String getTextTrim() : å»å‰åç©ºæ ¼,ç›´æ¥è·å–å½“å‰å…ƒç´ çš„æ–‡æœ¬å†…å®¹ã€‚

```java
public class Dom4JDemo {
    public static void main(String[] args) throws Exception {
        SAXReader saxReader = new SAXReader();
        Document document = saxReader.read(new File("Day13Demo/src/books.xml"));
        Element root = document.getRootElement();
        // 4.å¾—åˆ°ç¬¬ä¸€ä¸ªå­å…ƒç´ book
        Element bookEle = root.element("book");

        // 5.ç›´æ¥æ‹¿åˆ°å½“å‰bookå…ƒç´ ä¸‹çš„å­å…ƒç´ æ–‡æœ¬å€¼
        System.out.println(bookEle.elementText("name"));
        System.out.println(bookEle.elementTextTrim("name")); // å»å‰åç©ºæ ¼
        System.out.println(bookEle.elementText("author"));
        System.out.println(bookEle.elementTextTrim("author")); // å»å‰åç©ºæ ¼
        System.out.println(bookEle.elementText("sale"));
        System.out.println(bookEle.elementTextTrim("sale")); // å»å‰åç©ºæ ¼

        // 6.å…ˆè·å–åˆ°å­å…ƒç´ å¯¹è±¡ï¼Œå†è·å–è¯¥æ–‡æœ¬å€¼
        Element bookNameEle = bookEle.element("name");
        System.out.println(bookNameEle.getText());
        System.out.println(bookNameEle.getTextTrim());// å»å‰åç©ºæ ¼
    }
}
```



****



#### æ¡ˆä¾‹

Dom4jè§£æXMLæ–‡ä»¶:Contacts.xmlæˆä¸ºä¸€ä¸ªJavaçš„å¯¹è±¡
Contacts.xml è§£ææˆ===> List<Contact>

```java
public class Dom4JDemo {
    public static void main(String[] args) throws Exception {
        SAXReader saxReader = new SAXReader();
        Document document = saxReader.read(new File("Day13Demo/src/Contacts.xml"));
        Element root = docment.getRootElement();
        // 4.è·å–æ ¹å…ƒç´ ä¸‹çš„å…¨éƒ¨å­å…ƒç´ 
        List<Element> sonElements = root.elements();
        // 5.éå†å­å…ƒç´  å°è£…æˆListé›†åˆå¯¹è±¡
        List<Contact> contactList = new ArrayList<>();
        if(sonElements != null && sonElements.size() > 0) {
            for (Element sonElement : sonElements) {
                Contact c = new Contact();
                c.setID(Integer.valueOf(sonElement.attributeValue("id")));
                contact.setVip(Boolean.valueOf(sonElement.attributeValue("vip")));
                contact.setName(sonElement.elementText("name"));
                contact.setSex(sonElement.elementText("gender").charAt(0));
                contact.setEmail(sonElement.elementText("email"));
                contactList.add(contact);
            }
        }
        System.out.println(contactList);
    }
}  
public class Contact {
    private int id ;
    private boolean vip;
    private String name ;
    private char sex ;
    private String email ;
    //æ„é€ å™¨
}
```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<contactList>
    <contact id="1" vip="true">
        <name>æ½˜é‡‘è²</name>
        <gender>å¥³</gender>
        <email>panpan@itcast.cn</email>
    </contact>
    <contact id="2" vip="false">
        <name>æ­¦æ¾</name>
        <gender>ç”·</gender>
        <email>wusong@itcast.cn</email>
    </contact>
    <contact id="3" vip="false">
        <name>æ­¦å¤§ç‹¼</name>
        <gender>ç”·</gender>
        <email>wuda@itcast.cn</email>
    </contact>
</contactList>
```



****



### XPath

> Dom4Jå¯ä»¥ç”¨äºè§£ææ•´ä¸ªXMLçš„æ•°æ®ã€‚ä½†æ˜¯å¦‚æœè¦æ£€ç´¢XMLä¸­çš„æŸäº›ä¿¡æ¯ï¼Œå»ºè®®ä½¿ç”¨XPath.

XPathä½¿ç”¨æ­¥éª¤ï¼š
    1.å¯¼å…¥dom4jæ¡†æ¶ã€‚ï¼ˆXPathä¾èµ–äºDom4jæŠ€æœ¯,å¿…é¡»å…ˆå€’å…¥dom4jæ¡†æ¶ï¼ï¼‰
    2.å¯¼å…¥XPathç‹¬æœ‰çš„æ¡†æ¶åŒ…ã€‚jaxen-1.1.2.jar
XPathå¸¸ç”¨API:
    List<Node> selectNodes(String var1) : æ£€ç´¢å‡ºä¸€æ‰¹èŠ‚ç‚¹é›†åˆã€‚
    Node selectSingleNode(String var1) : æ£€ç´¢å‡ºä¸€ä¸ªèŠ‚ç‚¹è¿”å›ã€‚
XPathæä¾›çš„å››ç§æ£€ç´¢æ•°æ®çš„å†™æ³•ï¼š
	1.ç»å¯¹è·¯å¾„ï¼š /æ ¹å…ƒç´ /å­å…ƒç´ /å­å…ƒç´ ã€‚
	2.ç›¸å¯¹è·¯å¾„ï¼š ./å­å…ƒç´ /å­å…ƒç´ ã€‚ (.ä»£è¡¨äº†å½“å‰å…ƒç´ )
	3.å…¨æ–‡æœç´¢ï¼š
       	//å…ƒç´   åœ¨å…¨æ–‡æ‰¾è¿™ä¸ªå…ƒç´ 
     	  //å…ƒç´ 1/å…ƒç´ 2  åœ¨å…¨æ–‡æ‰¾å…ƒç´ 1ä¸‹é¢çš„ä¸€çº§å…ƒç´ 2
      	 //å…ƒç´ 1//å…ƒç´ 2  åœ¨å…¨æ–‡æ‰¾å…ƒç´ 1ä¸‹é¢çš„å…¨éƒ¨å…ƒç´ 2
	4.å±æ€§æŸ¥æ‰¾ã€‚
      	//@å±æ€§åç§°  åœ¨å…¨æ–‡æ£€ç´¢å±æ€§å¯¹è±¡ã€‚
       	//å…ƒç´ [@å±æ€§åç§°]  åœ¨å…¨æ–‡æ£€ç´¢åŒ…å«è¯¥å±æ€§çš„å…ƒç´ å¯¹è±¡ã€‚
      	 //å…ƒç´ [@å±æ€§åç§°=å€¼]  åœ¨å…¨æ–‡æ£€ç´¢åŒ…å«è¯¥å±æ€§çš„å…ƒç´ ä¸”å±æ€§å€¼ä¸ºè¯¥å€¼çš„å…ƒç´ å¯¹è±¡ã€‚

```java
public class XPathDemo {
    public static void main(String[] args) throws Exception {
        SAXReader saxReader = new SAXReader();
        InputStream is = XPathDemo.class.getResourceAsStream("/Contact.xml");
        Document document = saxReader.read(is);
        //1.ä½¿ç”¨ç»å¯¹è·¯å¾„å®šä½å…¨éƒ¨çš„nameåç§°
        List<Node> nameNodes1 = document.selectNodes("/contactList/contact/name");
        for (Node nameNode : nameNodes) {
            System.out.println(nameNode.getText());
        }
        
        //2.ç›¸å¯¹è·¯å¾„ã€‚ä»æ ¹å…ƒç´ å¼€å§‹æ£€ç´¢ï¼Œ.ä»£è¡¨å¾ˆæ ¹å…ƒç´ 
        List<Node> nameNodes2 = root.selectNodes("./contact/name");
        
        //3.1 åœ¨å…¨æ–‡ä¸­æ£€ç´¢nameèŠ‚ç‚¹
        List<Node> nameNodes3 = root.selectNodes("//name");//å…¨éƒ¨çš„
        //3.2 åœ¨å…¨æ–‡ä¸­æ£€ç´¢æ‰€æœ‰contactä¸‹çš„æ‰€æœ‰nameèŠ‚ç‚¹  //åŒ…æ‹¬sqlï¼Œä¸å¤–é¢çš„
        List<Node> nameNodes3 = root.selectNodes("//contact//name");
        //3.3 åœ¨å…¨æ–‡ä¸­æ£€ç´¢æ‰€æœ‰contactä¸‹çš„ç›´æ¥nameèŠ‚ç‚¹
        List<Node> nameNodes3 = root.selectNodes("//contact/name");//ä¸åŒ…æ‹¬sqlå’Œå¤–é¢
        
        //4.1 æ£€ç´¢å…¨éƒ¨å±æ€§å¯¹è±¡
        List<Node> attributes1 = root.selectNodes("//@id");//åŒ…æ‹¬sql4
        //4.2 åœ¨å…¨æ–‡æ£€ç´¢åŒ…å«è¯¥å±æ€§çš„å…ƒç´ å¯¹è±¡
        List<Node> attributes1 = root.selectNodes("//contact[@id]");
        //4.3 åœ¨å…¨æ–‡æ£€ç´¢åŒ…å«è¯¥å±æ€§çš„å…ƒç´ ä¸”å±æ€§å€¼ä¸ºè¯¥å€¼çš„å…ƒç´ å¯¹è±¡
        Node nodeEle = document.selectSingleNode("//contact[@id=2]");
        Element ele = (Element)nodeEle;
        System.out.println(ele.elementTextTrim("name"));//æ­¦æ¾
    }
}
```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<contactList>
<contact id="1">
    <name>æ½˜é‡‘è²</name>
    <gender>å¥³</gender>
    <email>panpan@itcast.cn</email>
</contact>
<contact id="2">
    <name>æ­¦æ¾</name>
    <gender>ç”·</gender>
    <email>wusong@itcast.cn</email>
    <sql id="sql4">
        <name>sqlè¯­å¥</name>
    </sql>
</contact>
<contact id="3">
    <name>æ­¦å¤§ç‹¼</name>
    <gender>ç”·</gender>
    <email>wuda@itcast.cn</email>
</contact>
<contact></contact>
<name>å¤–é¢çš„åç§°</name>
</contactList>
```







***



# JVM

## JVMæ¦‚è¿°

### åŸºæœ¬ä»‹ç»

JVMï¼šå…¨ç§°Java Virtual Machineï¼Œå³Javaè™šæ‹Ÿæœºï¼Œæœ¬èº«æ˜¯ä¸€ä¸ªè™šæ‹Ÿè®¡ç®—æœº

ç‰¹ç‚¹ï¼š

* Javaè™šæ‹ŸæœºåŸºäº**äºŒè¿›åˆ¶å­—èŠ‚ç **æ‰§è¡Œï¼Œç”±ä¸€å¥—å­—èŠ‚ç æŒ‡ä»¤é›†ã€ä¸€ç»„å¯„å­˜å™¨ã€ä¸€ä¸ªæ ˆã€ä¸€ä¸ªåƒåœ¾å›æ”¶å †ã€ä¸€ä¸ªæ–¹æ³•åŒºç­‰ç»„æˆ
* JVMå±è”½äº†ä¸æ“ä½œç³»ç»Ÿå¹³å°ç›¸å…³çš„ä¿¡æ¯ï¼Œä»è€Œèƒ½å¤Ÿè®©Javaç¨‹åºåªéœ€è¦ç”Ÿæˆèƒ½å¤Ÿåœ¨JVMä¸Šè¿è¡Œçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œé€šè¿‡è¯¥æœºåˆ¶å®ç°çš„**è·¨å¹³å°æ€§**

JVMç»“æ„ï¼š

<img src="https://gitee.com/seazean/images/raw/master/JavaSE/JVM-æ¦‚è¿°å›¾.png" style="zoom: 80%;" />

JVMã€JREã€JDKå¯¹æ¯”ï¼š

<img src="https://gitee.com/seazean/images/raw/master/JavaSE/JVM-JREå…³ç³».png" style="zoom: 80%;" />



***



### ç”Ÿå‘½å‘¨æœŸ

JVMçš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä¸ºï¼šå¯åŠ¨ã€è¿è¡Œã€æ­»äº¡ã€‚

- **å¯åŠ¨**ï¼šå½“å¯åŠ¨ä¸€ä¸ªJavaç¨‹åºæ—¶ï¼ŒJVMçš„å®ä¾‹å°±å·²ç»äº§ç”Ÿï¼Œå¯¹äºæ‹¥æœ‰mainå‡½æ•°çš„ç±»å°±æ˜¯JVMå®ä¾‹è¿è¡Œçš„èµ·ç‚¹ã€‚

- **è¿è¡Œ**ï¼šmain()æ–¹æ³•æ˜¯ä¸€ä¸ªç¨‹åºçš„åˆå§‹èµ·ç‚¹ï¼Œä»»ä½•çº¿ç¨‹å‡å¯ç”±åœ¨æ­¤å¤„å¯åŠ¨ã€‚åœ¨JVMå†…éƒ¨æœ‰ä¸¤ç§çº¿ç¨‹ç±»å‹ï¼Œåˆ†åˆ«ä¸ºï¼š**ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹**ã€‚JVMé€šå¸¸ä½¿ç”¨çš„æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œè€Œmain()ä½¿ç”¨çš„åˆ™æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¼šéšç€ç”¨æˆ·çº¿ç¨‹çš„ç»“æŸè€Œç»“æŸã€‚

- **æ­»äº¡**ï¼šå½“ç¨‹åºä¸­çš„ç”¨æˆ·çº¿ç¨‹éƒ½ä¸­æ­¢ï¼ŒJVMæ‰ä¼šé€€å‡º



***



### å†…å­˜ç»“æ„

#### å†…å­˜æ¦‚è¿°

JVMå†…å­˜ç»“æ„æ˜¯JVMä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”åœ¨JDK7å’ŒJDK8ä¸­ä¹Ÿè¿›è¡Œäº†ä¸€äº›æ”¹åŠ¨ã€‚å†…å­˜æ˜¯éå¸¸é‡è¦çš„ç³»ç»Ÿèµ„æºï¼Œæ˜¯ç¡¬ç›˜å’Œ CPU çš„ä¸­é—´ä»“åº“åŠæ¡¥æ¢ï¼Œæ‰¿è½½ç€æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„å®æ—¶è¿è¡Œ

JVM å†…å­˜ç»“æ„è§„å®šäº† Java åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å†…å­˜ç”³è¯·ã€åˆ†é…ã€ç®¡ç†çš„ç­–ç•¥ï¼Œä¿è¯äº† JVM çš„é«˜æ•ˆç¨³å®šè¿è¡Œ

Java**åç¼–è¯‘**æŒ‡ä»¤ï¼š`javap -v Test.class`

* Java1.8ä»¥å‰çš„å†…å­˜ç»“æ„å›¾ï¼š
  ![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-Java7å†…å­˜ç»“æ„å›¾.png)

* Java1.8ä¹‹åçš„å†…å­˜ç»“æœå›¾ï¼š

  ![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-Java8å†…å­˜ç»“æ„å›¾.png)



***



#### è™šæ‹Ÿæœºæ ˆ

Java è™šæ‹Ÿæœºæ ˆï¼šJava Virtual Machine Stacksï¼Œ**æ¯ä¸ªçº¿ç¨‹**è¿è¡Œæ—¶æ‰€éœ€è¦çš„å†…å­˜

* è™šæ‹Ÿæœºæ ˆæ—¶çº¿ç¨‹ç§æœ‰çš„ï¼Œå¯¹åº”æ–¹æ³•è°ƒç”¨åˆ°æ‰§è¡Œå®Œæˆçš„æ•´ä¸ªè¿‡ç¨‹

* ä¿å­˜æ‰§è¡Œæ–¹æ³•æ—¶çš„**å±€éƒ¨å˜é‡è¡¨ã€å¸¸é‡æ± å¼•ç”¨ã€æ–¹æ³•è¿”å›åœ°å€ä¿¡æ¯**ç­‰

* æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜

* æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•

  <img src="https://gitee.com/seazean/images/raw/master/JavaSE/JVM-è™šæ‹Ÿæœºæ ˆ.png" style="zoom:50%;" />

è®¾ç½®æ ˆå†…å­˜å¤§å°ï¼š`-Xss size`   `-Xss 1024k`

* è¿›å…¥ Run/Debug Configurations   ---> VM options è®¾ç½®å‚æ•°
* åœ¨ JDK 1.4 ä¸­é»˜è®¤ä¸º 256Kï¼Œè€Œåœ¨ JDK 1.5+ é»˜è®¤ä¸º 1M

è™šæ‹Ÿæœºæ ˆç‰¹ç‚¹ï¼š

* æ ˆå†…å­˜**ä¸éœ€è¦è¿›è¡ŒGC**ï¼Œæ–¹æ³•å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ä¼šè¿›æ ˆï¼Œæ–¹æ³•è°ƒç”¨åè‡ªåŠ¨å¼¹æ ˆï¼Œç›¸å½“äºæ¸…ç©ºäº†æ•°æ®

* æ ˆå†…å­˜åˆ†é…è¶Šå¤§è¶Šå¤§ï¼Œå¯ç”¨çš„çº¿ç¨‹æ•°è¶Šå°‘

* æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦**çº¿ç¨‹å®‰å…¨**ï¼š
  * å¦‚æœæ–¹æ³•å†…å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨è®¿é—®ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„
  * å¦‚æœæ˜¯å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡ï¼Œå¹¶é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨

å¼‚å¸¸ï¼š

* æ ˆå¸§è¿‡å¤šå¯¼è‡´æ ˆå†…å­˜æº¢å‡º ï¼ˆè¶…è¿‡äº†æ ˆçš„å®¹é‡ï¼‰ï¼Œä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸
* å½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡æœ€å¤§å€¼ï¼Œä¼šæŠ›å‡º StackOverflowError å¼‚å¸¸

çº¿ç¨‹è¿è¡Œè¯Šæ–­ï¼š

* å®šä½ï¼šç”¨topå®šä½å“ªä¸ªè¿›ç¨‹å¯¹cpuçš„å ç”¨è¿‡é«˜
* ps H -eo pid,tid,%cpu | grep è¿›ç¨‹id ï¼ˆç”¨pså‘½ä»¤è¿›ä¸€æ­¥å®šä½æ˜¯å“ªä¸ªçº¿ç¨‹å¼•èµ·çš„cpuå ç”¨è¿‡é«˜ï¼‰

* jstack è¿›ç¨‹idï¼šå¯ä»¥æ ¹æ®çº¿ç¨‹id æ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ï¼Œè¿›ä¸€æ­¥å®šä½åˆ°é—®é¢˜ä»£ç çš„æºç è¡Œå·





#### æœ¬åœ°æ–¹æ³•æ ˆ

æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºè™šæ‹Ÿæœº**æ‰§è¡Œæœ¬åœ°æ–¹æ³•æ—¶æä¾›æœåŠ¡çš„**ã€‚

* ä¸éœ€è¦è¿›è¡ŒGCï¼Œä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼

* æœ¬åœ°æ–¹æ³•ä¸€èˆ¬æ˜¯ç”±å…¶ä»–è¯­è¨€ç¼–å†™ï¼Œå¹¶ä¸”è¢«ç¼–è¯‘ä¸ºåŸºäºæœ¬æœºç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„ç¨‹åºï¼Œå¯¹è¿™äº›æ–¹æ³•éœ€è¦ç‰¹åˆ«å¤„ç†

  <img src="https://gitee.com/seazean/images/raw/master/JavaSE/JVM-æœ¬åœ°æ–¹æ³•æ ˆ.png" style="zoom:67%;" />



***



#### ç¨‹åºè®¡æ•°å™¨

Program Counter Register ç¨‹åºè®¡æ•°å™¨ï¼ˆå¯„å­˜å™¨ï¼‰

ä½œç”¨ï¼šå†…éƒ¨ä¿å­˜å­—èŠ‚ç çš„è¡Œå·ï¼Œç”¨äºè®°å½•æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼ˆå¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯æœ¬åœ°æ–¹æ³•åˆ™ä¸ºç©ºï¼‰

åŸç†ï¼š

* javaè™šæ‹Ÿæœºå¯¹äºå¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶ä¸”åˆ†é…çº¿ç¨‹æ‰§è¡Œæ—¶é—´ï¼Œä¸€ä¸ªå¤„ç†å™¨åªä¼šå¤„ç†æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹
* åˆ‡æ¢çº¿ç¨‹éœ€è¦ä»ç¨‹åºè®¡æ•°å™¨ä¸­æ¥å›å»åˆ°å½“å‰çš„çº¿ç¨‹ä¸Šä¸€æ¬¡æ‰§è¡Œçš„è¡Œå·

ç‰¹ç‚¹ï¼š

* æ˜¯çº¿ç¨‹ç§æœ‰çš„
* ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡ºï¼Œæ˜¯JVMè§„èŒƒä¸­å”¯ä¸€ä¸€ä¸ªä¸å‡ºç°OOMçš„åŒºåŸŸï¼Œæ‰€ä»¥è¿™ä¸ªç©ºé—´ä¸ä¼šè¿›è¡ŒGC

#20ï¼šå»Constant poolæŸ¥çœ‹è¯¥åœ°å€çš„æŒ‡ä»¤

```java
0: getstatic #20 		// PrintStream out = System.out;
3: astore_1 			// --
4: aload_1 				// out.println(1);
5: iconst_1 			// --
6: invokevirtual #26 	// --
9: aload_1 				// out.println(2);
10: iconst_2 			// --
11: invokevirtual #26 	// --
```



****



#### å †

Heap å †ï¼šç”¨æ¥ä¿å­˜**å¯¹è±¡å®ä¾‹ï¼Œæ•°ç»„**ç­‰ï¼Œé€šè¿‡ new åˆ›å»ºå¯¹è±¡éƒ½ä¼šä½¿ç”¨å †å†…å­˜ï¼Œæ˜¯åƒåœ¾æ”¶é›†çš„ä¸»è¦åŒºåŸŸï¼ˆ"GC å †"ï¼‰

ç‰¹ç‚¹ï¼š

* å®ƒæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå †ä¸­å¯¹è±¡éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜
* æœ‰åƒåœ¾å›æ”¶æœºåˆ¶

è®¾ç½®å †å†…å­˜æŒ‡ä»¤ï¼š`-Xmx Size`

å†…å­˜æº¢å‡ºï¼šnewå‡ºå¯¹è±¡ï¼Œå¾ªç¯æ·»åŠ å­—ç¬¦æ•°æ®ï¼Œå½“å †ä¸­æ²¡æœ‰å†…å­˜ç©ºé—´å¯åˆ†é…ç»™å®ä¾‹ï¼Œä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼Œå°±ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸

å †å†…å­˜è¯Šæ–­å·¥å…·ï¼šï¼ˆæ§åˆ¶å°å‘½ä»¤ï¼‰

1. jpsï¼šæŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æœ‰å“ªäº› java è¿›ç¨‹
2. jmapï¼šæŸ¥çœ‹å †å†…å­˜å ç”¨æƒ…å†µ `jhsdb jmap --heap --pid è¿›ç¨‹id`
3. jconsoleï¼šå›¾å½¢ç•Œé¢çš„ï¼Œå¤šåŠŸèƒ½çš„ç›‘æµ‹å·¥å…·ï¼Œå¯ä»¥è¿ç»­ç›‘æµ‹

```java
public static void main(String[] args) throws InterruptedException {
    System.out.println("1...");
    Thread.sleep(30000);
    byte[] array = new byte[1024 * 1024 * 10]; // 10 Mb
    System.out.println("2...");
    Thread.sleep(20000);
    array = null;
    System.gc();
    System.out.println("3...");
    Thread.sleep(1000000L);
}
```

åœ¨Java7ä¸­å †å†…ä¼šå­˜åœ¨**å¹´è½»ä»£ã€è€å¹´ä»£å’Œæ–¹æ³•åŒº(æ°¸ä¹…ä»£)**ï¼š

* YoungåŒºè¢«åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼ŒEdenåŒºå’Œä¸¤ä¸ªå¤§å°ä¸¥æ ¼ç›¸åŒçš„SurvivoråŒºã€‚SurvivoråŒºé—´ï¼ŒæŸä¸€æ—¶åˆ»åªæœ‰å…¶ä¸­ä¸€ä¸ªæ˜¯è¢«ä½¿ç”¨çš„ï¼Œå¦å¤–ä¸€ä¸ªç•™åšåƒåœ¾å›æ”¶æ—¶å¤åˆ¶å¯¹è±¡ã€‚åœ¨EdenåŒºå˜æ»¡çš„æ—¶å€™ï¼Œ GCå°±ä¼šå°†å­˜æ´»çš„å¯¹è±¡ç§»åˆ°ç©ºé—²çš„SurvivoråŒºé—´ä¸­ï¼Œæ ¹æ®JVMçš„ç­–ç•¥ï¼Œåœ¨ç»è¿‡å‡ æ¬¡åƒåœ¾å›æ”¶åï¼Œä»ç„¶å­˜æ´»äºSurvivorçš„å¯¹è±¡å°†è¢«ç§»åŠ¨åˆ°TenuredåŒºé—´
* TenuredåŒºä¸»è¦ä¿å­˜ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯ä¸€äº›è€çš„å¯¹è±¡ï¼Œå½“ä¸€äº›å¯¹è±¡åœ¨Youngå¤åˆ¶è½¬ç§»ä¸€å®šçš„æ¬¡æ•°ä»¥åï¼Œå¯¹è±¡å°±ä¼šè¢«è½¬ç§»åˆ°TenuredåŒº
* Permä»£ä¸»è¦ä¿å­˜**Classã€ClassLoaderã€é™æ€å˜é‡ã€å¸¸é‡ã€ç¼–è¯‘åçš„ä»£ç **ï¼Œåœ¨java7ä¸­å †å†…æ–¹æ³•åŒºä¼šå—åˆ°GCçš„ç®¡ç†ã€‚



***



#### æ–¹æ³•åŒº

æ–¹æ³•åŒº / æ°¸ä¹…ä»£ï¼šåœ¨HotSpot JVMä¸­ï¼Œç”¨äºå­˜æ”¾å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡æ± ã€é™æ€å˜é‡ä»¥åŠå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ï¼Œæ¯å½“ä¸€ä¸ªç±»åˆæ¬¡è¢«åŠ è½½æ—¶ï¼Œå®ƒçš„**å…ƒæ•°æ®**éƒ½ä¼šæ”¾åˆ°æ°¸ä¹…ä»£ä¸­

æ–¹æ³•åŒºæ˜¯ä¸€ä¸ª JVM è§„èŒƒï¼Œ**æ°¸ä¹…ä»£ä¸å…ƒç©ºé—´éƒ½æ˜¯å…¶ä¸€ç§å®ç°æ–¹å¼**

æ–¹æ³•åŒºå’Œå †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€æ‰©å±•ï¼›æ–¹æ³•åŒºæœ‰å¤§å°é™åˆ¶ï¼Œå› æ­¤åŠ è½½çš„ç±»å¤ªå¤šï¼Œå¯èƒ½å¯¼è‡´æ°¸ä¹…ä»£å†…å­˜æº¢å‡º (OutOfMemoryError)ï¼›å¯¹è¿™å—åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ä¸»è¦æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ï¼Œæ¯”è¾ƒéš¾å®ç°

ä¸ºäº†**é¿å…æ–¹æ³•åŒºå‡ºç°OOM**ï¼Œåœ¨JDK8ä¸­å°†å †å†…çš„æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ï¼‰ç§»åŠ¨åˆ°äº†æœ¬åœ°å†…å­˜ä¸Šï¼Œé‡æ–°å¼€è¾Ÿäº†ä¸€å—ç©ºé—´ï¼Œå«åš**å…ƒç©ºé—´**ï¼Œå…ƒç©ºé—´å­˜å‚¨ç±»çš„å…ƒä¿¡æ¯ï¼Œé™æ€å˜é‡å’Œå¸¸é‡æ± ç­‰æ”¾å…¥å †ä¸­



**è¿è¡Œæ—¶å¸¸é‡æ± **æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†

* Class æ–‡ä»¶ä¸­çš„å¸¸é‡æ± ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼‰ä¼šåœ¨ç±»åŠ è½½åè¢«æ”¾å…¥è¿™ä¸ªåŒºåŸŸ
* é™¤äº†åœ¨ç¼–è¯‘æœŸç”Ÿæˆçš„å¸¸é‡ï¼Œè¿˜å…è®¸åŠ¨æ€ç”Ÿæˆï¼Œä¾‹å¦‚ String ç±»çš„ intern()



***



#### æœ¬åœ°å†…å­˜

##### æœ¬åœ°å†…å­˜

æœ¬åœ°å†…å­˜ï¼šåˆå«åš**å †å¤–å†…å­˜**ï¼Œçº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œæœ¬åœ°å†…å­˜è¿™å—åŒºåŸŸæ˜¯ä¸ä¼šå—åˆ°JVMçš„æ§åˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºè¿™å—åŒºåŸŸæ˜¯ä¸ä¼šå‘ç”ŸGCçš„ï¼Œå› æ­¤å¯¹äºæ•´ä¸ªjavaçš„æ‰§è¡Œæ•ˆç‡æ˜¯æå‡éå¸¸å¤§

å¸¸é‡æ± ï¼š

* å¸¸é‡æ± ï¼Œå°±æ˜¯ä¸€å¼ è¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ç­‰ä¿¡æ¯
* è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¸¸é‡æ± æ˜¯ *.class æ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥ç±»è¢«åŠ è½½ï¼Œå®ƒçš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼šæ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¹¶æŠŠé‡Œé¢çš„ç¬¦å·åœ°å€å˜ä¸ºçœŸå®åœ°å€

æœ¬åœ°å†…å­˜æ¦‚è¿°å›¾ï¼š

<img src="https://gitee.com/seazean/images/raw/master/JavaSE/JVM-å†…å­˜å›¾å¯¹æ¯”.png" style="zoom: 67%;" />



***



##### å…ƒç©ºé—´

PermGen è¢«å…ƒç©ºé—´ä»£æ›¿ï¼Œå…¶ä»–å†…å®¹æ¯”å¦‚**ç±»ä¿¡æ¯ã€å­—æ®µã€é™æ€å±æ€§ã€æ–¹æ³•ã€å¸¸é‡æ± **ç­‰éƒ½ç§»åŠ¨åˆ°å…ƒç©ºé—´åŒºï¼Œå…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹ JVM è§„èŒƒä¸­æ–¹æ³•åŒºçš„å®ç°

å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œä½¿ç”¨çš„æœ¬åœ°å†…å­˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶

æ–¹æ³•åŒºå†…å­˜æº¢å‡ºï¼š

* JDK1.8ä»¥å‰ä¼šå¯¼è‡´æ°¸ä¹…ä»£å†…å­˜æº¢å‡º

  ```sh
  #æ¼”ç¤ºæ°¸ä¹…ä»£å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: PerGen space
  -XX:MaxPermSize=8m
  ```

* JDK1.8ä»¥åä¼šå¯¼è‡´å…ƒç©ºé—´å†…å­˜æº¢å‡º

  ```sh
  #æ¼”ç¤ºå…ƒç©ºé—´å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: Metaspace
  -XX:MaxMetaspaceSize=8m
  ```

åœºæ™¯ï¼šspringã€mybatis

å…ƒç©ºé—´å†…å­˜æº¢å‡ºæ¼”ç¤ºï¼š

```java
public class Demo1_8 extends ClassLoader { // å¯ä»¥ç”¨æ¥åŠ è½½ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç 
    public static void main(String[] args) {
        int j = 0;
        try {
            Demo1_8 test = new Demo1_8();
            for (int i = 0; i < 10000; i++, j++) {
                // ClassWriter ä½œç”¨æ˜¯ç”Ÿæˆç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç 
                ClassWriter cw = new ClassWriter(0);
                // ç‰ˆæœ¬å·ï¼Œ publicï¼Œ ç±»å, åŒ…å, çˆ¶ç±»ï¼Œ æ¥å£
                cw.visit(Opcodes.V1_8, Opcodes.ACC_PUBLIC, "Class" + i, null, "java/lang/Object", null);
                // è¿”å› byte[]
                byte[] code = cw.toByteArray();
                // æ‰§è¡Œäº†ç±»çš„åŠ è½½
                test.defineClass("Class" + i, code, 0, code.length); // Class å¯¹è±¡
            }
        } finally {
            System.out.println(j);
        }
    }
}
```



***



##### ç›´æ¥å†…å­˜

Direct Memoryç‰¹ç‚¹ï¼š

* å¸¸è§äº NIO æ“ä½œæ—¶ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒº
* åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜
* ä¸å— JVM å†…å­˜å›æ”¶ç®¡ç†

åˆ†é…å’Œå›æ”¶åŸç†ï¼š

* ä½¿ç”¨äº† Unsafe å¯¹è±¡å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å›æ”¶ï¼Œå¹¶ä¸”å›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨ freeMemory æ–¹æ³•
* ByteBuffer çš„å®ç°ç±»å†…éƒ¨ï¼Œä½¿ç”¨äº† Cleaner ï¼ˆè™šå¼•ç”¨ï¼‰æ¥ç›‘æµ‹ ByteBuffer å¯¹è±¡ï¼Œä¸€æ—¦ByteBuffer å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šç”± ReferenceHandler çº¿ç¨‹é€šè¿‡ Cleaner çš„ clean æ–¹æ³•è°ƒç”¨ freeMemory æ¥é‡Šæ”¾ç›´æ¥å†…å­˜

<img src="https://gitee.com/seazean/images/raw/master/JavaSE/JVM-ç›´æ¥å†…å­˜.png" style="zoom:50%;" />

```java
/**
 * ç›´æ¥å†…å­˜åˆ†é…çš„åº•å±‚åŸç†ï¼šUnsafe
 */
public class Demo1_27 {
    static int _1Gb = 1024 * 1024 * 1024;

    public static void main(String[] args) throws IOException {
        Unsafe unsafe = getUnsafe();
        // åˆ†é…å†…å­˜
        long base = unsafe.allocateMemory(_1Gb);
        unsafe.setMemory(base, _1Gb, (byte) 0);
        System.in.read();
        // é‡Šæ”¾å†…å­˜
        unsafe.freeMemory(base);
        System.in.read();
    }

    public static Unsafe getUnsafe() {
        try {
            Field f = Unsafe.class.getDeclaredField("theUnsafe");
            f.setAccessible(true);
            Unsafe unsafe = (Unsafe) f.get(null);
            return unsafe;
        } catch (NoSuchFieldException | IllegalAccessException e) {
            throw new RuntimeException(e);
        }
    }
}
```



***



### VMå‚æ•°

| å‚æ•°                                                         | åŠŸèƒ½                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| -Xms                                                         | å †åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/64ï¼‰                           |
| -Xmx æˆ– -XX:MaxHeapSize=size                                 | å †æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/4ï¼‰                            |
| -Xmn æˆ– -XX:NewSize=size + -XX:MaxNewSize=size               | æ–°ç”Ÿä»£å¤§å°ï¼ˆåˆå§‹å€¼åŠæœ€å¤§å€¼ï¼‰                                 |
| -XX:NewRatio                                                 | æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”                                 |
| -XX:SurvivorRatio=ratio                                      | å¹¸å­˜åŒºæ¯”ä¾‹ï¼ˆEdenå’ŒS0/S1ç©ºé—´çš„æ¯”ä¾‹ï¼‰                          |
| -XX:InitialSurvivorRatio=ratio å’Œ -XX:+UseAdaptiveSizePolicy | å¹¸å­˜åŒºæ¯”ä¾‹ï¼ˆåŠ¨æ€ï¼‰                                           |
| -XX:MaxTenuringThreshold=threshold                           | æ™‹å‡é˜ˆå€¼                                                     |
| -XX:+PrintTenuringDistribution                               | æ™‹å‡è¯¦æƒ…                                                     |
| -XX:+PrintFlagsInitial                                       | æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼                                   |
| -XX:+PrintFlagsFinal                                         | æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„æœ€ç»ˆå€¼<br />ï¼ˆå¯èƒ½ä¼šå­˜åœ¨ä¿®æ”¹ï¼Œä¸å†æ˜¯åˆå§‹å€¼ï¼‰ |
| -XX:+PrintGCDetails                                          | GCè¯¦æƒ…ï¼Œæ‰“å°gcç®€è¦ä¿¡æ¯ï¼š<br />1. -XXï¼š+PrintGC   2. - verbose:gc |
| -XX:+ScavengeBeforeFullGC                                    | FullGC å‰ MinorGC                                            |
| -XX:+DisableExplicitGC                                       | ç¦ç”¨æ˜¾å¼åƒåœ¾å›æ”¶ï¼Œè®©System.gcæ— æ•ˆ                            |



***





## å†…å­˜ç®¡ç†

### åˆ†ä»£æ€æƒ³

#### åˆ†ä»£æ¦‚è¿°

åœ¨java8æ—¶ï¼Œå †è¢«åˆ†ä¸ºäº†ä¸¤ä»½ï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼ˆ1ï¼š2ï¼‰ï¼Œåœ¨java7æ—¶ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ªæ°¸ä¹…ä»£

- æ–°ç”Ÿä»£ä½¿ç”¨ï¼šå¤åˆ¶ç®—æ³•
- è€å¹´ä»£ä½¿ç”¨ï¼šæ ‡è®° - æ¸…é™¤ æˆ–è€… æ ‡è®° - æ•´ç† ç®—æ³•

**Minor GC å’Œ Full GC**ï¼š

- Minor GCï¼šå›æ”¶æ–°ç”Ÿä»£ï¼Œå› ä¸ºæ–°ç”Ÿä»£å¯¹è±¡å­˜æ´»æ—¶é—´å¾ˆçŸ­ï¼Œå› æ­¤ Minor GC ä¼šé¢‘ç¹æ‰§è¡Œï¼Œæ‰§è¡Œçš„é€Ÿåº¦ä¸€èˆ¬ä¹Ÿä¼šæ¯”è¾ƒå¿«ã€‚
- Full GCï¼šå›æ”¶è€å¹´ä»£å’Œæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å¯¹è±¡å…¶å­˜æ´»æ—¶é—´é•¿ï¼Œå› æ­¤ Full GC å¾ˆå°‘æ‰§è¡Œï¼Œæ‰§è¡Œé€Ÿåº¦ä¼šæ¯” Minor GC æ…¢å¾ˆå¤š

 Eden å’Œ Survivor å¤§å°æ¯”ä¾‹é»˜è®¤ä¸º 8:1:1

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-åˆ†ä»£æ”¶é›†ç®—æ³•.png)





***



#### å›æ”¶ç­–ç•¥

å¯¹äº Minor GCï¼Œå…¶è§¦å‘æ¡ä»¶éå¸¸ç®€å•ï¼Œå½“ Eden ç©ºé—´æ»¡æ—¶ï¼Œå°±å°†è§¦å‘ä¸€æ¬¡ Minor GC

Full GC åˆ™ç›¸å¯¹å¤æ‚ï¼Œ**FullGCåŒæ—¶å›æ”¶æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå½“å‰åªä¼šå­˜åœ¨ä¸€ä¸ªFullGCçš„çº¿ç¨‹è¿›è¡Œæ‰§è¡Œï¼Œå…¶ä»–çš„çº¿ç¨‹å…¨éƒ¨ä¼šè¢«æŒ‚èµ·**

æœ‰ä»¥ä¸‹**è§¦å‘æ¡ä»¶**ï¼š

* è°ƒç”¨ System.gc()ï¼š

  * ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œåº”è¯¥è®©è™šæ‹Ÿæœºç®¡ç†å†…å­˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåƒåœ¾å›æ”¶åº”è¯¥æ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ— é¡»æ‰‹åŠ¨è§¦å‘ã€‚åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦‚æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ€§èƒ½åŸºå‡†ï¼Œå¯ä»¥åœ¨è¿è¡Œä¹‹é—´è°ƒç”¨System.gc() 
  * åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡system.gcï¼ˆï¼‰è€…Runtime.getRuntime().gc() çš„è°ƒç”¨ï¼Œä¼šæ˜¾å¼è§¦å‘FullGCï¼ŒåŒæ—¶å¯¹è€å¹´ä»£å’Œæ–°ç”Ÿä»£è¿›è¡Œå›æ”¶ï¼Œå°è¯•é‡Šæ”¾è¢«ä¸¢å¼ƒå¯¹è±¡å ç”¨çš„å†…å­˜ï¼Œä½†æ˜¯è™šæ‹Ÿæœºä¸ä¸€å®šçœŸæ­£å»æ‰§è¡Œï¼Œæ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨

* è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼š

  * ä¸ºäº†é¿å…å¼•èµ·çš„ Full GCï¼Œåº”å½“å°½é‡ä¸è¦åˆ›å»ºè¿‡å¤§çš„å¯¹è±¡ä»¥åŠæ•°ç»„
  * é€šè¿‡ -Xmn è™šæ‹Ÿæœºå‚æ•°è°ƒå¤§æ–°ç”Ÿä»£çš„å¤§å°ï¼Œè®©å¯¹è±¡å°½é‡åœ¨æ–°ç”Ÿä»£è¢«å›æ”¶æ‰ï¼Œä¸è¿›å…¥è€å¹´ä»£ã€‚è¿˜å¯ä»¥é€šè¿‡ -XX:MaxTenuringThreshold è°ƒå¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„ï¼Œè®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»ä¸€æ®µæ—¶é—´

* ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥ï¼š

* JDK 1.7 åŠä»¥å‰çš„æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³ï¼š

  * åœ¨ JDK 1.7 åŠä»¥å‰ï¼ŒHotSpot è™šæ‹Ÿæœºä¸­çš„æ–¹æ³•åŒºæ˜¯ç”¨æ°¸ä¹…ä»£å®ç°çš„ï¼Œæ°¸ä¹…ä»£ä¸­å­˜æ”¾çš„ä¸ºä¸€äº› Class çš„ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ã€‚å½“ç³»ç»Ÿä¸­è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒç”¨çš„æ–¹æ³•è¾ƒå¤šæ—¶ï¼Œæ°¸ä¹…ä»£å¯èƒ½ä¼šè¢«å æ»¡ï¼Œåœ¨æœªé…ç½®ä¸ºé‡‡ç”¨ CMS GC çš„æƒ…å†µä¸‹ä¹Ÿä¼šæ‰§è¡Œ Full GCï¼Œå¦‚æœç»è¿‡ Full GC ä»ç„¶å›æ”¶ä¸äº†ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºä¼šæŠ›å‡º java.lang.OutOfMemoryError
  * å¯é‡‡ç”¨å¢å¤§æ°¸ä¹…ä»£ç©ºé—´æˆ–è½¬ä¸ºä½¿ç”¨ CMS GCæ¥é¿å…

* Concurrent Mode Failureï¼š

  æ‰§è¡Œ CMS GC çš„è¿‡ç¨‹ä¸­åŒæ—¶æœ‰å¯¹è±¡è¦æ”¾å…¥è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼ˆå¯èƒ½æ˜¯ GC è¿‡ç¨‹ä¸­æµ®åŠ¨åƒåœ¾è¿‡å¤šå¯¼è‡´æš‚æ—¶æ€§çš„ç©ºé—´ä¸è¶³ï¼‰ï¼Œä¾¿ä¼šæŠ¥ Concurrent Mode Failure é”™è¯¯ï¼Œå¹¶è§¦å‘ Full GC



***



### å†…å­˜åˆ†é…

#### åˆ†ä»£åˆ†é…

å·¥ä½œæœºåˆ¶ï¼š

* **å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åˆ†é…**ï¼šå½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡ä¼šè¢«åˆ†é…åœ¨æ–°ç”Ÿä»£çš„EdenåŒºï¼Œå½“EdenåŒºè¦æ»¡äº†æ—¶å€™ï¼Œè§¦å‘YoungGC

* å½“è¿›è¡ŒYoungGCåï¼Œæ­¤æ—¶åœ¨EdenåŒºå­˜æ´»çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°S0åŒºï¼Œå¹¶ä¸”**å½“å‰å¯¹è±¡çš„å¹´é¾„ä¼šåŠ 1**ï¼Œæ¸…ç©ºEdenåŒº

* å½“å†ä¸€æ¬¡è§¦å‘YoungGCçš„æ—¶å€™ï¼Œä¼šæŠŠEdenåŒºä¸­å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å’ŒS0ä¸­çš„å¯¹è±¡ï¼Œç§»åŠ¨åˆ°S1åŒºä¸­ï¼Œè¿™äº›å¯¹è±¡çš„å¹´é¾„ä¼šåŠ 1ï¼Œæ¸…ç©ºEdenåŒºå’ŒS0åŒº

* toåŒºæ°¸è¿œæ˜¯ç©ºSurvivoråŒºï¼ŒfromåŒºæ˜¯æœ‰æ•°æ®çš„ï¼Œæ¯æ¬¡MinorGCåä¸¤ä¸ªåŒºåŸŸäº’æ¢

æ™‹å‡åˆ°è€å¹´ä»£ï¼š

* **é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£**ï¼šä¸ºå¯¹è±¡å®šä¹‰å¹´é¾„è®¡æ•°å™¨ï¼Œå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ Minor GC ä¾ç„¶å­˜æ´»ï¼Œå°†ç§»åŠ¨åˆ° Survivor ä¸­ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå¢åŠ åˆ°ä¸€å®šå¹´é¾„åˆ™ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­
  * -XX:MaxTenuringThreshold ç”¨æ¥å®šä¹‰å¹´é¾„çš„é˜ˆå€¼
* **å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£**ï¼šéœ€è¦è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œæœ€å…¸å‹çš„å¤§å¯¹è±¡æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ï¼›é¿å…åœ¨ Eden å’Œ Survivor ä¹‹é—´çš„å¤§é‡å†…å­˜å¤åˆ¶ï¼›ç»å¸¸å‡ºç°å¤§å¯¹è±¡ä¼šæå‰è§¦å‘åƒåœ¾æ”¶é›†ä»¥è·å–è¶³å¤Ÿçš„è¿ç»­ç©ºé—´åˆ†é…ç»™å¤§å¯¹è±¡ï¼Œ
  * -XX:PretenureSizeThresholdï¼Œå¤§äºæ­¤å€¼çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…
* **åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š**ï¼šå¦‚æœåœ¨SurvivoråŒºä¸­ç›¸åŒå¹´é¾„çš„å¯¹è±¡çš„æ‰€æœ‰å¤§å°ä¹‹å’Œè¶…è¿‡Survivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£
* **ç©ºé—´åˆ†é…æ‹…ä¿**ï¼š
  * åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœæ¡ä»¶æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆ Minor GC å¯ä»¥ç¡®è®¤æ˜¯å®‰å…¨çš„
  * å¦‚æœä¸æˆç«‹ï¼Œè™šæ‹Ÿæœºä¼šæŸ¥çœ‹ HandlePromotionFailure çš„å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœå…è®¸é‚£ä¹ˆå°±ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•ç€è¿›è¡Œä¸€æ¬¡ Minor GCï¼›å¦‚æœå°äºï¼Œæˆ–è€… HandlePromotionFailure çš„å€¼ä¸å…è®¸å†’é™©ï¼Œé‚£ä¹ˆå°±è¦è¿›è¡Œä¸€æ¬¡ Full GCã€‚



***



#### TLAB

TLABï¼šThread Local Allocation Bufferï¼Œä¹Ÿå°±æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹å•ç‹¬åˆ†é…äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œå¤šçº¿ç¨‹åˆ†é…å†…å­˜æ—¶ï¼Œä½¿ç”¨TLABå¯ä»¥é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿæå‡å†…å­˜åˆ†é…çš„ååé‡ï¼Œè¿™ç§å†…å­˜åˆ†é…æ–¹å¼å«åš**å¿«é€Ÿåˆ†é…ç­–ç•¥**

- æ ˆä¸Šåˆ†é…ä½¿ç”¨çš„æ˜¯æ ˆæ¥è¿›è¡Œå¯¹è±¡å†…å­˜çš„åˆ†é…
- TLAB åˆ†é…ä½¿ç”¨çš„æ˜¯ Eden åŒºåŸŸè¿›è¡Œå†…å­˜åˆ†é…ï¼Œå±äºå †å†…å­˜

èƒŒæ™¯ï¼šå †åŒºæ˜¯çº¿ç¨‹å…±äº«åŒºåŸŸï¼Œä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®åˆ°å †åŒºä¸­çš„å…±äº«æ•°æ®ï¼Œç”±äºå¯¹è±¡å®ä¾‹çš„åˆ›å»ºåœ¨JVMä¸­éå¸¸é¢‘ç¹ï¼Œå› æ­¤åœ¨å¹¶å‘ç¯å¢ƒä¸‹ä¸ºé¿å…å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€åœ°å€ï¼Œéœ€è¦ä½¿ç”¨åŠ é”ç­‰æœºåˆ¶ï¼Œè¿›è€Œå½±å“åˆ†é…é€Ÿåº¦

é—®é¢˜ï¼šå †ç©ºé—´éƒ½æ˜¯å…±äº«çš„ä¹ˆï¼Ÿ ä¸ä¸€å®šï¼Œå› ä¸ºè¿˜æœ‰TLABï¼Œåœ¨å †ä¸­åˆ’åˆ†å‡ºä¸€å—åŒºåŸŸï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹æ‰€ç‹¬å 

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-TLABå†…å­˜åˆ†é…ç­–ç•¥.jpg)

JVMæ˜¯å°†TLABä½œä¸ºå†…å­˜åˆ†é…çš„é¦–é€‰ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½èƒ½å¤Ÿåœ¨TLABä¸­æˆåŠŸåˆ†é…å†…å­˜ï¼Œä¸€æ—¦å¯¹è±¡åœ¨TLABç©ºé—´åˆ†é…å†…å­˜å¤±è´¥æ—¶ï¼ŒJVMå°±ä¼šå°è¯•ç€é€šè¿‡**ä½¿ç”¨åŠ é”æœºåˆ¶ç¡®ä¿æ•°æ®æ“ä½œçš„åŸå­æ€§**ï¼Œä»è€Œç›´æ¥åœ¨Edenç©ºé—´ä¸­åˆ†é…å†…å­˜

æ ˆä¸Šåˆ†é…ä¼˜å…ˆäº TLAB åˆ†é…è¿›è¡Œï¼Œé€ƒé€¸åˆ†æä¸­è‹¥å¯è¿›è¡Œæ ˆä¸Šåˆ†é…ä¼˜åŒ–ï¼Œä¼šä¼˜å…ˆè¿›è¡Œå¯¹è±¡æ ˆä¸Šç›´æ¥åˆ†é…å†…å­˜

å‚æ•°è®¾ç½®ï¼š

* `-XX:UseTLAB`ï¼šè®¾ç½®æ˜¯å¦å¼€å¯TLABç©ºé—´

* `-XX:TLABWasteTargetPercent`ï¼šè®¾ç½®TLABç©ºé—´æ‰€å ç”¨Edenç©ºé—´çš„ç™¾åˆ†æ¯”å¤§å°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒTLABç©ºé—´çš„å†…å­˜éå¸¸å°ï¼Œä»…å æœ‰æ•´ä¸ªEdenç©ºé—´çš„1ï¼Œå³1%
* `-XX:TLABRefillWasteFraction`ï¼šæŒ‡å½“ TLAB ç©ºé—´ä¸è¶³ï¼Œè¯·æ±‚åˆ†é…çš„å¯¹è±¡å†…å­˜å¤§å°è¶…è¿‡æ­¤é˜ˆå€¼æ—¶ä¸ä¼šè¿›è¡Œ TLAB åˆ†é…ï¼Œç›´æ¥è¿›è¡Œå †å†…å­˜åˆ†é…ï¼Œå¦åˆ™è¿˜æ˜¯ä¼šä¼˜å…ˆè¿›è¡Œ TLAB åˆ†é…

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-TLABå†…å­˜åˆ†é…è¿‡ç¨‹.jpg)



***



#### å †å¤–åˆ†é…

å³æ—¶ç¼–è¯‘ï¼ˆJust-in-time Compilationï¼ŒJITï¼‰æ˜¯ä¸€ç§é€šè¿‡åœ¨è¿è¡Œæ—¶å°†å­—èŠ‚ç ç¿»è¯‘ä¸ºæœºå™¨ç ï¼Œä»è€Œæ”¹å–„å­—èŠ‚ç ç¼–è¯‘è¯­è¨€æ€§èƒ½çš„æŠ€æœ¯ï¼Œåœ¨HotSpotå®ç°ä¸­æœ‰å¤šç§é€‰æ‹©ï¼šC1ã€C2å’ŒC1+C2ï¼Œåˆ†åˆ«å¯¹åº”clientã€serverå’Œåˆ†å±‚ç¼–è¯‘

* C1ç¼–è¯‘é€Ÿåº¦å¿«ï¼Œä¼˜åŒ–æ–¹å¼æ¯”è¾ƒä¿å®ˆï¼›C2ç¼–è¯‘é€Ÿåº¦æ…¢ï¼Œä¼˜åŒ–æ–¹å¼æ¯”è¾ƒæ¿€è¿›
* C1+C2åœ¨å¼€å§‹é˜¶æ®µé‡‡ç”¨C1ç¼–è¯‘ï¼Œå½“ä»£ç è¿è¡Œåˆ°ä¸€å®šçƒ­åº¦ä¹‹åé‡‡ç”¨G2é‡æ–°ç¼–è¯‘
* åœ¨1.8ä¹‹å‰ï¼Œåˆ†å±‚ç¼–è¯‘é»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¯ä»¥æ·»åŠ `-server -XX:+TieredCompilation`å‚æ•°è¿›è¡Œå¼€å¯

**é€ƒé€¸åˆ†æ**ï¼šå¹¶ä¸æ˜¯ç›´æ¥çš„ä¼˜åŒ–æ‰‹æ®µï¼Œè€Œæ˜¯ä¸€ä¸ªä»£ç åˆ†æï¼Œé€šè¿‡åŠ¨æ€åˆ†æå¯¹è±¡çš„ä½œç”¨åŸŸï¼Œä¸ºå…¶å®ƒä¼˜åŒ–æ‰‹æ®µå¦‚æ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢å’ŒåŒæ­¥æ¶ˆé™¤ç­‰æä¾›ä¾æ®ï¼Œå‘ç”Ÿé€ƒé€¸è¡Œä¸ºçš„æƒ…å†µæœ‰ä¸¤ç§ï¼šæ–¹æ³•é€ƒé€¸å’Œçº¿ç¨‹é€ƒé€¸

* æ–¹æ³•é€ƒé€¸ï¼šå½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­å®šä¹‰ä¹‹åï¼Œä½œä¸ºå‚æ•°ä¼ é€’åˆ°å…¶å®ƒæ–¹æ³•ä¸­
* çº¿ç¨‹é€ƒé€¸ï¼šå¦‚ç±»å˜é‡æˆ–å®ä¾‹å˜é‡ï¼Œå¯èƒ½è¢«å…¶å®ƒçº¿ç¨‹è®¿é—®åˆ°

å¦‚æœä¸å­˜åœ¨é€ƒé€¸è¡Œä¸ºï¼Œåˆ™å¯ä»¥å¯¹è¯¥å¯¹è±¡è¿›è¡Œå¦‚ä¸‹ä¼˜åŒ–ï¼šåŒæ­¥æ¶ˆé™¤ã€æ ‡é‡æ›¿æ¢å’Œæ ˆä¸Šåˆ†é…

* **åŒæ­¥æ¶ˆé™¤**

  çº¿ç¨‹åŒæ­¥æœ¬èº«æ¯”è¾ƒè€—æ—¶ï¼Œå¦‚æœç¡®å®šä¸€ä¸ªå¯¹è±¡ä¸ä¼šé€ƒé€¸å‡ºçº¿ç¨‹ï¼Œæ— æ³•è¢«å…¶å®ƒçº¿ç¨‹è®¿é—®åˆ°ï¼Œé‚£è¯¥å¯¹è±¡çš„è¯»å†™å°±ä¸ä¼šå­˜åœ¨ç«äº‰ï¼Œåˆ™å¯ä»¥æ¶ˆé™¤å¯¹è¯¥å¯¹è±¡çš„åŒæ­¥é”ï¼Œé€šè¿‡`-XX:+EliminateLocks`å¯ä»¥å¼€å¯åŒæ­¥æ¶ˆé™¤

* **æ ‡é‡æ›¿æ¢**

  * æ ‡é‡æ›¿æ¢ï¼šå¦‚æœæŠŠä¸€ä¸ªå¯¹è±¡æ‹†æ•£ï¼Œå°†å…¶æˆå‘˜å˜é‡æ¢å¤åˆ°åŸºæœ¬ç±»å‹æ¥è®¿é—®
  * æ ‡é‡ (scalar) ï¼šä¸å¯åˆ†å‰²çš„é‡ï¼Œå¦‚åŸºæœ¬æ•°æ®ç±»å‹å’Œreferenceç±»å‹
    èšåˆé‡ (Aggregate)ï¼šä¸€ä¸ªæ•°æ®å¯ä»¥ç»§ç»­åˆ†è§£
  * å¦‚æœé€ƒé€¸åˆ†æå‘ç°ä¸€ä¸ªå¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡å¯ä»¥è¢«æ‹†æ•£ï¼Œé‚£ä¹ˆç»è¿‡ä¼˜åŒ–ä¹‹åï¼Œå¹¶ä¸ç›´æ¥ç”Ÿæˆè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯åœ¨æ ˆä¸Šåˆ›å»ºè‹¥å¹²ä¸ªæˆå‘˜å˜é‡
  * å‚æ•°è®¾ç½®ï¼š
    `-XX:+EliminateAllocations`ï¼šå¼€å¯æ ‡é‡æ›¿æ¢
    `-XX:+PrintEliminateAllocations`ï¼šæŸ¥çœ‹æ ‡é‡æ›¿æ¢æƒ…å†µ

* **æ ˆä¸Šåˆ†é…**

  JITç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´æ ¹æ®é€ƒé€¸åˆ†æçš„ç»“æœï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•çš„è¯ï¼Œå°±å¯èƒ½è¢«ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é…ã€‚åˆ†é…å®Œæˆåï¼Œç»§ç»­åœ¨è°ƒç”¨æ ˆå†…æ‰§è¡Œï¼Œæœ€åçº¿ç¨‹ç»“æŸï¼Œæ ˆç©ºé—´è¢«å›æ”¶ï¼Œå±€éƒ¨å˜é‡å¯¹è±¡ä¹Ÿè¢«å›æ”¶ï¼Œè¿™æ ·å°±æ— éœ€GC

  Userå¯¹è±¡çš„ä½œç”¨åŸŸå±€é™åœ¨æ–¹æ³•fnä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ ‡é‡æ›¿æ¢çš„ä¼˜åŒ–æ‰‹æ®µåœ¨æ ˆä¸Šåˆ†é…å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œè¿™æ ·å°±ä¸ä¼šç”ŸæˆUserå¯¹è±¡ï¼Œå¤§å¤§å‡è½»GCçš„å‹åŠ›

  ```java
  public class JVM {
      public static void main(String[] args) throws Exception {
          int sum = 0;
          int count = 1000000;
          //warm up
          for (int i = 0; i < count ; i++) {
              sum += fn(i);
          }
          System.out.println(sum);
          System.in.read();
      }
      private static int fn(int age) {
          User user = new User(age);
          int i = user.getAge();
          return i;
      }
  }
  
  class User {
      private final int age;
  
      public User(int age) {
          this.age = age;
      }
  
      public int getAge() {
          return age;
      }
  }
  ```

  



***



### åƒåœ¾åˆ¤æ–­

#### åƒåœ¾æ”¶é›†

åƒåœ¾ï¼š**å¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•çš„å¼•ç”¨æŒ‡å‘å®ƒäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ç°åœ¨å°±æ˜¯åƒåœ¾**

åƒåœ¾æ”¶é›†ä¸»è¦æ˜¯é’ˆå¯¹å †å’Œæ–¹æ³•åŒºè¿›è¡Œã€‚ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆè¿™ä¸‰ä¸ªåŒºåŸŸå±äºçº¿ç¨‹ç§æœ‰çš„ï¼Œåªå­˜åœ¨äºçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œçº¿ç¨‹ç»“æŸä¹‹åå°±ä¼šæ¶ˆå¤±ï¼Œå› æ­¤ä¸éœ€è¦å¯¹è¿™ä¸‰ä¸ªåŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶

åœ¨å †é‡Œå­˜æ”¾ç€å‡ ä¹æ‰€æœ‰çš„Javaå¯¹è±¡å®ä¾‹ï¼Œåœ¨GCæ‰§è¡Œåƒåœ¾å›æ”¶ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åŒºåˆ†å‡ºå†…å­˜ä¸­å“ªäº›æ˜¯å­˜æ´»å¯¹è±¡ï¼Œå“ªäº›æ˜¯å·²ç»æ­»äº¡çš„å¯¹è±¡ã€‚åªæœ‰è¢«æ ‡è®°ä¸ºå·±ç»æ­»äº¡çš„å¯¹è±¡ï¼ŒGCæ‰ä¼šåœ¨æ‰§è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œé‡Šæ”¾æ‰å…¶æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ç§°ä¸º**åƒåœ¾æ ‡è®°é˜¶æ®µ**ï¼Œåˆ¤æ–­å¯¹è±¡å­˜æ´»ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š**å¼•ç”¨è®¡æ•°ç®—æ³•**å’Œ**å¯è¾¾æ€§åˆ†æç®—æ³•**



#### å¼•ç”¨è®¡æ•°æ³•

å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆReference Countingï¼‰ï¼šå¯¹æ¯ä¸ªå¯¹è±¡ä¿å­˜ä¸€ä¸ªæ•´å‹çš„å¼•ç”¨è®¡æ•°å™¨å±æ€§ï¼Œç”¨äºè®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µã€‚å¯¹äºä¸€ä¸ªå¯¹è±¡Aï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº†Aï¼Œåˆ™Açš„å¼•ç”¨è®¡æ•°å™¨å°±åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±å‡1ï¼›å½“å¯¹è±¡Açš„å¼•ç”¨è®¡æ•°å™¨çš„å€¼ä¸º0ï¼Œå³è¡¨ç¤ºå¯¹è±¡Aä¸å¯èƒ½å†è¢«ä½¿ç”¨ï¼Œå¯è¿›è¡Œå›æ”¶

ä¼˜ç‚¹ï¼š

- å›æ”¶æ²¡æœ‰å»¶è¿Ÿæ€§ï¼Œæ— éœ€ç­‰åˆ°å†…å­˜ä¸å¤Ÿçš„æ—¶å€™æ‰å¼€å§‹å›æ”¶ï¼Œè¿è¡Œæ—¶æ ¹æ®å¯¹è±¡è®¡æ•°å™¨æ˜¯å¦ä¸º0ï¼Œå¯ä»¥ç›´æ¥å›æ”¶
- åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨æ— éœ€æŒ‚èµ·ï¼›å¦‚æœç”³è¯·å†…å­˜æ—¶ï¼Œå†…å­˜ä¸è¶³ï¼Œåˆ™ç«‹åˆ»æŠ¥OOMé”™è¯¯ã€‚
- åŒºåŸŸæ€§ï¼Œæ›´æ–°å¯¹è±¡çš„è®¡æ•°å™¨æ—¶ï¼Œåªæ˜¯å½±å“åˆ°è¯¥å¯¹è±¡ï¼Œä¸ä¼šæ‰«æå…¨éƒ¨å¯¹è±¡

ç¼ºç‚¹ï¼š

- æ¯æ¬¡å¯¹è±¡è¢«å¼•ç”¨æ—¶ï¼Œéƒ½éœ€è¦å»æ›´æ–°è®¡æ•°å™¨ï¼Œæœ‰ä¸€ç‚¹æ—¶é—´å¼€é”€ã€‚ 

- **æµªè´¹CPUèµ„æº**ï¼Œå³ä½¿å†…å­˜å¤Ÿç”¨ï¼Œä»ç„¶åœ¨è¿è¡Œæ—¶è¿›è¡Œè®¡æ•°å™¨çš„ç»Ÿè®¡ã€‚

- **æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œä¼šå¼•å‘å†…å­˜æ³„éœ²**ï¼ˆæœ€å¤§çš„ç¼ºç‚¹ï¼‰

  å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰ï¼šæ˜¯æŒ‡ç¨‹åºä¸­å·²åŠ¨æ€åˆ†é…çš„å †å†…å­˜ç”±äºæŸç§åŸå› ç¨‹åºæœªé‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾ï¼Œé€ æˆç³»ç»Ÿå†…å­˜çš„æµªè´¹ï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œé€Ÿåº¦å‡æ…¢ç”šè‡³ç³»ç»Ÿå´©æºƒç­‰ä¸¥é‡åæœ

  ```java
  public class Test {
      public Object instance = null;
      public static void main(String[] args) {
          Test a = new Test();// a = 1
          Test b = new Test();// b = 1
          a.instance = b;		// b = 2
          b.instance = a;		// a = 2
          a = null;			// a = 1
          b = null;			// b = 1
      }
  }
  ```

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-å¾ªç¯å¼•ç”¨.png)



***



#### å¯è¾¾æ€§åˆ†æ

å¯è¾¾æ€§åˆ†æç®—æ³•ï¼šä¹Ÿå¯ä»¥ç§°ä¸º æ ¹æœç´¢ç®—æ³•ã€è¿½è¸ªæ€§åƒåœ¾æ”¶é›†

**GC Roots**ï¼š

- è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼šå„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•ä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰
- æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼šJavaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡
- æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡
- æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆstring Tableï¼‰é‡Œçš„å¼•ç”¨

æ³¨æ„ï¼š

* GC Rootsæ˜¯ä¸€ç»„æ´»è·ƒçš„**å¼•ç”¨**ï¼Œä¸æ˜¯å¯¹è±¡
* ç”±äºRooté‡‡ç”¨æ ˆæ–¹å¼å­˜æ”¾å˜é‡å’ŒæŒ‡é’ˆï¼Œå¦‚æœä¸€ä¸ªæŒ‡é’ˆä¿å­˜äº†å †å†…å­˜ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±ä¸åœ¨å †å†…å­˜ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªRoot

ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å†…å­˜æ˜¯å¦å¯å›æ”¶ï¼Œåˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ä¿éšœ**ä¸€è‡´æ€§çš„å¿«ç…§**ä¸­è¿›è¡Œã€‚è¿™ç‚¹ä¸æ»¡è¶³çš„è¯åˆ†æç»“æœçš„å‡†ç¡®æ€§å°±æ— æ³•ä¿è¯ï¼Œè¿™ç‚¹ä¹Ÿæ˜¯å¯¼è‡´GCè¿›è¡Œæ—¶å¿…é¡»â€œStop The Worldâ€çš„ä¸€ä¸ªé‡è¦åŸå› 

è¿‡ç¨‹ï¼š

- å¯è¾¾æ€§åˆ†æç®—æ³•æ˜¯ä»¥æ ¹å¯¹è±¡é›†åˆï¼ˆGCRootsï¼‰ä¸ºèµ·å§‹ç‚¹ï¼ŒæŒ‰ç…§ä»ä¸Šè‡³ä¸‹çš„æ–¹å¼æœç´¢è¢«æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„ç›®æ ‡å¯¹è±¡æ˜¯å¦å¯è¾¾

- ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•åï¼Œå†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡éƒ½ä¼šè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–é—´æ¥è¿æ¥ç€ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼ˆReference Chainï¼‰

- å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œåˆ™æ˜¯ä¸å¯è¾¾çš„ï¼Œå°±æ„å‘³ç€è¯¥å¯¹è±¡å·±ç»æ­»äº¡ï¼Œå¯ä»¥æ ‡è®°ä¸ºåƒåœ¾å¯¹è±¡

- åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ï¼Œåªæœ‰èƒ½å¤Ÿè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–è€…é—´æ¥è¿æ¥çš„å¯¹è±¡æ‰æ˜¯å­˜æ´»å¯¹è±¡

  <img src="https://gitee.com/seazean/images/raw/master/JavaSE/JVM-å¯è¾¾æ€§åˆ†æç®—æ³•.png" style="zoom:67%;" />



***



#### finalization

Javaè¯­è¨€æä¾›äº†å¯¹è±¡ç»ˆæ­¢ï¼ˆfinalizationï¼‰æœºåˆ¶æ¥å…è®¸å¼€å‘äººå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯ä¹‹å‰çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘

åƒåœ¾å›æ”¶æ­¤å¯¹è±¡ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•ï¼Œfinalize() æ–¹æ³•å…è®¸åœ¨å­ç±»ä¸­è¢«é‡å†™ï¼Œç”¨äºåœ¨å¯¹è±¡è¢«å›æ”¶æ—¶è¿›è¡Œèµ„æºé‡Šæ”¾ã€‚é€šå¸¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›èµ„æºé‡Šæ”¾å’Œæ¸…ç†çš„å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶ã€å¥—æ¥å­—å’Œæ•°æ®åº“è¿æ¥ç­‰

ç”Ÿå­˜ORæ­»äº¡ï¼šå¦‚æœä»æ‰€æœ‰çš„æ ¹èŠ‚ç‚¹éƒ½æ— æ³•è®¿é—®åˆ°æŸä¸ªå¯¹è±¡ï¼Œè¯´æ˜å¯¹è±¡å·±ç»ä¸å†ä½¿ç”¨ï¼Œæ­¤å¯¹è±¡éœ€è¦è¢«å›æ”¶ã€‚ä½†äº‹å®ä¸Šè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€ç¼“åˆ‘â€œé˜¶æ®µã€‚**ä¸€ä¸ªæ— æ³•è§¦åŠçš„å¯¹è±¡æœ‰å¯èƒ½åœ¨æŸä¸€ä¸ªæ¡ä»¶ä¸‹â€œå¤æ´»â€è‡ªå·±**ï¼Œå¦‚æœè¿™æ ·å¯¹å®ƒçš„å›æ”¶å°±æ˜¯ä¸åˆç†çš„ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºä¸­çš„å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š

- å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯ä»¥åˆ°è¾¾è¿™ä¸ªå¯¹è±¡ã€‚
- å¯å¤æ´»çš„ï¼šå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«é‡Šæ”¾ï¼Œä½†æ˜¯å¯¹è±¡æœ‰å¯èƒ½åœ¨finalize() ä¸­å¤æ´»
- ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize() è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ²¡æœ‰å¤æ´»ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥ä¸å¯è§¦åŠçŠ¶æ€ï¼Œä¸å¯è§¦åŠçš„å¯¹è±¡ä¸å¯èƒ½è¢«å¤æ´»ã€‚å› ä¸º**finalize()åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡**ï¼Œç­‰åˆ°è¿™ä¸ªå¯¹è±¡å†è¢«æ ‡è®°ä¸ºå¯å›æ”¶æ—¶å°±å¿…é¡»å›æ”¶

æ³¨æ„ï¼šæ°¸è¿œä¸è¦ä¸»åŠ¨è°ƒç”¨æŸä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•ï¼Œåº”è¯¥äº¤ç»™åƒåœ¾å›æ”¶æœºåˆ¶è°ƒç”¨

* finalize() æ—¶å¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡å¤æ´»ã€‚
* finalize() æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´æ˜¯æ²¡æœ‰ä¿éšœçš„ï¼Œå®ƒå®Œå…¨ç”±GCçº¿ç¨‹å†³å®šï¼Œæç«¯æƒ…å†µä¸‹ï¼Œè‹¥ä¸å‘ç”ŸGCï¼Œåˆ™finalize()æ–¹æ³•å°†æ²¡æœ‰æ‰§è¡Œæœºä¼šã€‚å› ä¸ºä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œå³ä½¿ä¸»åŠ¨è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šå› æ­¤å°±ç›´æ¥è¿›è¡Œå›æ”¶
* ä¸€ä¸ªç³Ÿç³•çš„finalize() ä¼šä¸¥é‡å½±å“GCçš„æ€§èƒ½ã€‚



***



#### å››ç§å¼•ç”¨

æ— è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶éƒ½ä¸å¼•ç”¨æœ‰å…³ï¼ŒJava æä¾›äº†å››ç§å¼ºåº¦ä¸åŒçš„å¼•ç”¨ç±»å‹

1. å¼ºå¼•ç”¨ï¼šè¢«å¼ºå¼•ç”¨å…³è”çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ï¼Œåªæœ‰æ‰€æœ‰GCRootséƒ½ä¸é€šè¿‡å¼ºå¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡ï¼Œæ‰èƒ½è¢«åƒåœ¾å›æ”¶

   * å¼ºå¼•ç”¨å¯ä»¥ç›´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡
   * è™šæ‹Ÿæœºå®æ„¿æŠ›å‡ºOOMå¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨æ‰€æŒ‡å‘å¯¹è±¡
   * å¼ºå¼•ç”¨å¯èƒ½å¯¼è‡´**å†…å­˜æ³„æ¼**

   ```java
   Object obj = new Object();//ä½¿ç”¨ new ä¸€ä¸ªæ–°å¯¹è±¡çš„æ–¹å¼æ¥åˆ›å»ºå¼ºå¼•ç”¨
   ```

2. è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ï¼šè¢«è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸å¤Ÿçš„æƒ…å†µä¸‹æ‰ä¼šè¢«å›æ”¶

   * **ä»…ï¼ˆå¯èƒ½æœ‰å¼ºå¼•ç”¨ï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥è¢«å¤šä¸ªå¼•ç”¨ï¼‰**æœ‰è½¯å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶åï¼Œå†…å­˜ä»ä¸è¶³æ—¶ä¼šå†æ¬¡å‡ºå‘åƒåœ¾å›æ”¶ï¼Œå›æ”¶è½¯å¼•ç”¨å¯¹è±¡
   * é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾è½¯**å¼•ç”¨è‡ªèº«**ï¼Œåœ¨æ„é€ è½¯å¼•ç”¨æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼Œå½“è½¯å¼•ç”¨å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œå°±ä¼šåŠ å…¥æŒ‡å®šçš„å¼•ç”¨é˜Ÿåˆ—ï¼Œé€šè¿‡è¿™ä¸ªé˜Ÿåˆ—å¯ä»¥è·Ÿè¸ªå¯¹è±¡çš„å›æ”¶æƒ…å†µ
   * è½¯å¼•ç”¨é€šå¸¸ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ï¼Œæ¯”å¦‚é«˜é€Ÿç¼“å­˜å°±æœ‰ç”¨åˆ°è½¯å¼•ç”¨ï¼›å¦‚æœè¿˜æœ‰ç©ºé—²å†…å­˜ï¼Œå°±å¯ä»¥æš‚æ—¶ä¿ç•™ç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶æ¸…ç†æ‰ï¼Œè¿™æ ·å°±ä¿è¯äº†ä½¿ç”¨ç¼“å­˜çš„åŒæ—¶ä¸ä¼šè€—å°½å†…å­˜

   ```java
   Object obj = new Object();
   SoftReference<Object> sf = new SoftReference<Object>(obj);
   obj = null;  // ä½¿å¯¹è±¡åªè¢«è½¯å¼•ç”¨å…³è”
   ```

3. å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ï¼šè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶ï¼Œåªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶å‘ç”Ÿä¹‹å‰

   * ä»…æœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨å¯¹è±¡
   * é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾å¼±å¼•ç”¨è‡ªèº«
   * WeakHashMapç”¨æ¥å­˜å‚¨å›¾ç‰‡ä¿¡æ¯ï¼Œå¯ä»¥åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™åŠæ—¶å›æ”¶ï¼Œé¿å…äº†OOM

   ```java
   Object obj = new Object();
   WeakReference<Object> wf = new WeakReference<Object>(obj);
   obj = null;
   ```

4. è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ï¼šä¹Ÿç§°ä¸ºâ€œå¹½çµå¼•ç”¨â€æˆ–è€…â€œå¹»å½±å¼•ç”¨â€ï¼Œæ˜¯æ‰€æœ‰å¼•ç”¨ç±»å‹ä¸­æœ€å¼±çš„ä¸€ä¸ª

   * ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´é€ æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨å¾—åˆ°ä¸€ä¸ªå¯¹è±¡
   * ä¸ºå¯¹è±¡è®¾ç½®è™šå¼•ç”¨çš„å”¯ä¸€ç›®çš„æ˜¯åœ¨äºè·Ÿè¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ï¼Œèƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥
   * å¿…é¡»é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œä¸»è¦é…åˆ ByteBuffer ä½¿ç”¨ï¼Œè¢«å¼•ç”¨å¯¹è±¡å›æ”¶æ—¶ä¼šå°†è™šå¼•ç”¨å…¥é˜Ÿï¼Œç”± Reference Handler çº¿ç¨‹è°ƒç”¨è™šå¼•ç”¨ç›¸å…³æ–¹æ³•é‡Šæ”¾ç›´æ¥å†…å­˜

   ```java
   Object obj = new Object();
   PhantomReference<Object> pf = new PhantomReference<Object>(obj, null);
   obj = null;
   ```

5. ç»ˆç»“å™¨å¼•ç”¨ï¼ˆfinalizationï¼‰



***



### å›æ”¶ç®—æ³•

#### æ ‡è®°æ¸…é™¤

å½“æˆåŠŸåŒºåˆ†å‡ºå†…å­˜ä¸­å­˜æ´»å¯¹è±¡å’Œæ­»äº¡å¯¹è±¡åï¼ŒGCæ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œé‡Šæ”¾æ‰æ— ç”¨å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä»¥ä¾¿æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ç©ºé—´ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ã€‚ç›®å‰åœ¨JVMä¸­æ¯”è¾ƒå¸¸è§çš„ä¸‰ç§åƒåœ¾æ”¶é›†ç®—æ³•æ˜¯

- æ ‡è®°æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰
- å¤åˆ¶ç®—æ³•ï¼ˆcopyingï¼‰
- æ ‡è®°å‹ç¼©ç®—æ³•ï¼ˆMark-Compactï¼‰

æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œæ˜¯å°†åƒåœ¾å›æ”¶åˆ†ä¸º2ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯**æ ‡è®°å’Œæ¸…é™¤**ã€‚

- **æ ‡è®°**ï¼šCollectorä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œ**æ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡**ï¼Œä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„Headerä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ï¼Œ**æ ‡è®°çš„æ˜¯å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸æ˜¯åƒåœ¾**
- **æ¸…é™¤**ï¼šCollectorå¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œçº¿æ€§çš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡åœ¨å…¶Headerä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™å°†å…¶å›æ”¶ï¼Œæ¸…é™¤å¹¶ä¸æ˜¯çœŸçš„ç½®ç©ºï¼Œè€Œæ˜¯æŠŠéœ€è¦æ¸…é™¤çš„å¯¹è±¡åœ°å€ä¿å­˜åœ¨ç©ºé—²çš„åœ°å€åˆ—è¡¨é‡Œ

å›æ”¶å’Œåˆ†é…ï¼š

- å›æ”¶é˜¶æ®µï¼šåˆ¤æ–­å›æ”¶åçš„åˆ†å—ä¸å‰ä¸€ä¸ªç©ºé—²åˆ†å—æ˜¯å¦è¿ç»­ï¼Œè‹¥è¿ç»­ä¼šåˆå¹¶è¿™ä¸¤ä¸ªåˆ†å—ã€‚å›æ”¶å¯¹è±¡å°±æ˜¯æŠŠåˆ†å—è¿æ¥åˆ° â€œ**ç©ºé—²é“¾è¡¨**â€ çš„å•å‘é“¾è¡¨ï¼Œä¹‹åè¿›è¡Œåˆ†é…æ—¶åªéœ€è¦éå†è¿™ä¸ªç©ºé—²é“¾è¡¨ï¼Œå°±å¯ä»¥æ‰¾åˆ°åˆ†å—
- åˆ†é…é˜¶æ®µï¼šç¨‹åºä¼šæœç´¢ç©ºé—²é“¾è¡¨å¯»æ‰¾ç©ºé—´å¤§äºç­‰äºæ–°å¯¹è±¡å¤§å° size çš„å— blockï¼Œå¦‚æœæ‰¾åˆ°çš„å—ç­‰äº sizeï¼Œä¼šç›´æ¥è¿”å›è¿™ä¸ªåˆ†å—ï¼›å¦‚æœæ‰¾åˆ°çš„å—å¤§äº sizeï¼Œä¼šå°†å—åˆ†å‰²æˆå¤§å°ä¸º size ä¸ (block - size) çš„ä¸¤éƒ¨åˆ†ï¼Œè¿”å›å¤§å°ä¸º size çš„åˆ†å—ï¼Œå¹¶æŠŠå¤§å°ä¸º (block - size) çš„å—è¿”å›ç»™ç©ºé—²é“¾è¡¨

ç¼ºç‚¹ï¼š

- æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹æ•ˆç‡éƒ½ä¸é«˜
- è¿›è¡ŒGCçš„æ—¶å€™ï¼Œéœ€è¦åœæ­¢æ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨æˆ·ä½“éªŒè¾ƒå·®
- ä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´æ— æ³•ç»™å¤§å¯¹è±¡åˆ†é…å†…å­˜ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²é“¾è¡¨

<img src="https://gitee.com/seazean/images/raw/master/JavaSE/JVM-æ ‡è®°æ¸…é™¤ç®—æ³•.png" style="zoom: 67%;" />



***



#### å¤åˆ¶ç®—æ³•

å¤åˆ¶ç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯ï¼Œ**å°†åŸæœ‰çš„å†…å­˜ç©ºé—´ä¸€åˆ†ä¸ºäºŒï¼Œæ¯æ¬¡åªç”¨å…¶ä¸­çš„ä¸€å—**ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œå°†æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªå†…å­˜ç©ºé—´ä¸­ï¼Œç„¶åå°†è¯¥å†…å­˜ç©ºé—´æ¸…ç†ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜çš„è§’è‰²ï¼Œå®Œæˆåƒåœ¾çš„å›æ”¶

åº”ç”¨åœºæ™¯ï¼šå¦‚æœå†…å­˜ä¸­çš„åƒåœ¾å¯¹è±¡è¾ƒå¤šï¼Œéœ€è¦å¤åˆ¶çš„å¯¹è±¡å°±è¾ƒå°‘ï¼Œè¿™ç§æƒ…å†µä¸‹é€‚åˆä½¿ç”¨è¯¥æ–¹å¼å¹¶ä¸”æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œåä¹‹ï¼Œåˆ™ä¸é€‚åˆ

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-å¤åˆ¶ç®—æ³•.png)

ä¼˜ç‚¹ï¼š

- æ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆ
- å¤åˆ¶è¿‡å»ä»¥åä¿è¯ç©ºé—´çš„è¿ç»­æ€§ï¼Œä¸ä¼šå‡ºç°â€œç¢ç‰‡â€é—®é¢˜ã€‚

ç¼ºç‚¹ï¼š

- ä¸»è¦ä¸è¶³æ˜¯åªä½¿ç”¨äº†å†…å­˜çš„ä¸€åŠã€‚
- å¯¹äºG1è¿™ç§åˆ†æ‹†æˆä¸ºå¤§é‡regionçš„GCï¼Œå¤åˆ¶è€Œä¸æ˜¯ç§»åŠ¨ï¼Œæ„å‘³ç€GCéœ€è¦ç»´æŠ¤regionä¹‹é—´å¯¹è±¡å¼•ç”¨å…³ç³»ï¼Œä¸ç®¡æ˜¯å†…å­˜å ç”¨æˆ–è€…æ—¶é—´å¼€é”€ä¹Ÿä¸å°

ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•å›æ”¶æ–°ç”Ÿä»£ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œè€Œæ˜¯ä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´



***



#### æ ‡è®°æ•´ç†

æ ‡è®°æ•´ç†ï¼ˆå‹ç¼©ï¼‰ç®—æ³•æ˜¯åœ¨æ ‡è®°æ¸…é™¤ç®—æ³•çš„åŸºç¡€ä¹‹ä¸Šï¼Œåšäº†ä¼˜åŒ–æ”¹è¿›çš„ç®—æ³•

æ ‡è®°é˜¶æ®µå’Œæ ‡è®°æ¸…é™¤ç®—æ³•ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹å¯¹è±¡çš„å¼•ç”¨è¿›è¡Œæ ‡è®°ï¼Œåœ¨æ¸…ç†é˜¶æ®µï¼Œå¹¶ä¸æ˜¯ç®€å•çš„ç›´æ¥æ¸…ç†å¯å›æ”¶å¯¹è±¡ï¼Œè€Œæ˜¯å°†å­˜æ´»å¯¹è±¡éƒ½å‘å†…å­˜å¦ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…ç†è¾¹ç•Œä»¥å¤–çš„åƒåœ¾ï¼Œä»è€Œ**è§£å†³äº†ç¢ç‰‡åŒ–**çš„é—®é¢˜

ä¼˜ç‚¹ï¼šä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡

ç¼ºç‚¹ï¼šéœ€è¦ç§»åŠ¨å¤§é‡å¯¹è±¡ï¼Œå¤„ç†æ•ˆç‡æ¯”è¾ƒä½

<img src="https://gitee.com/seazean/images/raw/master/JavaSE/JVM-æ ‡è®°æ•´ç†ç®—æ³•.png" style="zoom:67%;" />





***



### åƒåœ¾å›æ”¶å™¨

#### GCæ¦‚è¿°

åƒåœ¾æ”¶é›†å™¨åˆ†ç±»ï¼š

* æŒ‰çº¿ç¨‹æ•°åˆ†ï¼ˆåƒåœ¾å›æ”¶çº¿ç¨‹æ•°ï¼‰ï¼Œå¯ä»¥åˆ†ä¸ºä¸²è¡Œåƒåœ¾å›æ”¶å™¨å’Œå¹¶è¡Œåƒåœ¾å›æ”¶å™¨
  * é™¤äº† CMS å’Œ G1 ä¹‹å¤–ï¼Œå…¶å®ƒåƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œ
* æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºå¹¶å‘å¼åƒåœ¾å›æ”¶å™¨å’Œç‹¬å å¼åƒåœ¾å›æ”¶å™¨
  * å¹¶å‘å¼åƒåœ¾å›æ”¶å™¨ä¸åº”ç”¨ç¨‹åºçº¿ç¨‹äº¤æ›¿å·¥ä½œï¼Œä»¥å°½å¯èƒ½å‡å°‘åº”ç”¨ç¨‹åºçš„åœé¡¿æ—¶é—´ã€‚
  * ç‹¬å å¼åƒåœ¾å›æ”¶å™¨ï¼ˆStop the worldï¼‰ä¸€æ—¦è¿è¡Œï¼Œå°±åœæ­¢åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾å›æ”¶è¿‡ç¨‹å®Œå…¨ç»“æŸ
* æŒ‰ç¢ç‰‡å¤„ç†æ–¹å¼åˆ†ï¼Œå¯åˆ†ä¸ºå‹ç¼©æ­¦åƒåœ¾å›æ”¶å™¨å’Œéå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨
  * å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ä¼šåœ¨å›æ”¶å®Œæˆåï¼Œå¯¹å­˜æ´»å¯¹è±¡è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œæ¶ˆé™¤å›æ”¶åçš„ç¢ç‰‡ã€‚
  * éå‹ç¼©å¼çš„åƒåœ¾å›æ”¶å™¨ä¸è¿›è¡Œè¿™æ­¥æ“ä½œã€‚
* æŒ‰å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ï¼Œåˆå¯åˆ†ä¸ºå¹´è½»ä»£åƒåœ¾å›æ”¶å™¨å’Œè€å¹´ä»£åƒåœ¾å›æ”¶å™¨

GCæ€§èƒ½æŒ‡æ ‡ï¼š

- **ååé‡**ï¼šç¨‹åºçš„è¿è¡Œæ—¶é—´å æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ï¼ˆæ€»è¿è¡Œæ—¶é—´ = ç¨‹åºçš„è¿è¡Œæ—¶é—´ + å†…å­˜å›æ”¶çš„æ—¶é—´ï¼‰
- åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹
- **æš‚åœæ—¶é—´**ï¼šæ‰§è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹è¢«æš‚åœçš„æ—¶é—´
- **æ”¶é›†é¢‘ç‡**ï¼šç›¸å¯¹äºåº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼Œæ”¶é›†æ“ä½œå‘ç”Ÿçš„é¢‘ç‡
- **å†…å­˜å ç”¨**ï¼šJavaå †åŒºæ‰€å çš„å†…å­˜å¤§å°
- å¿«é€Ÿï¼šä¸€ä¸ªå¯¹è±¡ä»è¯ç”Ÿåˆ°è¢«å›æ”¶æ‰€ç»å†çš„æ—¶é—´

**åƒåœ¾æ”¶é›†å™¨çš„ç»„åˆå…³ç³»**ï¼š

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-åƒåœ¾å›æ”¶å™¨å…³ç³»å›¾.png)

æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼šSerialã€ParNewã€Paralle1 Scavengeï¼›

è€å¹´ä»£æ”¶é›†å™¨ï¼šSerial oldã€Parallel oldã€CMSï¼›

æ•´å †æ”¶é›†å™¨ï¼šG1

* çº¢è‰²è™šçº¿åœ¨JDK9ç§»é™¤ã€ç»¿è‰²è™šçº¿åœ¨JDK14å¼ƒç”¨è¯¥ç»„åˆã€é’è‰²è™šçº¿åœ¨JDK14åˆ é™¤CMSåƒåœ¾å›æ”¶å™¨

æŸ¥çœ‹é»˜è®¤çš„åƒåœ¾æ”¶å›æ”¶å™¨ï¼š

* `-XX:+PrintcommandLineFlags`ï¼šæŸ¥çœ‹å‘½ä»¤è¡Œç›¸å…³å‚æ•°ï¼ˆåŒ…å«ä½¿ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼‰

* ä½¿ç”¨å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼šjinfo -flag  ç›¸å…³åƒåœ¾å›æ”¶å™¨å‚æ•°  è¿›ç¨‹ID



***



#### Serial

**Serial**ï¼šä¸²è¡Œåƒåœ¾æ”¶é›†å™¨ï¼Œä½œç”¨äºæ–°ç”Ÿä»£ï¼Œæ˜¯æŒ‡ä½¿ç”¨å•çº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œé‡‡ç”¨**å¤åˆ¶ç®—æ³•**

**STWï¼ˆStop-The-Worldï¼‰**ï¼šåƒåœ¾å›æ”¶æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å·¥ä½œï¼Œå¹¶ä¸”javaåº”ç”¨ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½è¦æš‚åœï¼Œç­‰å¾…åƒåœ¾å›æ”¶çš„å®Œæˆ

**Serial old**ï¼šæ‰§è¡Œè€å¹´ä»£åƒåœ¾å›æ”¶çš„ä¸²è¡Œæ”¶é›†å™¨ï¼Œå†…å­˜å›æ”¶ç®—æ³•ä½¿ç”¨çš„æ˜¯**æ ‡è®°-æ•´ç†ç®—æ³•**ï¼ŒåŒæ ·ä¹Ÿé‡‡ç”¨äº†ä¸²è¡Œå›æ”¶å’Œ"Stop the World"æœºåˆ¶ï¼Œ

- Serial oldæ˜¯è¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹é»˜è®¤çš„è€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨
- Serial oldåœ¨Serveræ¨¡å¼ä¸‹ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼š
  - åœ¨ JDK 1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ï¼ˆParallel Old è¯ç”Ÿä»¥å‰ï¼‰ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨
  - ä½œä¸ºè€å¹´ä»£CMSæ”¶é›†å™¨çš„**åå¤‡åƒåœ¾å›æ”¶æ–¹æ¡ˆ**ï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”Ÿ Concurrent Mode Failure æ—¶ä½¿ç”¨

å¼€å¯å‚æ•°ï¼š`-XX:+UseSerialGC == Serial + SerialOld` ç­‰ä»·äºæ–°ç”Ÿä»£ç”¨Serial GCä¸”è€å¹´ä»£ç”¨Serial old GC

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-Serial æ”¶é›†å™¨.png)

ä¼˜ç‚¹ï¼šç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹æ¯”ï¼‰ï¼Œå¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œå¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚

ç¼ºç‚¹ï¼šå¯¹äºäº¤äº’æ€§è¾ƒå¼ºçš„åº”ç”¨è€Œè¨€ï¼Œè¿™ç§åƒåœ¾æ”¶é›†å™¨æ˜¯ä¸èƒ½å¤Ÿæ¥å—çš„ï¼Œæ¯”å¦‚Javawebåº”ç”¨



****



#### ParNew

Paræ˜¯Parallelå¹¶è¡Œçš„ç¼©å†™ï¼ŒNewï¼šåªèƒ½å¤„ç†çš„æ˜¯æ–°ç”Ÿä»£

**å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨**åœ¨ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨çš„åŸºç¡€ä¹‹ä¸Šåšäº†æ”¹è¿›ï¼Œ**é‡‡ç”¨å¤åˆ¶ç®—æ³•**ï¼Œå°†å•çº¿ç¨‹æ”¹ä¸ºäº†å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿™æ ·å¯ä»¥ç¼©çŸ­åƒåœ¾å›æ”¶çš„æ—¶é—´

å¯¹äºå…¶ä»–çš„è¡Œä¸ºï¼ˆæ”¶é›†ç®—æ³•ã€stop the worldã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰ï¼‰åŒSerialæ”¶é›†å™¨ä¸€æ ·ï¼Œåº”ç”¨åœ¨å¹´è½»ä»£ï¼Œé™¤Serialå¤–ï¼Œåªæœ‰**ParNew GCèƒ½ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œ**

å¼€å¯å‚æ•°ï¼š`-XXï¼š+UseParNewGC`ï¼Œè¡¨ç¤ºå¹´è½»ä»£ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼Œä¸å½±å“è€å¹´ä»£

é™åˆ¶çº¿ç¨‹æ•°é‡ï¼š`-XX:ParallelGCThreads`ï¼Œé»˜è®¤å¼€å¯å’ŒCPUæ•°æ®ç›¸åŒçš„çº¿ç¨‹æ•°

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-ParNewæ”¶é›†å™¨.png)

ParNew æ˜¯å¾ˆå¤šJVMè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹æ–°ç”Ÿä»£çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨

- å¯¹äºæ–°ç”Ÿä»£ï¼Œå›æ”¶æ¬¡æ•°é¢‘ç¹ï¼Œä½¿ç”¨å¹¶è¡Œæ–¹å¼é«˜æ•ˆ
- å¯¹äºè€å¹´ä»£ï¼Œå›æ”¶æ¬¡æ•°å°‘ï¼Œä½¿ç”¨ä¸²è¡Œæ–¹å¼èŠ‚çœèµ„æºï¼ˆCPUå¹¶è¡Œéœ€è¦åˆ‡æ¢çº¿ç¨‹ï¼Œä¸²è¡Œå¯ä»¥çœå»åˆ‡æ¢çº¿ç¨‹çš„èµ„æºï¼‰



****



#### Parallel

Parallel Scavengeæ”¶é›†å™¨æ˜¯åº”ç”¨äºæ–°ç”Ÿä»£çš„å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼Œ**é‡‡ç”¨å¤åˆ¶ç®—æ³•**ã€å¹¶è¡Œå›æ”¶å’Œ"Stop the World"æœºåˆ¶

Parallel Oldæ”¶é›†å™¨ï¼šæ˜¯ä¸€ä¸ªåº”ç”¨äºè€å¹´ä»£çš„å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼Œ**é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•**

å¯¹æ¯”å…¶ä»–å›æ”¶å™¨ï¼š

* å…¶å®ƒæ”¶é›†å™¨ç›®æ ‡æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´
* Parallelç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼Œè¢«ç§°ä¸ºâ€œååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨
* Parallel Scavengeå¯¹æ¯”ParNewæ‹¥æœ‰**è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥**ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªå¼€å…³å‚æ•°æ‰“å¼€GC Ergonomics

åº”ç”¨åœºæ™¯ï¼š

* åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒ
* é«˜ååé‡å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨ CPU æ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œé€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’

åœé¡¿æ—¶é—´å’Œååé‡çš„å…³ç³»ï¼šæ–°ç”Ÿä»£ç©ºé—´å˜å° -> ç¼©çŸ­åœé¡¿æ—¶é—´ -> åƒåœ¾å›æ”¶å˜å¾—é¢‘ç¹ -> å¯¼è‡´ååé‡ä¸‹é™

åœ¨æ³¨é‡ååé‡åŠCPUèµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘Parallel Scavenge+Parallel Oldæ”¶é›†å™¨ï¼Œåœ¨serveræ¨¡å¼ä¸‹çš„å†…å­˜å›æ”¶æ€§èƒ½å¾ˆå¥½ï¼Œ**Java8é»˜è®¤æ˜¯æ­¤åƒåœ¾æ”¶é›†å™¨ç»„åˆ**

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-ParallelScavengeæ”¶é›†å™¨.png)

å‚æ•°é…ç½®ï¼š

* `-XX:+UseAdaptivesizepplicy`ï¼šè®¾ç½®Parallel scavengeæ”¶é›†å™¨å…·æœ‰**è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥**ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¹´è½»ä»£çš„å¤§å°ã€Edenå’ŒSurvivorçš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ç­‰å‚æ•°ä¼šè¢«è‡ªåŠ¨è°ƒæ•´ï¼Œ**è™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡**
* `-XXï¼š+UseParallelGC`ï¼šæ‰‹åŠ¨æŒ‡å®šå¹´è½»ä»£ä½¿ç”¨Paralleå¹¶è¡Œæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡

* `-XXï¼š+UseParalleloldcc`ï¼šæ‰‹åŠ¨æŒ‡å®šè€å¹´ä»£ä½¿ç”¨å¹¶è¡Œå›æ”¶æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡
  * ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤å¼€å¯ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¹Ÿä¼šè¢«å¼€å¯ï¼ˆäº’ç›¸æ¿€æ´»ï¼‰ï¼Œé»˜è®¤jdk8æ˜¯å¼€å¯çš„
* `-XX:ParallelGcrhreads`ï¼šè®¾ç½®å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚ä¸€èˆ¬æœ€å¥½ä¸CPUæ•°é‡ç›¸ç­‰ï¼Œä»¥é¿å…è¿‡å¤šçš„çº¿ç¨‹æ•°å½±å“åƒåœ¾æ”¶é›†æ€§èƒ½
  * åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“CPUæ•°é‡å°äº8ä¸ªï¼ŒParallelGcThreadsçš„å€¼ç­‰äºCPUæ•°é‡
  * å½“CPUæ•°é‡å¤§äº8ä¸ªï¼ŒParallelGCThreadsçš„å€¼ç­‰äº3+[5*CPU Count]/8]
* `-XX:MaxGCPauseMillis`ï¼šè®¾ç½®åƒåœ¾æ”¶é›†å™¨æœ€å¤§åœé¡¿æ—¶é—´ï¼ˆå³STWçš„æ—¶é—´ï¼‰ï¼Œå•ä½æ˜¯æ¯«ç§’
  * å¯¹äºç”¨æˆ·æ¥è®²ï¼Œåœé¡¿æ—¶é—´è¶ŠçŸ­ä½“éªŒè¶Šå¥½ï¼›åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ³¨é‡é«˜å¹¶å‘ï¼Œæ•´ä½“çš„ååé‡
  * ä¸ºäº†æŠŠåœé¡¿æ—¶é—´æ§åˆ¶åœ¨MaxGCPauseMillisä»¥å†…ï¼Œæ”¶é›†å™¨åœ¨å·¥ä½œæ—¶ä¼šè°ƒæ•´Javaå †å¤§å°æˆ–å…¶ä»–ä¸€äº›å‚æ•°
* `-XX:GCTimeRatio`ï¼šåƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ä¾‹ï¼ˆ=1/ï¼ˆN+1ï¼‰ï¼‰ï¼Œç”¨äºè¡¡é‡ååé‡çš„å¤§å°
  * å–å€¼èŒƒå›´ï¼ˆ0ï¼Œ100ï¼‰ã€‚é»˜è®¤å€¼99ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶æ—¶é—´ä¸è¶…è¿‡1
  * ä¸`-xx:MaxGCPauseMillis`å‚æ•°æœ‰ä¸€å®šçŸ›ç›¾æ€§ï¼Œæš‚åœæ—¶é—´è¶Šé•¿ï¼ŒRadioå‚æ•°å°±å®¹æ˜“è¶…è¿‡è®¾å®šçš„æ¯”ä¾‹



***



#### CMS

CMSå…¨ç§° Concurrent Mark Sweepï¼Œæ˜¯ä¸€æ¬¾**å¹¶å‘**çš„ã€ä½¿ç”¨**æ ‡è®°-æ¸…é™¤**ç®—æ³•ã€é’ˆå¯¹è€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨ï¼Œå…¶æœ€å¤§ç‰¹ç‚¹æ˜¯**è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œ**

CMSæ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œåœé¡¿æ—¶é—´è¶ŠçŸ­ï¼ˆä½å»¶è¿Ÿï¼‰è¶Šé€‚åˆä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒï¼Œç›®å‰å¤§éƒ¨åˆ†çš„Javaåº”ç”¨é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–è€…B/Sç³»ç»Ÿçš„æœåŠ¡ç«¯ä¸Š

åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæµç¨‹ï¼š

- åˆå§‹æ ‡è®°ï¼šä½¿ç”¨STWå‡ºç°çŸ­æš‚åœé¡¿ï¼Œä»…æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œ
- å¹¶å‘æ ‡è®°ï¼šè¿›è¡Œ GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾ï¼Œåœ¨æ•´ä¸ªå›æ”¶è¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿ï¼Œä¸éœ€è¦STWï¼Œå¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œ
- é‡æ–°æ ‡è®°ï¼šä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œæ¯”åˆå§‹æ ‡è®°æ—¶é—´é•¿ä½†è¿œæ¯”å¹¶å‘æ ‡è®°æ—¶é—´çŸ­ï¼Œéœ€è¦STW
- å¹¶å‘æ¸…é™¤ï¼šæ¸…é™¤æ ‡è®°ä¸ºå¯ä»¥å›æ”¶å¯¹è±¡ï¼Œç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªé˜¶æ®µå¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘çš„ï¼Œè¿™åŒæ ·æ˜¯ä¸é€‰æ‹©æ ‡è®°æ•´ç†ç®—æ³•çš„åŸå› 

åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œä¸éœ€è¦è¿›è¡Œåœé¡¿

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-CMSæ”¶é›†å™¨.png)

ä¼˜ç‚¹ï¼šå¹¶å‘æ”¶é›†ã€ä½å»¶è¿Ÿ

ç¼ºç‚¹ï¼š

- ååé‡é™ä½ï¼šåœ¨å¹¶å‘é˜¶æ®µè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·åœé¡¿ï¼Œä½†æ˜¯ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼ŒCPU åˆ©ç”¨ç‡ä¸å¤Ÿé«˜
- CMSæ”¶é›†å™¨æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå¯èƒ½å‡ºç° Concurrent Mode Failureå¯¼è‡´å¦ä¸€æ¬¡Full GCçš„äº§ç”Ÿã€‚
  æµ®åŠ¨åƒåœ¾æ˜¯æŒ‡å¹¶å‘æ¸…é™¤é˜¶æ®µç”±äºç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œäº§ç”Ÿçš„åƒåœ¾ï¼Œè¿™éƒ¨åˆ†åƒåœ¾åªèƒ½åˆ°ä¸‹ä¸€æ¬¡ GC æ—¶æ‰èƒ½è¿›è¡Œå›æ”¶ã€‚ç”±äºæµ®åŠ¨åƒåœ¾çš„å­˜åœ¨ï¼Œéœ€è¦é¢„ç•™å‡ºä¸€éƒ¨åˆ†å†…å­˜ï¼ŒCMS æ”¶é›†ä¸èƒ½ç­‰å¾…è€å¹´ä»£å¿«æ»¡çš„æ—¶å€™å†å›æ”¶ï¼Œå¦‚æœé¢„ç•™çš„å†…å­˜ä¸å¤Ÿå­˜æ”¾æµ®åŠ¨åƒåœ¾ï¼Œå°±ä¼šå‡ºç° Concurrent Mode Failureï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†ä¸´æ—¶å¯ç”¨ Serial Old æ¥æ›¿ä»£ CMSï¼Œå¯¼è‡´å¾ˆé•¿çš„åœé¡¿æ—¶é—´
- æ ‡è®° - æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡ï¼Œå¾€å¾€å‡ºç°è€å¹´ä»£ç©ºé—´æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡ Full GCï¼›ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼Œå°†æ— æ³•ä½¿ç”¨æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰æŠ€æœ¯ï¼Œè€Œåªèƒ½å¤Ÿé€‰æ‹©ç©ºé—²é“¾è¡¨ï¼ˆFree Listï¼‰æ‰§è¡Œå†…å­˜åˆ†é…

å‚æ•°è®¾ç½®ï¼š

* `-XXï¼š+UseConcMarkSweepGC`ï¼šæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨CMSæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡

  å¼€å¯è¯¥å‚æ•°åä¼šè‡ªåŠ¨å°†`-XX:+UseParNewGC`æ‰“å¼€ï¼Œå³ï¼šParNew+CMS+Serial oldçš„ç»„åˆ

* `-XX:CMSInitiatingoccupanyFraction`ï¼šè®¾ç½®å †å†…å­˜ä½¿ç”¨ç‡çš„é˜ˆå€¼ï¼Œä¸€æ—¦è¾¾åˆ°è¯¥é˜ˆå€¼ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶

  * JDK5åŠä»¥å‰ç‰ˆæœ¬çš„é»˜è®¤å€¼ä¸º68ï¼Œå³å½“è€å¹´ä»£çš„ç©ºé—´ä½¿ç”¨ç‡è¾¾åˆ°68%æ—¶ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡CMSå›æ”¶ï¼ŒJDK6åŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å€¼ä¸º92%

* `-XX:+UseCMSCompactAtFullCollection`ï¼šç”¨äºæŒ‡å®šåœ¨æ‰§è¡Œå®ŒFull GCåå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œä»¥æ­¤é¿å…å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿï¼Œç”±äºå†…å­˜å‹ç¼©æ•´ç†è¿‡ç¨‹æ— æ³•å¹¶å‘æ‰§è¡Œï¼Œæ‰€å¸¦æ¥çš„é—®é¢˜å°±æ˜¯åœé¡¿æ—¶é—´å˜å¾—æ›´é•¿

* `-XX:CMSFullGCsBeforecompaction`ï¼šè®¾ç½®åœ¨æ‰§è¡Œå¤šå°‘æ¬¡Full GCåå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†

* `-XX:ParallelCMSThreads`ï¼šè®¾ç½®CMSçš„çº¿ç¨‹æ•°é‡

  * CMSé»˜è®¤å¯åŠ¨çš„çº¿ç¨‹æ•°æ˜¯(ParallelGCThreads+3)/4ï¼ŒParallelGCThreadsæ˜¯å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°
  * æ”¶é›†çº¿ç¨‹å ç”¨çš„CPUèµ„æºå¤šäº25%ï¼Œå¯¹ç”¨æˆ·ç¨‹åºå½±å“å¯èƒ½è¾ƒå¤§ï¼›å½“CPUèµ„æºæ¯”è¾ƒç´§å¼ æ—¶ï¼Œå—åˆ°CMSæ”¶é›†å™¨çº¿ç¨‹çš„å½±å“ï¼Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½åœ¨åƒåœ¾å›æ”¶é˜¶æ®µå¯èƒ½ä¼šéå¸¸ç³Ÿç³•

Serial GCã€Parallel GCã€Concurrent Mark Sweep GCè¿™ä¸‰ä¸ªGCä¸åŒï¼š

- æœ€å°åŒ–åœ°ä½¿ç”¨å†…å­˜å’Œå¹¶è¡Œå¼€é”€ï¼Œé€‰Serial GC
- æœ€å¤§åŒ–åº”ç”¨ç¨‹åºçš„ååé‡ï¼Œé€‰Parallel GC
- æœ€å°åŒ–GCçš„ä¸­æ–­æˆ–åœé¡¿æ—¶é—´ï¼Œé€‰CMS GC



***



#### G1

##### ç‰¹ç‚¹

G1ï¼ˆGarbage-Firstï¼‰æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œ**åº”ç”¨äºæ–°ç”Ÿä»£å’Œè€å¹´ä»£**ã€é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€è½¯å®æ—¶ã€ä½å»¶è¿Ÿã€å¯è®¾å®šç›®æ ‡(æœ€å¤§STWåœé¡¿æ—¶é—´)çš„åƒåœ¾å›æ”¶å™¨ï¼Œç”¨äºä»£æ›¿CMSï¼Œé€‚ç”¨äºè¾ƒå¤§çš„å †(>4~6G)ï¼Œåœ¨JDK9ä¹‹åé»˜è®¤ä½¿ç”¨G1

å¹¶å‘ä¸å¹¶è¡Œï¼š

* å¹¶è¡Œæ€§ï¼šG1åœ¨å›æ”¶æœŸé—´ï¼Œå¯ä»¥æœ‰å¤šä¸ªGCçº¿ç¨‹åŒæ—¶å·¥ä½œï¼Œæœ‰æ•ˆåˆ©ç”¨å¤šæ ¸è®¡ç®—èƒ½åŠ›ï¼Œæ­¤æ—¶ç”¨æˆ·çº¿ç¨‹STW
* å¹¶å‘æ€§ï¼šG1æ‹¥æœ‰ä¸åº”ç”¨ç¨‹åºäº¤æ›¿æ‰§è¡Œçš„èƒ½åŠ›ï¼Œéƒ¨åˆ†å·¥ä½œå¯ä»¥å’Œåº”ç”¨ç¨‹åºåŒæ—¶æ‰§è¡Œï¼Œå› æ­¤ä¸ä¼šåœ¨æ•´ä¸ªå›æ”¶é˜¶æ®µå‘ç”Ÿå®Œå…¨é˜»å¡åº”ç”¨ç¨‹åºçš„æƒ…å†µ
* HotSpotåƒåœ¾æ”¶é›†å™¨é‡Œï¼Œå…¶ä»–çš„åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨å†…ç½®çš„JVMçº¿ç¨‹æ‰§è¡ŒGCçš„å¤šçº¿ç¨‹æ“ä½œï¼Œè€ŒG1 GCå¯ä»¥é‡‡ç”¨åº”ç”¨çº¿ç¨‹æ‰¿æ‹…åå°è¿è¡Œçš„GCå·¥ä½œï¼Œå³å½“JVMçš„GCçº¿ç¨‹å¤„ç†é€Ÿåº¦æ…¢æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨åº”ç”¨ç¨‹åºçº¿ç¨‹åŠ é€Ÿåƒåœ¾å›æ”¶è¿‡ç¨‹

åˆ†ä»£æ”¶é›†ï¼š

* ä»åˆ†ä»£ä¸Šçœ‹ï¼ŒG1ä¾ç„¶å±äºåˆ†ä»£å‹åƒåœ¾å›æ”¶å™¨ï¼Œä¼šåŒºåˆ†å¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œå¹´è½»ä»£ä¾ç„¶æœ‰EdenåŒºå’ŒSurvivoråŒºã€‚ä»å †çš„ç»“æ„ä¸Šçœ‹ï¼Œä¸è¦æ±‚æ•´ä¸ªEdenåŒºã€å¹´è½»ä»£æˆ–è€…è€å¹´ä»£éƒ½æ˜¯è¿ç»­çš„ï¼Œä¹Ÿä¸å†åšæŒå›ºå®šå¤§å°å’Œå›ºå®šæ•°é‡
* å°†æ•´ä¸ªJavaå †åˆ’åˆ†æˆçº¦2048ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹Regionå—ï¼Œæ¯ä¸ªRegionå—å¤§å°æ ¹æ®å †ç©ºé—´çš„å®é™…å¤§å°è€Œå®šï¼Œæ•´ä½“è¢«æ§åˆ¶åœ¨1MBåˆ°32MBä¹‹é—´ä¸”ä¸º2**çš„Næ¬¡å¹‚**ï¼Œæ‰€æœ‰çš„Regionå¤§å°ç›¸åŒï¼Œä¸”åœ¨JVMç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šè¢«æ”¹å˜
* G1 æŠŠå †åˆ’åˆ†æˆå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œä»è€Œå°†åŸæ¥çš„ä¸€æ•´å—å†…å­˜ç©ºé—´åˆ’åˆ†æˆå¤šä¸ªçš„å°ç©ºé—´ï¼Œä½¿å¾—æ¯ä¸ªå°ç©ºé—´å¯ä»¥å•ç‹¬è¿›è¡Œåƒåœ¾å›æ”¶ï¼›æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†ç‰©ç†éš”ç¦»ï¼Œä¸ç”¨æ‹…å¿ƒæ¯ä¸ªä»£å†…å­˜æ˜¯å¦è¶³å¤Ÿ

* **æ–°çš„åŒºåŸŸHumongous**ï¼šæœ¬èº«å±äºè€å¹´ä»£åŒºï¼Œå½“å‡ºç°äº†ä¸€ä¸ªå·¨å¤§çš„å¯¹è±¡ï¼Œè¶…å‡ºäº†åˆ†åŒºå®¹é‡çš„ä¸€åŠï¼Œåˆ™è¿™ä¸ªå¯¹è±¡ä¼šè¿›å…¥åˆ°è¯¥åŒºåŸŸã€‚å¦‚æœä¸€ä¸ªHåŒºè£…ä¸ä¸‹ä¸€ä¸ªå·¨å‹å¯¹è±¡ï¼Œé‚£ä¹ˆG1ä¼šå¯»æ‰¾è¿ç»­çš„Håˆ†åŒºæ¥å­˜å‚¨ï¼Œä¸ºäº†èƒ½æ‰¾åˆ°è¿ç»­çš„HåŒº ï¼Œæœ‰æ—¶å€™ä¸å¾—ä¸å¯åŠ¨Full GC
* G1 ä¸ä¼šå¯¹å·¨å‹å¯¹è±¡è¿›è¡Œæ‹·è´ï¼Œå›æ”¶æ—¶è¢«ä¼˜å…ˆè€ƒè™‘ï¼ŒG1 ä¼šè·Ÿè¸ªè€å¹´ä»£æ‰€æœ‰ incoming å¼•ç”¨ï¼Œè¿™æ ·è€å¹´ä»£incoming å¼•ç”¨ä¸º0 çš„å·¨å‹å¯¹è±¡å°±å¯ä»¥åœ¨æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶å¤„ç†æ‰
* æ¯ä¸ªRegionéƒ½æ˜¯é€šè¿‡æŒ‡é’ˆç¢°æ’ï¼ˆBump the pointerï¼‰æ¥åˆ†é…ç©ºé—´

Regionç»“æ„å›¾ï¼š

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-G1 RegionåŒºåŸŸ.png)

**G1å¯¹æ¯”CMSä¼˜ç‚¹**ï¼š

- **ç©ºé—´æ•´åˆ**ï¼š

  - CMSï¼šâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ã€å†…å­˜ç¢ç‰‡ã€è‹¥å¹²æ¬¡GCåè¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†
  - G1ï¼šæ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®° - æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆRegion ä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ï¼Œä¸¤ç§ç®—æ³•éƒ½å¯ä»¥é¿å…å†…å­˜ç¢ç‰‡
  - è¿™ç§ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡GCï¼Œå°¤å…¶æ˜¯å½“Javaå †éå¸¸å¤§çš„æ—¶å€™ï¼ŒG1çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾

- **å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³ï¼šè½¯å®æ—¶soft real-timeï¼‰**ï¼š

  - G1é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨ GC ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’
  - ç”±äºåˆ†åŒºçš„åŸå› ï¼ŒG1å¯ä»¥åªé€‰å–éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå†…å­˜å›æ”¶ï¼Œè¿™æ ·ç¼©å°äº†å›æ”¶çš„èŒƒå›´ï¼Œå› æ­¤å¯¹äºå…¨å±€åœé¡¿æƒ…å†µçš„å‘ç”Ÿä¹Ÿèƒ½å¾—åˆ°è¾ƒå¥½çš„æ§åˆ¶
  - G1è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionï¼Œä¿è¯äº†G1æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…å¯ä»¥è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡

  * ç›¸æ¯”äºCMS GCï¼ŒG1æœªå¿…èƒ½åšåˆ°CMSåœ¨æœ€å¥½æƒ…å†µä¸‹çš„å»¶æ—¶åœé¡¿ï¼Œä½†æ˜¯æœ€å·®æƒ…å†µè¦å¥½å¾ˆ

G1åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹ï¼š

* ç›¸è¾ƒäºCMSï¼ŒG1è¿˜ä¸å…·å¤‡å…¨æ–¹ä½ã€å‹å€’æ€§ä¼˜åŠ¿ã€‚æ¯”å¦‚åœ¨ç”¨æˆ·ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒG1æ— è®ºæ˜¯ä¸ºäº†åƒåœ¾æ”¶é›†äº§ç”Ÿçš„å†…å­˜å ç”¨ï¼ˆFootprintï¼‰è¿˜æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„é¢å¤–æ‰§è¡Œè´Ÿè½½ï¼ˆoverloadï¼‰éƒ½è¦æ¯”CMSè¦é«˜
* ä»ç»éªŒä¸Šæ¥è¯´ï¼Œåœ¨å°å†…å­˜åº”ç”¨ä¸ŠCMSçš„è¡¨ç°å¤§æ¦‚ç‡ä¼šä¼˜äºG1ï¼Œè€ŒG1åœ¨å¤§å†…å­˜åº”ç”¨ä¸Šåˆ™å‘æŒ¥å…¶ä¼˜åŠ¿ã€‚å¹³è¡¡ç‚¹åœ¨6-8GBä¹‹é—´

åº”ç”¨åœºæ™¯ï¼š

* é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œé’ˆå¯¹å…·æœ‰å¤§å†…å­˜ã€å¤šå¤„ç†å™¨çš„æœºå™¨
* éœ€è¦ä½GCå»¶è¿Ÿï¼Œå¹¶å…·æœ‰å¤§å †çš„åº”ç”¨ç¨‹åºæä¾›è§£å†³æ–¹æ¡ˆ





##### å‚æ•°

- `-XX:+UseG1GC`ï¼šæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨G1åƒåœ¾æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡
- `-XX:G1HeapRegionSize`ï¼šè®¾ç½®æ¯ä¸ªRegionçš„å¤§å°ã€‚å€¼æ˜¯2çš„å¹‚ï¼ŒèŒƒå›´æ˜¯1MBåˆ°32MBä¹‹é—´ï¼Œç›®æ ‡æ˜¯æ ¹æ®æœ€å°çš„Javaå †å¤§å°åˆ’åˆ†å‡ºçº¦2048ä¸ªåŒºåŸŸï¼Œé»˜è®¤æ˜¯å †å†…å­˜çš„1/2000
- `-XX:MaxGCPauseMillis`ï¼šè®¾ç½®æœŸæœ›è¾¾åˆ°çš„æœ€å¤§GCåœé¡¿æ—¶é—´æŒ‡æ ‡ (JVMä¼šå°½åŠ›å®ç°ï¼Œä½†ä¸ä¿è¯è¾¾åˆ°)ï¼Œé»˜è®¤å€¼æ˜¯200ms
- `-XX:+ParallelGcThread`ï¼šè®¾ç½®STWå·¥ä½œçº¿ç¨‹æ•°çš„å€¼ï¼Œæœ€å¤šè®¾ç½®ä¸º8
- `-XX:ConcGCThreads`ï¼šè®¾ç½®å¹¶å‘æ ‡è®°çº¿ç¨‹æ•°ï¼Œè®¾ç½®ä¸ºå¹¶è¡Œåƒåœ¾å›æ”¶çº¿ç¨‹æ•°(ParallelGcThreads) çš„1/4å·¦å³
- `-XX:InitiatingHeapoccupancyPercent`ï¼šè®¾ç½®è§¦å‘å¹¶å‘Mixed GCå‘¨æœŸçš„Javaå †å ç”¨ç‡é˜ˆå€¼ï¼Œè¶…è¿‡æ­¤å€¼ï¼Œå°±è§¦å‘GCï¼Œé»˜è®¤å€¼æ˜¯45
- `-XX:+ClassUnloadingWithConcurrentMark`ï¼šå¹¶å‘æ ‡è®°ç±»å¸è½½ï¼Œé»˜è®¤å¯ç”¨ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½ç»è¿‡å¹¶å‘æ ‡è®°åï¼Œå°±å¯ä»¥çŸ¥é“å“ªäº›ç±»ä¸å†è¢«ä½¿ç”¨ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨çš„æ‰€æœ‰ç±»éƒ½ä¸å†ä½¿ç”¨ï¼Œåˆ™å¸è½½å®ƒæ‰€åŠ è½½çš„æ‰€æœ‰ç±»





##### è®°å¿†é›†

æ¯ä¸ª Region éƒ½æœ‰ä¸€ä¸ª Remembered Setï¼Œç”¨æ¥è®°å½•è¯¥ Region å¯¹è±¡çš„å¼•ç”¨å¯¹è±¡æ‰€åœ¨çš„ Region

* Referenceç±»å‹æ•°æ®å†™æ“ä½œæ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªWrite Barrieræš‚æ—¶ä¸­æ–­æ“ä½œï¼Œæ£€æŸ¥å°†è¦å†™å…¥çš„å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦å’Œè¯¥Referenceç±»å‹æ•°æ®åœ¨ä¸åŒçš„Regionï¼ˆå…¶ä»–æ”¶é›†å™¨ï¼šæ£€æŸ¥è€å¹´ä»£å¯¹è±¡æ˜¯å¦å¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ï¼‰ï¼Œå¦‚æœä¸åŒï¼Œé€šè¿‡CardTableæŠŠç›¸å…³å¼•ç”¨ä¿¡æ¯è®°å½•åˆ°å¼•ç”¨æŒ‡å‘å¯¹è±¡çš„æ‰€åœ¨Regionå¯¹åº”çš„Remembered Setä¸­
* å½“è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œåœ¨GCæ ¹èŠ‚ç‚¹çš„æšä¸¾èŒƒå›´åŠ å…¥Remembered Setï¼Œå°±å¯ä»¥ä¿è¯ä¸è¿›è¡Œå…¨å±€æ‰«æï¼Œä¹Ÿä¸ä¼šæœ‰é—æ¼



##### å›æ”¶

G1ä¸­æä¾›äº†ä¸‰ç§åƒåœ¾å›æ”¶æ¨¡å¼ï¼šYoungGCã€Mixed GCå’ŒFu11GCï¼Œåœ¨ä¸åŒçš„æ¡ä»¶ä¸‹è¢«è§¦å‘

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-G1å›æ”¶è¿‡ç¨‹.png)

é¡ºæ—¶é’ˆï¼šyoung gc -> young gc+concurrent mark -> Mixed GCé¡ºåºï¼Œè¿›è¡Œåƒåœ¾å›æ”¶

* **Young GC**ï¼šå‘ç”Ÿåœ¨å¹´è½»ä»£çš„GCç®—æ³•ï¼Œä¸€èˆ¬å¯¹è±¡ï¼ˆé™¤äº†å·¨å‹å¯¹è±¡ï¼‰éƒ½æ˜¯åœ¨eden regionä¸­åˆ†é…å†…å­˜ï¼Œå½“æ‰€æœ‰eden regionè¢«è€—å°½æ— æ³•ç”³è¯·å†…å­˜æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡young gcï¼Œæ´»è·ƒå¯¹è±¡ä¼šè¢«æ‹·è´åˆ°survivor regionæˆ–è€…æ™‹å‡åˆ°old regionä¸­ï¼Œç©ºé—²çš„regionä¼šè¢«æ”¾å…¥ç©ºé—²åˆ—è¡¨ä¸­ï¼Œç­‰å¾…ä¸‹æ¬¡è¢«ä½¿ç”¨

  YGCæ—¶ï¼ŒG1åœæ­¢åº”ç”¨ç¨‹åºçš„æ‰§è¡Œ (Stop-The-Wor1d)ï¼ŒG1åˆ›å»ºå›æ”¶é›† (Collection Set)ï¼Œå›æ”¶é›†æ˜¯æŒ‡éœ€è¦è¢«å›æ”¶çš„å†…å­˜åˆ†æ®µçš„é›†åˆï¼Œå¹´è½»ä»£å›æ”¶è¿‡ç¨‹çš„å›æ”¶é›†åŒ…å«å¹´è½»ä»£EdenåŒºå’ŒSurvivoråŒºæ‰€æœ‰çš„å†…å­˜åˆ†æ®µ

  **å›æ”¶è¿‡ç¨‹**ï¼š

  1. æ‰«ææ ¹ï¼šæ ¹å¼•ç”¨è¿åŒRSetè®°å½•çš„å¤–éƒ¨å¼•ç”¨ä½œä¸ºæ‰«æå­˜æ´»å¯¹è±¡çš„å…¥å£

  2. æ›´æ–°RSetï¼šå¤„ç†dirty card queue ä¸­çš„cardï¼Œæ›´æ–°RSetï¼›æ­¤é˜¶æ®µå®Œæˆåï¼ŒRSetå¯ä»¥å‡†ç¡®çš„åæ˜ è€å¹´ä»£å¯¹æ‰€åœ¨çš„å†…å­˜åˆ†æ®µä¸­å¯¹è±¡çš„å¼•ç”¨

  3. å¤„ç†RSetï¼šè¯†åˆ«è¢«è€å¹´ä»£å¯¹è±¡æŒ‡å‘çš„Edenä¸­çš„å¯¹è±¡ï¼Œè¿™äº›è¢«æŒ‡å‘çš„Edenä¸­çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯å­˜æ´»çš„å¯¹è±¡

  4. å¤åˆ¶å¯¹è±¡ï¼šå¯¹è±¡æ ‘è¢«éå†ï¼ŒEdenåŒºå†…å­˜æ®µä¸­å­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°SurvivoråŒºä¸­ç©ºçš„å†…å­˜åˆ†æ®µï¼ŒSurvivoråŒºå†…å­˜æ®µä¸­å­˜æ´»çš„å¯¹è±¡å¦‚æœå¹´é¾„æœªè¾¾é˜ˆå€¼ï¼Œå¹´é¾„ä¼šåŠ 1ï¼Œè¾¾åˆ°é˜€å€¼ä¼šè¢«ä¼šè¢«å¤åˆ¶åˆ°oldåŒºä¸­ç©ºçš„å†…å­˜åˆ†æ®µï¼Œå¦‚æœSurvivorç©ºé—´ä¸å¤Ÿï¼ŒEdenç©ºé—´çš„éƒ¨åˆ†æ•°æ®ä¼šç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ç©ºé—´

  5. å¤„ç†å¼•ç”¨ï¼šå¤„ç†Softï¼ŒWeakï¼ŒPhantomï¼ŒJNI Weak ç­‰å¼•ç”¨ï¼Œæœ€ç»ˆEdenç©ºé—´çš„æ•°æ®ä¸ºç©ºï¼ŒGCåœæ­¢å·¥ä½œ

* **Mixed GC**ï¼šå½“è¶Šæ¥è¶Šå¤šçš„å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£old regionæ—¶ï¼Œä¸ºäº†é¿å…å †å†…å­˜è¢«è€—å°½ï¼Œè™šæ‹Ÿæœºä¼šè§¦å‘ä¸€ä¸ªæ··åˆçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå³**mixed gc**ï¼Œé™¤äº†å›æ”¶æ•´ä¸ªyoung regionï¼Œè¿˜ä¼šå›æ”¶ä¸€éƒ¨åˆ†çš„old regionï¼Œ**è¿‡ç¨‹åŒYGC**

  æ³¨æ„ï¼š**æ˜¯ä¸€éƒ¨åˆ†è€å¹´ä»£ï¼Œè€Œä¸æ˜¯å…¨éƒ¨è€å¹´ä»£**ï¼Œå¯ä»¥é€‰æ‹©å“ªäº›old regionæ”¶é›†ï¼Œå¯¹åƒåœ¾å›æ”¶çš„è€—æ—¶æ—¶é—´è¿›è¡Œæ§åˆ¶

  åœ¨G1ä¸­ï¼ŒMixed GCå¯ä»¥é€šè¿‡`-XX:InitiatingHeapOccupancyPercent`è®¾ç½®é˜ˆå€¼

* **Full GC**ï¼šå¦‚æœå¯¹è±¡å†…å­˜åˆ†é…é€Ÿåº¦è¿‡å¿«ï¼ŒMixed GCæ¥ä¸åŠå›æ”¶ï¼Œå¯¼è‡´è€å¹´ä»£è¢«å¡«æ»¡ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡Full GCï¼ŒG1çš„Full GCç®—æ³•å°±æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„åƒåœ¾å›æ”¶ï¼Œä¼šå¯¼è‡´å¼‚å¸¸é•¿æ—¶é—´çš„æš‚åœæ—¶é—´ï¼Œéœ€è¦è¿›è¡Œä¸æ–­çš„è°ƒä¼˜ï¼Œå°½å¯èƒ½çš„é¿å…Full GC

  **äº§ç”ŸFull GCçš„åŸå› **ï¼š

  * æ™‹å‡æ—¶æ²¡æœ‰è¶³å¤Ÿçš„to-spaceæ¥å­˜æ”¾æ™‹å‡çš„å¯¹è±¡
  * å¹¶å‘å¤„ç†è¿‡ç¨‹å®Œæˆä¹‹å‰ç©ºé—´è€—å°½

G1 æ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹ï¼š

- **åˆå§‹æ ‡è®°**ï¼šæ ‡è®°ä»æ ¹èŠ‚ç‚¹ç›´æ¥å¯è¾¾çš„å¯¹è±¡ï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯STWçš„ï¼Œå¹¶ä¸”ä¼šè§¦å‘ä¸€æ¬¡å¹´è½»ä»£GC
- æ ¹åŒºåŸŸæ‰«æ (Root Region Scanning)ï¼šG1 GCæ‰«æsurvivoråŒºç›´æ¥å¯è¾¾çš„è€å¹´ä»£åŒºåŸŸå¯¹è±¡ï¼Œå¹¶æ ‡è®°è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿™ä¸€è¿‡ç¨‹å¿…é¡»åœ¨Young GCä¹‹å‰å®Œæˆ
- **å¹¶å‘æ ‡è®°** (Concurrent Marking)ï¼šåœ¨æ•´ä¸ªå †ä¸­è¿›è¡Œå¹¶å‘æ ‡è®°ï¼ˆå’Œåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼‰ï¼Œå¯èƒ½è¢«YoungGCä¸­æ–­ã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œè‹¥å‘ç°åŒºåŸŸå¯¹è±¡ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯åƒåœ¾ï¼Œé‚£è¿™ä¸ªåŒºåŸŸä¼šè¢«ç«‹å³å›æ”¶ï¼ŒåŒæ—¶å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œä¼šè®¡ç®—æ¯ä¸ªåŒºåŸŸçš„å¯¹è±¡æ´»æ€§ï¼Œå³åŒºåŸŸä¸­å­˜æ´»å¯¹è±¡çš„æ¯”ä¾‹
- **æœ€ç»ˆæ ‡è®°**ï¼šä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„ Remembered Set Logs é‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠ Remembered Set Logs çš„æ•°æ®åˆå¹¶åˆ° Remembered Set ä¸­ï¼Œè¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œ
- **ç­›é€‰å›æ”¶**ï¼šå¹¶å‘æ¸…ç†é˜¶æ®µï¼Œé¦–å…ˆå¯¹å„ä¸ª Region ä¸­çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„ GC åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ† Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆç‡

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-G1æ”¶é›†å™¨.jpg)





##### è°ƒä¼˜

G1çš„è®¾è®¡åŸåˆ™å°±æ˜¯ç®€åŒ–JVMæ€§èƒ½è°ƒä¼˜ï¼Œåªéœ€è¦ç®€å•çš„ä¸‰æ­¥å³å¯å®Œæˆè°ƒä¼˜ï¼š

1. å¼€å¯G1åƒåœ¾æ”¶é›†å™¨
2. è®¾ç½®å †çš„æœ€å¤§å†…å­˜
3. è®¾ç½®æœ€å¤§çš„åœé¡¿æ—¶é—´ï¼ˆstwï¼‰

**ä¸æ–­è°ƒä¼˜æš‚åœæ—¶é—´æŒ‡æ ‡**ï¼š

* `XX:MaxGCPauseMillis=x`å¯ä»¥è®¾ç½®å¯åŠ¨åº”ç”¨ç¨‹åºæš‚åœçš„æ—¶é—´ï¼ŒG1åœ¨è¿è¡Œçš„æ—¶å€™ä¼šæ ¹æ®è¿™ä¸ªå‚æ•°é€‰æ‹©CSetæ¥æ»¡è¶³å“åº”æ—¶é—´çš„è®¾ç½®
* è®¾ç½®åˆ°100msæˆ–è€…200mséƒ½å¯ä»¥(ä¸åŒæƒ…å†µä¸‹ä¼šä¸ä¸€æ ·)ï¼Œä½†è®¾ç½®æˆ50mså°±ä¸å¤ªåˆç†
* æš‚åœæ—¶é—´è®¾ç½®çš„å¤ªçŸ­ï¼Œå°±ä¼šå¯¼è‡´å‡ºç°G1è·Ÿä¸ä¸Šåƒåœ¾äº§ç”Ÿçš„é€Ÿåº¦ï¼Œæœ€ç»ˆé€€åŒ–æˆFull GC
* å¯¹è¿™ä¸ªå‚æ•°çš„è°ƒä¼˜æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œé€æ­¥è°ƒæ•´åˆ°æœ€ä½³çŠ¶æ€

**ä¸è¦è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å¤§å°**ï¼š

- é¿å…ä½¿ç”¨-Xmnæˆ–-XX:NewRatioç­‰ç›¸å…³é€‰é¡¹æ˜¾å¼è®¾ç½®å¹´è½»ä»£å¤§å°ï¼ŒG1æ”¶é›†å™¨åœ¨è¿è¡Œçš„æ—¶å€™ä¼šè°ƒæ•´æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å¤§å°ï¼Œä»è€Œè¾¾åˆ°æˆ‘ä»¬ä¸ºæ”¶é›†å™¨è®¾ç½®çš„æš‚åœæ—¶é—´ç›®æ ‡
- è®¾ç½®äº†æ–°ç”Ÿä»£å¤§å°ç›¸å½“äºæ”¾å¼ƒäº†G1ä¸ºæˆ‘ä»¬åšçš„è‡ªåŠ¨è°ƒä¼˜ï¼Œæˆ‘ä»¬éœ€è¦åšçš„åªæ˜¯è®¾ç½®æ•´ä¸ªå †å†…å­˜çš„å¤§å°ï¼Œå‰©ä¸‹çš„äº¤ç»™G1è‡ªå·±å»åˆ†é…å„ä¸ªä»£çš„å¤§å°





***



#### æ€»ç»“

![](https://gitee.com/seazean/images/raw/master/JavaSE/JVM-åƒåœ¾å›æ”¶å™¨æ€»ç»“.png)





***



### æ—¥å¿—åˆ†æ

å†…å­˜åˆ†é…ä¸åƒåœ¾å›æ”¶çš„å‚æ•°åˆ—è¡¨ï¼šè¿›å…¥ Run/Debug Configurations   ---> VM options è®¾ç½®å‚

- `-XX:+PrintGC`ï¼šè¾“å‡ºGCæ—¥å¿—ï¼Œç±»ä¼¼ï¼š-verbose:gc
- `-XX:+PrintGcDetails`ï¼šè¾“å‡ºGCçš„è¯¦ç»†æ—¥å¿—
- `-XX:+PrintGcTimestamps`ï¼šè¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥åŸºå‡†æ—¶é—´çš„å½¢å¼ï¼‰
- `-XX:+PrintGCDatestamps`ï¼šè¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚2013-05-04T21ï¼š53ï¼š59.234+0800ï¼‰
- `-XX:+PrintHeapAtGC`ï¼šåœ¨è¿›è¡ŒGCçš„å‰åæ‰“å°å‡ºå †çš„ä¿¡æ¯
- `-Xloggc:../logs/gc.1og`ï¼šæ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„









***







# Pattern

## å•ä¾‹æ¨¡å¼

å•ä¾‹æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼å¯ä»¥ä¿è¯ç³»ç»Ÿä¸­ï¼Œ
è¯¥æ¨¡å¼çš„è¿™ä¸ªç±»æ°¸è¿œåªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚å³**ä¸€ä¸ªç±»æ°¸è¿œåªæœ‰ä¸€ä¸ªå¯¹è±¡å®ä¾‹**ã€‚
å•ä¾‹æ˜¯ä¸ºäº†èŠ‚çº¦å†…å­˜ï¼Œå•ä¾‹åœ¨æœ‰äº›ä¸šåŠ¡åœºæ™¯ä¸‹è¿˜å¿…é¡»ç”¨åˆ°ï¼ï¼

> å•ä¾‹çš„åº”ç”¨åœºæ™¯ï¼š
> åœ¨å®é™…å¼€å‘ä¸­ï¼Œæœ‰å¾ˆå¤šä¸šåŠ¡å¯¹è±¡æ°¸è¿œåªéœ€è¦ä¸€ä¸ªï¼Œæ— è®ºå¯åŠ¨å¤šå°‘æ¬¡
> æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ä»»åŠ¡ç®¡ç†å¯¹è±¡ï¼Œåªéœ€è¦ä¸€ä¸ªå¯¹è±¡ã€‚èŠ‚çº¦å†…å­˜å’Œæ€§èƒ½ã€‚
> å› ä¸ºå¯¹è±¡è¶Šå¤šå†…å­˜å ç”¨è¶Šå¤§ï¼Œææœ‰å¯èƒ½å‡ºç°å†…å­˜æº¢å‡ºï¼

* é¥¿æ±‰å•ä¾‹è®¾è®¡æ¨¡å¼
      åœ¨ç”¨ç±»è·å–å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡å·²ç»æå‰åˆ›å»ºå¥½äº†ã€‚
      a.å®šä¹‰ä¸€ä¸ªç±»ï¼ŒæŠŠæ„é€ å™¨ç§æœ‰ã€‚
      b.å®šä¹‰ä¸€ä¸ªé™æ€å˜é‡å­˜å‚¨ä¸€ä¸ªå¯¹è±¡ã€‚
      c.æä¾›ä¸€ä¸ªè¿”å›å•ä¾‹å¯¹è±¡çš„æ–¹æ³•ã€‚

* æ‡’æ±‰å•ä¾‹è®¾è®¡æ¨¡å¼
      åœ¨çœŸæ­£éœ€è¦è¯¥å¯¹è±¡çš„æ—¶å€™ï¼Œæ‰å»åˆ›å»ºä¸€ä¸ªå¯¹è±¡(å»¶è¿ŸåŠ è½½å¯¹è±¡)ã€‚
      a.å®šä¹‰ä¸€ä¸ªç±»ï¼ŒæŠŠæ„é€ å™¨ç§æœ‰ã€‚
      b.å®šä¹‰ä¸€ä¸ªé™æ€å˜é‡å­˜å‚¨ä¸€ä¸ªå¯¹è±¡ã€‚
      c.æä¾›ä¸€ä¸ªè¿”å›å•ä¾‹å¯¹è±¡çš„æ–¹æ³•ã€‚

```java
//é¥¿æ±‰å•ä¾‹è®¾è®¡æ¨¡å¼
public class SingleInstanceDemo{
    public static void main(String[] args){
        Singleton s1 = Singleton.getInstance();
        Singleton s2 = Singleton.getInstance();
        System.out.println(s1 == s2);//true
    }
}
class Singleton{
    //åœ¨ç”¨ç±»è·å–å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡å·²ç»æå‰ä¸ºä½ åˆ›å»ºå¥½äº†ã€‚
    public static final Singleton INSTANCE = new Singleton();
    private Singleton(){}
    //è¿”å›å•ä¾‹å¯¹è±¡
    public static Singleton getInstance(){
        return INSTANCE 
    }
}
```

```java
//æ‡’æ±‰å•ä¾‹è®¾è®¡æ¨¡å¼
public class SingleInstanceDemo{
    public static void main(String[] args){
        Singleton s1 = Singleton.getInstance();
        Singleton s2 = Singleton.getInstance();
        System.out.println(s1 == s2);//true
    }
}
class Singleton{
    //åœ¨ç”¨ç±»è·å–å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡è‡ªå·±åˆ›å»ºå¥½äº†ã€‚
    public static Singleton instance;
    private Singleton(){}
    //è¿”å›å•ä¾‹å¯¹è±¡
    public static Singleton getInstance(){
        if (instance == null) {
            instance = new Singleton;
        }
        return instance;
    }
}
```



***



## åŠ¨æ€ä»£ç†

ä»£ç†å°±æ˜¯è¢«ä»£ç†è€…æ²¡æœ‰èƒ½åŠ›æˆ–è€…ä¸æ„¿æ„å»å®ŒæˆæŸä»¶äº‹æƒ…ï¼Œéœ€è¦æ‰¾ä¸ªäººä»£æ›¿è‡ªå·±å»å®Œæˆè¿™ä»¶äº‹ã€‚
åŠ¨æ€ä»£ç†åªèƒ½ä¸ºå®ç°æ¥å£çš„å®ç°ç±»å¯¹è±¡åšä»£ç†(ä¹Ÿå¯ä»¥åªä¸ºæ¥å£åšä»£ç†å¯¹è±¡)

> åœ¨ä¸šåŠ¡å¼€å‘ä¸­ç»å¸¸å­˜åœ¨å¾ˆå¤šé‡å¤çš„æ–¹æ³•ä»£ç ï¼Œä»–ä»¬å‰åçš„ä»£ç å½¢å¼æ˜¯ä¸€æ ·çš„
> åªæœ‰ä¸­é—´éƒ¨åˆ†ä»£ç æœ‰å·®åˆ«ï¼ï¼è¿™ç§æ—¶å€™ä»£ç å†—ä½™è¯»å¾ˆé«˜
> æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ç›´æ¥çœç•¥å‰åé‡å¤çš„ä»£ç å°±å¯ä»¥å®ŒæˆåŠŸèƒ½ï¼Œè¿™æ—¶å€™ç”¨åŠ¨æ€ä»£ç†ã€‚

* ä¼˜ç‚¹ï¼š
  * åŠ¨æ€ä»£ç†éå¸¸çš„çµæ´»ï¼Œå¯ä»¥ä¸ºä»»æ„çš„æ¥å£å®ç°ç±»å¯¹è±¡åšä»£ç†ï¼Œå¯ä»¥ä¸ºè¢«ä»£ç†å¯¹è±¡çš„æ‰€æœ‰æ¥å£çš„æ‰€æœ‰æ–¹æ³•åšä»£ç†ï¼ŒåŠ¨æ€ä»£ç†å¯ä»¥åœ¨ä¸æ”¹å˜æ–¹æ³•æºç çš„æƒ…å†µä¸‹ï¼Œå®ç°å¯¹æ–¹æ³•åŠŸèƒ½çš„å¢å¼ºï¼›
  * åŠ¨æ€ä»£ç†ç±»ç®€åŒ–äº†ç¼–ç¨‹å·¥ä½œï¼Œæé«˜äº†è½¯ä»¶çš„å¯æ‰©å±•æ€§ï¼ŒJava åå°„æœºåˆ¶å¯ä»¥ç”Ÿæˆä»»æ„ç±»å‹çš„åŠ¨æ€ä»£ç†ç±»ã€‚
  * åŠ¨æ€ä»£ç†æé«˜äº†å¼€å‘æ•ˆç‡ã€‚
* ç¼ºç‚¹ï¼š**åªèƒ½é’ˆå¯¹æ¥å£æˆ–è€…æ¥å£çš„å®ç°ç±»å¯¹è±¡åšä»£ç†å¯¹è±¡**ï¼Œæ™®é€šç±»æ˜¯ä¸èƒ½åšä»£ç†å¯¹è±¡çš„
* åŸå› ï¼š**ç”Ÿæˆçš„ä»£ç†ç±»ç»§æ‰¿äº†Proxy**ï¼Œå› ä¸ºjavaæ˜¯å•ç»§æ‰¿çš„ï¼Œæ‰€ä»¥JDKåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ¥å£ã€‚

```java
public class TestDemo {
    public static void main(String[] args) {
        // 1.åˆ›å»ºä¸€ä¸ªä¸šåŠ¡å¯¹è±¡
        // ä¸ºæˆ‘ä»¬çš„ä¸šåŠ¡å¯¹è±¡åšæˆä¸€ä¸ªè¢«ä»£ç†çš„ä¸šåŠ¡å¯¹è±¡!!
        UserService userService = ProxyUtil.getProxy(new UserServiceImpl());
        String rs = userService.login("admin","123456");//èµ°ä»£ç†ï¼
        System.out.println(rs);
        userService.deleteAll(); // èµ°ä»£ç†ï¼
        userService.updateAll(); // èµ°ä»£ç†ï¼
    }
}
```

```java
//ä¸šåŠ¡æ¥å£
public interface UserService {
    String login(String loginName, String passWord);
    void deleteAll();
    void updateAll();
}
```

```java
//ä¸šåŠ¡å®ç°ç±»
public class UserServiceImpl implements UserService {
    @Override
    public String login(String loginName, String passWord) {
        String flag = "ç™»é™†åç§°æˆ–è€…å¯†ç é”™è¯¯";
        if("admin".equals(loginName) && "123456".equals(passWord)){
            flag = "success";
        }
        try {
            Thread.sleep(2000);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return flag;
    }
    @Override
    public void deleteAll() {
        try {
            Thread.sleep(1500);
        } catch (Exception e) {
            e.printStackTrace();
        }
        System.out.println("åˆ é™¤æˆåŠŸï¼");
    }
    @Override
    public void updateAll() {
        try {
            Thread.sleep(500);
        } catch (Exception e) {
            e.printStackTrace();
        }
        System.out.println("æ›´æ–°æˆåŠŸï¼");
    }
}
```

ä»£ç†ç±»ï¼šå¸®åŠ©æˆ‘ä»¬åšä¸€ä¸ªè¢«ä»£ç†çš„ä¸šåŠ¡å¯¹è±¡è¿”å›ã€‚
java.lang.reflect.Proxyï¼šè¿™æ˜¯ Java åŠ¨æ€ä»£ç†æœºåˆ¶çš„ä¸»ç±»ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•æ¥ä¸ºä¸€ç»„æ¥å£çš„å®ç°ç±»åŠ¨æ€åœ°ç”Ÿæˆä»£ç†ç±»åŠå…¶å¯¹è±¡ã€‚
**public static Object newProxyInstance(ClassLoader loader,Class[] interfaces, InvocationHandler h)**
    å‚æ•°ä¸€ï¼šç±»åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½åˆ°æ—¶å€™åšå¥½çš„ä¸šåŠ¡ä»£ç†å¯¹è±¡ï¼
    å‚æ•°äºŒï¼šè¢«ä»£ç†ä¸šåŠ¡å¯¹è±¡çš„**å…¨éƒ¨å®ç°çš„æ¥å£**ï¼Œä»¥ä¾¿ä»£ç†å¯¹è±¡å¯ä»¥çŸ¥é“è¦ä¸ºå“ªäº›æ–¹æ³•åšä»£ç†ã€‚
	å‚æ•°ä¸‰ï¼šä»£ç†çœŸæ­£çš„æ‰§è¡Œæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä»£ç†çš„å¤„ç†é€»è¾‘ï¼

```java
public class ProxyUtil {
     //åšä¸€ä¸ªè¢«ä»£ç†çš„ä¸šåŠ¡å¯¹è±¡è¿”å›!
    public static <T> T getProxy(Object obj) {
        return (T) Proxy.newProxyInstance(obj.getClass().getClassLoader(),
                obj.getClass().getInterfaces(), new InvocationHandler() {
                    @Override
                    public Object invoke(Object proxy, Method method, Object[]
                                         params) throws Throwable {
                        // proxy : ä¸šåŠ¡ä»£ç†å¯¹è±¡æœ¬èº«ã€‚ç”¨ä¸åˆ°
                        // method: ä»£è¡¨å½“å‰æ­£åœ¨è¢«ä»£ç†æ‰§è¡Œçš„æ–¹æ³•ï¼ï¼
                        // params: ä»£è¡¨çš„æ˜¯æ‰§è¡Œæ–¹æ³•çš„å‚æ•°ï¼Œæ•°ç»„çš„å½¢å¼!
                        long startTime = System.currentTimeMillis();

                        // çœŸæ­£è§¦å‘çœŸå®çš„æ–¹æ³•æ‰§è¡Œ
                        Object rs = method.invoke(obj,params);

                        long endTime = System.currentTimeMillis();
                     	sout(method.getName()+"æ–¹æ³•è€—æ—¶ï¼š"+
                     				 (endTime - startTime)/1000.0+"s");
                        return rs; // è¿”å›æ–¹æ³•æ‰§è¡Œçš„ç»“æœï¼ï¼
                    }
                });
    }
}
```



***



## å·¥å‚æ¨¡å¼

å·¥å‚è®¾è®¡æ¨¡å¼ï¼š

* å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰æ˜¯ Java ä¸­æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€

* è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼

* ä»¥å‰æˆ‘ä»¬åˆ›å»ºç±»å¯¹è±¡æ—¶, éƒ½æ˜¯ä½¿ç”¨new å¯¹è±¡çš„å½¢å¼åˆ›å»º,ï¼Œé™¤new å¯¹è±¡æ–¹å¼ä»¥å¤–ï¼Œå·¥å‚æ¨¡å¼ä¹Ÿå¯ä»¥åˆ›å»ºå¯¹è±¡

å·¥å‚è®¾è®¡æ¨¡å¼çš„ä½œç”¨ï¼š

* å¯¹è±¡é€šè¿‡å·¥å‚çš„æ–¹æ³•åˆ›å»ºè¿”å›ï¼Œå·¥å‚çš„æ–¹æ³•å¯ä»¥ä¸ºè¯¥å¯¹è±¡è¿›è¡ŒåŠ å·¥å’Œæ•°æ®æ³¨å…¥ã€‚
* å¯ä»¥å®ç°ç±»ä¸ç±»ä¹‹é—´çš„è§£è€¦æ“ä½œï¼ˆæ ¸å¿ƒæ€æƒ³ï¼Œé‡ç‚¹ï¼‰ 

ä¼˜ç‚¹ï¼šå·¥å‚æ¨¡å¼çš„å­˜åœ¨å¯ä»¥æ”¹å˜åˆ›å»ºå¯¹è±¡çš„æ–¹å¼,è§£å†³ç±»ä¸ç±»ä¹‹é—´çš„**è€¦åˆ**ã€‚
ç¼ºç‚¹ï¼šå·¥å‚è®¾è®¡æ¨¡å¼å¤šäº†ä¸€ä¸ªå·¥å‚ç±»ï¼ï¼ï¼

```java
public class FactoryDemo {
    public static void main(String[] args) {
        Animal a = FactoryPattern.createAniaml();
        a.run();
    }
}
// å·¥å‚è®¾è®¡æ¨¡å¼
public class FactoryPattern {
    // ç”Ÿäº§å¯¹è±¡çš„æ–¹æ³•ï¼šå·¥å‚æ–¹æ³•
    public static Animal createAniaml(){
        return new Dog();
    }
}

public abstract class Animal {
    public abstract void run();
}
public class Cat extends Animal {
    @Override
    public void run() {
        System.out.println("çŒ«è·‘çš„è´¼æºœ~~~~");
    }
}
public class Dog extends Animal {
    @Override
    public void run() {
        System.out.println("ç‹—è·‘çš„ä¹Ÿè´¼æºœ~~~~");
    }
}
```



***



## è£…é¥°æ¨¡å¼

è£…é¥°æ¨¡å¼æŒ‡çš„æ˜¯åœ¨ä¸æ”¹å˜åŸç±», åŠ¨æ€åœ°æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ã€‚
æ€æƒ³ï¼šæ˜¯åˆ›å»ºä¸€ä¸ªæ–°ç±»ï¼ŒåŒ…è£…åŸå§‹ç±»ï¼Œä»è€Œåœ¨æ–°ç±»ä¸­æå‡åŸæ¥ç±»çš„åŠŸèƒ½ï¼ï¼

è£…é¥°æ¨¡å¼å¯ä»¥åœ¨ä¸æ”¹å˜åŸç±»çš„åŸºç¡€ä¸Šå¯¹ç±»ä¸­çš„æ–¹æ³•è¿›è¡Œæ‰©å±•å¢å¼º,å®ç°åŸåˆ™ä¸º:
		1.å®šä¹‰çˆ¶ç±»ã€‚
		2.å®šä¹‰åŸå§‹ç±»ï¼Œç»§æ‰¿çˆ¶ç±»ï¼Œå®šä¹‰åŠŸèƒ½ã€‚
		3.å®šä¹‰è£…é¥°ç±»ï¼Œç»§æ‰¿çˆ¶ç±»ï¼ŒåŒ…è£…åŸå§‹ç±»ï¼Œå¢å¼ºåŠŸèƒ½ï¼ï¼

```java
public class Demo {
    public static void main(String[] args) {
        InputStream is = new BufferedInputStrem(new FileInputStream());
        is.read();
        is.close();
    }
}
public abstract class InputStream {
    public abstract void read();
    public abstract void close();
}
public class FileInputStream extends InputStream {
    @Override
    public void read() {
        System.out.println("è¯»å–æ•°æ®~~~");
    }

    @Override
    public void close() {
        System.out.println("å…³é—­æµ~~~");
    }
}
// è£…é¥°æ¨¡å¼ï¼æå‡åŸå§‹åŠŸèƒ½ï¼ï¼ï¼
public class BufferedInputStrem extends InputStream {
    private InputStream is ;
    public BufferedInputStrem(InputStream is){
        this.is = is;
    }
    @Override
    public void read() {
        System.out.println("å¼€å¯é«˜æ•ˆç¼“å†²è¯»å–~");
        is.read();
    }
    @Override
    public void close() {
        is.close();
    }
}
```





***





# JUC





















